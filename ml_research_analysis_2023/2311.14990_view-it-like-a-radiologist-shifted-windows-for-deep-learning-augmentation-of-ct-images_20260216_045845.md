---
ver: rpa2
title: 'View it like a radiologist: Shifted windows for deep learning augmentation
  of CT images'
arxiv_id: '2311.14990'
source_url: https://arxiv.org/abs/2311.14990
tags:
- images
- liver
- augmentation
- window
- intensity
- transformers
- self-attention
- retrieval-augmented-generation
- instruction-tuning
- parameter-efficient-finetuning
- mixture-of-experts
- chain-of-thought
core_contribution: The paper introduces "window shifting," a preprocessing and intensity
  augmentation method for deep learning segmentation of contrast-enhanced CT images.
  The method dynamically adjusts viewing windows during training, inspired by radiologists'
  practices, to improve model robustness to poorly timed contrast.
---

# View it like a radiologist: Shifted windows for deep learning augmentation of CT images

## Quick Facts
- arXiv ID: 2311.14990
- Source URL: https://arxiv.org/abs/2311.14990
- Reference count: 0
- Primary result: Window shifting augmentation improves liver lesion segmentation in contrast-enhanced CT images

## Executive Summary
This paper introduces "window shifting," a preprocessing and intensity augmentation method for deep learning segmentation of contrast-enhanced CT images. The method dynamically adjusts viewing windows during training, inspired by radiologists' practices, to improve model robustness to poorly timed contrast. It outperforms classical intensity augmentations and nn-UNet's pipeline on liver lesion segmentation tasks, showing better performance and generalization, especially on difficult cases with low contrast.

## Method Summary
The method introduces window shifting as a preprocessing and intensity augmentation technique specifically designed for contrast-enhanced CT images. It dynamically adjusts the viewing window during training by sampling from a range of intensity clipping levels based on per-volume median HU distributions. Unlike traditional augmentations that treat preprocessed images as natural images, window shifting respects the physical meaning of CT intensities while providing robust augmentation. The approach is integrated into standard segmentation pipelines like DeepLabv3+ with ResNet50 backbone and shows improved performance on liver lesion segmentation tasks.

## Key Results
- Window shifting improves liver lesion segmentation dice scores compared to classical intensity augmentations
- The method shows better generalization to difficult cases with low contrast between tumor and liver tissue
- Outperforms nn-UNet's standard preprocessing pipeline on transfer datasets (Hepatic Vessels and UNN)

## Why This Works (Mechanism)

### Mechanism 1
- Claim: Randomly shifting viewing windows during training improves model robustness to poorly timed contrast in CT images.
- Mechanism: By dynamically adjusting the intensity clipping range during training, the model is exposed to a wider distribution of HU intensities that mimic the variability seen in real clinical scenarios.
- Core assumption: The liver lesion segmentation task benefits from learning representations that are robust to intensity variations caused by different contrast timings.
- Evidence anchors:
  - [abstract] The method "improves liver lesion segmentation performance and robustness on images with poorly timed contrast agent."
  - [section 3.3] "When applying the viewing window during preprocessing, much of the image's original intensity distribution is removed."

### Mechanism 2
- Claim: Window shifting respects the physical properties of CT imaging, unlike standard intensity augmentations.
- Mechanism: Traditional augmentations like brightness and contrast adjustments are applied to preprocessed images, which can distort the meaningful HU values. Window shifting is applied during preprocessing, maintaining the physical meaning of intensities while still providing augmentation.
- Core assumption: Maintaining the physical meaning of HU values during augmentation is crucial for the model to learn clinically relevant features.
- Evidence anchors:
  - [abstract] "For contrast-enhanced Computed Tomography (CT) images in particular, the signals producing the voxel intensities have physical meaning, which is lost during preprocessing and augmentation when treating such images as natural images."
  - [section 3.3] "Traditional intensity augmentations applied during training often have trouble with introducing sufficient and relevant variations to such corrupted images."

### Mechanism 3
- Claim: The method improves generalization to difficult cases with low contrast between tumor and liver tissue.
- Mechanism: By exposing the model to a range of intensity distributions during training, it learns to identify lesions even when the contrast is poor. The model becomes less sensitive to the absolute intensity differences and more focused on relative features and shapes.
- Core assumption: The ability to segment lesions with low contrast is a key challenge in liver tumor segmentation, and models trained with window shifting are better equipped to handle this.
- Evidence anchors:
  - [section 4.3] "As low contrast within the liver often is due to poor timing in the contrast-enhanced CT image, we hypothesize that our clinically motivated window shifting augmentation will allow the model to generalize better to such difficult cases."
  - [section 4.3] "We report the results of this experiment in Table 2."

## Foundational Learning

- Concept: Hounsfield Units (HU) and their physical meaning in CT imaging
  - Why needed here: Understanding HU is crucial because the method leverages the physical properties of CT images, unlike standard augmentations that treat images as natural images.
  - Quick check question: What are the HU values for air and water, and why are they significant in CT imaging?

- Concept: Contrast-enhanced CT imaging and its role in liver lesion detection
  - Why needed here: The method is specifically designed for contrast-enhanced CT images, where the timing of contrast agent affects lesion visibility.
  - Quick check question: How does the timing of contrast agent injection affect the visibility of liver lesions in CT images?

- Concept: Data augmentation techniques and their impact on model generalization
  - Why needed here: The method is an augmentation technique, and understanding how augmentations improve model robustness and generalization is key to appreciating its benefits.
  - Quick check question: How do traditional intensity augmentations differ from window shifting in their effect on CT images?

## Architecture Onboarding

- Component map: Preprocessing pipeline -> Window shifting augmentation -> DeepLabv3+ with ResNet50 -> Dice coefficient evaluation

- Critical path:
  1. Analyze the dataset to determine the base viewing window (0.5 and 99.5 percentiles of foreground intensities).
  2. Calculate the range for Llow and Lhigh based on per-volume median HU distribution.
  3. Implement window shifting during training by sampling L from Uniform(Llow, Lhigh) with probability p.
  4. Train the segmentation model with geometric augmentations and window shifting.
  5. Evaluate on validation and transfer datasets, focusing on difficult cases with low contrast.

- Design tradeoffs:
  - Using a dynamic window during training vs. a fixed window: Dynamic window improves robustness but adds complexity.
  - Probability p of applying window shifting: Higher p increases diversity but may slow convergence.
  - Range of L sampling: Too wide a range may introduce unrealistic variations; too narrow may not provide sufficient augmentation.

- Failure signatures:
  - Poor performance on validation data: May indicate incorrect window range or probability p.
  - Overfitting to training data: Could suggest insufficient augmentation or too small a dataset.
  - Failure to improve on difficult cases: Might mean the window shifting range is not aligned with the low-contrast scenarios in the data.

- First 3 experiments:
  1. Implement window shifting with a fixed p=0.3 and analyze the effect on validation dice scores.
  2. Vary p (e.g., 0.1, 0.5, 0.7) to find the optimal probability that balances performance and robustness.
  3. Test different ranges for L sampling by adjusting Llow and Lhigh percentiles to see their impact on segmentation of low-contrast cases.

## Open Questions the Paper Calls Out

### Open Question 1
- Question: How does window shifting affect model performance on contrast-enhanced CT images from modalities other than liver imaging (e.g., brain, lung, or abdominal organs other than liver)?
- Basis in paper: [inferred] The paper demonstrates window shifting's effectiveness for liver lesion segmentation but notes potential applicability to other medical imaging domains.
- Why unresolved: The study focuses solely on liver CT images; no experiments were conducted on other anatomical regions or modalities.
- What evidence would resolve it: Comparative experiments applying window shifting to CT datasets from other organs or imaging modalities, with performance metrics against standard augmentations.

### Open Question 2
- Question: What is the optimal probability p for applying window shifting during training to maximize performance without overfitting?
- Basis in paper: [explicit] The paper uses p = 0.3 for window shifting but does not explore sensitivity to this hyperparameter.
- Why unresolved: The study uses a fixed probability without ablation studies to determine its impact on model robustness or convergence.
- What evidence would resolve it: Systematic experiments varying p across a range (e.g., 0.1 to 0.9) and evaluating segmentation performance and generalization.

### Open Question 3
- Question: How does window shifting compare to domain-specific intensity augmentations for other medical imaging modalities, such as MRI or ultrasound?
- Basis in paper: [inferred] The paper highlights the importance of respecting physical properties of CT imaging and suggests future research for other modalities.
- Why unresolved: The method is tailored to CT's HU-based signal model; its applicability to modalities with different intensity representations (e.g., MRI's arbitrary units) is untested.
- What evidence would resolve it: Direct comparisons of window shifting with modality-specific augmentations on MRI or ultrasound segmentation tasks, measuring Dice scores and robustness.

## Limitations
- The method's effectiveness appears highly dependent on dataset characteristics, particularly the variation in contrast timing and lesion visibility.
- The study primarily validates on liver lesion segmentation, raising questions about generalizability to other anatomical structures or imaging modalities.
- The computational overhead introduced by dynamic window sampling during training is not quantified.

## Confidence
- **High confidence**: The core claim that window shifting improves liver lesion segmentation performance on contrast-enhanced CT images is well-supported by the experimental results across multiple datasets.
- **Medium confidence**: The mechanism that window shifting respects physical properties of CT imaging better than standard augmentations is theoretically sound but lacks direct ablation studies.
- **Low confidence**: The claim that window shifting specifically improves generalization to difficult low-contrast cases needs more rigorous validation, as the "difficult cases" subset definition and sample sizes vary significantly across datasets.

## Next Checks
1. Design an experiment comparing window shifting against traditional intensity augmentations while controlling for the amount of intensity variation introduced, to directly test whether maintaining HU physical meaning provides additional benefits beyond simple intensity augmentation.

2. Apply window shifting to segmentation tasks for other anatomical structures (e.g., lung nodules, kidney tumors) with contrast-enhanced CT to test generalizability beyond liver lesions and assess whether the method's benefits are task-specific or more broadly applicable.

3. Measure and report the training time increase and GPU memory requirements when implementing window shifting compared to standard preprocessing pipelines, including profiling across different batch sizes and image resolutions to assess clinical deployment feasibility.