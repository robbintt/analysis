---
ver: rpa2
title: 'Relay Diffusion: Unifying diffusion process across resolutions for image synthesis'
arxiv_id: '2309.03350'
source_url: https://arxiv.org/abs/2309.03350
tags:
- noise
- diffusion
- images
- block
- frequency
- transformers
- self-attention
- retrieval-augmented-generation
- instruction-tuning
- parameter-efficient-finetuning
- mixture-of-experts
- chain-of-thought
core_contribution: Relay Diffusion (RDM) addresses the challenge of generating high-resolution
  images with diffusion models by analyzing the frequency domain characteristics of
  noise across resolutions. The key insight is that the same noise level has different
  effects on low vs.
---

# Relay Diffusion: Unifying diffusion process across resolutions for image synthesis

## Quick Facts
- arXiv ID: 2309.03350
- Source URL: https://arxiv.org/abs/2309.03350
- Reference count: 19
- Primary result: Achieves state-of-the-art FID of 3.15 on CelebA-HQ 256x256 and 1.87 on ImageNet 256x256

## Executive Summary
Relay Diffusion (RDM) introduces a novel approach to high-resolution image synthesis using diffusion models by analyzing noise characteristics in the frequency domain. The key insight is that the same noise level has different effects on low vs. high-resolution images, leading to suboptimal noise schedules when scaling up. RDM bridges this gap using block noise and patch-wise blurring diffusion, enabling seamless transfer of low-resolution images or noise to high-resolution equivalents. This eliminates the need for low-resolution conditioning and achieves state-of-the-art performance on standard benchmarks while improving training efficiency.

## Method Summary
RDM builds on the EDM framework and introduces a cascaded pipeline for high-resolution image synthesis. The core innovation involves block noise generation and patch-wise blurring diffusion to bridge the resolution gap. Block noise correlates nearby pixel noise values in a kernel-sized window, creating frequency characteristics similar to lower-resolution independent Gaussian noise. Patch-wise blurring diffusion applies heat dissipation independently to each patch corresponding to the upsampling scale, allowing continuation of the diffusion process across resolution boundaries. The method eliminates low-resolution conditioning and achieves state-of-the-art FID scores while improving training efficiency.

## Key Results
- Achieves state-of-the-art FID of 3.15 on CelebA-HQ 256x256
- Achieves state-of-the-art FID of 1.87 on ImageNet 256x256 with classifier-free guidance
- Surpasses previous methods like ADM, LDM, and DiT by a large margin

## Why This Works (Mechanism)

### Mechanism 1
- Claim: High-resolution images require different noise schedules than low-resolution images due to frequency domain characteristics.
- Mechanism: The same noise level has different Signal-to-Noise Ratios (SNR) in the frequency domain when applied to different resolutions. Higher resolution images maintain higher SNR in low-frequency regions under the same noise level, making standard noise schedules suboptimal.
- Core assumption: Natural images have similar frequency characteristics across resolutions, and noise affects different frequency bands proportionally.
- Evidence anchors:
  - [abstract] "the same noise level on a higher resolution results in a higher Signal-to-Noise Ratio in the frequency domain"
  - [section] "the same noise level on a higher resolution results in a higher SNR in the (low-frequency part of) the frequency domain"
  - [corpus] Weak - related papers focus on high-resolution synthesis but don't specifically analyze frequency domain SNR characteristics
- Break condition: If image distributions have fundamentally different frequency characteristics across resolutions, or if noise scheduling can be made resolution-independent through other means.

### Mechanism 2
- Claim: Block noise can bridge the gap between low and high-resolution noise characteristics.
- Mechanism: Block noise correlates nearby pixel noise values in a kernel-sized window, creating a frequency spectrum similar to independent Gaussian noise at lower resolutions. This allows seamless transfer between resolution stages.
- Core assumption: The frequency spectrum of block noise with appropriate kernel size approximates that of lower-resolution independent Gaussian noise.
- Evidence anchors:
  - [section] "The block noise with kernel size s = 4 on 256 × 256 has a similar frequency spectrum as the independent Gaussian noise on 64 × 64 images"
  - [section] "block noise can corrupt the low-frequency components of images more easily"
  - [corpus] Weak - corpus papers don't discuss block noise as a solution for resolution bridging
- Break condition: If the block noise kernel size cannot be optimized for different resolution pairs, or if the approximation breaks down for certain image types.

### Mechanism 3
- Claim: Patch-wise blurring diffusion enables continuation of the diffusion process across resolution boundaries.
- Mechanism: By applying blurring diffusion independently to each patch corresponding to the upsampling scale, RDM can continue the diffusion process from where the previous stage left off, rather than restarting from pure noise.
- Core assumption: The upsampled low-resolution image contains sufficient information for patch-wise blurring to produce a valid starting point for high-resolution generation.
- Evidence anchors:
  - [section] "we propose to implement the heat dissipation on each 4 × 4 patch independently"
  - [section] "RDM considers the equivalence of the low-resolution generated images when upsampled to high resolution"
  - [corpus] Weak - corpus papers focus on training-free or alternative high-resolution methods, not patch-wise continuation
- Break condition: If the patch-wise approximation introduces artifacts that cannot be corrected in subsequent steps, or if the blurring process loses too much high-frequency information.

## Foundational Learning

- Concept: Discrete Cosine Transform (DCT) and frequency domain analysis
  - Why needed here: Understanding how images are represented in frequency space is crucial for analyzing noise characteristics and designing block noise
  - Quick check question: What is the mathematical relationship between spatial and frequency domain representations of images, and how does this affect noise perception?

- Concept: Markov Chain Monte Carlo and diffusion process formulations
  - Why needed here: The paper builds on EDM framework and requires understanding of forward/reverse diffusion processes
  - Quick check question: How does the noise schedule affect the forward diffusion process, and what guarantees convergence in the reverse process?

- Concept: Signal-to-Noise Ratio (SNR) analysis and power spectral density
  - Why needed here: The core insight about resolution-dependent noise effects relies on SNR analysis in frequency domain
  - Quick check question: How does SNR vary across frequency bands for different noise types, and what implications does this have for perceptual quality?

## Architecture Onboarding

- Component map: Input image → DCT → Noise addition (block + Gaussian) → UNet denoiser → Inverse DCT → Output image
- Critical path: Input image → DCT → Noise addition (block + Gaussian) → UNet denoiser → Inverse DCT → Output image
- Design tradeoffs: Block noise vs independent Gaussian noise (frequency characteristics vs implementation complexity), patch-wise vs full blurring (computational efficiency vs accuracy)
- Failure signatures: Artifacts at patch boundaries, inconsistent frequency characteristics between stages, poor convergence during training
- First 3 experiments:
  1. Visualize frequency spectra of images with different noise types at various resolutions to verify block noise approximation
  2. Implement and test patch-wise blurring diffusion on synthetic data to validate continuation property
  3. Compare training curves and FID scores with/without block noise and patch-wise blurring to isolate their effects

## Open Questions the Paper Calls Out

### Open Question 1
- Question: What is the optimal noise schedule for high-resolution diffusion models, and how does it depend on model architecture and data distribution?
- Basis in paper: [explicit] The authors mention that "the optimal noise schedule is also be related to the size of the model, inductive bias, and the nuanced distribution characteristics of the data" and that their attempts to derive it "did not yield good results."
- Why unresolved: Previous work has shown noise schedules are resolution-dependent, but finding the optimal schedule for specific architectures and datasets remains challenging. The authors' attempts suggest it's a complex optimization problem.
- What evidence would resolve it: Empirical results showing improved performance with optimized noise schedules across different architectures, resolutions, and datasets. A theoretical framework explaining the relationship between noise schedule, model capacity, and data characteristics.

### Open Question 2
- Question: How does the block noise kernel size affect the quality and diversity of generated images, and what is the optimal kernel size for different resolutions and datasets?
- Basis in paper: [explicit] The authors introduce block noise as a way to bridge the gap between low and high-resolution noise, but note it as a hyperparameter that may need tuning.
- Why unresolved: The authors use a fixed kernel size of 4 in their experiments, but don't explore the effects of different kernel sizes or provide guidance on how to choose it for different scenarios.
- What evidence would resolve it: Systematic experiments varying kernel sizes and measuring their impact on FID, diversity metrics, and perceptual quality across different resolutions and datasets. An analysis of the frequency domain effects of different kernel sizes.

### Open Question 3
- Question: What is the optimal allocation of computational resources between low and high-resolution stages in cascaded diffusion models?
- Basis in paper: [explicit] The authors mention that "with more NFE allocated in the first stage, RDM achieves a better FID" and compare different allocation strategies in their experiments.
- Why unresolved: The optimal allocation likely depends on the specific architecture, dataset, and computational constraints, but the authors only explore a limited range of allocations.
- What evidence would resolve it: A comprehensive study varying the allocation of computational resources (e.g., model size, training iterations, sampling steps) between stages and measuring the impact on quality, efficiency, and overall performance. Guidelines for choosing optimal allocations based on different scenarios.

## Limitations

- The frequency domain analysis relies on assumptions about natural images sharing similar frequency characteristics across resolutions, which may not hold for structured or synthetic content.
- The computational overhead of block noise generation and patch-wise blurring diffusion is not thoroughly discussed, raising questions about practical deployment efficiency.
- The SNR analysis lacks comprehensive ablation studies on the frequency approximation error between block noise and independent Gaussian noise across different resolutions and image types.

## Confidence

**High Confidence**: The empirical performance improvements on standard benchmarks (FID scores on CelebA-HQ and ImageNet) are well-supported by quantitative results.

**Medium Confidence**: The frequency domain analysis and block noise approximation mechanism are theoretically sound but rely on assumptions that need more rigorous validation.

**Low Confidence**: The claim that RDM achieves "state-of-the-art" performance with "significantly improved" training efficiency is based on comparisons with specific baselines but lacks broader benchmarking across the full landscape of high-resolution diffusion methods.

## Next Checks

1. **Frequency Spectrum Validation**: Generate and visualize the frequency spectra of block noise with different kernel sizes versus independent Gaussian noise at various resolutions to quantify the approximation error across different image types.

2. **Patch Boundary Analysis**: Conduct controlled experiments measuring artifacts at patch boundaries when using different patch sizes and overlapping strategies, particularly for images with high-frequency content like textures and edges.

3. **Cross-Resolution Generalization**: Test RDM's performance on datasets with fundamentally different frequency characteristics (e.g., medical images, satellite imagery, or synthetic patterns) to assess the generalizability of the frequency-based approach beyond natural images.