---
ver: rpa2
title: Analyzing domain shift when using additional data for the MICCAI KiTS23 Challenge
arxiv_id: '2309.02001'
source_url: https://arxiv.org/abs/2309.02001
tags:
- data
- training
- distribution
- dataset
- images
- transformers
- self-attention
- retrieval-augmented-generation
- instruction-tuning
- parameter-efficient-finetuning
- mixture-of-experts
- chain-of-thought
core_contribution: This paper analyzes techniques to mitigate domain shift when using
  additional training data from a different source for the KiTS23 kidney tumor segmentation
  challenge. The core idea is to preprocess the additional KiPA22 data to reduce distribution
  mismatch with the target KiTS23 data.
---

# Analyzing domain shift when using additional data for the MICCAI KiTS23 Challenge

## Quick Facts
- arXiv ID: 2309.02001
- Source URL: https://arxiv.org/abs/2309.02001
- Reference count: 9
- Primary result: Histogram matching KiPA22 data to match KiTS23 distribution achieves 95.45% Dice for kidney+tumor, 80.76% for tumor, 94.02% for kidney, and 20.77% for cyst on KiTS23 validation set

## Executive Summary
This paper addresses domain shift challenges when using additional training data (KiPA22) from a different source for the KiTS23 kidney tumor segmentation challenge. The authors propose histogram matching as a preprocessing technique to transform the KiPA22 data distribution to match the KiTS23 target distribution. Their 3D U-Net model trained on histogram-matched additional data achieves strong performance across multiple segmentation tasks, with particular improvement in kidney and tumor segmentation metrics compared to simple normalization approaches.

## Method Summary
The method involves preprocessing KiPA22 data using histogram matching to align its distribution with KiTS23, followed by training a 3D U-Net model with region-based learning targets. The model uses patch size 128x128x128, batch size 2, and trains for 1000 epochs with data augmentation including rotation, scaling, and various image transformations. The approach combines the preprocessed KiPA22 data with KiTS23 training data and employs separate loss functions for kidney+tumor+cyst, tumor+cyst, and tumor-only segmentation tasks.

## Key Results
- Histogram matching outperforms simple normalization across all evaluation metrics
- Kidney+tumor segmentation achieves 95.45% Dice score
- Tumor segmentation achieves 80.76% Dice score
- Cyst segmentation remains challenging at 20.77% Dice score

## Why This Works (Mechanism)

### Mechanism 1
- Histogram matching better aligns the KiPA22 data distribution with KiTS23 than simple mean/std shifting
- Transforms pixel value histograms of KiPA22 to match those of KiTS23, forcing distributions to overlap completely
- Core assumption: Matching full distribution shape is more important than aligning means and variances
- Evidence: Results show histogram matching gives better results across all metrics compared to normalization

### Mechanism 2
- Preprocessing only the additional dataset reduces domain shift without corrupting the original KiTS23 distribution
- KiPA22 images are preprocessed in isolation, preserving KiTS23 distribution while transforming KiPA22 to match it
- Core assumption: Target domain distribution should remain unchanged; only source domain needs adaptation
- Evidence: Paper chooses to transform KiPA images because test data is expected to match original KiTS distribution

### Mechanism 3
- Region-based training improves segmentation accuracy for each anatomical structure
- Training separate models for kidney+tumor+cyst, tumor+cyst, and tumor separately allows direct optimization of each region's Dice score
- Core assumption: Multi-task training with separate loss functions improves overall segmentation quality
- Evidence: This approach directly optimizes official evaluation metrics

## Foundational Learning

- **Domain adaptation and domain shift**
  - Why needed: The paper addresses using data from different distributions (KiPA22 vs KiTS23) for training
  - Quick check: What is the difference between domain adaptation and domain generalization?

- **Histogram matching**
  - Why needed: Key preprocessing technique that transforms KiPA22 data to match KiTS23 distribution
  - Quick check: How does histogram matching differ from simple normalization?

- **3D U-Net architecture**
  - Why needed: Proposed method uses 3D U-Net for kidney and tumor segmentation
  - Quick check: What are the key components of a 3D U-Net architecture?

## Architecture Onboarding

- **Component map**: KiTS23 CT images + KiPA22 CT images (histogram matched) -> 3D U-Net -> Segmentation masks (kidney, tumor, cyst)
- **Critical path**: Preprocess KiPA22 with histogram matching -> Combine with KiTS23 data -> Train 3D U-Net with region-based targets -> Validate on KiTS23 validation set
- **Design tradeoffs**: Histogram matching vs. simple normalization (better distribution alignment vs. preserving original data characteristics); region-based training vs. single model (optimized metrics vs. computational efficiency)
- **Failure signatures**: Poor performance on KiTS23 validation (histogram matching may not have properly aligned distributions); overfitting (insufficient data augmentation or regularization); class imbalance issues (cysts underrepresented)
- **First 3 experiments**: 1) Apply histogram matching to KiPA22 and compare validation Dice scores to simple normalization; 2) Train separate models for each region (kidney, tumor, cyst) and evaluate performance; 3) Experiment with different data augmentation techniques to improve generalization

## Open Questions the Paper Calls Out

### Open Question 1
- Question: What is the optimal target domain for histogram matching when the test data distribution is unknown?
- Basis: The paper assumes test data will match original KiTS distribution but this is unverified
- Why unresolved: Actual test data distribution is unknown during preprocessing
- What evidence would resolve it: Results comparing models trained with different histogram matching targets evaluated on actual test data

### Open Question 2
- Question: What preprocessing method performs best when additional data has completely different anatomical focus?
- Basis: KiPA22 contains only diseased kidneys vs KiTS23 has both kidneys
- Why unresolved: Only two preprocessing methods compared on this mismatched data
- What evidence would resolve it: Comparative study of various domain adaptation methods on similar anatomical mismatches

### Open Question 3
- Question: How can the model be improved to better distinguish between cysts and tumors?
- Basis: Dice score for cysts is low because many cysts are classified as tumors
- Why unresolved: Proposed solution of cyst-specific loss terms not implemented
- What evidence would resolve it: Experimental results showing impact of adding cyst-specific loss terms

## Limitations
- Evaluation limited to single dataset pair (KiTS23 and KiPA22), making generalizability uncertain
- Cyst class shows notably lower Dice scores (20.77%), suggesting method struggles with rare classes
- Approach relies on relatively simple distribution alignment rather than sophisticated domain adaptation methods

## Confidence
- **High**: Histogram matching improves over simple normalization for domain alignment
- **Medium**: Region-based training approach is beneficial for segmentation accuracy
- **Medium**: 3D U-Net architecture is appropriate for this segmentation task

## Next Checks
1. Test histogram matching approach on additional dataset pairs to assess generalizability beyond KiTS23/KiPA22
2. Systematically remove histogram matching to quantify its specific contribution to performance gains
3. Investigate why cyst segmentation performs poorly and test whether class weighting or oversampling could improve results