---
ver: rpa2
title: 'TraCE: Trajectory Counterfactual Explanation Scores'
arxiv_id: '2309.15965'
source_url: https://arxiv.org/abs/2309.15965
tags:
- trace
- scores
- counterfactual
- data
- score
- transformers
- self-attention
- retrieval-augmented-generation
- instruction-tuning
- parameter-efficient-finetuning
- mixture-of-experts
- chain-of-thought
core_contribution: This paper introduces TraCE (Trajectory Counterfactual Explanation)
  scores, a model-agnostic modular framework for evaluating progress in sequential
  decision-making tasks. TraCE distills complex trajectories into a single interpretable
  value between -1 and 1 by comparing each step to counterfactual examples.
---

# TraCE: Trajectory Counterfactual Explanation Scores

## Quick Facts
- arXiv ID: 2309.15965
- Source URL: https://arxiv.org/abs/2309.15965
- Authors: 
- Reference count: 40
- Key outcome: TraCE (Trajectory Counterfactual Explanation) scores provide a model-agnostic framework for evaluating progress in sequential decision-making tasks by comparing actual trajectories to counterfactual examples.

## Executive Summary
This paper introduces TraCE, a framework that distills complex sequential trajectories into interpretable scores between -1 and 1 by measuring alignment with counterfactual examples. TraCE uses angle and distance metrics at each time step to quantify how closely a trajectory follows desired paths. The framework was validated through two case studies: ICU patient outcome prediction (accuracy 0.95) where TraCE potentially detects early recovery/deterioration, and monitoring sustainable development where it quantifies alignment with Shared Socioeconomic Pathways (SSPs). For ICU patients, average TraCE scores were 0.0267 (discharged) vs -0.0097 (mortality), demonstrating its ability to differentiate outcomes.

## Method Summary
TraCE converts sequential decision-making trajectories into scalar scores by comparing each step to counterfactual examples using two metrics: angle alignment and distance traveled. The framework combines these metrics with a weighted parameter λ to produce a single interpretable score. In the ICU case study, a multi-layer perceptron classifier was trained on MIMIC-IV data (30,860 hospital stays) with 17 features, using KDTrees to generate counterfactual samples. For the SSP analysis, TraCE compared actual socioeconomic and environmental data (2015-2022) against scenario projections across countries, normalizing features at the country level.

## Key Results
- TraCE achieved 0.95 accuracy in ICU patient outcome prediction with average scores of 0.0267 for discharged patients versus -0.0097 for mortality cases
- In SSP analysis, most countries showed highest alignment with SSP5, though Poland aligned best with SSP4
- TraCE scores can potentially detect early trajectory changes before classifier probabilities reflect them, as demonstrated in the ICU case study
- The framework provides a simple scalar value that enables comparison of complex multi-dimensional trajectories across different scenarios

## Why This Works (Mechanism)

### Mechanism 1
- Claim: TraCE distills complex sequential trajectories into a single interpretable score between -1 and 1 by measuring alignment with counterfactual examples.
- Mechanism: TraCE calculates angle and distance metrics at each time step, combining them into S(xt, x't) = λR1(xt, x't) + (1-λ)R2(xt, x't) where λ weights angle vs distance importance.
- Core assumption: Counterfactual examples are meaningful and available for each time step.
- Evidence anchors:
  - [abstract] "TraCE distills complex trajectories into a single interpretable value between -1 and 1 by comparing each step to counterfactual examples."
  - [section] "We then combine Equations 2 and 4 into a single score: S(xt, x't) = λR1(xt, x't) + (1-λ)R2(xt, x't)"
  - [corpus] Weak - no direct evidence in corpus papers about this specific combination mechanism
- Break condition: If counterfactual examples are not meaningful or cannot be generated, the alignment measurement becomes meaningless.

### Mechanism 2
- Claim: TraCE scores can detect early changes in trajectory before they're reflected in classifier probabilities.
- Mechanism: By comparing the true trajectory to counterfactual trajectories at each step, TraCE captures directional alignment that may precede changes in classification outcomes.
- Core assumption: Changes in trajectory alignment precede changes in classifier predictions for the given domain.
- Evidence anchors:
  - [section] "The TraCE score begins to increase prior to the patient's improved health being reflected in the classifier probabilities."
  - [corpus] Weak - corpus papers focus on counterfactual explanations but don't discuss early trajectory detection
- Break condition: If classifier predictions are already highly sensitive to changes, TraCE may not provide additional early warning capability.

### Mechanism 3
- Claim: TraCE enables comparison of complex multi-dimensional development trajectories across different scenarios or countries.
- Mechanism: By converting complex time series data into a single TraCE score for each scenario, TraCE allows easy comparison of alignment between observed data and different scenario projections.
- Core assumption: The multi-dimensional data can be meaningfully reduced to a single scalar value without losing critical information for the comparison task.
- Evidence anchors:
  - [section] "TraCE quantifies the development sustainability of different countries, relative to the established SSP scenarios, with a view to monitoring alignment with the development trajectories to date."
  - [corpus] Weak - corpus papers discuss counterfactual explanations but not multi-dimensional trajectory comparison across scenarios
- Break condition: If the multi-dimensional data contains conflicting signals that cannot be meaningfully reduced to a single score, the comparison becomes misleading.

## Foundational Learning

- Concept: Counterfactual explanations
  - Why needed here: TraCE is fundamentally built on comparing actual trajectories to counterfactual (alternative) trajectories to measure progress.
  - Quick check question: What is the difference between a factual and counterfactual in the context of machine learning predictions?

- Concept: Sequential decision making
  - Why needed here: TraCE operates on sequences of decisions/steps rather than single decisions, requiring understanding of how trajectories evolve over time.
  - Quick check question: How does sequential decision making differ from single-step decision making in terms of evaluation metrics?

- Concept: Inner product and angle calculation in vector spaces
  - Why needed here: TraCE uses normalized dot products to calculate angles between trajectory vectors, which is fundamental to its scoring mechanism.
  - Quick check question: What is the range of values for the cosine of the angle between two vectors?

## Architecture Onboarding

- Component map: KDTree counterfactual generation -> Angle and distance calculation -> Weighted score combination -> Evaluation and visualization
- Critical path: For each time step: generate counterfactuals → calculate R1 (angle) and R2 (distance) → combine into S score → aggregate or visualize results
- Design tradeoffs: λ weighting balances sensitivity to direction vs magnitude of change; equal weighting (λ=0.5) treats both equally, while λ>0.5 emphasizes directional alignment
- Failure signatures: Low variance in TraCE scores across time steps may indicate either stable trajectory or inappropriate counterfactuals; negative scores indicate movement away from goals
- First 3 experiments:
  1. Implement TraCE on a simple 2D synthetic dataset with known optimal trajectories to verify scoring behavior
  2. Test TraCE sensitivity to λ parameter by comparing scores across different weightings on the same trajectory
  3. Compare TraCE scores with classifier probabilities on a time-series classification task to validate early detection capability

## Open Questions the Paper Calls Out

### Open Question 1
- Question: How can TraCE scores be adapted to account for the feasibility and practicality of counterfactual trajectories in clinical settings?
- Basis in paper: [explicit] The paper mentions that TraCE enables determination of the optimal vector for any single time point to maximize the TraCE score, which could be applied prospectively to suggest optimal actions for current ICU patients. It also notes that clinicians can specify desirable and undesirable counterfactual targets personalized for a given patient.
- Why unresolved: While the paper demonstrates the potential of TraCE in clinical settings, it does not address how to ensure that the suggested counterfactual trajectories are actually feasible or practical for patients to follow given their medical constraints.
- What evidence would resolve it: A study comparing TraCE-suggested interventions with clinically feasible interventions and measuring patient outcomes could demonstrate whether TraCE can effectively account for feasibility constraints.

### Open Question 2
- Question: How does the choice of weighting parameter λ in the TraCE formula affect the interpretation and utility of the scores across different applications?
- Basis in paper: [explicit] The paper states that λ ∈ [0, 1] is a weight which can be either a scalar value or a function, and that λ > 1/2 implies we care more about the trajectory angle than the distance traveled. It also mentions that different weighting schemes will yield distinct results and should be developed in accordance with the priorities and specific questions of the user.
- Why unresolved: The paper demonstrates the use of λ = 0.9 in both case studies but does not explore how varying this parameter affects the TraCE scores or their interpretability. It also does not provide guidance on how to choose λ based on the specific application or domain.
- What evidence would resolve it: A sensitivity analysis of TraCE scores to different values of λ across various applications and domains would show how the choice of λ impacts the scores and their usefulness.

### Open Question 3
- Question: How can TraCE be extended to handle multivariate time series with complex dependencies between features?
- Basis in paper: [inferred] The paper applies TraCE to univariate time series in the ICU case study (17 features) and to aggregated monthly mean values in the SSP case study. However, it does not address how to handle complex dependencies between features in multivariate time series data.
- Why unresolved: Real-world multivariate time series often exhibit complex dependencies between features, which can impact the trajectory and counterfactuals. The current formulation of TraCE does not explicitly account for these dependencies, potentially limiting its applicability to more complex scenarios.
- What evidence would resolve it: A case study applying TraCE to a multivariate time series with known feature dependencies and comparing the results to alternative methods that explicitly model these dependencies would demonstrate the effectiveness of TraCE in handling complex multivariate data.

## Limitations

- TraCE's effectiveness depends heavily on the quality and availability of meaningful counterfactual examples, which may not be available in all domains
- The framework reduces complex multi-dimensional trajectories to a single scalar score, potentially losing critical information when different dimensions have conflicting signals
- The optimal selection of the λ weighting parameter is not thoroughly explored, and its sensitivity across different applications remains unclear

## Confidence

- ICU accuracy claim: Medium
- Early detection capability: Low
- SSP alignment analysis: Medium

## Next Checks

1. Test TraCE on a synthetic dataset with known optimal trajectories and varying noise levels to quantify robustness and sensitivity to λ parameter selection across different scenarios.

2. Compare TraCE scores against established trajectory analysis methods (e.g., Dynamic Time Warping, Fréchet distance) on benchmark time series datasets to validate its effectiveness in capturing meaningful trajectory differences.

3. Conduct a sensitivity analysis varying the number of counterfactual examples per time step (n>3) and the distance threshold for KDTree sampling to determine how these hyperparameters affect TraCE score stability and interpretability.