---
ver: rpa2
title: 'FheFL: Fully Homomorphic Encryption Friendly Privacy-Preserving Federated
  Learning with Byzantine Users'
arxiv_id: '2306.05112'
source_url: https://arxiv.org/abs/2306.05112
tags: []
core_contribution: This paper presents FheFL, a fully homomorphic encryption-based
  approach for privacy-preserving federated learning that simultaneously addresses
  privacy leakage and data poisoning attacks. The core innovation is a distributed
  multi-key additive homomorphic encryption scheme based on CKKS that enables secure
  model aggregation without requiring two non-colluding servers or user-to-user communication.
---

# FheFL: Fully Homomorphic Encryption Friendly Privacy-Preserving Federated Learning with Byzantine Users

## Quick Facts
- **arXiv ID**: 2306.05112
- **Source URL**: https://arxiv.org/abs/2306.05112
- **Reference count**: 35
- **Key outcome**: Privacy-preserving federated learning using distributed multi-key CKKS FHE with weighted aggregation that mitigates data poisoning attacks

## Executive Summary
This paper presents FheFL, a fully homomorphic encryption-based approach for privacy-preserving federated learning that simultaneously addresses privacy leakage and data poisoning attacks. The core innovation is a distributed multi-key additive homomorphic encryption scheme based on CKKS that enables secure model aggregation without requiring two non-colluding servers or user-to-user communication. The authors develop a non-poisoning rate-based weighted aggregation scheme that mitigates poisoning attacks in the encrypted domain by assigning lower weights to model updates with high Euclidean distance from the global model. Experimental results on MNIST dataset with 100 users (20 malicious) demonstrate comparable accuracy to FedAvg (98.78% vs 98.68%) while successfully mitigating label-flipping attacks.

## Method Summary
FheFL modifies the CKKS fully homomorphic encryption scheme to support distributed multi-key operations, enabling each user to encrypt their model updates using a shared secret key. The server aggregates these encrypted updates using homomorphic addition and decrypts the result using the sum of all users' shared secret keys. A non-poisoning rate-based weighted aggregation scheme is employed where the server calculates the squared Euclidean distance between each user's model update and the global model from the previous iteration. This distance is used to compute a non-poisoning rate for each user, which scales down the contribution of potentially malicious users to the global model. The scheme eliminates the need for two non-colluding servers and preserves privacy even if some users collude with the server.

## Key Results
- FheFL achieves 98.78% accuracy on MNIST with 20% malicious users, comparable to FedAvg's 98.68%
- Successfully mitigates label-flipping attacks while maintaining privacy guarantees
- Computational overhead of approximately 6 minutes per epoch for 100 users with 8192 parameters
- Requires less than 3MB bandwidth per user per epoch
- Demonstrates resilience to collusion attacks where the server needs to collude with (U-1) users to compromise one benign user's privacy

## Why This Works (Mechanism)

### Mechanism 1
- **Claim**: FheFL can aggregate model updates from multiple users in the encrypted domain without requiring two non-colluding servers.
- **Mechanism**: FheFL modifies the CKKS FHE scheme into a distributed multi-key additive homomorphic encryption scheme. Each user encrypts their model update using their shared secret key, and the server aggregates these encrypted updates using homomorphic properties of CKKS. The server decrypts the aggregated model using the sum of shared secret keys from all users.
- **Core assumption**: The security of the underlying CKKS FHE scheme remains intact when modified for distributed multi-key usage.
- **Evidence anchors**: [abstract]: "We modify the one-to-one single-key Cheon-Kim-Kim-Song (CKKS)-based FHE scheme into a distributed multi-key additive homomorphic encryption scheme that supports model aggregation in FL."
- **Break condition**: If the underlying CKKS scheme's security is compromised when used in a distributed multi-key setting.

### Mechanism 2
- **Claim**: The non-poisoning rate-based weighted aggregation scheme effectively mitigates data poisoning attacks in the encrypted domain.
- **Mechanism**: The server calculates the squared Euclidean distance between each user's model update and the global model from the previous iteration. This distance is used to compute a non-poisoning rate for each user, which scales down the contribution of potentially malicious users to the global model. This calculation is performed in the encrypted domain using the homomorphic properties of CKKS.
- **Core assumption**: Malicious users' model updates will have a significantly different Euclidean distance from the global model compared to benign users' updates.
- **Evidence anchors**: [abstract]: "We employ a novel aggregation scheme within the encrypted domain, utilizing users' non-poisoning rates, to effectively address data poisoning attacks while ensuring privacy is preserved by the proposed encryption scheme."
- **Break condition**: If malicious users can craft their model updates to have a similar Euclidean distance to the global model as benign users.

### Mechanism 3
- **Claim**: The proposed scheme preserves the privacy of individual user model updates even if some users collude with the server.
- **Mechanism**: Each user's model update is encrypted using their shared secret key, and the server can only decrypt the aggregated model using the sum of all users' shared secret keys. Even if some users collude with the server, they cannot decrypt individual model updates unless they collude with all other users.
- **Core assumption**: The pairwise secret key sharing scheme ensures that the server cannot obtain individual model updates unless it colludes with all users.
- **Evidence anchors**: [abstract]: "The proposed FHE-based scheme eliminates privacy leakage by encrypting the gradients, preventing the server from inferring private information."
- **Break condition**: If the pairwise secret key sharing scheme is compromised.

## Foundational Learning

- **Concept**: Fully Homomorphic Encryption (FHE)
  - **Why needed here**: FHE allows computations to be performed on encrypted data without decrypting it first, crucial for privacy-preserving federated learning.
  - **Quick check question**: What are the two main operations that FHE schemes must support to be useful for machine learning applications?

- **Concept**: Distributed Multi-key Encryption
  - **Why needed here**: In federated learning, each user has their own secret key, and a distributed multi-key encryption scheme allows the server to aggregate encrypted model updates from multiple users.
  - **Quick check question**: How does the proposed scheme ensure that the server can decrypt the aggregated model without having access to each individual user's secret key?

- **Concept**: Data Poisoning Attacks
  - **Why needed here**: Malicious users can sabotage the federated learning process by sending false model updates, and the proposed scheme must be able to detect and mitigate these attacks.
  - **Quick check question**: What metric does the proposed scheme use to identify potentially malicious model updates?

## Architecture Onboarding

- **Component map**: Users (with local data and shared secret keys) -> Server (aggregates encrypted updates) -> CKKS FHE Scheme (encryption/decryption) -> Pairwise Secret Key Sharing (key generation)

- **Critical path**:
  1. Users encrypt their model updates using their shared secret keys
  2. Users send their encrypted model updates and shared secret keys to the server
  3. Server aggregates encrypted model updates using homomorphic addition
  4. Server computes non-poisoning rates for each user
  5. Server uses non-poisoning rates to weight the aggregated model updates
  6. Server decrypts the weighted aggregated model using the sum of shared secret keys

- **Design tradeoffs**:
  - Computational overhead: FHE operations are computationally expensive, especially for large models
  - Communication overhead: Each user must send their encrypted model update and shared secret key to the server
  - Accuracy vs. security: Higher security parameters may lead to a loss in accuracy

- **Failure signatures**:
  - If the server can decrypt individual model updates, the privacy guarantee is broken
  - If the non-poisoning rate metric is not effective, the scheme may not mitigate data poisoning attacks
  - If the homomorphic aggregation introduces significant errors, the aggregated model may be inaccurate

- **First 3 experiments**:
  1. Implement the pairwise secret key sharing scheme and verify that the server can only decrypt the aggregated model when it has the sum of all users' shared secret keys
  2. Implement the non-poisoning rate-based weighted aggregation scheme and test its effectiveness in mitigating data poisoning attacks on a small dataset
  3. Integrate the CKKS FHE scheme with the aggregation scheme and measure the computational and communication overhead on a larger dataset

## Open Questions the Paper Calls Out

- **Question**: How does the proposed FheFL scheme perform against more sophisticated data poisoning attacks beyond label-flipping, such as backdoor attacks or targeted model poisoning?
  - **Basis in paper**: [explicit] The paper states "In this paper, we consider only the data poisoning attacks" and "we experiment with the proposed algorithm against targeted attacks involving label-flipping."
  - **Why unresolved**: The authors acknowledge they only tested against label-flipping attacks and did not evaluate the scheme against other types of poisoning attacks like backdoor attacks or targeted model poisoning.
  - **What evidence would resolve it**: Experimental results showing FheFL's accuracy and robustness against various data poisoning attack types beyond label-flipping.

- **Question**: What is the impact of the FheFL scheme on convergence time and final model accuracy when scaling to larger models and datasets beyond MNIST?
  - **Basis in paper**: [inferred] The paper mentions "the computational time almost doubled when the server switches the CKKS security parameter N from 8192 to 16384" but only evaluates on MNIST with a simple CNN architecture.
  - **Why unresolved**: The paper only provides experimental results for a simple CNN on MNIST, with no evaluation of how the scheme scales to larger models and datasets.
  - **What evidence would resolve it**: Experimental results showing FheFL's performance (convergence time, final accuracy) on larger models and datasets.

- **Question**: How does the proposed non-poisoning rate-based weighted aggregation scheme compare to other robust aggregation techniques like Krum or Bulyan in terms of accuracy and resistance to poisoning attacks?
  - **Basis in paper**: [explicit] The paper compares FheFL to FedAvg, Trimmed Mean, Median, and KRUM, stating "the proposed non-poisoning rate-based weighted aggregation scheme outperforms Trimmed Mean [33], Mean Median [33] and KRUM [12] approaches."
  - **Why unresolved**: While the paper compares to some robust aggregation techniques, it does not compare to other popular methods like Krum or Bulyan.
  - **What evidence would resolve it**: Experimental results comparing FheFL's non-poisoning rate-based aggregation to other robust aggregation techniques like Krum, Bulyan, or Multi-KRUM.

## Limitations

- Experimental evaluation is limited to a single dataset (MNIST) and a relatively simple CNN architecture with only 8,192 parameters
- Computational overhead of 6 minutes per epoch for 100 users may become prohibitive for larger models or more users
- Security analysis relies on theoretical proofs rather than empirical validation of the pairwise secret key sharing scheme's resistance to collusion attacks

## Confidence

- **High Confidence**: The core mechanism of using homomorphic encryption for secure aggregation is well-established and follows standard FHE principles
- **Medium Confidence**: The effectiveness of the non-poisoning rate-based weighted aggregation scheme is demonstrated on MNIST but may not generalize to more complex datasets or attack scenarios
- **Low Confidence**: The security guarantees of the distributed multi-key CKKS modification and the pairwise secret key sharing scheme are theoretical without empirical validation

## Next Checks

1. **Security Analysis Extension**: Conduct a comprehensive security analysis of the pairwise secret key sharing scheme, including potential collusion scenarios and resistance to known cryptographic attacks specific to the CKKS-based construction.

2. **Scalability Testing**: Evaluate the system's performance with larger model sizes (e.g., ResNet-18 or BERT-base) and more users (500-1000) to determine practical computational and communication limits.

3. **Generalization Study**: Test the non-poisoning rate mechanism on diverse datasets (CIFAR-10, ImageNet) and attack types (gradient inversion, backdoor attacks) to validate the robustness of the distance-based detection approach.