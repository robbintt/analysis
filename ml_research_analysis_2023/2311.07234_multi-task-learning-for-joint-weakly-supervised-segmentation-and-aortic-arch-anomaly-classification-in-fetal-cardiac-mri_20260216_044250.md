---
ver: rpa2
title: Multi-task learning for joint weakly-supervised segmentation and aortic arch
  anomaly classification in fetal cardiac MRI
arxiv_id: '2311.07234'
source_url: https://arxiv.org/abs/2311.07234
tags:
- segmentation
- u-net
- attention
- anomaly
- classifier
- transformers
- self-attention
- retrieval-augmented-generation
- instruction-tuning
- parameter-efficient-finetuning
- mixture-of-experts
- chain-of-thought
core_contribution: This work addresses automated multi-class fetal cardiac vessel
  segmentation and aortic arch anomaly classification from T2w MRI. The proposed method
  leverages both binary manual segmentations and multi-class atlas labels, combining
  VoxelMorph label propagation, 3D Attention U-Net segmentation, and DenseNet121 classification
  into a multi-task framework.
---

# Multi-task learning for joint weakly-supervised segmentation and aortic arch anomaly classification in fetal cardiac MRI

## Quick Facts
- arXiv ID: 2311.07234
- Source URL: https://arxiv.org/abs/2311.07234
- Reference count: 32
- Primary result: Joint segmentation and classification framework achieves multi-class Dice scores up to 0.91 and classification accuracy up to 0.99 on fetal cardiac MRI

## Executive Summary
This work presents a weakly supervised multi-task learning framework for joint fetal cardiac vessel segmentation and aortic arch anomaly classification from T2w MRI. The method combines binary manual segmentations with multi-class atlas-propagated labels using VoxelMorph registration, trains a 3D Attention U-Net for segmentation, and integrates a DenseNet121 classifier for anomaly detection. Joint training improves topological accuracy of vessel segmentations, particularly for distinguishing double aortic arch cases, while achieving high classification accuracy (average balanced accuracy 0.99). The framework requires no labels at inference and is validated on fetal CMR data.

## Method Summary
The approach uses both binary manual segmentation masks and fully-labelled anomaly-specific population atlases, propagating labels via VoxelMorph registration to individual subjects. A 3D Attention U-Net is trained on this combined label set, with segmentation outputs fed into a DenseNet121 classifier for anomaly classification. The networks share a common encoder and are jointly trained with a weighted loss combining DiceCE loss for segmentation and cross-entropy for classification. The method operates weakly supervised, requiring no labels at inference, and is validated on 195 fetal subjects with Coarctation of Aorta (CoA), Right Aortic Arch (RAA), or Double Aortic Arch (DAA) anomalies.

## Key Results
- Multi-class Dice scores up to 0.91 for segmentation of individual vessel classes
- Average balanced accuracy of 0.99 for anomaly classification (CoA, RAA, DAA)
- Joint multi-task training improves topological correctness of aortic arch segmentation compared to single-task approaches
- Method handles class imbalance through weighted random sampling during training

## Why This Works (Mechanism)

### Mechanism 1
Multi-task learning with joint segmentation and classification improves topological accuracy of aortic arch segmentation by encouraging the segmentation network to learn anomaly-specific features. The segmentation network and classifier share a common encoder, allowing the classifier's learned anomaly-specific features to influence and regularize the segmentation network's output, particularly for distinguishing between anatomically similar aortic arch anomalies (e.g., RAA vs. DAA).

### Mechanism 2
Using both binary manual segmentations and multi-class atlas-propagated labels in training provides a weakly supervised approach that improves segmentation performance compared to using only one type of label. Binary manual labels ensure accurate vessel region detection, while multi-class atlas labels provide detailed anatomical structure information, enabling the network to learn both global vessel regions and fine-grained vessel identities.

### Mechanism 3
Incorporating the original image as an additional input channel to the classifier improves classification accuracy by reducing dependence on perfect segmentation. The classifier can leverage global image features (e.g., vessel shape, spatial relationships) alongside segmentation outputs, making it more robust to segmentation errors and improving overall diagnostic reliability.

## Foundational Learning

- **Concept: Multi-task learning and shared representations**
  - Why needed here: To leverage the complementary nature of segmentation and classification tasks, improving both performance and topological correctness
  - Quick check question: What is the benefit of having the segmentation and classification networks share a common encoder?

- **Concept: Weakly supervised learning with mixed label types**
  - Why needed here: To overcome the scarcity of fully annotated multi-class labels in fetal cardiac MRI by combining readily available binary masks with atlas-propagated multi-class labels
  - Quick check question: Why might using only binary labels or only propagated labels be insufficient for this task?

- **Concept: Anatomical topology and its importance in segmentation evaluation**
  - Why needed here: Standard Dice/HD metrics may not capture topological correctness, which is critical for clinical usability in aortic arch anomaly detection
  - Quick check question: How does a segmentation that merges vessels affect clinical interpretation compared to one that separates them?

## Architecture Onboarding

- **Component map:**
  Input (3D T2w MRI) -> VoxelMorph registration -> Label propagation -> Attention U-Net (segmentation) -> DenseNet121 (classification) -> Output (segmentation + classification)

- **Critical path:**
  1. Load and preprocess image
  2. Apply VoxelMorph to generate propagated labels (frozen during segmentation training)
  3. Train Attention U-Net on propagated + binary labels
  4. Attach DenseNet121 to segmentation output
  5. Jointly fine-tune segmentation and classification networks
  6. At inference: single forward pass through both networks

- **Design tradeoffs:**
  - Using both propagated and manual labels increases robustness but requires careful loss balancing
  - Multi-task learning improves topological accuracy but adds complexity in hyperparameter tuning
  - Including image in classifier increases accuracy but may reduce segmentation quality as a diagnostic signal

- **Failure signatures:**
  - Segmentation: Oversegmentation leading to vessel merging; missed small vessels; topologically incorrect aortic arch (split/arch duplication)
  - Classification: Confusion between RAA and DAA; reliance on flawed segmentations when image not included
  - Training: Unstable loss curves; poor convergence when loss weights not balanced

- **First 3 experiments:**
  1. Train Attention U-Net on propagated labels only (LP) vs. manual labels only (Man) vs. both (LP+Man) to validate label combination benefit
  2. Train DenseNet121 on segmentation output alone vs. segmentation + image input to test classification accuracy
  3. Jointly train segmentation + classification (DenseMulti) vs. separate training to measure topological improvement

## Open Questions the Paper Calls Out

### Open Question 1
How do different types of topology-aware loss functions (e.g., persistent homology-based losses) compare to the current DiceCE loss in improving segmentation accuracy for complex anatomical structures like fetal cardiac vessels? The paper suggests exploring topology-aware losses as future work since commonly used metrics don't fully capture topological correctness.

### Open Question 2
How does the proposed multi-task framework generalize to out-of-distribution cases, such as cases with significant anatomical variations or lower image quality not present in the training data? The paper acknowledges potential restrictions in flexibility and generalizability to data that deviate strongly from training data.

### Open Question 3
What is the optimal balance between the segmentation loss weight (λ3) and the classification loss weight (λ4) in the joint training framework for different datasets and anomaly types? The paper mentions that stability depends on accurate hyperparameter tuning of loss weight balancing in each experiment.

## Limitations
- Reliance on atlas propagation accuracy for multi-class labels
- Potential domain shift when applying to different MRI scanners or protocols
- Multi-task learning improvements demonstrated only on a single dataset

## Confidence
- Segmentation performance metrics (multi-class Dice, ASD, HD95): High
- Topological correctness improvements: Low (requires detailed case-by-case analysis)
- Anomaly classification accuracy (balanced accuracy 0.99): Medium (requires external validation)

## Next Checks
1. **Cross-scanner validation**: Test the trained model on fetal cardiac MRI data acquired on different scanners or with different protocols to assess robustness to domain shift

2. **Detailed topological analysis**: Conduct expert review of segmentation outputs for all cases, specifically focusing on aortic arch topology (single vs. double arch) to validate the claimed improvements in topological correctness

3. **Atlas propagation quality assessment**: Quantitatively evaluate the accuracy of VoxelMorph-propagated labels by comparing to manual segmentations on a subset of cases, and analyze the impact of propagation errors on final segmentation performance