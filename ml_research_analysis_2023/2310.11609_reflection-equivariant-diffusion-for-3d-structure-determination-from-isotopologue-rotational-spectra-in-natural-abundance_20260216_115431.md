---
ver: rpa2
title: Reflection-Equivariant Diffusion for 3D Structure Determination from Isotopologue
  Rotational Spectra in Natural Abundance
arxiv_id: '2310.11609'
source_url: https://arxiv.org/abs/2310.11609
tags:
- coordinates
- substitution
- structure
- diffusion
- figure
- transformers
- self-attention
- retrieval-augmented-generation
- instruction-tuning
- parameter-efficient-finetuning
- mixture-of-experts
- chain-of-thought
core_contribution: This paper tackles the challenge of determining 3D molecular structures
  from rotational spectroscopy data, specifically by inferring complete atomic coordinates
  from unsigned Kraitchman substitution coordinates. The authors introduce KREED,
  a reflection-equivariant diffusion model that generates 3D structures conditioned
  on molecular formula, moments of inertia, and unsigned substitution coordinates.
---

# Reflection-Equivariant Diffusion for 3D Structure Determination from Isotopologue Rotational Spectra in Natural Abundance

## Quick Facts
- arXiv ID: 2310.11609
- Source URL: https://arxiv.org/abs/2310.11609
- Reference count: 40
- KREED achieves >98% top-1 accuracy on QM9/GEOM with all coordinates, 91% on QM9 and 32% on GEOM with only carbon coordinates, and 25/33 correct predictions on experimental data

## Executive Summary
This paper addresses the inverse problem of determining 3D molecular structures from rotational spectroscopy data by inferring complete atomic coordinates from unsigned Kraitchman substitution coordinates. The authors introduce KREED, a reflection-equivariant diffusion model that generates 3D structures conditioned on molecular formula, moments of inertia, and unsigned substitution coordinates. The model performs denoising in the principal axis system and is designed to be invariant to axially-aligned reflections. When tested on QM9 and GEOM datasets, KREED achieves >98% top-1 accuracy when all substitution coordinates are available and maintains 91% on QM9 and 32% on GEOM when restricted to only carbon coordinates. On a test set of experimentally measured substitution coordinates, the model correctly predicts the 3D structure in 25 of 33 cases, demonstrating practical applicability.

## Method Summary
KREED is a reflection-equivariant diffusion model that generates 3D molecular structures by denoising point clouds in the principal axis system. The model takes as input the molecular formula, moments of inertia, and unsigned Kraitchman substitution coordinates for heavy atoms. It uses a data augmentation strategy with random coordinate dropout during training to improve robustness. The diffusion process operates in the 3(N-1)-dimensional zero center-of-mass subspace, with the denoiser designed to be equivariant under axially-aligned reflections and atom permutations. During generation, candidate structures are ranked by their deviation from the input substitution coordinates rather than being strictly constrained to match them exactly.

## Key Results
- >98% top-1 accuracy on QM9 and GEOM datasets when all heavy atom substitution coordinates are available
- 91% accuracy on QM9 and 32% on GEOM when restricted to only carbon substitution coordinates
- 25 out of 33 correct predictions on experimentally measured substitution coordinates from literature

## Why This Works (Mechanism)

### Mechanism 1
KREED solves the inverse problem of inferring 3D structure from unsigned Kraitchman substitution coordinates by learning to denoise point clouds in the principal axis system. The model uses a diffusion process in the 3(N-1)-dimensional zero CoM subspace of the principal axis system. By training a reflection-equivariant denoiser, it learns the steric and electronic rules that atoms obey (e.g., valency, bond lengths, bond angles) from data, allowing it to generate physically plausible 3D structures consistent with the given constraints.

Core assumption: The molecular formula, moments of inertia, and unsigned substitution coordinates provide sufficient constraints to uniquely identify the correct 3D structure among the 8^m-1 possible arrangements consistent with the unsigned coordinates.

Evidence anchors:
- [abstract] "KREED's top-1 predictions identify the correct 3D structure with >98% accuracy on the QM9 and GEOM datasets when provided with substitution coordinates of all heavy atoms with natural isotopic abundance."
- [section 2] "Since each atom lies in one of 8 octants, the measured substitution coordinates of a set of m atoms are consistent with 8m−1 possible arrangements (fix the first atom), but only one of these makes up the true 3D structure."
- [corpus] Weak - related papers focus on structure elucidation from spectra but don't directly address the Kraitchman substitution coordinate inverse problem.

Break condition: If the number of heavy atoms with unavailable substitution coordinates is too large relative to the number of available constraints, the model cannot uniquely identify the correct structure.

### Mechanism 2
Fixing the CoM to the origin and aligning to principal axes reduces symmetries to axially-aligned reflections, enabling efficient learning with a reflection-equivariant model. By working in the principal axis system, translational symmetries are removed and rotational symmetries are reduced to sign flips of the principal axes. The denoiser is designed to be equivariant under axially-aligned reflections (across xy, yz, xz planes) and atom permutations, ensuring the learned distribution is invariant to these transformations.

Core assumption: The principal axis system is well-defined and the alignment process is accurate enough that the model can learn the correct distribution.

Evidence anchors:
- [section 3.1.2] "Once the CoM has been fixed to the origin, diffusion takes place in the principal axis system of the molecule by construction. The remaining symmetries are stated as follows. For all axially-aligned reflections R ∈ {diag(b) | b ∈ {−1, +1}3} and node permutations Π that map U onto itself, we desire that: pθ(ΠXR ⊤|ΠC) = pθ(X|C)."
- [section 3.1] "A natural approach is to consider the principal axis system of the molecule, which is the coordinate system whose origin is the mass-weighted center-of-mass (CoM) and whose axes are the principal axes of rotation, or the orthonormal eigenvectors of the inertia matrix."
- [corpus] Weak - related papers on structure elucidation don't discuss equivariant models or the principal axis system.

Break condition: If the principal axis alignment is inaccurate due to numerical instability or if the molecule has high symmetry leading to degenerate principal axes.

### Mechanism 3
The model's performance is robust to errors in experimentally measured substitution coordinates due to zero-point vibrational effects because it does not strictly enforce agreement with the coordinates during generation. Instead of forcing the generated structures to exactly match the given unsigned substitution coordinates, KREED ranks candidate structures by their deviation from the coordinates. This allows the model to account for systematic errors in the coordinates caused by vibrational effects, which make them smaller in magnitude than the true equilibrium coordinates.

Core assumption: The errors in experimentally measured substitution coordinates are systematic and can be accounted for by allowing some deviation during generation.

Evidence anchors:
- [abstract] "On a test set of experimentally measured substitution coordinates gathered from the literature, KREED predicts the correct all-atom 3D structure in 25 of 33 cases, demonstrating experimental applicability for context-free 3D structure determination with rotational spectroscopy."
- [section 2] "Since effective moments were used in Kraitchman's equations, these substitution coordinates are susceptible to errors arising from zero-point vibrational effects, so that they are systematically smaller in magnitude than the true equilibrium coordinates."
- [corpus] Weak - related papers don't discuss robustness to errors in input coordinates.

Break condition: If the errors in substitution coordinates are too large or random, the model may not be able to generate structures close to the true structure.

## Foundational Learning

- Concept: Principal axis system and moments of inertia
  - Why needed here: The problem requires inferring 3D structure from unsigned substitution coordinates, which are defined in the principal axis system. Understanding how to compute and use the principal moments of inertia and the principal axis system is crucial for implementing KREED.
  - Quick check question: How are the principal moments of inertia and principal axes of rotation computed from the inertia matrix of a molecule?

- Concept: Diffusion models and equivariant neural networks
  - Why needed here: KREED uses a diffusion model to generate 3D structures and an equivariant neural network to ensure the model is invariant to certain transformations. Understanding how diffusion models work and how to implement equivariant neural networks is necessary for implementing KREED.
  - Quick check question: What is the key idea behind diffusion models and how do you ensure a neural network is equivariant under a certain group of transformations?

- Concept: Kraitchman analysis and isotopic substitution
  - Why needed here: The problem is based on inferring 3D structure from Kraitchman substitution coordinates, which are derived from isotopic substitution. Understanding how Kraitchman analysis works and how isotopic substitution affects the moments of inertia is important for understanding the problem and the constraints on the solution.
  - Quick check question: How do you compute the unsigned substitution coordinates of an atom from the moments of inertia of the parent molecule and an isotopologue where that atom has been substituted?

## Architecture Onboarding

- Component map: Molecular formula, moments of inertia, unsigned substitution coordinates -> Principal axis system alignment -> Diffusion process in zero CoM subspace -> Reflection-equivariant denoiser -> Ranked candidate 3D structures

- Critical path:
  1. Preprocess input to orient molecule in principal axis system and compute unsigned substitution coordinates
  2. Sample from standard Gaussian in zero CoM subspace
  3. Iteratively denoise using reflection-equivariant denoiser
  4. Rank generated structures by deviation from unsigned substitution coordinates

- Design tradeoffs:
  - Fixing CoM to origin vs. using weighted CoM: Fixing to origin simplifies the problem by removing translational symmetries, but using weighted CoM might be more accurate for molecules with significantly different atomic masses.
  - Reflection-equivariance vs. full E(3)-equivariance: Reflection-equivariance is sufficient for the problem and computationally cheaper than full E(3)-equivariance, but might not capture all symmetries.
  - Strict vs. loose conditioning on substitution coordinates: Loose conditioning allows the model to account for errors in coordinates but might lead to less accurate predictions if the coordinates are reliable.

- Failure signatures:
  - Poor performance on molecules with many heavy atoms and missing substitution coordinates: Indicates the model struggles with under-constrained problems.
  - Generated structures have unreasonable bond lengths or angles: Indicates the denoiser is not learning the correct steric and electronic rules.
  - Performance degrades significantly when moving from QM9 to GEOM: Indicates the model is overfitting to the QM9 dataset or GEOM has different properties.

- First 3 experiments:
  1. Train KREED on QM9 with all substitution coordinates available and evaluate top-1 accuracy to verify the model can learn the task with ideal inputs.
  2. Train KREED on QM9 with a subset of substitution coordinates dropped (e.g., only carbons) and evaluate top-1 accuracy to see how the model performs with more realistic inputs.
  3. Evaluate KREED on a small set of experimentally measured substitution coordinates to test the model's robustness to errors in the input.

## Open Questions the Paper Calls Out

The paper does not explicitly call out open questions in the provided content.

## Limitations

- Performance significantly degrades when moving from QM9 to GEOM datasets, suggesting potential overfitting to smaller molecules or differences in chemical space coverage.
- The experimental validation on 33 cases represents a limited test set that may not capture the full variability of real-world spectroscopic data.
- The model's reliance on accurate principal axis system alignment and the assumption that unsigned substitution coordinates provide sufficient constraints for unique structure determination are critical factors that could limit generalizability.

## Confidence

- Mechanism 1 (Core problem solving approach): Medium - Strong performance on synthetic data but limited experimental validation
- Mechanism 2 (Equivariant design): High - Strong theoretical foundation and successful implementation
- Mechanism 3 (Error robustness): Medium - Evidence primarily based on experimental results without systematic error analysis

Overall confidence: Medium-High, with strongest results on synthetic data and reasonable but more limited success on experimental data.

## Next Checks

1. Test KREED on a larger and more diverse set of experimentally measured substitution coordinates to better assess real-world performance and identify failure patterns.

2. Perform ablation studies varying the number and type of available substitution coordinates (e.g., only carbons, only oxygens, random subsets) to characterize the model's sensitivity to input constraints.

3. Evaluate the model's performance on molecules with known high symmetry or near-degeneracy in principal moments of inertia to test the robustness of the principal axis system alignment.