---
ver: rpa2
title: 'Purify++: Improving Diffusion-Purification with Advanced Diffusion Models
  and Control of Randomness'
arxiv_id: '2310.18762'
source_url: https://arxiv.org/abs/2310.18762
tags:
- diffusion
- purification
- adversarial
- accuracy
- attacks
- transformers
- self-attention
- retrieval-augmented-generation
- instruction-tuning
- parameter-efficient-finetuning
- mixture-of-experts
- chain-of-thought
core_contribution: 'This paper proposes Purify++, a diffusion purification algorithm
  that improves adversarial defense by optimizing three key components: the forward
  diffusion model, the numerical simulation method, and the control of randomness.
  Purify++ employs an improved EDM diffusion model that better preserves data features
  during purification, uses an efficient Heun numerical solver for simulation, and
  optimally balances randomness in the purification process.'
---

# Purify++: Improving Diffusion-Purification with Advanced Diffusion Models and Control of Randomness

## Quick Facts
- arXiv ID: 2310.18762
- Source URL: https://arxiv.org/abs/2310.18762
- Reference count: 40
- Primary result: Achieves 91.21% robust accuracy against Square Attack on CIFAR10

## Executive Summary
This paper proposes Purify++, a diffusion-based adversarial purification algorithm that improves upon existing methods by optimizing three key components: the forward diffusion model, the numerical simulation method, and the control of randomness. By employing an improved EDM diffusion model, using Heun's numerical solver, and introducing an optimal mixing coefficient for randomness control, Purify++ achieves state-of-the-art performance against various adversarial attacks on the CIFAR10 dataset. The method demonstrates robustness across different attack types including black-box, gray-box, and strong adaptive attacks, while remaining insensitive to variations in total diffusion steps.

## Method Summary
Purify++ builds upon diffusion-based adversarial purification by making three key improvements: (1) an improved EDM diffusion model that better preserves data features during purification by avoiding fast convergence to Gaussian noise, (2) an efficient Heun numerical solver for more stable and accurate simulation of the purification SDE, and (3) optimal control of randomness through a mixing coefficient that balances deterministic and stochastic components. The method uses a variance-exploding diffusion schedule where the conditional mean remains constant over time, allowing the forward and reverse procedures to maintain distinguishable information about the original data throughout the purification process.

## Key Results
- Achieves 91.21% robust accuracy against Square Attack on CIFAR10
- Maintains 90.5% robust accuracy against SPSA attack
- Demonstrates robustness to variations in total diffusion steps, making it practical for real-world applications

## Why This Works (Mechanism)

### Mechanism 1
- Claim: The improved forward diffusion (EDM model) better preserves data features during purification by avoiding fast convergence to Gaussian noise.
- Mechanism: The EDM diffusion model uses a variance-exploding schedule where the conditional mean Ext|x0 xt = x0 remains constant over time, unlike variance-preserving diffusion where the mean contracts to zero. This allows the forward and reverse procedures to maintain distinguishable information about the original data throughout the purification process.
- Core assumption: The forward diffusion process needs to maintain information about the original data rather than converging quickly to a stationary distribution.
- Evidence anchors:
  - [section]: "The variance of conditional distribution explodes to infinity when t → ∞. One key characteristic of VE diffusion is that the conditional mean Ext|x0 xt = x0 does not change with time. While the conditional mean of VP diffusion contracts to zero with coefficient αt in equation 5."
  - [section]: "Theorem 3.3 states that for a relatively small data gap, the interaction time of VE diffusion is of the first order, bigger than the interaction time of VP diffusion which is of second order."
  - [corpus]: The corpus contains related works on diffusion-based purification but lacks direct comparative evidence for EDM vs VP diffusion performance.
- Break condition: If the data gap between clean and adversarial examples becomes too large, even the VE/EDM diffusion may not maintain sufficient distinguishability between samples.

### Mechanism 2
- Claim: Advanced numerical simulation with Heun's method provides better stability and accuracy for purification than first-order methods.
- Mechanism: Heun's second-order numerical solver reduces truncation errors in the simulation of the purification SDE, leading to more accurate reverse diffusion and better restoration of clean data from adversarial examples.
- Core assumption: Second-order numerical methods provide meaningful improvements for diffusion purification compared to first-order methods.
- Evidence anchors:
  - [section]: "We believe one reason is, for sampling, the numerical simulation starts from pure random noise which is easy to introduce much more truncation errors. However, for purification, the simulation starts from slightly noised data, which can potentially give small truncation errors regardless of first or second order."
  - [section]: "In practice, we still use Heun's second-order methods for their stability."
  - [corpus]: The corpus lacks specific comparative evidence for Heun vs Euler-Maruyama methods in purification contexts.
- Break condition: If the purification process requires extremely fast computation with minimal steps, the additional computational cost of Heun's method may not justify its marginal accuracy improvements.

### Mechanism 3
- Claim: Optimal control of randomness (mixing coefficient λ) significantly improves purification performance by balancing deterministic and stochastic components.
- Mechanism: By introducing a mixing coefficient λ that controls the strength of randomness in the purification SDE, the algorithm can balance between the deterministic ODE path (which exactly reverses the forward diffusion) and the stochastic Langevin dynamics (which adds beneficial noise for robustness).
- Core assumption: There exists an optimal level of randomness that improves purification performance beyond pure deterministic or pure stochastic approaches.
- Evidence anchors:
  - [section]: "We find that with optimal choice of randomness strength, the purification performance can be further improved by a significant margin."
  - [section]: "Table 2 records the relation of optimal robust accuracy and random strength λ. The best robust accuracy occurs when taking λ = 0.75 which corresponds to neither the ODE nor the purification SDE."
  - [corpus]: The corpus mentions randomization in defense but lacks specific evidence for the λ = 0.75 finding.
- Break condition: If the mixing coefficient is set too high, the purification process may add excessive noise that degrades rather than improves classification accuracy.

## Foundational Learning

- Concept: Diffusion models and score matching
  - Why needed here: Purify++ relies on diffusion models as the core purification mechanism, requiring understanding of how these models are trained and how they represent data distributions through score functions.
  - Quick check question: What is the key difference between training a diffusion model for generation versus using it for adversarial purification?

- Concept: Stochastic differential equations (SDEs) and numerical solvers
  - Why needed here: The purification process involves simulating forward and reverse SDEs, requiring knowledge of different numerical methods (Euler-Maruyama, Heun's method) and their trade-offs in terms of accuracy and computational cost.
  - Quick check question: How does the choice of numerical solver affect the trade-off between computational efficiency and purification accuracy?

- Concept: Adversarial attacks and defense mechanisms
  - Why needed here: Understanding the threat model (black-box, gray-box, white-box attacks) and how different defense strategies like adversarial training and purification work is crucial for evaluating Purify++'s effectiveness.
  - Quick check question: What distinguishes black-box attacks from gray-box attacks in terms of the attacker's knowledge about the defense mechanism?

## Architecture Onboarding

- Component map: Input preprocessing -> EDM diffusion model -> Heun numerical solver -> Mixing coefficient controller -> Classifier

- Critical path:
  1. Input image normalization
  2. Forward diffusion with EDM model to add noise
  3. Reverse diffusion with Heun solver and controlled randomness
  4. Output classification by pre-trained classifier

- Design tradeoffs:
  - Accuracy vs. speed: Higher-order solvers (Heun) provide better accuracy but require more computation than first-order methods
  - Randomness vs. determinism: Optimal λ balances between exact reversal (ODE) and robustness (SDE)
  - Diffusion steps vs. performance: More steps improve purification but increase computational cost

- Failure signatures:
  - Poor robust accuracy: May indicate suboptimal λ value or insufficient diffusion steps
  - High standard accuracy but low robust accuracy: Suggests the purification process is not effectively removing adversarial perturbations
  - Instability during reverse diffusion: Could indicate numerical solver issues or problematic mixing coefficient

- First 3 experiments:
  1. Test Purify++ with varying λ values (0.0, 0.25, 0.5, 0.75, 1.0) on MNIST to verify the optimal randomness finding
  2. Compare Heun vs. Euler-Maruyama solvers on CIFAR10 with 25 vs. 100 diffusion steps to quantify the accuracy-speed tradeoff
  3. Evaluate robust accuracy against PGD attacks with different iteration counts (10, 20, 40, 100) to determine sensitivity to attack strength

## Open Questions the Paper Calls Out

### Open Question 1
- Question: How does the optimal choice of randomness strength (λ) vary across different datasets and adversarial attack types?
- Basis in paper: [explicit] The paper mentions an optimal randomness strength of λ = 0.75 for the MNIST dataset, but does not explore its variability across other datasets or attack types.
- Why unresolved: The study focused on the MNIST dataset for exploring the impact of randomness strength, leaving the generalizability of the findings to other datasets and attack types unexplored.
- What evidence would resolve it: Conducting experiments with different datasets and attack types to determine if the optimal λ value remains consistent or varies significantly.

### Open Question 2
- Question: What are the theoretical guarantees for the robustness of Purify++ against adaptive attacks, such as BPDA+EOT?
- Basis in paper: [inferred] The paper demonstrates empirical robustness against BPDA+EOT attacks but does not provide theoretical analysis or guarantees for this scenario.
- Why unresolved: The focus was on empirical validation rather than theoretical analysis, leaving a gap in understanding the underlying principles that ensure robustness.
- What evidence would resolve it: Developing theoretical models or proofs that establish conditions under which Purify++ maintains robustness against adaptive attacks.

### Open Question 3
- Question: How does the performance of Purify++ scale with larger image sizes or more complex datasets?
- Basis in paper: [inferred] The experiments were conducted on the CIFAR10 and MNIST datasets, but the paper does not address scalability to larger images or more complex datasets.
- Why unresolved: The paper's scope was limited to specific datasets, and there was no exploration of performance implications for larger or more complex data.
- What evidence would resolve it: Testing Purify++ on datasets with larger images or higher complexity to assess performance scaling and identify potential limitations.

### Open Question 4
- Question: Can the improved diffusion model and numerical simulation techniques be further optimized for specific types of adversarial attacks?
- Basis in paper: [explicit] The paper discusses the use of an improved EDM diffusion model and Heun's numerical solver but does not explore optimization for specific attack types.
- Why unresolved: The improvements were presented as general enhancements, without delving into attack-specific optimizations.
- What evidence would resolve it: Conducting targeted experiments to optimize the diffusion model and simulation techniques for particular adversarial attacks, measuring the impact on robustness.

### Open Question 5
- Question: What is the impact of varying the diffusion time steps on the computational efficiency and robustness of Purify++ in real-time applications?
- Basis in paper: [explicit] The paper notes that Purify++ is insensitive to total diffusion steps, but does not explore the trade-offs in real-time applications.
- Why unresolved: The focus was on demonstrating robustness rather than analyzing computational efficiency in real-time scenarios.
- What evidence would resolve it: Evaluating Purify++ in real-time applications with varying diffusion steps to determine the balance between computational efficiency and robustness.

## Limitations

- The optimal randomness mixing coefficient (λ = 0.75) is only validated on MNIST and CIFAR10, limiting generalizability to other datasets
- The method's performance against adaptive attacks is empirically demonstrated but lacks theoretical guarantees
- The computational cost of using Heun's second-order solver may limit real-time applications despite improved accuracy

## Confidence

- High confidence: The general framework of diffusion-based purification and the concept of controlling randomness in the purification process are well-established
- Medium confidence: The EDM diffusion model's theoretical advantages and Heun solver's improved stability are supported by theory but lack direct purification-specific evidence
- Low confidence: The specific finding that λ = 0.75 provides optimal performance across different attack scenarios needs more extensive validation

## Next Checks

1. Conduct ablation studies comparing EDM vs VP diffusion models directly on the same purification task with identical hyperparameters to isolate the model's contribution to performance gains
2. Test the sensitivity of robust accuracy to the mixing coefficient λ across multiple datasets (CIFAR10, CIFAR100, SVHN) and attack types to determine if λ = 0.75 is universally optimal
3. Evaluate Purify++ against a broader range of adversarial attacks including transfer-based attacks and adaptive attacks specifically designed to break diffusion-based defenses