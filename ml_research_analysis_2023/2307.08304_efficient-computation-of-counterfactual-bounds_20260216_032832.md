---
ver: rpa2
title: Efficient Computation of Counterfactual Bounds
arxiv_id: '2307.08304'
source_url: https://arxiv.org/abs/2307.08304
tags:
- equation
- bounds
- causal
- each
- variables
- transformers
- self-attention
- retrieval-augmented-generation
- instruction-tuning
- parameter-efficient-finetuning
- mixture-of-experts
- chain-of-thought
core_contribution: This work provides an algorithm to compute counterfactual bounds
  for partially identifiable queries in structural causal models. It maps causal models
  to credal networks, enabling computation of exact bounds for a subclass of models.
---

# Efficient Computation of Counterfactual Bounds

## Quick Facts
- arXiv ID: 2307.08304
- Source URL: https://arxiv.org/abs/2307.08304
- Reference count: 9
- One-line primary result: Provides an EM-based algorithm to compute approximate counterfactual bounds for partially identifiable queries in structural causal models, with credible intervals quantifying approximation quality.

## Executive Summary
This paper introduces a method to compute counterfactual bounds for partially identifiable queries in structural causal models (SCMs). The approach maps SCMs to credal networks, enabling exact computation for quasi-Markovian models. For general models, an expectation-maximization (EM) scheme iteratively samples the set of compatible exogenous probability mass functions to approximate bounds. The method includes credible intervals to assess approximation quality, showing RRMSE<0.1 in most experiments on synthetic and real data.

## Method Summary
The method maps structural causal models to credal networks, enabling computation of counterfactual bounds. For quasi-Markovian models, exact bounds are computed via credal network inference. For general models, an EM scheme approximates bounds by sampling global optima of the log-likelihood over the feasible set of exogenous PMFs. The approach includes a credibility assessment via credible intervals derived from the EM runs. The method is particularly useful for Markovian models where exact bounds can be computed via credal network inference.

## Key Results
- EM scheme converges to points inside exact counterfactual bounds by sampling global optima of log-likelihood
- Credal network mapping allows exact computation for quasi-Markovian models
- Credible intervals provide probabilistic guarantees on approximation quality with RRMSE<0.1 in most cases

## Why This Works (Mechanism)

### Mechanism 1
The EM scheme converges to points inside the exact counterfactual bounds by sampling the global optima of the log-likelihood over the feasible set K of exogenous PMFs. The EM algorithm is run multiple times with different random initializations. Each run yields a candidate exogenous PMF that, if it achieves the global log-likelihood λ*, belongs to K. The collection of such PMFs maps to a set of candidate counterfactual queries, whose min and max form an inner approximation of the true bounds. Core assumption: The log-likelihood function is concave and its global optima correspond exactly to the elements of K. Break condition: If the EM converges to a saddle point instead of a global maximum (i.e., l(ˆθU) < λ*), the candidate is discarded.

### Mechanism 2
The credal network mapping allows exact computation of counterfactual bounds for quasi-Markovian models by transforming the causal inference problem into a credal network inference problem. For quasi-Markovian models, the constraints linking exogenous PMFs to the observed data factor into independent linear constraints for each exogenous variable. These constraints define the conditional credal sets in the corresponding credal network. Exact inference on this network yields the counterfactual bounds. Core assumption: The PSCM is quasi-Markovian, meaning each endogenous variable has at most one exogenous parent. Break condition: If the PSCM is not quasi-Markovian, the mapping becomes intractable due to exponential blowup in the number of constraints.

### Mechanism 3
Credible intervals quantify the quality of the EMCC approximation by characterizing the distribution of EM runs around the true bounds. The EM runs are modeled as samples from a Beta distribution. The credible interval calculation uses the spread of these runs to estimate the probability that the true bounds lie within an ε-neighborhood of the computed range. Core assumption: The EM runs are distributed according to a four-parameter Beta distribution. Break condition: If the Beta distribution assumption is violated (e.g., if the runs are not unimodal or skewed), the credible interval estimates may be inaccurate.

## Foundational Learning

- Concept: Structural Causal Models (SCMs)
  - Why needed here: The paper operates on SCMs as the underlying causal model; understanding the mapping to credal networks and the EM scheme requires familiarity with SCMs.
  - Quick check question: What is the difference between a semi-Markovian and a Markovian PSCM?

- Concept: Credal Networks
  - Why needed here: Credal networks generalize Bayesian networks to handle sets of probability distributions, which is essential for representing the set of compatible exogenous PMFs K.
  - Quick check question: How does a credal network differ from a Bayesian network in terms of quantification?

- Concept: Expectation-Maximization (EM) Algorithm
  - Why needed here: The EM scheme is the core approximate method for sampling the set K; understanding its convergence properties and saddle point issues is critical.
  - Quick check question: What guarantees does the EM algorithm provide regarding convergence to global optima in concave likelihood functions?

## Architecture Onboarding

- Component map: PSCM + dataset -> M-compatibility check -> Credal network mapping (quasi-Markovian) OR EMCC runs (general) -> Credible interval computation -> Counterfactual bounds + credible interval

- Critical path:
  1. Check M-compatibility via likelihood maximization
  2. If quasi-Markovian and small, map to credal network and run exact inference
  3. Otherwise, run EMCC with multiple initializations
  4. Compute credible intervals from EM runs
  5. Return bounds and interval

- Design tradeoffs:
  - Exact vs. approximate: Exact CN inference is limited to quasi-Markovian models and small sizes; EMCC is approximate but general
  - Computational cost: EMCC scales with number of runs and iterations; CN inference scales exponentially with treewidth
  - Accuracy vs. runtime: More EM runs improve accuracy but increase runtime

- Failure signatures:
  - M-incompatibility: Likelihood never reaches λ* → no valid bounds
  - EM convergence to saddle point: Check if l(ˆθU) < λ*; discard if so
  - Credible interval breakdown: If Beta distribution assumption fails, intervals may be misleading

- First 3 experiments:
  1. Verify M-compatibility on a small synthetic PSCM with known ground truth
  2. Run EMCC on the same model with increasing numbers of runs; plot RRMSE vs. runs
  3. Compare EMCC bounds to exact credal network bounds (for quasi-Markovian case) to validate inner approximation

## Open Questions the Paper Calls Out

### Open Question 1
- Question: How does the quality of the computed bounds change with sample size, and what sample size is required to ensure the true SCM is embedded with high probability?
- Basis in paper: [explicit] "Yet a sufficient condition to address the problem exists: we should use the canonical specification and check whether all sub-models are embedded. In the Markovian case this is readily possible to do since we can exactly represent the set K via linear constraints as Theorem 2 proves... In the opposite case, we should give the disclaimer that the bounds are not guaranteed to be correct; or we should just refrain from yielding them."
- Why unresolved: The paper discusses the importance of M-compatibility but does not provide specific guidance on sample size requirements for ensuring the true SCM is embedded with high probability.
- What evidence would resolve it: Empirical studies or theoretical results showing the relationship between sample size and the probability of the true SCM being embedded.

### Open Question 2
- Question: How do the EMCC ranges compare to other methods for approximating partially identifiable queries, such as the Bayesian approach proposed by Zhang et al. (2022)?
- Basis in paper: [explicit] "It would be interesting in the future to compare the relative power of the two types of credible intervals... For the time being, let us just note that the EMCC provides an inner approximation to the actual expectation bounds, besides a probabilistic guarantee on the fact that the credible interval is an outer approximation."
- Why unresolved: The paper mentions the potential for comparison but does not provide a direct empirical comparison between the EMCC and the Bayesian approach.
- What evidence would resolve it: A head-to-head comparison of the EMCC and the Bayesian approach on the same benchmark datasets, evaluating accuracy, computational efficiency, and robustness.

### Open Question 3
- Question: Can the EMCC be extended to handle continuous domains, and if so, how would this impact its performance and applicability?
- Basis in paper: [explicit] "Finally, another useful direction would be to extend the EMCC to continuous domains."
- Why unresolved: The paper focuses on discrete variables and does not explore the potential for extending the EMCC to continuous domains.
- What evidence would resolve it: A proof-of-concept implementation of the EMCC for continuous domains, along with empirical results demonstrating its effectiveness and efficiency compared to existing methods.

## Limitations
- The method's scalability is limited by exponential complexity of exact credal network inference, restricting exact computation to quasi-Markovian models with small treewidth.
- The credible interval method relies on a four-parameter Beta distribution assumption, which may not hold in practice, potentially mischaracterizing approximation quality.
- The approach assumes the log-likelihood function is concave, which is critical for EM convergence to global optima but may not hold in all cases.

## Confidence
- High confidence: The mapping from quasi-Markovian SCMs to credal networks is theoretically sound, as supported by structural causal theory.
- Medium confidence: The EM scheme reliably approximates bounds when the log-likelihood is concave, but practical convergence to global optima may vary.
- Low confidence: The credible interval method's Beta distribution assumption is unverified, and its accuracy in real-world scenarios is uncertain.

## Next Checks
1. Test EM convergence to global optima: Run EMCC on synthetic models with known M-compatible PMFs and verify that log-likelihood consistently reaches λ* across random initializations.
2. Validate credible interval accuracy: Compare the Beta-based credible intervals to empirical coverage rates on models with known ground truth bounds.
3. Assess scalability limits: Benchmark exact credal network inference on quasi-Markovian models with increasing treewidth to quantify the exponential complexity barrier.