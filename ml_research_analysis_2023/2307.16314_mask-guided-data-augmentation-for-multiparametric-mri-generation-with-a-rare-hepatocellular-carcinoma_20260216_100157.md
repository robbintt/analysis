---
ver: rpa2
title: Mask-guided Data Augmentation for Multiparametric MRI Generation with a Rare
  Hepatocellular Carcinoma
arxiv_id: '2307.16314'
source_url: https://arxiv.org/abs/2307.16314
tags:
- tumor
- images
- synthetic
- data
- liver
- transformers
- self-attention
- retrieval-augmented-generation
- instruction-tuning
- parameter-efficient-finetuning
- mixture-of-experts
- chain-of-thought
core_contribution: 'This work addresses the challenge of generating synthetic multiparametric
  MRI data for a rare hepatocellular carcinoma subtype (MMHCC), where traditional
  data augmentation methods fall short due to their inability to realistically mimic
  pathology-specific features and preserve global anatomical structure. The proposed
  method introduces a two-stage approach: first, it generates realistic tumor masks
  by intersecting augmented tumor regions with manually segmented liver masks and
  overlaying them onto anatomical edges detected via Canny edge detection; second,
  it uses these generated masks as input to a Pix2Pix network to synthesize multiparametric
  MRI triplets (T1-FS arterial, T1-FS portal, T2) that correspond to the synthetic
  tumors.'
---

# Mask-guided Data Augmentation for Multiparametric MRI Generation with a Rare Hepatocellular Carcinoma

## Quick Facts
- arXiv ID: 2307.16314
- Source URL: https://arxiv.org/abs/2307.16314
- Reference count: 0
- Achieved FID score of 86.55 for synthetic multiparametric MRI generation, outperforming Pix2Pix (234.39) and CycleGAN (210.32)

## Executive Summary
This work addresses the challenge of generating synthetic multiparametric MRI data for a rare hepatocellular carcinoma subtype (MMHCC), where traditional data augmentation methods fall short due to their inability to realistically mimic pathology-specific features and preserve global anatomical structure. The proposed method introduces a two-stage approach: first, it generates realistic tumor masks by intersecting augmented tumor regions with manually segmented liver masks and overlaying them onto anatomical edges detected via Canny edge detection; second, it uses these generated masks as input to a Pix2Pix network to synthesize multiparametric MRI triplets (T1-FS arterial, T1-FS portal, T2) that correspond to the synthetic tumors. Trained on 89 real MMHCC patients, the model generated 1,000 synthetic cases with associated tumor masks. The method achieved a Frechet Inception Distance (FID) score of 86.55, outperforming existing approaches like Pix2Pix (234.39) and CycleGAN (210.32), demonstrating superior fidelity and diversity in synthetic image generation. This approach ensures anatomically correct tumor positioning and inter-parameter consistency, making it well-suited for medical imaging applications.

## Method Summary
The method uses a two-stage approach to generate synthetic multiparametric MRI triplets for MMHCC. In stage one, tumor masks are augmented through geometric transformations (zoom, rotation, flip, translation), intersected with manually segmented liver masks to ensure anatomical correctness, and overlaid on Canny edge detection images of the original MRI. In stage two, these combined tumor+edge masks are used as input to three parallel Pix2Pix networks, each generating one of the MRI modalities (T1-FS arterial, T1-FS portal, T2). The networks are trained with Adam optimizer (lr=0.0001, β1=0.5, β2=0.9) for 200 epochs with batch size 24, producing synthetic MRI triplets that maintain anatomical consistency and pathology-specific features.

## Key Results
- Achieved FID score of 86.55, significantly outperforming Pix2Pix (234.39) and CycleGAN (210.32)
- Generated 1,000 synthetic cases from 89 real MMHCC patients
- Successfully preserved tumor pathology-specific features and anatomical structure in synthetic images
- Ensured inter-parameter consistency across all three MRI modalities

## Why This Works (Mechanism)

### Mechanism 1
- Claim: The method ensures anatomically correct tumor positioning by intersecting augmented tumor regions with manually segmented liver masks.
- Mechanism: The intersection operation (Ims = ¯Xms ∩ Lm) filters out any tumor regions that fall outside the liver boundary, guaranteeing that all synthetic tumors are placed within anatomically plausible locations.
- Core assumption: Liver segmentation masks accurately represent the liver boundary across all patients, and tumor augmentation does not introduce tumors larger than the liver.
- Evidence anchors:
  - [abstract]: "This approach ensures anatomically correct tumor positioning and inter-parameter consistency"
  - [section]: "The last step of the first stage overlays the tumor masks Ims from the previous step on the edge detection images Emp"
  - [corpus]: Weak evidence; no direct mention of liver mask intersection in neighbors, but similar mask-guided methods exist (e.g., "Less is More: Unsupervised Mask-guided Annotated CT Image Synthesis").

### Mechanism 2
- Claim: The method preserves global anatomical structure and inter-parameter consistency by conditioning image generation on liver edges and tumor masks.
- Mechanism: By providing Pix2Pix networks with images that combine liver edge contours (Emp) and tumor masks (Ims), the model learns to generate MRI triplets that maintain consistent organ boundaries and tumor locations across different imaging sequences.
- Core assumption: The Canny edge detection reliably captures liver and organ contours, and the Pix2Pix network can learn to translate edge+tumor mask inputs into anatomically consistent MRI images.
- Evidence anchors:
  - [abstract]: "This approach ensures anatomically correct tumor positioning and inter-parameter consistency, making it well-suited for medical imaging applications"
  - [section]: "The method normalizes the input image pixels between 0 and 255. Then, the Canny operator uses a multi-stage algorithm to detect a wide range of edges in the images"
  - [corpus]: No direct evidence in neighbors, but Pix2Pix-based conditional generation is well-established for maintaining structure in translation tasks.

### Mechanism 3
- Claim: The method achieves superior FID scores by generating diverse and realistic synthetic MRI triplets through controlled tumor augmentation and edge variation.
- Mechanism: By applying multiple geometric transformations to tumor masks and varying Canny edge detection thresholds, the method creates a rich set of input conditions that force the Pix2Pix networks to generate diverse yet realistic MRI images, leading to lower FID scores.
- Core assumption: The combination of geometric tumor transformations and edge threshold variations creates sufficient diversity in training data to improve GAN generalization.
- Evidence anchors:
  - [abstract]: "The resulting Frechet Inception Distance score was 86.55... outperforming existing approaches like Pix2Pix (234.39) and CycleGAN (210.32)"
  - [section]: "Since the threshold to calculate the borders is variable, this method can generate multiple contour images from the same MRI"
  - [corpus]: No direct evidence in neighbors; however, the use of diverse conditioning inputs is a known strategy to improve GAN diversity.

## Foundational Learning

- Concept: GAN-based image-to-image translation (Pix2Pix)
  - Why needed here: Pix2Pix is used to translate edge+tumor mask inputs into realistic multiparametric MRI images while maintaining anatomical consistency.
  - Quick check question: How does Pix2Pix differ from a standard GAN, and why is it appropriate for this conditional generation task?

- Concept: Edge detection (Canny algorithm)
  - Why needed here: Canny edge detection extracts liver and organ contours that serve as structural guidance for synthetic MRI generation.
  - Quick check question: What are the key parameters of the Canny algorithm, and how do they affect edge detection quality in medical images?

- Concept: Mask intersection for spatial constraints
  - Why needed here: Intersecting tumor masks with liver masks ensures tumors are placed within anatomically plausible regions.
  - Quick check question: Why is it important to constrain tumor placement to the liver, and what could happen if this step is skipped?

## Architecture Onboarding

- Component map: Original tumor masks (Xm) + Liver segmentations (Lm) + Original MRI triplets (X1m, X2m, X3m) -> Tumor mask augmentation -> Liver mask intersection -> Canny edge detection -> Mask overlay -> Pix2Pix networks -> Synthetic MRI triplets (Y1msp, Y2msp, Y3msp) + Tumor masks (Ims)
- Critical path: Tumor mask augmentation → Liver mask intersection → Edge detection → Mask overlay → Pix2Pix generation
- Design tradeoffs:
  - Using manual liver segmentations ensures accuracy but adds annotation overhead
  - Canny edge detection is fast but may miss subtle boundaries; alternatives like U-Net could be more accurate but require more computation
  - Pix2Pix ensures consistency across MRI types but may be less flexible than unpaired methods like CycleGAN
- Failure signatures:
  - Tumors appearing outside the liver → Intersection step failed or liver masks inaccurate
  - Blurry or unrealistic MRI images → Pix2Pix training issues or insufficient diversity in conditioning inputs
  - High FID scores → Poor generalization of GAN or mismatch between real and synthetic data distributions
- First 3 experiments:
  1. Verify liver mask accuracy by overlaying them on original MRI and checking alignment
  2. Test Canny edge detection with different threshold ranges and visualize resulting edges on MRI
  3. Train a single Pix2Pix network on a subset of data and visually inspect generated MRI for anatomical plausibility

## Open Questions the Paper Calls Out
- How does the proposed mask-guided data augmentation framework impact downstream computer vision tasks such as tumor segmentation and classification?
- How sensitive is the proposed method to variations in the manual liver segmentation step, and can automated liver segmentation methods be used instead?
- Can the proposed framework be generalized to generate synthetic images for other rare pathologies beyond MMHCC?

## Limitations
- Limited quantitative validation beyond FID scores, lacking detailed metrics on tumor shape realism or anatomical accuracy
- Small dataset size (89 patients) may limit generalizability to broader clinical populations
- No comparison against state-of-the-art GAN architectures specifically designed for medical imaging

## Confidence
- High confidence in the overall two-stage methodology and its ability to generate anatomically consistent synthetic MRI triplets
- Medium confidence in the superiority of the proposed approach over baseline methods due to limited quantitative validation beyond FID scores
- Medium confidence in the clinical applicability given the specific focus on a rare tumor subtype and the lack of diverse patient demographics

## Next Checks
1. Perform quantitative analysis of tumor shape realism by measuring overlap between synthetic and real tumor masks using Dice coefficient and Hausdorff distance metrics
2. Test the model's performance on patients from different medical centers to evaluate generalization across scanner types and acquisition protocols
3. Conduct ablation studies to isolate the contribution of each component (liver mask intersection, edge detection, geometric transformations) to the final FID score