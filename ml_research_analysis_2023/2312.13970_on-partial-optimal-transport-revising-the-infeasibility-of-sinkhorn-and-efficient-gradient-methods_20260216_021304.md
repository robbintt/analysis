---
ver: rpa2
title: 'On Partial Optimal Transport: Revising the Infeasibility of Sinkhorn and Efficient
  Gradient Methods'
arxiv_id: '2312.13970'
source_url: https://arxiv.org/abs/2312.13970
tags:
- sinkhorn
- algorithm
- apdagd
- dual
- optimal
- transformers
- self-attention
- retrieval-augmented-generation
- instruction-tuning
- parameter-efficient-finetuning
- mixture-of-experts
- chain-of-thought
core_contribution: This paper addresses the Partial Optimal Transport (POT) problem,
  which seeks an optimal mapping between two unbalanced probability measures with
  at most n supports, and its applications in various AI tasks. The authors investigate
  the infeasibility of the state-of-the-art Sinkhorn algorithm for POT due to its
  incompatible rounding procedure, which degrades its qualitative performance in real-world
  applications like point-cloud registration.
---

# On Partial Optimal Transport: Revising the Infeasibility of Sinkhorn and Efficient Gradient Methods

## Quick Facts
- arXiv ID: 2312.13970
- Source URL: https://arxiv.org/abs/2312.13970
- Reference count: 40
- Key outcome: Proposes novel rounding algorithm ROUND-POT and two first-order methods (APDAGD and Dual Extrapolation) to efficiently approximate Partial Optimal Transport problems, addressing the infeasibility of Sinkhorn for POT.

## Executive Summary
This paper addresses the Partial Optimal Transport (POT) problem, which seeks an optimal mapping between two unbalanced probability measures with at most n supports. The authors identify that the state-of-the-art Sinkhorn algorithm is infeasible for POT due to its incompatible rounding procedure, which degrades qualitative performance in real-world applications. To overcome this issue, they propose a novel rounding algorithm (ROUND-POT) that projects approximate solutions onto the feasible POT set in O(n²) time. Additionally, they develop two first-order methods: Adaptive Primal-Dual Accelerated Gradient Descent (APDAGD) and Dual Extrapolation, achieving improved computational complexities of Õ(n^2.5/ε) and Õ(n²/ε) respectively.

## Method Summary
The paper proposes two main algorithms for approximating the POT problem. APDAGD uses adaptive primal-dual accelerated gradient descent on the entropic regularized POT problem, leveraging the novel dual formulation and ROUND-POT rounding algorithm to find ε-approximate solutions in Õ(n^2.5/ε) time. Dual Extrapolation reformulates POT with ℓ₁ penalization as a minimax problem and solves it using dual extrapolation with a carefully chosen area-convex regularizer, achieving the best theoretical complexity of Õ(n²/ε). Both algorithms rely on the novel ROUND-POT rounding procedure to ensure feasibility of the solutions.

## Key Results
- ROUND-POT rounding algorithm projects infeasible approximate POT solutions onto the feasible set in O(n²) time
- APDAGD achieves better ε-approximation complexity than revised Sinkhorn for POT
- Dual Extrapolation achieves the best theoretical complexity Õ(n²/ε) for POT approximation

## Why This Works (Mechanism)

### Mechanism 1
- Claim: The novel ROUND-POT rounding algorithm can project an infeasible approximate POT solution onto the feasible POT set in O(n²) time.
- Mechanism: ROUND-POT works by first enforcing the inequality constraints X1 + p = r and X^T1 + q = c through a novel Enforcing Procedure (EP) that adjusts slack variables p and q while maintaining feasibility. It then corrects the equality constraint 1^T X 1 = s by computing error vectors e1 and e2 and adjusting X accordingly.
- Core assumption: The approximate solution x satisfies ∥Ax - b∥₁ ≤ δ for some δ ≥ 0, where A encodes the POT constraints and b contains the marginals and mass s.
- Evidence anchors:
  - [section] The paper explicitly describes the rounding algorithm and its guarantees: "Given an approximate solution x = (X, p, q) ≥ 0 violating the POT constraints...ROUND-POT returns ¯x = ( ¯X, ¯p, ¯q) ≥ 0 strictly in the feasible set"
  - [abstract] "Our rounding algorithm also permits the development of two first-order methods to approximate the POT problem"
  - [corpus] Weak - the related papers mention rounding but don't provide specific evidence for ROUND-POT's mechanism
- Break condition: If the input solution violates the constraints by more than what can be corrected by the O(n²) rounding procedure, or if the rounding introduces numerical instability for very large matrices.

### Mechanism 2
- Claim: APDAGD achieves better ε-approximation complexity than the revised Sinkhorn algorithm for POT.
- Mechanism: APDAGD uses adaptive primal-dual accelerated gradient descent on the entropic regularized POT problem, leveraging the novel dual formulation and the ROUND-POT rounding algorithm. The adaptive nature allows it to find ε-approximate solutions in Õ(n^2.5/ε) time.
- Core assumption: The dual variables can be bounded appropriately (specifically ∥(y*, z*, t*)∥₂ = Õ(√n ∥C∥max)) to ensure convergence within the stated complexity.
- Evidence anchors:
  - [abstract] "The first algorithm, Adaptive Primal-Dual Accelerated Gradient Descent (APDAGD), finds an ε-approximate solution to the POT problem in Õ(n^2.5/ε), which is better in ε than revised Sinkhorn"
  - [section] "We also establish the revised complexity of Sinkhorn for POT in the following theorem" and the subsequent Theorem 3 showing Sinkhorn has complexity Õ(n²∥C∥²max/ε⁴)
  - [corpus] Weak - related papers discuss complexity bounds but don't provide specific evidence for APDAGD's mechanism
- Break condition: If the dual variable bounds are not tight enough, or if the entropic regularization parameter γ needs to be set too small for the problem, increasing the number of iterations beyond the claimed complexity.

### Mechanism 3
- Claim: Dual Extrapolation (DE) achieves the best theoretical complexity Õ(n²/ε) for POT approximation.
- Mechanism: DE reformulates the POT problem with ℓ₁ penalization as a minimax problem and solves it using the dual extrapolation framework with a carefully chosen area-convex regularizer. The algorithm is parallelizable with eO(1/ε) parallel depth.
- Core assumption: The chosen Sherman regularizer is 9-area-convex with respect to the gradient operator g, and the ℓ₁ penalization reformulation preserves the optimal value of the original POT problem.
- Evidence anchors:
  - [abstract] "The second method, Dual Extrapolation, achieves the computation complexity of Õ(n²/ε), thereby being the best in the literature"
  - [section] "From our analysis, DE is a first-order and parallelizable algorithm that can approximate POT distance up to ε accuracy with eO(1/ε) parallel depth and eO(n²/ε) total work"
  - [corpus] Weak - the related papers mention dual extrapolation but don't provide specific evidence for this POT application
- Break condition: If the area-convexity parameter κ cannot be maintained throughout the iterations, or if the ℓ₁ penalization introduces significant approximation error that accumulates over iterations.

## Foundational Learning

- Concept: Linear programming and duality theory
  - Why needed here: POT is formulated as a linear program with linear constraints, and the algorithms rely on strong duality to solve the dual problem
  - Quick check question: What is the relationship between the primal and dual optimal values in a linear program with strong duality?

- Concept: Entropic regularization and Sinkhorn algorithm
  - Why needed here: The paper builds upon entropic regularization techniques for OT and extends them to POT, requiring understanding of how entropy terms affect the problem structure
  - Quick check question: How does adding an entropic regularization term γ⟨x, log x⟩ change the optimal solution compared to the unregularized problem?

- Concept: First-order optimization methods and convergence analysis
  - Why needed here: All three proposed algorithms (revised Sinkhorn, APDAGD, and DE) are first-order methods requiring understanding of gradient descent, accelerated methods, and convergence rates
  - Quick check question: What is the difference between standard gradient descent and accelerated gradient descent in terms of convergence rate?

## Architecture Onboarding

- Component map: Input marginals and cost matrix -> ROUND-POT rounding -> APDAGD or DE optimization -> Feasible POT transport plan
- Critical path: Parse input marginals and cost matrix -> Choose algorithm (APDAGD recommended for practical use) -> Run optimization to get approximate solution -> Apply ROUND-POT to project onto feasible set -> Output final transport plan
- Design tradeoffs:
  - Complexity vs. practicality: DE has best theoretical complexity but poor practical performance compared to APDAGD
  - Accuracy vs. speed: Higher ε tolerance requires fewer iterations but less accurate solutions
  - Memory vs. computation: Sinkhorn-style methods require storing full matrices, while first-order methods can be more memory-efficient
- Failure signatures:
  - Constraint violations: If ROUND-POT fails to project onto feasible set correctly
  - Slow convergence: If dual variable bounds are not tight, causing APDAGD to require many iterations
  - Numerical instability: If entropic regularization parameter γ is set too small or too large
- First 3 experiments:
  1. Test ROUND-POT on a simple 2x2 POT problem with known solution to verify it projects correctly
  2. Compare APDAGD vs revised Sinkhorn on a small color transfer problem to verify practical speedup claims
  3. Test DE on a synthetic POT problem to verify it achieves the claimed O(n²/ε) complexity experimentally

## Open Questions the Paper Calls Out

### Open Question 1
- Question: Can the rounding algorithm ROUND-POT be generalized to other unbalanced optimal transport problems beyond the POT formulation studied here?
- Basis in paper: The authors introduce ROUND-POT as a novel rounding procedure specifically designed for POT, and mention that previous rounding algorithms for OT do not generalize to POT due to its more intricate structural constraints.
- Why unresolved: The paper does not explore the potential generalization of ROUND-POT to other unbalanced OT problems. It would be valuable to investigate if ROUND-POT can be adapted to other formulations with unbalanced marginals, such as unbalanced OT or other variants.
- What evidence would resolve it: Developing a generalized version of ROUND-POT and demonstrating its effectiveness on a range of unbalanced OT problems, comparing its performance to existing rounding algorithms and showing improved feasibility and accuracy.

### Open Question 2
- Question: How does the choice of the transported mass parameter s affect the quality and interpretability of the POT solution in real-world applications?
- Basis in paper: The authors mention that POT offers flexibility in choosing the amount of mass transported (parameter s), and demonstrate this in the color transfer application where different levels of s lead to different results. However, the impact of s on the solution quality and interpretability is not extensively explored.
- Why unresolved: The paper does not provide a systematic analysis of how the choice of s influences the POT solution in various applications. It would be valuable to investigate the relationship between s and the quality of the solution, as well as the interpretability of the transport plan.
- What evidence would resolve it: Conducting a comprehensive study on the impact of s in different applications, including sensitivity analysis, visual comparisons, and quantitative metrics to assess the solution quality and interpretability for different values of s.

### Open Question 3
- Question: Can the theoretical complexity bounds of the proposed algorithms be improved further, especially for the Dual Extrapolation (DE) method?
- Basis in paper: The authors claim that DE achieves the best theoretical complexity among existing POT solvers (eO(n^2/ε)), but mention that it has poor practical performance compared to APDAGD due to large constants dismissed by asymptotic complexity.
- Why unresolved: The paper does not explore potential improvements to the theoretical complexity bounds of DE or investigate ways to reduce the large constants that affect its practical performance. It would be valuable to analyze the theoretical guarantees more closely and develop techniques to bridge the gap between theory and practice.
- What evidence would resolve it: Deriving tighter complexity bounds for DE, analyzing the source of large constants, and proposing algorithmic modifications or implementation strategies to improve its practical performance while maintaining the theoretical guarantees.

## Limitations

- The ℓ₁ penalization approach in Dual Extrapolation may introduce approximation errors that accumulate over iterations
- The rounding algorithm may fail for very large-scale problems (n > 1000) where numerical stability becomes critical
- Practical performance gap between APDAGD and DE suggests potential issues with DE's theoretical analysis of area-convexity assumptions

## Confidence

- **High confidence**: The infeasibility of standard Sinkhorn for POT and the need for a rounding procedure
- **Medium confidence**: The theoretical complexity bounds for APDAGD and the ROUND-POT algorithm
- **Low confidence**: The practical superiority of DE over APDAGD given their experimental results

## Next Checks

1. **Convergence validation**: Test the ROUND-POT algorithm on a series of increasingly large POT problems to verify it consistently projects onto the feasible set within the claimed O(n²) time.

2. **Complexity benchmarking**: Implement both APDAGD and DE for various problem sizes and ε tolerances to empirically verify their computational complexity claims match the theoretical predictions.

3. **Numerical stability analysis**: Conduct experiments with varying cost matrix conditions (ill-conditioned vs well-conditioned) to determine the stability bounds of the proposed algorithms, particularly focusing on the entropic regularization parameter sensitivity.