---
ver: rpa2
title: 'PRP Rebooted: Advancing the State of the Art in FOND Planning'
arxiv_id: '2312.11675'
source_url: https://arxiv.org/abs/2312.11675
tags:
- planning
- state
- fond
- solution
- node
- transformers
- self-attention
- retrieval-augmented-generation
- instruction-tuning
- parameter-efficient-finetuning
- mixture-of-experts
- chain-of-thought
core_contribution: This paper introduces PR2, a novel FOND planner that significantly
  advances the state of the art. The core idea is to iteratively solve a determinized
  version of the FOND planning problem to compute weak plans, incorporating them into
  an overall solution.
---

# PRP Rebooted: Advancing the State of the Art in FOND Planning

## Quick Facts
- arXiv ID: 2312.11675
- Source URL: https://arxiv.org/abs/2312.11675
- Reference count: 40
- Key outcome: PR2 achieves 17.75 normalized coverage compared to 13.65 for the next best planner (PRP) on 18 domains with 800 problems

## Executive Summary
This paper introduces PR2, a novel FOND planner that significantly advances the state of the art. The core idea is to iteratively solve a determinized version of the FOND planning problem to compute weak plans, incorporating them into an overall solution. PR2 uses a powerful solution representation that combines a compact controller graph with a reachable state space, allowing it to maintain search progress while capturing the conditions for a strong cyclic solution. Novel techniques include better handling of deadends, a preprocessing step to simplify problems, and a new FOND-aware heuristic for the classical planning sub-process.

## Method Summary
PR2 is built on the PRP planner framework but introduces several key innovations. It uses a dual representation with CONTROLLER (a compact graph of SolSteps with partial state conditions) and REACHABLE (the full explored state space). The planner iteratively solves a determinized version of the FOND problem, using fixed-point regression to maintain strong cyclic properties in the CONTROLLER. It incorporates deadend generalization to identify forbidden state-action pairs (FSAPs) and uses a custom FOND-aware heuristic that penalizes actions leading to potential deadends. The method also includes a preprocessing step for redundant object sampling to simplify problems.

## Key Results
- PR2 achieves 17.75 normalized coverage on 18 benchmark domains with 800 problems
- Decisively outperforms four leading FOND planners (MyND, FONDSAT, PRP, Paladinus)
- Ablation studies show all introduced features provide net benefits, with the FOND-aware heuristic having the largest impact

## Why This Works (Mechanism)

### Mechanism 1
- Claim: The dual representation of CONTROLLER and REACHABLE allows the planner to maintain search progress while keeping the solution compact.
- Mechanism: CONTROLLER stores a compact graph of SolSteps with partial state conditions, while REACHABLE stores the full explored state space. Nodes in REACHABLE map to SolSteps in CONTROLLER, enabling efficient state matching and solution extension without redundant exploration.
- Core assumption: The partial states in CONTROLLER accurately capture the conditions for strong cyclic solutions, and the mapping between CONTROLLER and REACHABLE is maintained correctly during updates.
- Evidence anchors:
  - [abstract] "PR2 uses a powerful solution representation that combines a compact controller graph with a reachable state space, allowing it to maintain search progress while capturing the conditions for a strong cyclic solution."
  - [section 3.1] "Both play an essential role to P2: the dual representation allows PR2 to maintain the inner-loop search progress with the reachable state space while maintaining a compact controller representation of the partial solution."
  - [corpus] Weak evidence: No direct citations found for this specific dual representation, but related work on controller-based planning exists.

### Mechanism 2
- Claim: Fixed-point regression ensures that the partial states in CONTROLLER capture the conditions required for strong cyclic solutions.
- Mechanism: When a new edge is added to CONTROLLER, regression is applied recursively backwards through the graph, updating the partial states to reflect the combined conditions needed for strong cyclic execution. This process continues until no further updates are needed.
- Core assumption: The regression process correctly computes the combined conditions for strong cyclic solutions, and the monotonicity of the .sc property ensures correctness.
- Evidence anchors:
  - [section 3.2] "The algorithm repeatedly strengthens the conditions on the nodes found in CONTROLLER, and leaves the strengthened version as a new copy... Because of the complex ways modifications are made to the CONTROLLER, we re-establish the strong cyclic property of the CONTROLLER nodes every time there is a modification that may change their status."
  - [section 3.3] "Algorithm 3... it assumes SolSteps in CONTROLLER default to having the .sc property be false... The algorithm relies on a few key assumptions... that the conditions associated with a SolStep are sufficient for executing from that point on, regardless of future action outcomes."
  - [corpus] Weak evidence: No direct citations found for this specific regression process, but related work on regression in planning exists.

### Mechanism 3
- Claim: The FSAP-aware heuristic guides the search towards solutions that avoid deadends by penalizing actions that may be forbidden.
- Mechanism: The heuristic modifies the FF heuristic by adding a penalty to actions that are potentially forbidden based on the FSAPs found so far. This encourages the search to avoid actions that may lead to deadends.
- Core assumption: The FSAPs correctly identify actions that may lead to deadends, and the penalty in the heuristic effectively guides the search away from these actions.
- Evidence anchors:
  - [section 3.5] "PR2 further employs a custom classical heuristic that uses information from the FSAPs found so far to re-weight the hF F heuristic computation... We change the heuristic value by adding a penalty to any potentially forbidden action that is used in the computation of the heuristic value."
  - [section 3.4] "We first employ deadend generalization in the same way as SixthSense and PRP... the generalized deadend de is then regressed through every action and outcome that is consistent with de, in order to produce a set of forbidden state-action pairs (FSAPs) used in subsequent search iterations."
  - [corpus] Weak evidence: No direct citations found for this specific heuristic modification, but related work on heuristics in planning exists.

## Foundational Learning

- Concept: Regression (pre-image computation)
  - Why needed here: Regression is used to compute the conditions under which a partial state can be achieved by applying an action and outcome. This is essential for maintaining the CONTROLLER's partial states and ensuring strong cyclic solutions.
  - Quick check question: Given a partial state p, action a, and outcome o, what is the regression of p through a and o?

- Concept: Delete relaxation
  - Why needed here: The FF heuristic uses delete relaxation to compute a relaxed plan and identify helpful actions. The FSAP-aware heuristic modifies this by considering FSAPs in the relaxation.
  - Quick check question: What is the difference between the original planning problem and its delete relaxation?

- Concept: Deadend detection and generalization
  - Why needed here: Deadends are states from which the goal is not reachable. Detecting and generalizing deadends allows the planner to avoid these states in future search iterations.
  - Quick check question: How does the planner generalize a deadend to a forbidden state-action pair (FSAP)?

## Architecture Onboarding

- Component map:
  - PR2 planner (top-level) -> CONTROLLER (compact graph of SolSteps) -> REACHABLE (full explored state space) -> FSAP-aware heuristic -> Object sampling preprocessing

- Critical path:
  1. Initialize CONTROLLER and REACHABLE with the initial state.
  2. While the CONTROLLER is not strong cyclic:
     a. Pop a node from the REACHABLE's open list.
     b. Handle the node based on its type (Cases 0-6).
     c. If a new weak plan is found, update CONTROLLER and REACHABLE.
     d. If a deadend is found, record the FSAP and poison the relevant nodes.
  3. Convert the CONTROLLER to a policy and return it.

- Design tradeoffs:
  - Memory vs. search efficiency: The dual representation (CONTROLLER and REACHABLE) trades memory for search efficiency by avoiding redundant exploration.
  - Solution size vs. planning time: The CONTROLLER representation allows for compact solutions but may require more computation to maintain during updates.
  - Heuristic accuracy vs. computation time: The FSAP-aware heuristic guides the search more effectively but requires additional computation to consider FSAPs.

- Failure signatures:
  - Incorrect CONTROLLER mapping: The planner explores redundant states or fails to recognize solution states.
  - Incorrect regression: The CONTROLLER's partial states do not capture the true conditions for strong cyclic solutions.
  - Ineffective FSAPs: The search still leads to deadends despite the FSAP-aware heuristic.

- First 3 experiments:
  1. Verify the CONTROLLER-REACHABLE mapping: Create a simple problem and check that the mapping between CONTROLLER and REACHABLE is maintained correctly during updates.
  2. Test the regression process: Create a problem where a new edge is added to CONTROLLER and verify that the regression process correctly updates the partial states.
  3. Evaluate the FSAP-aware heuristic: Compare the search behavior with and without the FSAP-aware heuristic on a problem with known deadends.

## Open Questions the Paper Calls Out

### Open Question 1
- Question: How does the FSAP-aware heuristic impact the search efficiency in terms of nodes expanded and time taken compared to the standard FF heuristic?
- Basis in paper: [explicit] The paper states that the FSAP-aware heuristic provides the largest improvement in performance and mentions it modifies the FF heuristic by incorporating penalties for potentially forbidden actions.
- Why unresolved: The paper focuses on the impact on normalized coverage but does not provide specific data on search efficiency metrics like nodes expanded or time taken per node.
- What evidence would resolve it: Comparative data showing the number of nodes expanded and the time taken per node for the FSAP-aware heuristic versus the standard FF heuristic across a representative set of FOND planning problems.

### Open Question 2
- Question: What are the specific conditions under which the redundant object sampling preprocessing step is most beneficial, and are there scenarios where it might hinder performance?
- Basis in paper: [inferred] The paper introduces redundant object sampling as a preprocessing step that simplifies problems by removing redundant objects, but it does not provide a detailed analysis of its impact across different types of FOND problems.
- Why unresolved: While the paper mentions that the preprocessing step is sound-but-incomplete, it does not explore the conditions under which it is most effective or if there are cases where it could negatively impact performance.
- What evidence would resolve it: An empirical study analyzing the impact of redundant object sampling on a diverse set of FOND planning problems, including those where it significantly improves performance and those where it may not be beneficial.

### Open Question 3
- Question: How does the CONTROLLER representation compare to other solution representations in terms of solution size and execution efficiency in practice?
- Basis in paper: [explicit] The paper introduces the CONTROLLER representation as a novel solution representation that combines a compact controller graph with a reachable state space, but does not provide a direct comparison with other representations in terms of solution size and execution efficiency.
- Why unresolved: The paper discusses the theoretical advantages of the CONTROLLER representation but lacks empirical data comparing it to other representations in terms of the practical aspects of solution size and execution efficiency.
- What evidence would resolve it: Comparative experiments measuring the solution size and execution efficiency of plans generated using the CONTROLLER representation versus other solution representations across a wide range of FOND planning problems.

## Limitations

- The comparison uses only four leading FOND planners, potentially missing newer or more efficient approaches
- Coverage varies significantly across domains (0-10 problems per domain), affecting statistical significance for some domains
- Memory constraints (4GB) and timeout (60 minutes) may have prevented solving larger problems in domains like blockworlds-new

## Confidence

- Experimental evaluation: High (extensive testing on 18 domains with 800 problems)
- Algorithm correctness: High (detailed descriptions and pseudocode provided)
- Long-term impact: Medium (rapid evolution of planning algorithms may yield newer approaches)

## Next Checks

1. Verify CONTROLLER-REACHABLE mapping correctness by implementing a test suite that checks state mappings after each CONTROLLER update on simple benchmark problems.

2. Conduct a scalability analysis by systematically increasing problem sizes in the blockworlds-new domain to identify the exact memory/computation bottlenecks that prevent PR2 from scaling further.

3. Perform a domain-specific analysis comparing PR2's performance across all 18 domains to identify whether certain domain characteristics (e.g., action outcome distributions, deadend prevalence) correlate with success or failure.