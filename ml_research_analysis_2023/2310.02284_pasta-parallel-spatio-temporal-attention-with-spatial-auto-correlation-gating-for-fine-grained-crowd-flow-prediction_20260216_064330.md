---
ver: rpa2
title: 'PASTA: PArallel Spatio-Temporal Attention with spatial auto-correlation gating
  for fine-grained crowd flow prediction'
arxiv_id: '2310.02284'
source_url: https://arxiv.org/abs/2310.02284
tags:
- spatial
- attention
- temporal
- module
- fine-grained
- transformers
- self-attention
- retrieval-augmented-generation
- instruction-tuning
- parameter-efficient-finetuning
- mixture-of-experts
- chain-of-thought
core_contribution: This paper addresses the challenge of predicting fine-grained city-wide
  crowd flows, which involves handling irregular spatial patterns, multi-range spatial
  dependencies, and irrelevant temporal information. The authors propose PASTA, a
  neural network that integrates spatial auto-correlation gating, multi-scale residual
  blocks, and temporal attention gating to effectively capture these complexities.
---

# PASTA: PArallel Spatio-Temporal Attention with spatial auto-correlation gating for fine-grained crowd flow prediction

## Quick Facts
- arXiv ID: 2310.02284
- Source URL: https://arxiv.org/abs/2310.02284
- Authors: 
- Reference count: 16
- Primary result: Novel neural network that outperforms state-of-the-art baselines on fine-grained crowd flow prediction using spatial auto-correlation gating, multi-scale residual blocks, and temporal attention

## Executive Summary
This paper addresses the challenge of predicting fine-grained city-wide crowd flows by introducing PASTA, a neural network that effectively captures irregular spatial patterns, multi-range spatial dependencies, and irrelevant temporal information. The model integrates spatial auto-correlation gating using Moran's I statistics to identify and normalize irregular regions, multi-scale residual blocks with parallel convolutions to handle dependencies across different spatial scales, and temporal attention gating to filter out irrelevant historical information. Experiments on NYC-Taxi, NYC-Bike, and Seoul-Crowd datasets demonstrate that PASTA achieves lower RMSE and MAPE compared to state-of-the-art baselines, particularly excelling in fine-grained maps with irregular spatial patterns.

## Method Summary
PASTA processes historical crowd flow data partitioned into grid maps by first applying spatial positional encoding, then passing through three key modules: spatial auto-correlation gating (SAG) to normalize irregular spatial regions using Moran's I statistics, temporal attention gating (TAG) to filter irrelevant timestamps, and multi-scale residual block (MSR) to capture spatial dependencies at multiple scales. External features are processed through fully-connected layers and combined with the MSR output. The model is trained using Huber loss to reduce sensitivity to outliers. SAG identifies irregular regions by computing local Moran's I statistics, TAG applies attention weights to temporal features using pooling and fully connected layers, and MSR uses parallel convolution filters of different sizes with skip connections.

## Key Results
- PASTA outperforms state-of-the-art baselines (ST-ResNet, STDN, DSAN) on NYC-Taxi, NYC-Bike, and Seoul-Crowd datasets
- Achieves lower RMSE and MAPE metrics, particularly excelling in fine-grained maps with irregular spatial patterns
- Visualization of temporal attention module validates its ability to identify critical time points for prediction
- Demonstrates robust performance across different grid resolutions, especially in challenging high-low and low-high irregular regions

## Why This Works (Mechanism)

### Mechanism 1
- Claim: Spatial auto-correlation gating identifies and normalizes irregular spatial patterns by leveraging local Moran's I statistics to distinguish high-low and low-high regions.
- Mechanism: The model computes local Moran's I statistics for each grid cell, which measures spatial auto-correlation. Grids with negative statistics indicate irregular patterns (high-low or low-high). These values are normalized and used as gating signals to modulate the original flow data, effectively reducing noise from irregular regions.
- Core assumption: Local Moran's I statistics accurately capture the degree of spatial irregularity and can be used as a gating signal.
- Evidence anchors:
  - [abstract] "The spatial auto-correlation gating employs the concept of spatial statistics to identify irregular spatial regions."
  - [section] "Local Moran's I statistics si,j t of (i, j) grid in timestamp t is calculated as follows... These grids with negative si,j t are challenging to predict in that their spatial patterns are highly irregular."
- Break condition: If spatial patterns don't follow the first law of geography or if Moran's I doesn't capture irregularity in the specific dataset.

### Mechanism 2
- Claim: Multi-scale residual block captures multi-range spatial dependencies by using parallel convolution filters of different sizes (1×1, 3×3, 5×5) with skip connections.
- Mechanism: The architecture processes the temporally filtered features through parallel convolutional layers with varying kernel sizes. This allows the model to capture dependencies at different spatial scales simultaneously. Skip connections preserve the original information while enabling gradient flow.
- Core assumption: Different spatial scales have distinct but complementary information for predicting crowd flows.
- Evidence anchors:
  - [abstract] "The multi-scale residual block is responsible for handling multiple range spatial dependencies in the fine-grained map."
  - [section] "We designed an MSR module composed of shallow layers using parallel convolution filters of different sizes... The multiple filters are adopted with a parallel scheme."
- Break condition: If spatial dependencies are uniform across scales or if the dataset doesn't benefit from multi-scale processing.

### Mechanism 3
- Claim: Temporal attention gating filters irrelevant temporal information by assigning attention weights to each timestamp, focusing on critical time points for prediction.
- Mechanism: The module applies max-pooling and average-pooling to the spatially normalized features, then processes them through fully connected layers to generate attention weights. These weights are applied to the original features, emphasizing important timestamps while suppressing irrelevant ones.
- Core assumption: Not all historical timestamps contribute equally to future prediction; some contain noise or irrelevant information.
- Evidence anchors:
  - [abstract] "The temporal attention gating filters out irrelevant temporal information for the prediction."
  - [section] "We introduces a temporal attention gating module [11], which weights core temporal information for the prediction... The TAG module is described in Figure 2B and Figure 3."
- Break condition: If all timestamps are equally relevant or if the attention mechanism over-suppresses important temporal information.

## Foundational Learning

- Concept: Spatial auto-correlation and Moran's I statistics
  - Why needed here: To identify and normalize irregular spatial patterns that violate the first law of geography, which is crucial for accurate fine-grained crowd flow prediction.
  - Quick check question: What does a negative Local Moran's I statistic indicate about a grid cell's relationship to its neighbors?

- Concept: Multi-scale feature extraction with parallel convolutions
  - Why needed here: To capture dependencies at different spatial ranges simultaneously, as fine-grained maps contain multiple geographical hierarchies with varying inter-relations.
  - Quick check question: How does using parallel convolutions of different sizes help capture multi-range spatial dependencies?

- Concept: Temporal attention mechanisms
  - Why needed here: To filter out irrelevant historical information that introduces noise, especially important in fine-grained maps where temporal patterns change dynamically.
  - Quick check question: Why might distant historical timestamps receive lower attention weights in crowd flow prediction?

## Architecture Onboarding

- Component map: Input → Spatial Positional Encoding → Spatial Auto-correlation Gating (SAG) → Temporal Attention Gating (TAG) → Multi-scale Residual Block (MSR) → External Features → Output
- Critical path: The data flows through SAG (normalization), TAG (temporal filtering), MSR (spatial processing), and then combines with external features before final prediction. Each module adds a specific capability for handling fine-grained prediction challenges.
- Design tradeoffs: Using parallel convolutions instead of deeper single-path architectures trades parameter efficiency for explicit multi-scale processing. The attention mechanisms add computation but improve prediction accuracy by focusing on relevant information.
- Failure signatures: Poor performance on irregular regions suggests SAG isn't working correctly. Temporal attention weights being uniformly distributed indicates TAG isn't filtering effectively. If performance doesn't improve with finer grids, MSR may not be capturing the right spatial dependencies.
- First 3 experiments:
  1. Remove SAG module and compare performance on high-low vs low-high regions to verify its importance for irregular patterns.
  2. Test with single-scale convolution instead of multi-scale to validate the benefit of parallel processing for spatial dependencies.
  3. Remove temporal attention and use all timestamps equally to measure the impact of filtering irrelevant temporal information.

## Open Questions the Paper Calls Out

### Open Question 1
- Question: How does the performance of PASTA compare to other methods when predicting crowd flows in regions with highly irregular spatial patterns, such as high-low or low-high grids?
- Basis in paper: [explicit] The paper mentions that PASTA outperforms other baselines in predicting high-low and low-high grids, which are challenging due to their spatially irregular patterns.
- Why unresolved: The paper provides experimental results showing PASTA's superior performance in these regions, but does not offer a detailed comparison of its effectiveness against other methods specifically for highly irregular spatial patterns.
- What evidence would resolve it: Detailed comparative analysis of PASTA and other methods' performance specifically in regions with high-low and low-high spatial patterns, including quantitative metrics and qualitative insights.

### Open Question 2
- Question: What is the impact of varying the resolution of the grid map on the accuracy of crowd flow predictions using PASTA?
- Basis in paper: [explicit] The paper mentions that PASTA shows robust performance in fine-grained maps with high resolutions, such as 68 × 92, and that higher resolutions typically lead to lower model performance due to increased spatio-temporal irregularity.
- Why unresolved: While the paper discusses PASTA's performance across different resolutions, it does not provide a comprehensive analysis of how resolution impacts accuracy, nor does it explore the optimal resolution for different types of urban areas.
- What evidence would resolve it: A systematic study examining PASTA's accuracy across a wide range of grid resolutions, including analysis of how resolution affects performance in different urban contexts and identification of the optimal resolution for various scenarios.

### Open Question 3
- Question: How does the inclusion of external features, such as weather data, influence the accuracy of crowd flow predictions in PASTA?
- Basis in paper: [explicit] The paper mentions that external features like weather are adopted and processed through fully-connected layers to extract latent features, which are then summed with the outputs of the MSR module.
- Why unresolved: The paper does not provide experimental results or analysis on the impact of including external features on prediction accuracy, nor does it discuss which external features are most influential.
- What evidence would resolve it: Experiments comparing PASTA's performance with and without external features, as well as analysis of the relative importance of different types of external features (e.g., weather, events) on prediction accuracy.

## Limitations
- Spatial auto-correlation approach assumes first-order spatial relationships that may not hold in all cities
- Performance evaluation limited to three datasets without cross-city validation
- Computational overhead of multiple attention mechanisms and multi-scale processing not discussed
- Model's sensitivity to hyperparameter choices (window sizes, kernel dimensions) unclear

## Confidence
- High confidence in temporal attention mechanism and multi-scale residual block components
- Medium confidence in spatial auto-correlation gating, as Moran's I may not capture all types of irregular patterns
- Medium confidence in overall performance claims, as results based on three datasets may not generalize

## Next Checks
1. Test Moran's I gating sensitivity by systematically varying the neighborhood window size and measuring impact on prediction accuracy
2. Evaluate model performance on additional cities with different spatial patterns to assess generalizability
3. Conduct ablation studies comparing PASTA against simpler architectures without spatial gating to isolate the contribution of each component