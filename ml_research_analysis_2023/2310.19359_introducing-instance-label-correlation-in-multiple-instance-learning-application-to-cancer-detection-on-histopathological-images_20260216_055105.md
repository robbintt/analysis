---
ver: rpa2
title: Introducing instance label correlation in multiple instance learning. Application
  to cancer detection on histopathological images
arxiv_id: '2310.19359'
source_url: https://arxiv.org/abs/2310.19359
tags:
- vgpmil-pr-i
- which
- vgpmil-pr
- methods
- patches
- transformers
- self-attention
- retrieval-augmented-generation
- instruction-tuning
- parameter-efficient-finetuning
- mixture-of-experts
- chain-of-thought
core_contribution: "This paper introduces VGPMIL-PR-I, a multiple instance learning\
  \ method for cancer detection in histopathology images that incorporates instance\
  \ label correlation via an Ising-inspired coupling term. Building on VGPMIL-PR,\
  \ the model uses variational inference to estimate parameters and generalizes VGPMIL-PR\
  \ when the coupling strength parameter \u03BB vanishes."
---

# Introducing instance label correlation in multiple instance learning. Application to cancer detection on histopathological images

## Quick Facts
- arXiv ID: 2310.19359
- Source URL: https://arxiv.org/abs/2310.19359
- Reference count: 39
- Primary result: VGPMIL-PR-I achieves up to 95.11% accuracy and 96.44% F1-score at instance level for prostate cancer detection, outperforming state-of-the-art MIL methods

## Executive Summary
This paper introduces VGPMIL-PR-I, a probabilistic multiple instance learning method that incorporates instance label correlation for cancer detection in histopathological images. The method extends VGPMIL-PR by adding an Ising-inspired coupling term that captures spatial dependencies between neighboring patches. Applied to prostate cancer detection on SICAPv2 and PANDA datasets, the model demonstrates superior predictive performance at both instance and bag levels compared to existing probabilistic MIL methods. The correlation term effectively reduces false positive predictions while providing interpretable visualizations of patch-level cancer probabilities.

## Method Summary
VGPMIL-PR-I is a Gaussian Processes-based MIL method that incorporates instance label correlation through an Ising-inspired coupling term. The model uses variational inference to estimate parameters, with sparse GPs (M=200 inducing points) to handle the large number of patches efficiently. The coupling term C(mb) = exp(-λ/2 · Σi,j∈b,i<j 1[i,j are contiguous] · (mi - mj)²) creates smooth label distributions across neighboring patches, reducing isolated false positives. The method generalizes VGPMIL-PR when the coupling strength parameter λ vanishes, maintaining theoretical consistency while improving practical performance.

## Key Results
- Instance-level accuracy up to 95.11% and F1-score up to 96.44% on prostate cancer detection
- Superior predictive performance at both instance and bag levels compared to state-of-the-art probabilistic MIL methods
- Correlation term effectively reduces false positive predictions while maintaining sensitivity
- Interpretability through patch-level cancer probability visualizations

## Why This Works (Mechanism)

### Mechanism 1
- Claim: Incorporating Ising-inspired coupling terms reduces false positive predictions by leveraging spatial correlation among neighboring patches
- Mechanism: The coupling term C(mb) = exp(-λ/2 · Σi,j∈b,i<j 1[i,j are contiguous] · (mi - mj)²) creates a smooth label distribution across neighboring patches, making isolated false positives less likely
- Core assumption: Neighboring patches in histopathological images have correlated labels (cancerous or non-cancerous)
- Evidence anchors:
  - [abstract] "The correlation term effectively reduces false positive predictions"
  - [section] "it is natural to think that neighboring patches in the same image are likely to have similar labels"
- Break condition: When λ becomes too large (e.g., λ ≥ 5.0 in experiments), the coupling term becomes too restrictive and homogenizes predictions, damaging performance on positive bags

### Mechanism 2
- Claim: The probabilistic formulation generalizes VGPMIL-PR when coupling strength vanishes
- Mechanism: When λ → 0, the Ising coupling term disappears and the model reduces to the VGPMIL-PR formulation, maintaining theoretical consistency
- Core assumption: The VGPMIL-PR formulation is a valid baseline that can be recovered as a special case
- Evidence anchors:
  - [abstract] "Interestingly, the VGPMIL-PR formulation is recovered when the weight that regulates the strength of the Ising term vanishes"
  - [section] "when λ → 0, we have that Σb → I and we recover eq. (6)"
- Break condition: If the Gaussian Process kernel parameters are misspecified or inducing points are poorly initialized, the recovery might not be exact in practice

### Mechanism 3
- Claim: Variational inference enables tractable parameter estimation despite non-conjugacy
- Mechanism: Mean-field variational inference with approximate truncated multivariate Gaussian expectations allows optimization without intractable integrals
- Core assumption: The mean-field approximation and diagonal truncation approximation are reasonable
- Evidence anchors:
  - [section] "we leverage standard mean-field variational inference (VI) theory" and "we decided to approximate the multivariate Gaussian... by the factorized N(mb|µmb, diag(Σb))"
- Break condition: If the approximation error becomes significant, the posterior estimates may be biased and affect predictive performance

## Foundational Learning

- Concept: Multiple Instance Learning (MIL) framework
  - Why needed here: The entire problem formulation assumes only bag-level labels are available, requiring specialized learning methods
  - Quick check question: In MIL, what determines whether a bag is positive or negative?

- Concept: Gaussian Processes and sparse approximations
  - Why needed here: The model uses GP classification with inducing points to handle the large number of patches efficiently
  - Quick check question: Why are sparse GPs necessary when dealing with whole-slide images containing thousands of patches?

- Concept: Ising model and spatial correlation
  - Why needed here: The coupling term is inspired by the Ising model to capture spatial dependencies between neighboring patches
  - Quick check question: How does the Ising coupling term mathematically encourage similar labels for neighboring patches?

## Architecture Onboarding

- Component map:
  - Input: Patch feature vectors (128-dimensional)
  - GP layer: Sparse GP classification with inducing points (M=200)
  - Ising coupling: λ parameter and neighbor connectivity matrix Cb
  - Variational inference: Posterior distributions over u, f, m
  - Output: Instance-level probabilities and bag-level predictions

- Critical path:
  1. Extract patch features from WSIs
  2. Build neighbor connectivity graph for each image
  3. Initialize GP kernel and inducing points
  4. Run variational inference (alternating updates for q(u) and q(m))
  5. Make predictions using learned posterior

- Design tradeoffs:
  - Sparse vs full GP: Sparse GP reduces computational complexity from O(N³) to O(NM²)
  - Diagonal approximation: Simplifies truncated Gaussian expectations but loses some correlation structure
  - λ tuning: Trade-off between reducing false positives and maintaining sensitivity to positive patches

- Failure signatures:
  - High standard deviation across runs: Likely issues with initialization or convergence
  - Degraded performance on positive bags when λ is large: Coupling term too restrictive
  - Poor performance overall: Possible issues with feature extraction or GP kernel specification

- First 3 experiments:
  1. Verify λ=0 reproduces VGPMIL-PR performance exactly
  2. Test with synthetic data where spatial correlation is known to validate coupling mechanism
  3. Compare instance-level predictions with ground truth on a small subset of labeled patches to verify learning quality

## Open Questions the Paper Calls Out

### Open Question 1
- Question: How can the variational inference method be improved to better handle the truncated multivariate Gaussian distributions in VGPMIL-PR-I?
- Basis in paper: [explicit] The authors mention that they use a diagonal approximation to compute the expectation of the truncated multivariate Gaussian in VGPMIL-PR-I, which may limit the influence of the Ising correlation.
- Why unresolved: The paper does not explore alternative variational inference methods or provide a thorough analysis of the impact of this approximation on the model's performance.
- What evidence would resolve it: Comparing the performance of VGPMIL-PR-I with other variational inference methods, such as expectation propagation or stochastic variational inference, and evaluating the impact of different approximations on the model's predictions.

### Open Question 2
- Question: Can the hyperparameter λ be learned from the data rather than set empirically?
- Basis in paper: [explicit] The authors mention that λ regulates the strength of the Ising correlation and discuss its role, but they do not explore methods to estimate it from the data.
- Why unresolved: The paper does not provide a method to estimate λ from the data or discuss the potential benefits of doing so.
- What evidence would resolve it: Developing a method to estimate λ from the data, such as a Bayesian approach or a cross-validation procedure, and evaluating its impact on the model's performance.

### Open Question 3
- Question: How can the VGPMIL-PR-I model be extended to handle more complex image structures, such as multi-scale features or non-grid-based arrangements of patches?
- Basis in paper: [inferred] The paper focuses on modeling correlations between neighboring patches in a grid-based arrangement, but does not explore more complex image structures.
- Why unresolved: The paper does not discuss how to extend the model to handle more complex image structures or provide experimental results in this direction.
- What evidence would resolve it: Developing extensions of the VGPMIL-PR-I model to handle multi-scale features or non-grid-based arrangements of patches, and evaluating their performance on datasets with such structures.

## Limitations

- The diagonal approximation for truncated multivariate Gaussian expectations introduces approximation error that is not quantified in the paper
- The method requires careful tuning of the coupling strength λ, with results showing degradation at higher values (λ=5.0, 10.0), suggesting potential brittleness
- Performance gains from the Ising coupling term are demonstrated empirically but the theoretical conditions for when this approach is most beneficial remain unclear

## Confidence

- **High Confidence**: The mechanism of reducing false positives through spatial correlation is well-supported by the empirical results showing improved F1-scores (up to 96.44% at instance level) and reduced false positives on both SICAPv2 and PANDA datasets.
- **Medium Confidence**: The claim that VGPMIL-PR is recovered when λ→0 is theoretically sound based on the mathematical formulation, though practical implementation details may introduce deviations.
- **Low Confidence**: The diagonal approximation's impact on inference quality and the robustness of performance across different initialization schemes require further investigation.

## Next Checks

1. Conduct ablation studies with synthetic data where ground truth spatial correlations are known to quantify the exact benefit of the Ising coupling term versus random chance.
2. Perform sensitivity analysis on the diagonal approximation error by comparing against exact truncated multivariate Gaussian expectations on small-scale problems.
3. Test model robustness across multiple random initializations with statistical significance testing to verify the reported standard deviations (0.00-1.25) are consistently achievable.