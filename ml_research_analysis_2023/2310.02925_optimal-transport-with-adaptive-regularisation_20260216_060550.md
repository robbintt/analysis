---
ver: rpa2
title: Optimal Transport with Adaptive Regularisation
arxiv_id: '2310.02925'
source_url: https://arxiv.org/abs/2310.02925
tags:
- optimal
- transport
- where
- dual
- problem
- transformers
- self-attention
- retrieval-augmented-generation
- instruction-tuning
- parameter-efficient-finetuning
- mixture-of-experts
- chain-of-thought
core_contribution: This paper introduces a new formulation of optimal transport called
  OT with Adaptive RegularIsation (OTARI), which allows for controlling the smoothing
  effect of the transport plan at each source or target point individually. The key
  idea is to replace the global regularization constraint with pointwise constraints,
  ensuring a minimum amount of mass diffusion for each point.
---

# Optimal Transport with Adaptive Regularisation

## Quick Facts
- **arXiv ID:** 2310.02925
- **Source URL:** https://arxiv.org/abs/2310.02925
- **Reference count:** 40
- **Primary result:** OTARI improves domain adaptation performance by enforcing individual smoothing constraints per point, preventing outlier undersmoothing

## Executive Summary
This paper introduces OT with Adaptive Regularisation (OTARI), a novel formulation that replaces global regularization constraints with pointwise constraints in optimal transport. The key insight is that standard global regularization causes central points to receive more smoothing than outliers, creating an imbalance in mass diffusion. OTARI addresses this by ensuring each source or target point receives a minimum amount of mass diffusion, controlled by a perplexity parameter. The authors demonstrate that this approach outperforms traditional globally regularized OT on domain adaptation tasks, particularly for the negative entropy and ℓ2 norm regularizations.

## Method Summary
OTARI modifies the standard regularized optimal transport formulation by introducing pointwise constraints on the transport plan's rows and columns. The algorithm uses alternating Bregman projections (Dykstra's method) to solve the resulting optimization problem, decoupling the projection onto the pointwise constraint sets into independent subproblems for each row and column. This allows efficient computation of the transport plan while ensuring minimum smoothing per point. The method is applied to domain adaptation via barycentric mapping, where source points are transported to the target domain and a 1-NN classifier is trained on the mapped data.

## Key Results
- OTARI consistently outperforms global regularization on MNIST→USPS and USPS→MNIST domain adaptation tasks
- Performance gains are particularly significant when using negative entropy regularization
- The method effectively handles outliers by preventing them from receiving disproportionately low smoothing compared to central points
- OTARI can be tuned to interpolate between standard OT and its regularized variants through the perplexity parameter

## Why This Works (Mechanism)

### Mechanism 1
- Claim: Pointwise regularization constraints prevent outlier points from receiving disproportionately less smoothing than central points.
- Mechanism: In standard OT regularization, the smoothing effect is controlled globally, so the amount of mass diffusion per point depends on the overall cost. Outlier points require more "effort" to spread mass, leading to sparser plans for them. OTARI introduces individual constraints on each row/column, ensuring each point gets a minimum level of diffusion regardless of its position or cost.
- Core assumption: The minimum diffusion requirement per point is a valid modeling assumption for the application (e.g., domain adaptation).
- Evidence anchors:
  - [abstract]: "central data points tend to exhibit a denser (or more diffuse) transport plan compared to extreme (or outlier) data points, for which diffusion is more costly"
  - [section]: "As a result, the latter points receive limited benefits from the smoothing effect introduced by the regularizer"
- Break condition: If the application does not require uniform smoothing per point, or if the minimum diffusion constraint is set too high, performance may degrade.

### Mechanism 2
- Claim: OTARI can be solved efficiently using alternating Bregman projections with decoupled row/column subproblems.
- Mechanism: The formulation allows projection onto the pointwise constraint sets Bψ(ξ) independently for each row or column, which simplifies the alternating projection algorithm (Dykstra's method). This decouples the optimization into smaller, tractable subproblems.
- Core assumption: The Bregman divergence associated with the chosen regularizer has a simple form for the pointwise constraint projection.
- Evidence anchors:
  - [section]: "projection onto Bψ(ξ) exhibits a simple structure where the rows can be decoupled into independent subproblems"
  - [appendix]: "Proposition 3" and "Proposition 4" show explicit forms for KL and ℓ2 projections
- Break condition: If the Bregman projection onto the pointwise constraint does not decouple nicely (e.g., for other regularizers), the algorithm may become computationally expensive.

### Mechanism 3
- Claim: OTARI provides better barycentric mappings for domain adaptation by concentrating transport in high-density regions.
- Mechanism: By enforcing minimum smoothing per point, OTARI avoids mapping outlier source points to outlier target points. Instead, it concentrates the mass transport towards high-density target regions, yielding more robust and meaningful mappings for classification tasks.
- Core assumption: The domain adaptation task benefits from mapping source points to high-density target regions rather than preserving outlier-to-outlier matches.
- Evidence anchors:
  - [section]: "using pointwise constraints concentrate the mapped points in high-density regions, thus giving more robust estimates for the mappings onto the target domain"
  - [table]: OTARI outperforms global regularization in MNIST→USPS and USPS→MNIST tasks
- Break condition: If the domain shift is such that outliers should be mapped to outliers (e.g., rare classes), this mechanism could hurt performance.

## Foundational Learning

- Concept: Optimal Transport (OT)
  - Why needed here: OTARI is a generalization of regularized OT; understanding the basic formulation (primal, dual, entropic regularization) is essential.
  - Quick check question: What is the role of the regularization parameter ε in the Sinkhorn algorithm?

- Concept: Bregman Divergences and Projections
  - Why needed here: OTARI is framed as a Bregman projection onto the intersection of transport polytope and pointwise constraint set.
  - Quick check question: How does the KL divergence Bregman projection relate to the Sinkhorn algorithm?

- Concept: Dual Ascent and KKT Conditions
  - Why needed here: The dual formulation of OTARI is used to recover the optimal transport plan and dual variables.
  - Quick check question: What are the complementary slackness conditions in the KKT system for OTARI?

## Architecture Onboarding

- Component map:
  - Input: Source and target samples (XS, XT), cost matrix C, regularization parameter ξ
  - Core: Alternating Bregman projection algorithm (Dykstra) with KL or ℓ2 projections
  - Output: Transport plan P, barycentric mappings for domain adaptation

- Critical path:
  1. Compute cost matrix C (e.g., squared Euclidean distance)
  2. Initialize Bregman projection variables (Pb, Pa, Ξ, Θ)
  3. Alternate projections onto transport polytope and pointwise constraints
  4. Extract transport plan P and compute barycentric mappings

- Design tradeoffs:
  - Global vs. pointwise regularization: Global is simpler but can undersmooth outliers; pointwise ensures uniform smoothing but adds complexity.
  - Choice of regularizer (KL vs. ℓ2): KL leads to dense plans (entropic OT), ℓ2 can yield sparsity but may need careful tuning.

- Failure signatures:
  - Slow convergence: Check if dual variables ε⋆ are close to zero or if constraint sets are nearly empty.
  - Sparsity where smoothing is expected: Verify that pointwise constraints are properly enforced.
  - Numerical instability: Monitor log/exp operations in KL projections; consider adding epsilon for stability.

- First 3 experiments:
  1. Verify OTARI reduces to standard Sinkhorn when ξ is set to the average perplexity of the global plan.
  2. Compare OTARI vs. global regularization on a toy 2D domain adaptation task with known outliers.
  3. Test OTARI on a subset of MNIST→USPS with varying ξ to observe the effect on outlier handling.

## Open Questions the Paper Calls Out
The paper does not explicitly call out open questions in the provided content.

## Limitations
- The choice of the minimum diffusion requirement (ξ) is critical and may require problem-specific tuning
- Convergence properties of the alternating Bregman projection algorithm are not rigorously analyzed for all cases
- The formulation assumes the Bregman projection onto pointwise constraints has a simple structure, which may not hold for all regularizers

## Confidence
- **High Confidence**: The core idea of pointwise regularization constraints to address the imbalance in mass diffusion is well-supported by the theoretical analysis and empirical results.
- **Medium Confidence**: The efficiency of the alternating Bregman projection algorithm and its convergence properties for OTARI are reasonable given the structure of the constraints, but not rigorously proven.
- **Low Confidence**: The choice of the minimum diffusion requirement (ξ) and its impact on performance across different datasets and applications is not fully explored.

## Next Checks
1. **Convergence Analysis**: Conduct a rigorous convergence analysis of the alternating Bregman projection algorithm for OTARI, including conditions for global convergence and rates of convergence.
2. **Hyperparameter Sensitivity**: Perform an ablation study on the impact of the minimum diffusion requirement (ξ) on the performance of OTARI across different datasets and applications.
3. **Generalization to Other Regularizers**: Test OTARI with other regularizers (e.g., squared ℓ1 norm, total variation) to assess the generality of the pointwise constraint formulation and the alternating projection algorithm.