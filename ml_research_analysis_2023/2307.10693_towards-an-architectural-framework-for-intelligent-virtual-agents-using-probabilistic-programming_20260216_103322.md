---
ver: rpa2
title: Towards an architectural framework for intelligent virtual agents using probabilistic
  programming
arxiv_id: '2307.10693'
source_url: https://arxiv.org/abs/2307.10693
tags:
- user
- korraai
- probabilistic
- interactions
- used
- transformers
- self-attention
- retrieval-augmented-generation
- instruction-tuning
- parameter-efficient-finetuning
- mixture-of-experts
- chain-of-thought
core_contribution: The paper introduces KorraAI, a new framework for developing embodied
  conversational agents (ECAs) that leverage probabilistic programming to model uncertain
  behavior and context. The key idea is to use probabilistic distributions and Bayesian
  networks to control the ECA's actions and internal states, enabling more natural,
  non-repetitive interactions.
---

# Towards an architectural framework for intelligent virtual agents using probabilistic programming

## Quick Facts
- arXiv ID: 2307.10693
- Source URL: https://arxiv.org/abs/2307.10693
- Reference count: 40
- Primary result: Introduced KorraAI framework using probabilistic programming for ECAs, achieving 109 sales, 3,668 installations, and 3.2/5 rating in 3-year public deployment

## Executive Summary
This paper presents KorraAI, a novel framework for developing embodied conversational agents (ECAs) using probabilistic programming. The framework employs Bayesian networks and probabilistic distributions to model uncertain user behavior and ECA internal states, enabling more natural and adaptive interactions. KorraAI was evaluated through a public deployment of a virtual ECA named Joi and its successor April, demonstrating commercial viability while advancing the technical capabilities of ECAs through probabilistic modeling.

## Method Summary
The KorraAI framework separates ECA model definition from execution through a plugin architecture. The ECA model contains interactions, categories, probabilistic distributions, and Bayesian networks, while the execution engine manages the interaction loop, performs probabilistic sampling, and handles speech synthesis. The system uses a Main Distribution to probabilistically select interaction categories and Model Triggers to dynamically adapt behavior based on user responses or elapsed time. Probabilistic C# was used as the underlying PPL, and the framework was integrated with Unity 3D for 3D visualization and nonverbal behavior control.

## Key Results
- KorraAI framework successfully deployed with virtual ECA Joi achieving 109 sales, 3,668 installations, and 3.2/5 rating over 3 years
- Framework demonstrated ability to maintain natural, non-repetitive interactions through probabilistic category selection
- Model Triggers enabled ECA to adapt behavior dynamically based on user responses and temporal factors

## Why This Works (Mechanism)

### Mechanism 1
- Claim: Probabilistic distributions allow ECAs to model uncertain user responses and internal states, making behavior appear more natural.
- Mechanism: User responses are mapped to probability values and integrated into Bayesian networks that govern ECA behavior. This enables adaptation to user preferences and allows ECA internal states (e.g., mood, surprise) to evolve over time based on probabilistic inference.
- Core assumption: Human behavior can be approximated by probability distributions and Bayesian inference models.
- Evidence anchors:
  - [abstract]: "Probabilistic models in KorraAI are used to model its behavior and interactions with the user. They enable adaptation to the user's preferences and a certain degree of indeterminism in the ECAs to achieve more natural behavior."
  - [section]: "Responses to questions with a variable degree of uncertainty are encoded with the base category UncertainFact using a probabilistic variable... Once the answer has been mapped to probabilities, one can use, for example, InAGoodMood with a Bernoulli distribution as a part of a Bayesian network and perform inference."
  - [corpus]: Weak evidence. Corpus neighbors discuss ECAs and AI agents but do not specifically mention probabilistic programming or Bayesian networks as KorraAI does.
- Break condition: If the probabilistic model fails to capture meaningful user behavior patterns, or if inference becomes computationally prohibitive for real-time interaction.

### Mechanism 2
- Claim: The Main Distribution controls the overall ECA behavior by probabilistically selecting interaction categories, enabling non-repetitive, adaptive communication.
- Mechanism: A top-level distribution governs which category of interactions (e.g., "getting to know questions," "small talk," "advertise a product") is selected next. This distribution can evolve over time based on user responses or elapsed time, ensuring the ECA does not follow a fixed, predictable sequence.
- Core assumption: A probabilistic distribution over interaction categories can adequately represent and adapt ECA behavior over time.
- Evidence anchors:
  - [section]: "The Main Distribution governs the overall behavior of the ECA... Log Listing 1 is taken from KorraAI's log file and shows the result of probabilistic sampling of the Main Distribution over seven categories."
  - [section]: "Behavior can change mainly because of two factors: (a) an external event... (b) or time... In KorraAI, we introduce the concept of Model Triggers."
  - [corpus]: No direct evidence. Corpus neighbors discuss ECAs and AI agents but do not specifically mention Main Distributions or probabilistic category selection.
- Break condition: If the Main Distribution becomes skewed due to depleted categories or if probabilistic sampling fails to produce meaningful behavioral variation.

### Mechanism 3
- Claim: Model Triggers enable ECA behavior to change dynamically based on user responses or elapsed time, enhancing adaptability and proactivity.
- Mechanism: Two types of Model Triggers are defined: Model Update Trigger (MUT) tracks user responses and elapsed time to modify the Main Distribution and request resampling; Model Evaluate Trigger (MET) uses Bayesian models to assess situations and potentially insert new interactions into the queue (e.g., expressing surprise).
- Core assumption: ECA behavior can be effectively controlled by triggers that respond to user interactions and temporal factors.
- Evidence anchors:
  - [section]: "We introduce the concept of Model Triggers... Model Update Trigger (MUT). MUT tracks elapsed time and the user's responses... Model Evaluate Trigger (MET). It uses a Bayesian model and the user's responses to assess a situation."
  - [section]: "Behavior can change mainly because of two factors: (a) an external event, usually when new information from the user is available, (b) or time... In KorraAI, we introduce the concept of Model Triggers."
  - [corpus]: No direct evidence. Corpus neighbors discuss ECAs and AI agents but do not specifically mention Model Triggers or their role in dynamic behavior adaptation.
- Break condition: If Model Triggers fail to accurately capture relevant user behavior changes or if their computational overhead impacts real-time performance.

## Foundational Learning

- Concept: Probabilistic Programming Languages (PPLs)
  - Why needed here: PPLs allow ECA designers to define probabilistic models (e.g., Bayesian networks) without worrying about the underlying inference algorithms, simplifying the creation of complex behavioral models.
  - Quick check question: What are the two main components of a probabilistic variable in a PPL, and how do they differ from regular variables?

- Concept: Bayesian Networks
  - Why needed here: Bayesian networks represent the joint probability distribution over ECA states and user responses, enabling inference about hidden states (e.g., user stress level) and adaptation of ECA behavior.
  - Quick check question: How does a Bayesian network differ from a simple probabilistic distribution, and what advantage does it offer for modeling ECA behavior?

- Concept: Plugin Architecture
  - Why needed here: The plugin architecture separates the ECA model (behavior, interactions, distributions) from the execution engine, allowing easy exchange and modification of ECA models without changing the core framework.
  - Quick check question: What are the key benefits of using a plugin architecture for ECA models, and how does it facilitate model sharing and reuse?

## Architecture Onboarding

- Component map:
  - ECA Model (Plugin) -> Execution Engine -> Speech Synthesis & Nonverbal Behaviors
  - ECA Model contains: Interactions, Categories, Distributions, Bayesian Networks
  - Execution Engine manages: Interaction loop, Probabilistic sampling, Model Triggers

- Critical path:
  1. Load ECA model
  2. Initialize Main Distribution and Interactions Queue
  3. Execute interaction loop: Sample from Main Distribution, select interaction, perform speech adjustments, execute interaction, update states
  4. Monitor Model Triggers and update behavior as needed

- Design tradeoffs:
  - Flexibility vs. Performance: Using probabilistic distributions and Bayesian inference offers flexibility in modeling ECA behavior but can impact real-time performance if not optimized
  - Determinism vs. Indeterminism: Allowing some degree of indeterminism in ECA behavior makes it more natural but can make it harder to predict and debug
  - Complexity vs. Usability: Providing a rich set of features and customization options can make the framework more powerful but also more complex to use

- Failure signatures:
  - ECA becomes unresponsive or slow: Indicates performance issues with probabilistic inference or speech synthesis
  - ECA repeats the same interactions: Suggests a problem with the Main Distribution or interaction depletion handling
  - ECA behaves erratically or unpredictably: Points to issues with Model Triggers or Bayesian network inference
  - ECA fails to load or crashes: Indicates problems with the ECA model plugin or execution engine

- First 3 experiments:
  1. Create a simple ECA model with a single category of interactions and a uniform Main Distribution. Verify that the ECA executes interactions randomly without repetition.
  2. Add a probabilistic variable to track user responses and a Model Update Trigger to modify the Main Distribution based on user feedback. Observe how the ECA's behavior adapts over time.
  3. Implement a simple Bayesian network to model ECA internal states (e.g., mood) and use it to influence interaction selection. Verify that the ECA's behavior reflects its internal state changes.

## Open Questions the Paper Calls Out

### Open Question 1
- Question: How does controlled indeterminism in the ECA's behavior affect long-term user engagement compared to rule-based systems?
- Basis in paper: [explicit] The paper discusses "controlled indeterminism" where interactions are not hard-coded but result from applying distributions, aiming to produce more natural behavior.
- Why unresolved: While the paper mentions this approach and evaluates a public deployment, it lacks quantitative analysis comparing user engagement with deterministic vs. probabilistic systems.
- What evidence would resolve it: Controlled experiments measuring user engagement metrics (session length, return rate, interaction frequency) between KorraAI-based ECAs and rule-based ECAs over extended periods.

### Open Question 2
- Question: How can KorraAI be extended to handle multi-turn conversations where the ECA needs to maintain context across multiple interactions?
- Basis in paper: [inferred] The paper describes the Interactions Queue and category-based system, but doesn't address how context is maintained across multiple turns in complex conversations.
- Why unresolved: The current architecture focuses on individual interactions and category selection but doesn't explicitly discuss context tracking or memory mechanisms for extended dialogues.
- What evidence would resolve it: Implementation of a context management system within KorraAI and evaluation of its effectiveness in maintaining coherent multi-turn conversations.

### Open Question 3
- Question: What is the optimal balance between user preference learning and ECA autonomy in maintaining believability?
- Basis in paper: [explicit] The paper states that ECA behavior should not be completely dependent on user preferences and should include some probability of showing opposite or unexpected behaviors.
- Why unresolved: The paper proposes this balance conceptually but doesn't provide empirical data on what probability thresholds or patterns work best for maintaining believability without frustrating users.
- What evidence would resolve it: User studies varying the degree of ECA autonomy vs. preference-following and measuring perceived believability and satisfaction.

### Open Question 4
- Question: How does the performance of KorraAI's probabilistic inference scale with increasing model complexity and interaction variety?
- Basis in paper: [inferred] The paper mentions that KorraAI was tested to run for hours without crashes, but doesn't discuss performance scaling with larger models or more complex Bayesian networks.
- Why unresolved: The paper provides limited information about performance benchmarks or how the system handles increased computational load from more complex probabilistic models.
- What evidence would resolve it: Systematic performance testing with increasingly complex models and interaction sets, measuring inference time and system responsiveness.

## Limitations

- Performance Scalability: The computational overhead of continuous Bayesian network updates and probabilistic sampling in a conversational context could introduce latency or limit interaction complexity.
- Generalization Across Domains: The evaluation focused on sales assistant applications, and the framework's effectiveness for other ECA applications remains unknown.
- Evaluation Metrics: The success metrics demonstrate commercial viability but lack rigorous assessment of the probabilistic programming benefits compared to traditional approaches.

## Confidence

- High Confidence in the architectural framework design: The plugin-based architecture separating model definition from execution engine is well-specified and follows established software engineering principles.
- Medium Confidence in the probabilistic programming approach: While the theoretical foundation is sound and the mechanism descriptions are detailed, the practical benefits over deterministic approaches for ECAs remain unproven without controlled experiments.
- Low Confidence in the evaluation results: The public deployment metrics demonstrate market acceptance but do not validate the core claims about probabilistic programming enabling more natural, adaptable behavior compared to traditional approaches.

## Next Checks

- Controlled Comparative Study: Implement a deterministic version of the same ECA framework without probabilistic distributions and Bayesian networks. Conduct user studies measuring perceived naturalness, engagement, and adaptability across both versions to quantify the specific benefits of the probabilistic approach.
- Computational Performance Analysis: Profile the framework during extended interactions, measuring inference time for Bayesian networks, sampling latency for distributions, and overall CPU/memory usage. Identify performance bottlenecks and determine the maximum complexity of probabilistic models that maintain real-time interaction capabilities.
- Cross-Domain Application Testing: Port the Joi/April model to a different ECA domain (e.g., educational tutoring or therapeutic conversation). Evaluate whether the same probabilistic distributions and Bayesian networks effectively capture domain-specific behavioral patterns or require significant reconfiguration, testing the framework's generalizability.