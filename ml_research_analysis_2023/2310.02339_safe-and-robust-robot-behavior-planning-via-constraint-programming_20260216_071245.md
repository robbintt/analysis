---
ver: rpa2
title: Safe and Robust Robot Behavior Planning via Constraint Programming
arxiv_id: '2310.02339'
source_url: https://arxiv.org/abs/2310.02339
tags:
- state
- actions
- planning
- safety
- action
- transformers
- self-attention
- retrieval-augmented-generation
- instruction-tuning
- parameter-efficient-finetuning
- mixture-of-experts
- chain-of-thought
core_contribution: This work extends Tumato, a constraint-based planning framework,
  to handle non-deterministic action outcomes while maintaining safety guarantees.
  The approach models actions with both nominal (intended) and alternative (unintended)
  effects, and introduces state rules for declarative safety specification.
---

# Safe and Robust Robot Behavior Planning via Constraint Programming

## Quick Facts
- arXiv ID: 2310.02339
- Source URL: https://arxiv.org/abs/2310.02339
- Reference count: 29
- Primary result: Extends Tumato constraint-based planning to handle non-deterministic action outcomes while maintaining safety guarantees

## Executive Summary
This paper extends the Tumato constraint-based planning framework to handle non-deterministic action outcomes while maintaining safety guarantees for autonomous robotic systems. The approach introduces state rules for declarative safety specification and models actions with both nominal and alternative effects. The planner generates policies that ensure safety even when alternative effects occur, and can restore safety in the most preferred way using cost or duration values.

## Method Summary
The authors modify Tumato's constraint solver to incorporate state rules for declarative safety specification, allowing actions to have alternative effects. They assign costs to actions for preferred safety restoration and validate the extended framework using an autonomous mobile robot case study. The approach translates system specifications into constraint satisfaction problems that are solved to generate sound and complete policies.

## Key Results
- Generated policies that ensure safety even when alternative effects of actions occur
- Introduced declarative state rules that increase expressiveness compared to reaction rules
- Demonstrated early detection of unrealizable specifications through constraint solving

## Why This Works (Mechanism)

### Mechanism 1
- Claim: The planner guarantees safety by explicitly modeling both nominal and alternative action outcomes and using state rules to prevent unsafe transitions.
- Mechanism: Actions are defined with nominal effects (intended) and alternative effects (unintended but possible). State rules specify safety conditions that must always hold. The constraint solver uses these to exclude any action that could lead to a violation of a state rule in any possible outcome.
- Core assumption: The system can accurately model all foreseeable alternative outcomes of actions and the discrete state representation captures all relevant safety conditions.
- Evidence anchors:
  - [abstract] "The adapted solver generates a policy that enables reaching the goals in a safe manner, even when alternative outcomes of actions occur."
  - [section] "We introduce a purely declarative way of defining safety in Tumato, increasing its expressiveness."
  - [corpus] Weak correlation with related work on safety guarantees, but corpus does not provide direct evidence of this specific mechanism.

### Mechanism 2
- Claim: The planner can restore safety in the most preferred way by assigning costs/durations to actions and using them to minimize restoration time.
- Mechanism: When the system is in an unsafe state, the policy contains instructions to restore safety. If multiple restoration paths exist, the solver selects the one with the lowest cumulative cost/duration based on the values assigned to actions.
- Core assumption: Cost/duration values accurately reflect the relative preference for restoration paths and the solver can find the optimal solution within reasonable time.
- Evidence anchors:
  - [abstract] "the addition of cost or duration values to actions enables the solver to restore safety when necessary, in the most preferred way."
  - [section] "If multiple such instructions are available, the planner selects that set of instructions that restores safety in the most preferred way."
  - [corpus] No direct evidence in corpus, but the concept of cost-based optimization is common in related planning work.

### Mechanism 3
- Claim: The use of state rules instead of reaction rules reduces specification complexity and error-proneness.
- Mechanism: State rules specify desired safety conditions directly (e.g., "if location is corridor or charger, conveyor must be off"). The solver automatically generates constraints to enforce these conditions, replacing the need for many manual reaction rules.
- Core assumption: State rules can express all necessary safety conditions more concisely than reaction rules would require.
- Evidence anchors:
  - [abstract] "Furthermore, we introduce a purely declarative way of defining safety in Tumato, increasing its expressiveness."
  - [section] "This new kind of safety rule enables specifying constraints on reachable states rather than on the actions to execute."
  - [corpus] No direct evidence, but the reduction in manual rule specification is a common benefit of declarative approaches.

## Foundational Learning

- Concept: Constraint Satisfaction Problems (CSPs) and how they are used in planning
  - Why needed here: The entire planning approach is based on translating the system specification into CSPs that the solver can solve to generate a policy.
  - Quick check question: What are the key components of a CSP (variables, domains, constraints) and how do they map to the planning problem?

- Concept: Non-deterministic planning and the difference between fair and unfair actions
  - Why needed here: The extension handles non-deterministic action outcomes, and understanding the distinction between fair and unfair actions is important for modeling the system correctly.
  - Quick check question: What is the difference between fair and unfair non-deterministic actions, and why does this work focus on fair actions?

- Concept: Linear Temporal Logic (LTL) and its fragments for specifying goals and safety
  - Why needed here: While not directly used, understanding LTL provides context for other planning approaches and highlights the benefits of the constraint-based approach.
  - Quick check question: How can LTL be used to specify goals and safety properties, and what are the limitations compared to the constraint-based approach?

## Architecture Onboarding

- Component map: State Vector -> Resources -> Actions -> Safety Rules -> Goals -> Solver -> Monitoring Module
- Critical path:
  1. Define system specification (states, actions, resources, safety rules, goals)
  2. Translate specification to CSPs
  3. Solve CSPs to generate policy
  4. At runtime, monitor state and execute actions from policy
- Design tradeoffs:
  - Expressiveness vs. computational complexity: More complex specifications (e.g., more alternative effects, state rules) lead to larger CSPs and longer solve times.
  - Accuracy of discrete state representation vs. real-world complexity: The discrete state abstraction may not capture all relevant details, potentially leading to safety issues.
  - Cost assignment vs. optimality: Incorrect cost values can lead to suboptimal or unsafe policies.
- Failure signatures:
  - Unrealizable specification: Solver cannot find a solution, indicating conflicting safety rules or goals.
  - Incomplete policy: Solver times out or runs out of memory, suggesting the specification is too complex.
  - Unsafe behavior at runtime: Unforeseen alternative outcomes or insufficient discrete state representation.
- First 3 experiments:
  1. Implement a simple grid-world navigation problem with deterministic actions and basic safety rules to verify the core planning functionality.
  2. Extend the grid-world with non-deterministic actions and test the safety guarantees when alternative outcomes occur.
  3. Implement the AMR example from the paper and verify that the generated policy satisfies the specified safety rules and goals.

## Open Questions the Paper Calls Out

- Question: How can the state rules be extended to allow for multiple successive actions to restore safety in unsafe states?
  - Basis in paper: [inferred] The paper mentions that future research could explore how allowing multiple successive (sets of) actions in unsafe states could be required to restore safety.
  - Why unresolved: The current approach only allows for immediate restoration of safety within one step, and there is no mention of how to handle situations where multiple actions are needed.
  - What evidence would resolve it: A formal extension to the state rules that allows for multi-step safety restoration, along with experimental validation of the approach.

- Question: How can the safety rules be weighted to enable the constraint solver to find the overall best solution when different safety constraints relate to different severities?
  - Basis in paper: [inferred] The paper suggests that different safety constraints relate to different severities and that safety rules could be weighted to enable the constraint solver to find the overall best solution.
  - Why unresolved: The paper does not provide any details on how to assign weights to safety rules or how to integrate this into the existing framework.
  - What evidence would resolve it: A formal method for assigning weights to safety rules, along with experimental results showing the effectiveness of the approach.

- Question: How does the approach perform in practice, and how does it compare to the original version of Tumato and more traditional approaches?
  - Basis in paper: [explicit] The paper mentions that an empirical study will be conducted concerning the practical use of the adapted planner, including comparisons with the original version of Tumato and more traditional approaches.
  - Why unresolved: The paper does not provide any empirical results or comparisons.
  - What evidence would resolve it: Empirical results from experiments comparing the extended Tumato approach with the original version and other approaches, along with an analysis of the advantages and disadvantages of each.

## Limitations

- The approach relies on accurate modeling of all foreseeable alternative outcomes and sufficient discrete state representation to capture all relevant safety conditions.
- Effectiveness of cost-based optimization for safety restoration depends on correct cost assignment and solver performance.
- The claim that state rules reduce specification complexity and error-proneness is not directly supported by evidence in the paper.

## Confidence

- **High confidence**: The mechanism of using state rules for declarative safety specification and excluding unsafe actions based on their potential outcomes is well-founded and supported by the paper's results.
- **Medium confidence**: The approach's ability to restore safety in the most preferred way using cost/duration values is plausible but relies on correct cost assignment and solver performance.
- **Low confidence**: The claim that state rules reduce specification complexity and error-proneness is not directly supported by evidence in the paper.

## Next Checks

1. **Stress test with unforeseen outcomes**: Evaluate the system's behavior when encountering alternative outcomes not modeled in the specification to assess the robustness of safety guarantees.
2. **Discrete state representation analysis**: Analyze the impact of the discrete state abstraction on safety, identifying potential gaps or inaccuracies in representing real-world conditions.
3. **Cost assignment sensitivity**: Investigate the sensitivity of safety restoration paths to different cost assignments, ensuring that the chosen costs reflect the desired preferences and do not lead to suboptimal or unsafe policies.