---
ver: rpa2
title: 'TREEMENT: Interpretable Patient-Trial Matching via Personalized Dynamic Tree-Based
  Memory Network'
arxiv_id: '2307.09942'
source_url: https://arxiv.org/abs/2307.09942
tags:
- memory
- patient
- trial
- treement
- criteria
- transformers
- self-attention
- retrieval-augmented-generation
- instruction-tuning
- parameter-efficient-finetuning
- mixture-of-experts
- chain-of-thought
core_contribution: TREEMENT is a new interpretable patient-trial matching method that
  addresses challenges in accurately and efficiently identifying patients for clinical
  trials. The method uses a dynamic tree-based memory network to build personalized
  patient embeddings based on their longitudinal electronic health records (EHR) data.
---

# TREEMENT: Interpretable Patient-Trial Matching via Personalized Dynamic Tree-Based Memory Network

## Quick Facts
- arXiv ID: 2307.09942
- Source URL: https://arxiv.org/abs/2307.09942
- Reference count: 24
- Primary result: TREEMENT outperforms baseline models by 7% in criteria-level matching and achieves 84.9% accuracy in trial-level matching

## Executive Summary
TREEMENT introduces a novel interpretable patient-trial matching method that addresses the challenge of accurately and efficiently identifying patients for clinical trials. The method leverages a dynamic tree-based memory network to build personalized patient embeddings from longitudinal electronic health records (EHR) data, followed by an attentional beam search approach to match patients with trial eligibility criteria in a granular and interpretable way. TREEMENT was evaluated on a real-world dataset and demonstrated state-of-the-art performance, outperforming the best baseline by 7% in criteria-level matching and achieving 84.9% accuracy in trial-level matching. The method also provides interpretable results through case studies showing its ability to correctly identify relevant medical codes for easy verification of predictions.

## Method Summary
TREEMENT is a patient-trial matching method that uses a dynamic tree-based memory network to embed personalized patient data from longitudinal EHR records. The method employs hierarchical clinical ontologies to expand patient representations, capturing the semantic relationships between medical concepts. A transformer-based network is used to embed trial eligibility criteria sentences, which are then used as queries to guide an attentional beam search over the patient's knowledge-enhanced memory tree. This beam search efficiently navigates the tree to retrieve the most relevant medical codes for matching, while also providing interpretable explanations through an attention-based decision tree. The model is trained with cross-entropy loss and an inclusion/exclusion distance loss, using the Adam optimizer with a learning rate of 0.0001 for 20 epochs.

## Key Results
- TREEMENT outperforms the best baseline model by 7% in criteria-level matching
- Achieves 84.9% accuracy in trial-level matching
- Provides interpretable results through case studies showing correct identification of relevant medical codes

## Why This Works (Mechanism)

### Mechanism 1
- Claim: The dynamic tree-based memory network improves matching accuracy by representing each patient with only the medical codes present in their history, preserving granular detail while avoiding a bloated static memory.
- Mechanism: For each patient, the model builds a hierarchical tree where nodes correspond to specific medical codes enriched with ontological context. This personalization ensures memory cells contain only relevant, granular embeddings, avoiding the over-generalization seen in static memory approaches.
- Core assumption: Hierarchical medical ontologies provide sufficient context to meaningfully group codes while retaining necessary specificity for accurate matching.
- Evidence anchors:
  - [abstract] "utilizes hierarchical clinical ontologies to expand the personalized patient representation learned from sequential EHR data"
  - [section] "the memory tree only consists of memory slots for the medical concepts in the patient's record...individual slot for each concept"
  - [corpus] Weak anchor: no direct mention of hierarchical ontology usage in related works, but inferred from "tree-based" and "memory network" terminology.
- Break condition: If the hierarchical ontology fails to group codes meaningfully, the tree structure would collapse into redundant or overly broad categories, erasing the granularity advantage.

### Mechanism 2
- Claim: The attentional beam search efficiently navigates the personalized memory tree to retrieve only the most relevant medical codes for a given trial's eligibility criteria.
- Mechanism: The criteria embedding serves as a query; the beam search algorithm explores promising paths in the tree based on attention scores, expanding only unexpanded nodes and pruning the rest. This targeted retrieval avoids scanning irrelevant parts of the patient's history.
- Core assumption: The attention mechanism reliably scores relevance such that high-scoring paths contain the correct medical codes for matching.
- Evidence anchors:
  - [abstract] "uses an attentional beam-search query learned from eligibility criteria embedding to offer a granular level of alignment"
  - [section] "attentional beam search method for efficient top-down exploration of patients' knowledge-enhanced memory trees"
  - [corpus] No direct mention of beam search in related works, but implied from "attention" and "tree-based" retrieval descriptions.
- Break condition: If attention scores are noisy or uninformative, the beam search may expand irrelevant branches, leading to incorrect matches or loss of interpretability.

### Mechanism 3
- Claim: The model's interpretability stems from exposing the exact medical codes and their hierarchical relationships that drive each prediction, enabling easy human verification.
- Mechanism: The memory tree's structure plus the attention scores along the beam search path form an explanation tree. This shows which specific diagnoses, procedures, or medications were attended to and why, mapping decisions from broad categories down to granular codes.
- Core assumption: Human reviewers can reliably verify matches by inspecting the explanation tree's medical code paths.
- Evidence anchors:
  - [abstract] "provides interpretable results through case studies showing its ability to correctly identify relevant medical codes"
  - [section] "the attention paid to different individual medical codes during the beam query combine to form a decision tree"
  - [corpus] Weak anchor: interpretability is mentioned in related works but not the specific tree-based explanation mechanism.
- Break condition: If the explanation tree becomes too deep or complex, human verification may become impractical, negating the interpretability advantage.

## Foundational Learning

- Concept: Hierarchical clinical ontologies
  - Why needed here: They provide the parent-child relationships that structure the memory tree, enabling both granularity and efficient navigation.
  - Quick check question: How do hierarchical ontologies help distinguish between "Type 2 diabetes" and "Type 2 diabetes with complication" in the memory representation?

- Concept: Attention mechanisms in memory networks
  - Why needed here: They score the relevance of memory cells to the query, guiding the beam search to focus on promising paths.
  - Quick check question: Why does using attention scores to prune the search space improve both efficiency and interpretability?

- Concept: Beam search algorithm
  - Why needed here: It efficiently explores the tree by keeping only the top-k most promising paths at each depth, avoiding exhaustive search.
  - Quick check question: How does reducing the beam size from 25 to 4 during training balance exploration and efficiency?

## Architecture Onboarding

- Component map: Preprocessing -> Dynamic tree-based memory network -> Trial criteria embedding -> Attentional beam search -> Final prediction network
- Critical path: Criteria embedding -> Beam search -> Concatenation -> Prediction
- Design tradeoffs:
  - Granularity vs. memory efficiency: Dynamic trees avoid static large memory but require tree construction per patient.
  - Interpretability vs. complexity: Explanation trees are transparent but may grow unwieldy for patients with extensive histories.
  - Beam size vs. accuracy: Larger beams improve recall but increase computation and risk overfitting.
- Failure signatures:
  - Low attention scores across all nodes -> Model fails to find relevant codes.
  - Deep, unbalanced trees -> May indicate poor hierarchical grouping or noisy EHR data.
  - Inconsistent predictions across similar trials -> Could signal overfitting or insufficient contextual embeddings.
- First 3 experiments:
  1. Verify tree construction by printing the memory tree for a sample patient and checking that nodes correspond to actual medical codes.
  2. Test beam search attention by running a single criterion query and inspecting which nodes receive highest attention scores.
  3. Evaluate interpretability by manually verifying the explanation tree for a known match/mismatch case.

## Open Questions the Paper Calls Out

### Open Question 1
- Question: How does the dynamic tree-based memory network compare to other personalized embedding approaches in terms of computational efficiency and scalability?
- Basis in paper: [explicit] The paper mentions that TREEMENT's patient representation module has fewer parameters compared to baseline models, but it does not provide a direct comparison of computational efficiency or scalability.
- Why unresolved: The paper focuses on the performance and interpretability of TREEMENT but does not delve into a detailed analysis of its computational efficiency or scalability compared to other personalized embedding methods.
- What evidence would resolve it: A detailed comparative study of TREEMENT's computational efficiency and scalability against other personalized embedding approaches, including metrics such as training time, memory usage, and ability to handle large datasets.

### Open Question 2
- Question: How does TREEMENT handle eligibility criteria that require demographic information not present in the dataset, such as pregnancy information?
- Basis in paper: [explicit] The paper mentions that TREEMENT fails to accurately classify some eligibility criteria that require demographic information not present in the dataset, such as pregnancy information.
- Why unresolved: The paper does not provide a detailed explanation of how TREEMENT handles such cases or any strategies to incorporate missing demographic information.
- What evidence would resolve it: A detailed analysis of TREEMENT's performance on eligibility criteria requiring demographic information, along with strategies or modifications to incorporate missing demographic data into the model.

### Open Question 3
- Question: How does the interpretability of TREEMENT's tree structure compare to other interpretability methods, such as attention heatmaps or feature importance scores?
- Basis in paper: [explicit] The paper provides case studies comparing TREEMENT's tree structure interpretability to the attention heatmap generated by the COMPOSE model, but it does not compare TREEMENT's interpretability to other interpretability methods.
- Why unresolved: The paper focuses on comparing TREEMENT's interpretability to a specific baseline model but does not provide a broader comparison to other interpretability methods commonly used in the field.
- What evidence would resolve it: A comprehensive comparison of TREEMENT's tree structure interpretability to other interpretability methods, including attention heatmaps, feature importance scores, and other popular interpretability techniques, using metrics such as human evaluation or agreement with domain expert judgments.

## Limitations
- The proprietary nature of the evaluation dataset limits the ability to independently verify the claimed performance improvements.
- The exact preprocessing pipeline for mapping medical codes to hierarchical embeddings is not fully specified, making exact reproduction difficult.
- The impact of hierarchical clinical ontologies on matching accuracy is not empirically validated through ablation studies.

## Confidence
- High confidence: The core mechanism of using dynamic tree-based memory networks for personalized patient representation and attentional beam search for efficient matching is well-supported by the described architecture and evaluation results.
- Medium confidence: The claimed interpretability through explanation trees is plausible given the described attention mechanism, but practical usability depends on the complexity of real patient histories and the clarity of the generated explanations.
- Low confidence: The exact impact of hierarchical clinical ontologies on matching accuracy is not empirically validated - the paper claims this is important but doesn't isolate its contribution through ablation studies.

## Next Checks
1. **Tree construction validation**: Verify that the memory tree correctly maps each medical code to its hierarchical ontology levels by inspecting the tree structure for sample patients and confirming proper parent-child relationships.
2. **Attention mechanism testing**: Run beam search on known matching and non-matching criteria to verify that attention scores correctly identify relevant medical codes and that the top-k selection aligns with ground truth.
3. **Interpretability assessment**: Conduct a human evaluation where medical experts attempt to verify predictions using the explanation trees, measuring time required and accuracy of verification across different patient complexity levels.