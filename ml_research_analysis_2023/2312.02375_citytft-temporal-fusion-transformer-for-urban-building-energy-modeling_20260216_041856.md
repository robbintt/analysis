---
ver: rpa2
title: 'CityTFT: Temporal Fusion Transformer for Urban Building Energy Modeling'
arxiv_id: '2312.02375'
source_url: https://arxiv.org/abs/2312.02375
tags:
- climate
- energy
- loads
- urban
- building
- transformers
- self-attention
- retrieval-augmented-generation
- instruction-tuning
- parameter-efficient-finetuning
- mixture-of-experts
- chain-of-thought
core_contribution: This paper proposes CityTFT, a data-driven urban building energy
  modeling (UBEM) framework based on the Temporal Fusion Transformer (TFT) architecture.
  CityTFT aims to accurately predict heating and cooling energy demands in urban environments
  by leveraging simplified building parameters and weather data as inputs.
---

# CityTFT: Temporal Fusion Transformer for Urban Building Energy Modeling

## Quick Facts
- arXiv ID: 2312.02375
- Source URL: https://arxiv.org/abs/2312.02375
- Reference count: 15
- Primary result: CityTFT achieves 99.98% F1 score for heating/cooling trigger prediction and 13.57 kWh RMSE for energy load predictions on unseen climate scenarios

## Executive Summary
This paper introduces CityTFT, a data-driven urban building energy modeling (UBEM) framework that leverages the Temporal Fusion Transformer (TFT) architecture to predict heating and cooling energy demands in urban environments. The model uses simplified building parameters and weather data as inputs, achieving superior performance compared to RNN and transformer baselines. CityTFT demonstrates strong generalizability across different climate zones while maintaining high accuracy in predicting both energy demand triggers and load magnitudes.

## Method Summary
CityTFT is built on the TFT architecture with modifications for sequential modeling of urban energy consumption. The framework incorporates a variable selection network for instance-wise feature selection, a static covariate encoder for building parameters and weather data, and temporal processing using self-attention mechanisms. A customized probabilistic loss function handles the imbalanced distribution of heating/cooling triggers (with many zero values) by combining probabilistic loss for trigger prediction and quantile loss for energy load estimation. The model is trained on hourly data from 21 climate zones using AdamW optimizer for 400 epochs.

## Key Results
- Achieves 99.98% F1 score for predicting heating/cooling system triggers
- Maintains 13.57 kWh RMSE for energy load predictions across unseen climate scenarios
- Demonstrates strong generalizability across 21 different climate zones
- Outperforms RNN and transformer baselines in both trigger detection and energy load prediction

## Why This Works (Mechanism)

### Mechanism 1
- Claim: The variable selection network enables instance-wise variable selection to improve temporal accuracy.
- Mechanism: The variable selection network applies linear transformations to each variable into a dmodel dimension vector, then uses Gated Residual Networks (GRN) to enrich static features and self-attention layers for temporal feature processing. This allows the model to dynamically select relevant variables for each instance.
- Core assumption: Instance-wise variable selection improves temporal accuracy by focusing on the most relevant features for each prediction.
- Evidence anchors:
  - [abstract] mentions "variable selection network" as a key element
  - [section] describes "The variable section network is applied to both static building properties and temporal weather covariates to provide instance-wise variable selection"
- Break condition: If the variable selection mechanism fails to identify the most relevant features, or if all features are equally important, the benefits of instance-wise selection would be lost.

### Mechanism 2
- Claim: The customized probabilistic loss function handles the imbalanced data distribution of heating/cooling triggers.
- Mechanism: The loss function combines a probabilistic loss component that handles the binary classification of whether heating/cooling systems are triggered, and a quantile loss component that optimizes the range of likely target values for non-zero loads. This addresses the issue where about 30-50% of heating/cooling loads are zero.
- Core assumption: The zero-inflated nature of the energy demand data requires a specialized loss function to prevent the model from systematically underestimating energy demands.
- Evidence anchors:
  - [section] states "Since about 30 and 50 percent of the heating and cooling loads are zero, this work proposes a probabilistic-based loss to handle the imbalanced data"
  - [section] provides the mathematical formulation of the probabilistic and quantile loss components
- Break condition: If the data distribution changes significantly (e.g., fewer zero values), the customized loss function may become suboptimal and could be replaced with a simpler loss function.

### Mechanism 3
- Claim: Sequential modeling in the TFT architecture improves temporal accuracy compared to forecasting-based approaches.
- Mechanism: The CityTFT model aborts the future encoder part from the original TFT and applies the original observed temporal features for static enrichment and self-attention processing. This allows the model to predict energy demands for the same temporal period rather than future periods.
- Core assumption: Predicting energy demands for the same temporal period is more appropriate for urban building energy modeling than forecasting future demands.
- Evidence anchors:
  - [section] explains "Different from the original TFT, this work aims to predict the energy demands in the same temporal period i.e. sequential modeling, unlike the purpose of the forecasting mission in the original paper"
  - [section] mentions the model "aborts the future encoder part from the model"
- Break condition: If the task requirements change to forecasting future energy demands, the sequential modeling approach would need to be modified to include the future encoder.

## Foundational Learning

- Concept: Temporal Fusion Transformer (TFT) architecture
  - Why needed here: TFT provides the underlying framework for CityTFT, combining variable selection, static covariate encoding, and temporal processing to accurately model energy demands
  - Quick check question: What are the three key elements of the TFT architecture mentioned in the paper?

- Concept: Variable selection networks and self-attention mechanisms
  - Why needed here: These components enable instance-wise variable selection and temporal feature processing, which are crucial for improving the accuracy of urban building energy modeling
  - Quick check question: How does the variable selection network in CityTFT differ from traditional approaches?

- Concept: Loss functions for imbalanced data
  - Why needed here: The customized probabilistic loss function handles the imbalanced distribution of heating/cooling triggers (many zero values), preventing the model from systematically underestimating energy demands
  - Quick check question: Why is a quantile loss component included in the loss function, and what problem does it address?

## Architecture Onboarding

- Component map:
  Weather data and building parameters → Variable selection network → Static covariate encoder → Temporal processing → Decoder → Probabilistic output layer → Loss function (probabilistic + quantile)

- Critical path: Weather data and building parameters → Variable selection network → Static covariate encoder → Temporal processing → Decoder → Probabilistic output layer → Loss function (probabilistic + quantile)

- Design tradeoffs: The paper mentions that the TFT model performs better than RNN and transformer baselines, but doesn't explicitly discuss design tradeoffs. However, the use of sequential modeling instead of forecasting, and the customized probabilistic loss function, suggest tradeoffs between accuracy and computational efficiency.

- Failure signatures:
  - Poor F1 score for predicting heating/cooling triggers: Could indicate issues with the variable selection network or the probabilistic loss function
  - High RMSE for energy load predictions: Could indicate problems with the temporal processing or the quantile loss component
  - Overfitting on training data: Could suggest the need for regularization or a simpler model architecture

- First 3 experiments:
  1. Compare the performance of CityTFT with and without the variable selection network to quantify its impact on accuracy
  2. Test different loss function configurations (e.g., only probabilistic loss, only quantile loss, or different weightings) to optimize the handling of imbalanced data
  3. Evaluate the model's performance on different climate zones to assess its generalizability and identify potential weaknesses

## Open Questions the Paper Calls Out

### Open Question 1
- Question: How does CityTFT perform when evaluated on climate change data from CMIP6, which represents more extreme and variable climate scenarios than the TMY data used in this study?
- Basis in paper: [explicit] The authors mention that a thorough examination should be made to evaluate CityTFT on climate change data like CMIP6.
- Why unresolved: The study only used TMY data from 21 climate zones, which may not capture the full range of potential future climate conditions.
- What evidence would resolve it: Evaluating CityTFT on CMIP6 data and comparing its performance metrics (e.g., RMSE, F1 score) with those obtained from TMY data would provide evidence of its generalizability to more extreme climate scenarios.

### Open Question 2
- Question: What is the lower limit of CityTFT's performance when using more concise input data from publicly available sources, such as satellite observations or OpenStreetMap data, instead of detailed building parameters?
- Basis in paper: [explicit] The authors suggest that the community could realize substantial benefits if CityTFT could operate comparably on more concise input from publicly available data sources.
- Why unresolved: The study used detailed building parameters calibrated from CitySim, but it's unclear how well CityTFT would perform with less detailed inputs.
- What evidence would resolve it: Conducting an ablation analysis where CityTFT is trained and tested using progressively less detailed building data (e.g., only satellite-derived features) and comparing its performance metrics with those from the original study would indicate the minimum input requirements for acceptable performance.

### Open Question 3
- Question: What is the impact of the sequential modeling approach used in CityTFT compared to the original TFT's forecasting mission, and how does it affect the model's ability to capture temporal dependencies in urban energy consumption?
- Basis in paper: [inferred] The authors mention that they modified the original TFT by aborting the future encoder part and applying the original observed temporal features for static enrichment and self-attention processing.
- Why unresolved: While the authors state that sequential modeling is used, they do not provide a detailed comparison of its effectiveness versus the original TFT's forecasting approach.
- What evidence would resolve it: Conducting experiments where CityTFT is compared against both the original TFT and other baseline models (e.g., RNN, transformer) in terms of their ability to capture temporal dependencies and predict energy consumption accurately would provide insights into the effectiveness of the sequential modeling approach.

## Limitations

- The transformation from CitySim XML building geometries to the 13 input variables is not fully specified, creating potential reproducibility challenges
- Performance metrics are based on data from a single urban environment (Singapore), raising questions about generalizability to buildings with significantly different architectural characteristics
- The specific configurations and hyperparameters of RNN and transformer baselines are not detailed, making performance comparisons difficult to verify

## Confidence

- High confidence in the architectural validity of the TFT-based approach for UBEM
- Medium confidence in the generalizability claims across climate zones
- Low confidence in the exact implementation details required for reproduction

## Next Checks

1. **Architecture ablation study**: Remove the variable selection network from CityTFT and compare performance to the full model to quantify the exact contribution of this component to the reported accuracy

2. **Cross-climate validation**: Test CityTFT on buildings from climate zones not represented in the original dataset (e.g., cold continental climates) to validate the claimed generalizability across Koppen climate zones

3. **Baseline reimplementation**: Reimplement the RNN and transformer baselines using identical data preprocessing and hyperparameter tuning to verify the claimed performance improvements