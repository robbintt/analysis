---
ver: rpa2
title: 'RACR-MIL: Rank-aware contextual reasoning for weakly supervised grading of
  squamous cell carcinoma using whole slide images'
arxiv_id: '2308.15618'
source_url: https://arxiv.org/abs/2308.15618
tags:
- tumor
- grade
- patches
- depth
- attention
- transformers
- self-attention
- retrieval-augmented-generation
- instruction-tuning
- parameter-efficient-finetuning
- mixture-of-experts
- chain-of-thought
core_contribution: This paper introduces RACR-MIL, a weakly-supervised approach for
  grading squamous cell carcinoma (SCC) using whole slide images. The method addresses
  challenges in SCC grading, including tumor heterogeneity and the need for contextual
  information, by incorporating a hybrid WSI graph that captures both local and non-local
  dependencies, and a rank-ordering constraint in the attention mechanism to prioritize
  higher-grade tumor regions.
---

# RACR-MIL: Rank-aware contextual reasoning for weakly supervised grading of squamous cell carcinoma using whole slide images

## Quick Facts
- arXiv ID: 2308.15618
- Source URL: https://arxiv.org/abs/2308.15618
- Reference count: 7
- Key outcome: RACR-MIL achieves 3-9% higher grading accuracy and up to 16% better tumor localization compared to existing methods for weakly-supervised SCC grading

## Executive Summary
RACR-MIL introduces a weakly-supervised approach for grading squamous cell carcinoma using whole slide images, addressing challenges of tumor heterogeneity and limited annotations. The method combines a hybrid WSI graph that captures both local and non-local dependencies with a rank-ordering constraint in the attention mechanism to prioritize higher-grade tumor regions. By incorporating tumor depth as an auxiliary task, RACR-MIL achieves state-of-the-art performance across multiple SCC datasets with improved resilience to class imbalance.

## Method Summary
RACR-MIL uses self-supervised pre-trained transformer features from 448×448 patches extracted from downsampled WSIs. A hybrid graph is constructed using spatial K-nearest neighbors and semantic similarity edges with personalized PageRank diffusion. The graph convolution network extracts contextual features, which are aggregated using attention-based MIL with rank-ordering constraints between adjacent grade classes. The model jointly predicts grade classification, tumor depth regression, and optimizes interclass and intraclass ranking losses. Training uses class-balanced sampling and Adam optimizer with 60 epochs.

## Key Results
- Achieves 3-9% higher grading accuracy compared to existing methods
- Improves tumor localization by up to 16% against baseline approaches
- Demonstrates better resilience to class imbalance across SCC datasets

## Why This Works (Mechanism)

### Mechanism 1
Rank-aware attention prioritizes higher-grade tumor regions by enforcing pairwise inequality constraints between patches of adjacent grades. The interclass ranking loss compares pseudo-labeled patches from adjacent grade classes and imposes a soft constraint that attention weights increase monotonically with grade severity. Core assumption: Pseudo-labels derived from class probability thresholds reliably reflect the true grade order of patches within a WSI. Evidence: "a rank-ordering constraint in the attention mechanism that consistently prioritizes higher-grade tumor regions" and "We derive a set of pairs (i,j) of pseudo-labeled patches belonging to two adjacent classes...and impose a soft ordinal constraint on their attention weights (wi < wj)". Break condition: Inconsistent pseudo-labeling could misdirect attention away from the most clinically relevant tumor regions.

### Mechanism 2
Hybrid graph construction with both spatial and semantic edges captures tumor heterogeneity better than single-type graphs. The adjacency matrix combines K-nearest neighbor spatial edges (capturing local tumor microenvironment) with semantic similarity edges (capturing long-range relationships between phenotypically similar tumor regions). Core assumption: Tumor regions with similar morphology are likely to have similar grades, even when spatially distant. Evidence: "a hybrid WSI graph that captures both local tissue context and non-local phenotypical dependencies between tumor regions" and "The edges capture the pathology-related structure and interdependence among tumor regions via two types of contextual dependencies... (i) Asem, which represents non-local dependencies between patches that may be spatially distant, but are similar in terms of their tissue structure (grade)". Break condition: If tumor grade does not correlate with patch feature similarity, semantic edges could introduce noise.

### Mechanism 3
Tumor depth as an auxiliary task provides regularization that improves grade classification accuracy. Depth prediction shares the graph network with grade classification, creating a multitask learning framework where features useful for both tasks are emphasized. Core assumption: The relationship between tumor depth and grade is consistent and strong enough across the dataset to provide meaningful training signal. Evidence: "tumor depth as an auxiliary task to improve grade classification" and "Prior studies have shown that tumor grade is significantly associated with tumor depth...To capture the relationship between depth and grade, we develop a multitask framework that predicts depth and grade jointly". Break condition: If depth-grade correlation varies significantly across different anatomical sites, the auxiliary task could introduce conflicting gradients.

## Foundational Learning

- Concept: Multiple Instance Learning (MIL)
  - Why needed here: WSIs are labeled at the bag level (WSI grade) but individual patches lack labels, requiring MIL to aggregate patch-level information into WSI predictions.
  - Quick check question: In MIL, what is the relationship between instance labels and bag labels, and why is this suitable for weakly-supervised WSI grading?

- Concept: Graph Neural Networks (GNNs)
  - Why needed here: GNNs capture spatial and semantic dependencies between patches, enabling the model to incorporate contextual information beyond individual patch features.
  - Quick check question: How does message passing in a GNN differ from simple concatenation or pooling of patch features, and why is this important for capturing tumor heterogeneity?

- Concept: Attention Mechanisms
  - Why needed here: Attention allows the model to weight patches differently based on their relevance to grade classification, rather than treating all patches equally.
  - Quick check question: What advantage does attention-based aggregation have over max/mean pooling when dealing with WSIs containing both tumor and non-tumor regions?

## Architecture Onboarding

- Component map: Patch feature extraction -> Graph construction (spatial + semantic edges) -> Graph convolution (2-layer GConv) -> Attention aggregation -> Grade classification + Depth regression + Ranking losses
- Critical path: The graph convolution layer is the bottleneck - it transforms local features into contextual representations that drive both classification and attention mechanisms.
- Design tradeoffs: Using semantic edges increases model capacity and ability to capture long-range dependencies but also increases computational cost and risk of overfitting; using depth as auxiliary task adds training signal but requires additional annotation.
- Failure signatures: If attention consistently focuses on non-tumor regions, check pseudo-labeling quality; if model overfits to well-differentiated class, examine class imbalance handling and feature separability in tSNE plots.
- First 3 experiments:
  1. Compare performance with only spatial edges vs only semantic edges to quantify contribution of each edge type
  2. Test different K values for K-nearest neighbors in graph construction to optimize balance between local and global information
  3. Evaluate impact of removing rank-ordering constraint to measure its contribution to classification accuracy

## Open Questions the Paper Calls Out

- Question: How does the inclusion of tumor depth as an auxiliary task impact the model's ability to distinguish between different grade classes in challenging cases?
  - Basis in paper: [explicit] The paper states that using depth as an auxiliary task did not improve grading but did enhance tumor localization.
  - Why unresolved: While the paper shows improved localization, it does not fully explore how depth impacts the model's performance in differentiating between challenging grade classes.
  - What evidence would resolve it: A detailed analysis comparing the model's performance on challenging grade classes with and without the depth auxiliary task would provide insights into its impact on classification accuracy.

- Question: What is the effect of using self-attention-based dynamic edge weights in the graph convolution network compared to fixed edge weights on the model's overall performance?
  - Basis in paper: [explicit] The paper mentions that learning edge weights using graph attention is more effective than using predefined edge weights for higher-risk cases.
  - Why unresolved: The paper provides a comparison but does not delve into the specific reasons why dynamic edge weights lead to better performance, nor does it explore the impact on lower-risk cases.
  - What evidence would resolve it: A comprehensive study comparing the performance of models using fixed versus dynamic edge weights across all grade classes would clarify the advantages of each approach.

- Question: How can the model be improved to reduce false positives by better distinguishing between tumor and non-tumor patches?
  - Basis in paper: [inferred] The paper notes that the model can confuse non-tumor patches with tumor patches, leading to false positives.
  - Why unresolved: The paper acknowledges the issue but does not propose specific solutions or improvements to address this limitation.
  - What evidence would resolve it: Experiments testing different feature extraction techniques or contextual information integration methods to enhance the model's ability to differentiate between tumor and non-tumor patches would provide insights into potential improvements.

## Limitations
- Data Specificity and Generalization: Trained on single institutional dataset of cutaneous SCC, with significant performance drop (64.1% accuracy) on external esophageal SCC validation
- Pseudo-label Quality: Rank-ordering constraint depends critically on quality of pseudo-labels generated from thresholded class probabilities, which may contain errors in heterogeneous tumor regions
- Computational Complexity: Hybrid graph construction has O(n²) complexity for n patches per WSI, potentially limiting scalability to larger datasets or higher-resolution WSIs

## Confidence

- **RACR-MIL achieves state-of-the-art performance across multiple SCC datasets** (High): Supported by extensive comparative experiments showing 3-9% accuracy improvement over multiple baselines on primary dataset, and reasonable performance on external validation
- **Rank-aware attention consistently prioritizes higher-grade tumor regions** (Medium): Theoretically sound with ablation studies showing rank loss contributes 1-2% accuracy, but pseudo-label reliability introduces uncertainty
- **Hybrid graph captures both local and non-local dependencies effectively** (Medium): Well-motivated dual-edge approach with demonstrated contribution, but optimal balance may vary by tumor type and dataset characteristics

## Next Checks

1. Ablation on pseudo-labeling threshold: Systematically vary the 0.6 probability threshold for pseudo-label generation and measure its impact on rank loss effectiveness and overall classification accuracy

2. Cross-tumor type validation: Test the model on at least two additional SCC subtypes (e.g., oral and cervical) to evaluate whether the hybrid graph approach generalizes beyond cutaneous SCC

3. Computational efficiency analysis: Profile runtime and memory requirements for WSI processing, and evaluate whether semantic similarity computation becomes prohibitive as WSI size increases or whether approximate methods could maintain accuracy while reducing complexity