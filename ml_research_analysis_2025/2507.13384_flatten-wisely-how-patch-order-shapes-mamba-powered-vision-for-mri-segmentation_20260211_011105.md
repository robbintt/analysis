---
ver: rpa2
title: 'Flatten Wisely: How Patch Order Shapes Mamba-Powered Vision for MRI Segmentation'
arxiv_id: '2507.13384'
source_url: https://arxiv.org/abs/2507.13384
tags:
- scan
- experiment
- segmentation
- mamba
- order
- transformers
- self-attention
- retrieval-augmented-generation
- instruction-tuning
- parameter-efficient-finetuning
- mixture-of-experts
- chain-of-thought
core_contribution: This study demonstrates that patch scan order is a statistically
  significant and practically impactful hyperparameter for Vision Mamba models in
  brain MRI segmentation. By introducing Multi-Scan 2D (MS2D), a parameter-free module,
  the authors systematically benchmarked 21 scan strategies across three datasets
  (BraTS 2020, ISLES 2022, LGG), covering over 70,000 slices.
---

# Flatten Wisely: How Patch Order Shapes Mamba-Powered Vision for MRI Segmentation

## Quick Facts
- **arXiv ID**: 2507.13384
- **Source URL**: https://arxiv.org/abs/2507.13384
- **Authors**: Osama Hardan; Omar Elshenhabi; Tamer Khattab; Mohamed Mabrok
- **Reference count**: 23
- **Primary Result**: Spatially contiguous raster scans outperform disjointed diagonal scans by up to 27 Dice points in brain MRI segmentation

## Executive Summary
This study demonstrates that patch scan order is a critical hyperparameter for Vision Mamba models in medical image segmentation. The authors introduce Multi-Scan 2D (MS2D), a parameter-free module that systematically evaluates 21 different patch scan strategies across three MRI datasets totaling over 70,000 slices. Results show that simple horizontal and vertical raster scans consistently outperform more complex diagonal and serpentine patterns, with performance differences reaching 27 Dice points. The Friedman test confirms scan order's statistical significance (χ²₂₀=43.9, p=0.0016), establishing patch order as a powerful, cost-free optimization opportunity for Mamba-based medical vision models.

## Method Summary
The study benchmarks Vision Mamba models on brain MRI segmentation tasks using a systematic evaluation of patch scan orders. The authors implement Multi-Scan 2D (MS2D), a parameter-free module that applies different scan strategies to feature maps within the VSS block of a VM-UNet architecture. They evaluate 21 distinct scan patterns across three datasets (BraTS 2020, ISLES 2022, LGG), covering various scan types including horizontal/vertical rasters, diagonals, and serpentines. Performance is measured using Dice coefficient, with statistical significance assessed via Friedman test across datasets.

## Key Results
- Spatially contiguous raster scans (horizontal/vertical) consistently outperform disjointed diagonal scans by up to 27 Dice points
- The Friedman test confirms scan order is statistically significant (χ²₂₀=43.9, p=0.0016) across all datasets
- Four-direction orthogonal scan combinations provide robust performance gains without increasing parameters
- ISLES 2022 showed highest variance (0.269 Delta), indicating sensitivity to scan strategy choice
- Performance differences between optimal and worst scan strategies can exceed 20 Dice points

## Why This Works (Mechanism)

### Mechanism 1
- **Claim**: Spatially contiguous scan paths maximize alignment between image locality and sequence locality
- **Mechanism**: State Space Models process tokens sequentially; keeping physically adjacent pixels adjacent in the sequence prevents the recurrent state from bridging large memory gaps
- **Core assumption**: Target pathologies consist primarily of spatially contiguous masses rather than scattered points
- **Evidence anchors**: [abstract] contiguous paths outperform disjointed diagonal scans; [page 6] raster scan traverses regions coherently; [corpus] REOrdering Patches Improves Vision Models (ID 102809)

### Mechanism 2
- **Claim**: Disjointed scans impose a complexity tax by forcing the model to reconstruct spatial locality
- **Mechanism**: Diagonal scans create large spatial jumps between consecutive tokens, requiring the SSM to expend capacity learning to "stitch" distant neighbors back together
- **Core assumption**: SSM's effective receptive field struggles to efficiently relate distant-in-sequence but close-in-space tokens
- **Evidence anchors**: [page 6] diagonal scan creates large spatial "jumps"; [abstract] performance variance up to 27 Dice points; [corpus] Visual Attention Exploration in Vision-Based Mamba Models (ID 18381)

### Mechanism 3
- **Claim**: Multi-directional orthogonal scans aggregate directional anatomical priors
- **Mechanism**: Brain MRI structures exhibit anisotropy; aggregating scans along horizontal and vertical axes captures features aligned to those axes
- **Core assumption**: Anatomical structures of interest have strong directional regularities aligned with image axes
- **Evidence anchors**: [page 2] neuro-anatomical data possess strong directional regularities; [page 6] success of four-direction orthogonal mix; [corpus] limited direct anatomical evidence

## Foundational Learning

- **Concept**: State Space Models (SSMs) & Serialization
  - **Why needed here**: Mamba processes images as 1D streams, making scan order the model's perspective
  - **Quick check question**: Why does flattening a 2D image into a 1D sequence create a "scan order" problem for SSMs but not for standard CNNs?

- **Concept**: Spatial Locality vs. Sequence Distance
  - **Why needed here**: "Spatial jumps" hurt performance because increasing distance between related tokens makes it harder for recurrent models to learn relationships
  - **Quick check question**: In a diagonal scan, two pixels that are neighbors in the image might be 30 steps apart in the sequence. Why is this "distance" problematic for a recurrent state?

- **Concept**: The Friedman Test
  - **Why needed here**: Used to prove significance across multiple datasets when comparing 21 different scan strategies
  - **Quick check question**: Why is a non-parametric test used here instead of standard ANOVA when comparing 21 scan strategies across 3 datasets?

## Architecture Onboarding

- **Component map**: Input Slice (128x128) -> Patch Embedding (4x4 patches -> 32x32 grid) -> **MS2D Selection** -> Stream Processing -> Summation -> VSS Block (LayerNorm -> DW-Conv -> **MS2D** -> Linear) -> Output

- **Critical path**:
  1. Input Slice (128x128)
  2. Patch Embedding (4x4 patches -> 32x32 grid)
  3. MS2D Selection: Choose k (1, 2, or 4) unique scans
  4. Stream Processing: Duplicate scans to fill 4 parallel streams
  5. Summation: Aggregate the 4 output streams element-wise

- **Design tradeoffs**:
  - Contiguity vs. Diversity: Single contiguous scans are computationally cheapest but may miss orthogonal features; four-direction mixes offer robustness but require managing 4 distinct paths
  - Redundancy: MS2D ensures constant FLOPs by duplicating scans if k < 4, stabilizing gradients but offering no new spatial views

- **Failure signatures**:
  - The "Diagonal Drop": Sudden performance collapse (>20 Dice points) or unstable training indicates disjointed scan usage
  - ISLES Sensitivity: Performance fluctuation on stroke data suggests verifying scan strategy is locked to contiguous raster

- **First 3 experiments**:
  1. Baseline Verification (S3): Run single right-to-left horizontal scan to establish upper performance bound
  2. Stress Test (S7): Run diagonal scan on small subset to reproduce failure mode
  3. Production Config (Exp 19): Implement 4-direction horizontal + vertical mix to test robustness vs. single scan

## Open Questions the Paper Calls Out
None

## Limitations
- Anatomical generalization remains speculative without direct validation beyond performance metrics
- Task transferability to non-segmentation or non-brain imaging tasks is uncertain
- Dataset bias toward coherent spatial pathologies may not generalize to scattered or punctate pathologies

## Confidence
- **High Confidence**: Statistical significance of scan order and empirical performance differences between contiguous and disjointed scans
- **Medium Confidence**: Mechanistic explanations for raster superiority based on SSM capacity assumptions
- **Low Confidence**: Specific neuroanatomical benefits of orthogonal scan combinations require more direct evidence

## Next Checks
1. **Cross-Anatomical Testing**: Validate MS2D performance on chest CT or abdominal MRI to test generalizability beyond brain imaging
2. **Capacity Scaling Study**: Vary SSM state dimension systematically to determine if performance gap narrows with increased model capacity
3. **Pathology Structure Analysis**: Correlate scan strategy performance with ground truth pathology characteristics (compact vs. scattered lesions)