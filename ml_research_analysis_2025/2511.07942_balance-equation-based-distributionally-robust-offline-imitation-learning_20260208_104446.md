---
ver: rpa2
title: Balance Equation-based Distributionally Robust Offline Imitation Learning
arxiv_id: '2511.07942'
source_url: https://arxiv.org/abs/2511.07942
tags:
- learning
- transition
- policy
- robust
- imitation
- transformers
- self-attention
- retrieval-augmented-generation
- instruction-tuning
- parameter-efficient-finetuning
- mixture-of-experts
- chain-of-thought
core_contribution: "BE-DROIL addresses the challenge of learning robust policies in\
  \ offline imitation learning when the test environment\u2019s transition dynamics\
  \ differ from those under which expert demonstrations were collected. The key innovation\
  \ is reformulating robust policy learning as a constrained minimax optimization\
  \ over an f-divergence ambiguity set of transition models, with the inner maximization\
  \ over occupancy measures rather than unknown transition kernels."
---

# Balance Equation-based Distributionally Robust Offline Imitation Learning

## Quick Facts
- arXiv ID: 2511.07942
- Source URL: https://arxiv.org/abs/2511.07942
- Authors: Rishabh Agrawal; Yusuf Alvi; Rahul Jain; Ashutosh Nayyar
- Reference count: 40
- Primary result: BE-DROIL achieves superior robustness and generalization compared to state-of-the-art offline IL baselines under perturbed dynamics

## Executive Summary
BE-DROIL addresses the challenge of learning robust policies in offline imitation learning when test environment dynamics differ from those under which expert demonstrations were collected. The method reformulates robust policy learning as a constrained minimax optimization over an f-divergence ambiguity set of transition models, with the inner maximization over occupancy measures rather than unknown transition kernels. By introducing a triplet occupancy representation and leveraging strong duality, the intractable adversarial objective is transformed into a tractable importance-weighting scheme defined entirely under nominal expert data. Empirical results on MuJoCo locomotion tasks show that BE-DROIL achieves superior robustness and generalization compared to state-of-the-art offline IL baselines under perturbed dynamics.

## Method Summary
BE-DROIL learns robust policies from expert demonstrations without environment interaction by optimizing over occupancy measures in triplet form (s, a, s′). The method constructs an f-divergence ambiguity set around the nominal occupancy measure and solves a constrained minimax problem where the inner maximization is over this set. Through strong duality, this intractable problem is transformed into a tractable dual optimization over Lagrange multipliers Q and τ, yielding importance weights that re-scale the imitation loss. The algorithm alternates between estimating these dual variables and updating the policy, using only the expert dataset without requiring access to the true dynamics or additional environment interaction.

## Key Results
- BE-DROIL achieves superior robustness and generalization compared to state-of-the-art offline IL baselines under perturbed dynamics
- The method consistently outperforms baselines across diverse transition shifts while using a fixed hyperparameter configuration
- Empirical results on MuJoCo locomotion tasks (Hopper, HalfCheetah, Walker2d, Ant) demonstrate effectiveness against gravity, damping, stiffness, and actuator range perturbations

## Why This Works (Mechanism)

### Mechanism 1
- **Claim:** Representing occupancy measures over triplets (s, a, s′) rather than state–action pairs alone eliminates explicit dependence on unknown transition kernels, enabling fully offline optimization.
- **Mechanism:** The Bellman flow (balance equation) constraint in Eq. (7) must link occupancy measures to dynamics. If occupancy were defined only on (s, a), the constraint would require T(s′|s, a)—unknown for any T ∈ T(ρ′). By including s′ in the occupancy d(s, a, s′), the constraint becomes expressible purely through occupancy terms, removing T from the objective.
- **Core assumption:** The expert data contains sufficient coverage of (s, a, s′) transitions under nominal dynamics to estimate d^{T^o}_{π_D}.
- **Evidence anchors:**
  - [Section 4, "Why the Triplet (s, a, s′) Occupancy Measure"]: Explicitly states that incorporating s′ eliminates the need to deal with T explicitly.
  - [Section 4, Eq. (7)–(8)]: Balance equation written entirely in occupancy terms.
  - [Corpus]: Weak direct support—neighbor papers address robust RL but not this specific triplet formulation.
- **Break condition:** If expert trajectories have poor next-state coverage or are highly sparse, occupancy estimation degrades and robustness guarantees may not transfer.

### Mechanism 2
- **Claim:** The intractable inner maximization over unknown perturbed occupancy measures d^T_{π_D} is transformed into a tractable dual problem over Lagrange multipliers (Q, τ) defined entirely under nominal data.
- **Mechanism:** The constrained minimax problem (Eq. 6–8) is convex in the inner variable with a strictly feasible point (d^{T^o}_{π_D}), satisfying Slater's condition. Strong duality converts maximization over d^T_{π_D} into minimization over dual variables Q(s, a) (Bellman constraint) and τ ≥ 0 (f-divergence constraint). Introducing the importance ratio w = d^T_{π_D} / d^{T^o}_{π_D} re-weights all expectations under the nominal distribution.
- **Core assumption:** The f-divergence ambiguity set radius ρ is chosen such that it meaningfully captures the true transition shift magnitude.
- **Evidence anchors:**
  - [Section 4, Lagrangian Formulation]: Derivation of Eq. (10)–(11) showing the dual transformation.
  - [Section 4, Proposition 1]: Closed-form optimal w* derived from first-order conditions.
  - [Corpus]: Consistent with distributionally robust optimization principles in related work (e.g., Panaganti et al., 2025 on robust offline RL), but specific duality approach is novel here.
- **Break condition:** If ρ is severely misspecified (too small or too large), the worst-case weighting becomes either overly optimistic or excessively conservative, degrading generalization.

### Mechanism 3
- **Claim:** Alternating optimization between dual variables (Q, τ) and policy π yields a robust policy that minimizes expected loss under worst-case transition perturbations without environment interaction.
- **Mechanism:** The final objective (Eq. 12) decouples into two stages: (1) estimate Q and τ by minimizing the dual objective under nominal data, and (2) update π to minimize the importance-weighted imitation loss using the current w*(Q, τ, π). This alternation converges to a saddle point satisfying the robust optimality conditions.
- **Core assumption:** The policy class Π is sufficiently expressive to represent the robust optimal policy, and the learned Q-function approximates the true dual variable well.
- **Evidence anchors:**
  - [Section 4, Eq. (12)]: Explicit two-stage optimization procedure.
  - [Section 5, Implementation]: Describes alternating updates between Q/τ and π.
  - [Corpus]: Weak—related robust IL methods (DRBC) use different formulations without this alternating dual structure.
- **Break condition:** If Q-function approximation is poor (e.g., under limited data), the importance weights w* become inaccurate, and the learned policy may not achieve true robustness.

## Foundational Learning

- **Concept: Discounted Occupancy Measures**
  - **Why needed here:** The entire BE-DROIL formulation operates in occupancy space rather than trajectory space. Understanding how d^π_T(s, a, s′) aggregates visitation frequencies under a policy and dynamics is essential for grasping the balance equation and duality.
  - **Quick check question:** Given a policy π and transition T, can you explain why d^π_T(s, a, s′) sums discounted visitation counts and how it differs from the empirical trajectory distribution?

- **Concept: Strong Duality in Convex Optimization**
  - **Why needed here:** The core theoretical contribution relies on converting a constrained maximization over occupancy measures into an unconstrained dual minimization. Without understanding Slater's condition and KKT optimality, the derivation from Eq. (9) to Eq. (11) is opaque.
  - **Quick check question:** For a convex problem with inequality constraints, what conditions ensure that the primal and dual optimal values are equal, and why does d^{T^o}_{π_D} serve as a strictly feasible point here?

- **Concept: f-Divergences and Robustness**
  - **Why needed here:** The ambiguity set is defined via f-divergence bounds on occupancy deviation. Understanding how different generators (KL, TV, SoftTV) affect the shape of the uncertainty set and the resulting robustness–performance tradeoff is critical for selecting ρ and interpreting results.
  - **Quick check question:** Why does the paper use SoftTV instead of standard Total Variation, and how does Lemma 2 relate the f-divergence constraint to the TV bound from Lemma 1?

## Architecture Onboarding

- **Component map:**
  - Expert dataset (s, a, s′) triplets -> Q-network Q_ϕ -> τ scalar -> Importance weights w* -> Policy network π_θ -> Imitation loss
  - Q-network and policy alternate updates while τ is jointly optimized

- **Critical path:**
  1. Sample batch of (s, a, s′) triplets from expert dataset D.
  2. Compute ê_Q,π(s, a, s′) = L_π(s) + γ E_{a′∼π_D}[Q(s′, a′)] - Q(s, a).
  3. Obtain w*(s, a, s′) = max{0, (f′)^{-1}(ê_Q,π / τ)}.
  4. Update Q and τ by minimizing the dual objective (Eq. 12, first line).
  5. Update π by minimizing the weighted imitation loss (Eq. 12, second line).
  6. Repeat until convergence.

- **Design tradeoffs:**
  - **Fixed vs. tuned ρ:** Using a single ρ across environments (as BE-DROIL does) improves generalization fairness but may underperform on domains requiring different uncertainty radii (e.g., HalfCheetah under high damping).
  - **Choice of f-divergence:** SoftTV provides smooth gradients but approximates true TV; other divergences (KL, χ²) yield different robustness profiles and may be more or less conservative.
  - **Batch size and learning rate:** Larger batches stabilize occupancy estimation; smaller learning rates prevent instability in dual variable updates but slow convergence.

- **Failure signatures:**
  - **τ collapsing to zero:** Indicates the f-divergence constraint is inactive; robustness is lost. Check if ρ is too large or if Q is underestimating constraint violations.
  - **Exploding importance weights:** If ê_Q,π / τ produces extreme values, weights become unbounded. May indicate τ is too small or Q-function has diverged.
  - **Policy ignoring weights:** If weighted and unweighted losses converge to similar values, the robustness mechanism is not functioning. Verify that w* is being computed correctly and that τ is being updated.
  - **High variance across seeds:** Suggests insufficient data coverage or unstable dual optimization; consider increasing batch size or adjusting learning rates.

- **First 3 experiments:**
  1. **Validation on nominal dynamics:** Train BE-DROIL and BC on the same expert dataset; verify that BE-DROIL achieves comparable performance when test dynamics match training. This confirms the method does not sacrifice nominal performance for robustness.
  2. **Ablation on ρ:** Sweep ρ ∈ {0.1, 0.3, 0.5, 0.7} on a single environment (e.g., Ant) under moderate perturbations. Plot performance vs. perturbation strength to identify the robustness–performance frontier and validate that the fixed configuration (optimized on Ant) generalizes.
  3. **Component isolation:** Disable the balance equation constraint (set Q = 0) and compare against the full method. This isolates the contribution of enforcing valid stationary occupancy measures vs. naive distributionally robust weighting, revealing whether the triplet representation is essential for tractability.

## Open Questions the Paper Calls Out

- **Question:** Can analogues of Lemma 1 (bounding occupancy measure deviation under transition uncertainty) be derived for Wasserstein or other non-f-divergence ambiguity sets?
  - **Basis in paper:** [explicit] The conclusion states future work will include "deriving analogues of Lemma 1 for alternative divergence measures to broaden the class of admissible f-divergence generators in our optimization framework."
  - **Why unresolved:** Lemma 1 currently only bounds Total Variation distance between occupancy measures, limiting the framework to f-divergences whose generators are upper-bounded by TV. Other divergence classes may provide different robustness-tractability tradeoffs.
  - **What evidence would resolve it:** A theoretical derivation showing whether Wasserstein-based ambiguity sets admit similar occupancy bounds, plus empirical comparison of SoftTV vs. alternative divergence generators on perturbed dynamics benchmarks.

- **Question:** How can BE-DROIL be extended to handle non-stationary transition dynamics where perturbations vary over time rather than being fixed at deployment?
  - **Basis in paper:** [explicit] The conclusion identifies extending "this framework to non-stationary dynamics" as future work.
  - **Why unresolved:** The current balance equation constraint enforces stationarity via Bellman flow consistency; non-stationary dynamics would require time-indexed occupancy measures and modified duality arguments.
  - **What evidence would resolve it:** A reformulation of the constrained minimax optimization with time-varying occupancy measures, validated on benchmarks with temporally drifting dynamics parameters.

- **Question:** Why does BE-DROIL underperform DRBC under high damping and friction perturbations in HalfCheetah when using fixed hyperparameters, and is this a fundamental limitation of the importance-weighting approach?
  - **Basis in paper:** [inferred] The paper notes BE-DROIL "exhibits steeper declines under increased damping and friction" compared to DRBC on HalfCheetah, attributing this to DRBC's environment-specific tuning versus BE-DROIL's fixed configuration.
  - **Why unresolved:** The paper attributes the gap to hyperparameter choices but does not investigate whether certain perturbation types (e.g., energy-dissipative changes) are inherently harder for the occupancy-based formulation.
  - **What evidence would resolve it:** Controlled ablation studies varying uncertainty radius ρ and learning rate per perturbation type, plus analysis of whether importance weights w★ capture damping-related distributional shifts less effectively than stiffness or gravity shifts.

## Limitations
- The f-divergence radius ρ must align with actual transition shifts, yet the paper uses a single fixed value tuned on one domain, which may fail for domains with larger or different perturbation types
- The importance weighting assumes expert data covers all relevant (s,a,s') transitions; sparse or narrow coverage could break robustness
- The dual variables (Q, τ) are estimated from finite samples, so approximation error may accumulate, especially if the Q-network is underparameterized
- The method's robustness is empirically demonstrated but lacks theoretical guarantees on performance under misspecified ρ or poor coverage
- Without open-sourced code, exact hyperparameter choices (e.g., τ initialization, learning rates) remain ambiguous

## Confidence
- **High:** The mechanism by which triplet occupancy eliminates explicit transition dependence (Mechanism 1) and the alternating optimization procedure (Mechanism 3) are well-supported by derivations and implementation details
- **Medium:** The dual reformulation and its tractability (Mechanism 2) are theoretically sound but depend on strong duality conditions that may not hold with finite data or poor coverage
- **Low:** The empirical claim that a single ρ configuration generalizes across all environments (Section 5, "Robustness and Generalization") is under-supported; no sensitivity analysis or alternative divergence choices are explored

## Next Checks
1. **Coverage Sensitivity:** Vary the amount and diversity of expert data (e.g., reduce trajectory count by 50%) and measure robustness degradation to test the triplet occupancy assumption
2. **ρ Sweep Validation:** Systematically sweep ρ across environments and plot performance vs. perturbation strength to validate the single-configuration claim and identify robustness-performance tradeoffs
3. **Component Ablation:** Disable the balance equation constraint (Q=0) and compare against full BE-DROIL to isolate the contribution of enforcing valid stationary occupancy measures vs. naive distributionally robust weighting