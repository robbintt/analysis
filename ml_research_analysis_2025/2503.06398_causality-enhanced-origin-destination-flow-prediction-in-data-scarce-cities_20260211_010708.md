---
ver: rpa2
title: Causality Enhanced Origin-Destination Flow Prediction in Data-Scarce Cities
arxiv_id: '2503.06398'
source_url: https://arxiv.org/abs/2503.06398
tags:
- features
- flow
- cities
- causal
- prediction
- transformers
- self-attention
- retrieval-augmented-generation
- instruction-tuning
- parameter-efficient-finetuning
- mixture-of-experts
- chain-of-thought
core_contribution: This paper addresses the challenge of predicting origin-destination
  (OD) flow in data-scarce cities where regional features are often missing. The authors
  propose a novel Causality-Enhanced OD Flow Prediction (CE-OFP) framework that transfers
  urban knowledge from data-rich to data-scarce cities.
---

# Causality Enhanced Origin-Destination Flow Prediction in Data-Scarce Cities

## Quick Facts
- **arXiv ID**: 2503.06398
- **Source URL**: https://arxiv.org/abs/2503.06398
- **Reference count**: 40
- **Primary result**: CE-OFP reduces RMSE by up to 11% compared to seven baselines in data-scarce cities.

## Executive Summary
This paper addresses the challenge of predicting origin-destination (OD) flow in data-scarce cities where regional features are often missing. The authors propose a novel Causality-Enhanced OD Flow Prediction (CE-OFP) framework that transfers urban knowledge from data-rich to data-scarce cities. The approach consists of three main components: (1) using reinforcement learning to discover universal causal relationships among urban features in data-rich cities, (2) employing a Causality-Enhanced Variational Auto-Encoder (CE-VAE) to reconstruct missing features by incorporating causal graphs, and (3) applying a graph attention network with knowledge distillation to transfer OD prediction models. Experiments on real-world datasets from New York City (data-rich) to Chicago and Seattle (data-scarce) show that CE-OFP outperforms seven state-of-the-art baselines, reducing RMSE by up to 11% in data-scarce cities. The framework demonstrates strong generalization capabilities and robustness to increasing numbers of missing features.

## Method Summary
CE-OFP is a three-stage framework for OD flow prediction in data-scarce cities. First, an RL agent discovers a universal causal graph among urban features in the data-rich source city (NYC). Second, a CE-VAE uses this causal graph to reconstruct missing features in the target city (Chicago/Seattle) by learning to predict each feature from its causal parents. Third, a graph attention network (GAT) performs OD prediction, trained with knowledge distillation from a teacher model trained on the source city. The framework combines causal discovery, feature reconstruction, and transfer learning to address data scarcity.

## Key Results
- CE-OFP outperforms seven state-of-the-art baselines, achieving up to 11% RMSE reduction in data-scarce cities.
- The causal structure shows considerable similarity (>50%) between different cities, supporting the "universal" relationship assumption.
- CE-VAE demonstrates superior reconstruction performance compared to vanilla VAE and AE, with log-likelihood improvement of 0.5 and 2.5 respectively on target cities.
- Knowledge distillation effectively transfers prediction capability, with the student model outperforming direct fine-tuning approaches.

## Why This Works (Mechanism)

### Mechanism 1
- Claim: Reinforcement learning (RL) discovers universal causal graphs among urban features that transfer across cities.
- Mechanism: RL treats causal discovery as a sequential decision process, optimizing the Bayesian Information Criterion (BIC) while enforcing a Directed Acyclic Graph (DAG) constraint to find a graph $G$ that represents stable, domain-wide relationships (e.g., population $\rightarrow$ POI density) rather than city-specific spurious correlations.
- Core assumption: The underlying causal relationships between urban features (like demographics and POIs) are consistent across different cities (data-rich and data-scarce), even if feature distributions differ.
- Evidence anchors:
  - [section] "Specifically, we propose to search the causal graph between urban features in data-rich cities as universal relationships that can be shared across multiple cities... The obtained causal graph depicts the essential universal relationships..."
  - [section] "...experimental results show that the causal structure has considerable similarity between different cities, with more than 50% similarity between them."
  - [corpus] Evidence for RL-based causal discovery as a general method is supported by corpus neighbors like "Causal-Aware Collaborative Neural Controlled Differential Equation..." which leverages causal awareness for long-term prediction.
- Break condition: The mechanism fails if causal relationships among urban features are highly context-dependent (e.g., influenced by unique local zoning laws or cultural factors) and do not generalize from a source city (like NYC) to a target city (like Seattle).

### Mechanism 2
- Claim: A Causality-Enhanced Variational Auto-Encoder (CE-VAE) reconstructs missing features more robustly by using the causal graph to structure its latent space.
- Mechanism: The CE-VAE uses the discovered causal graph $G$ to constrain its encoder and decoder. Instead of fully-connected layers (which assume all features relate to all others), the CE-VAE reconstructs features according to paths in $G$ (e.g., predicting a missing feature only from its causal parents). It outputs a mean ($\mu$) and variance ($\sigma^2$), capturing both the value and uncertainty of the reconstructed features.
- Core assumption: Structuring reconstruction along causal paths reduces overfitting to spurious correlations present in the source city's data and improves generalization to the target city by focusing on essential, mechanistic relationships.
- Evidence anchors:
  - [abstract] "...we further build Causality-Enhanced Variational Auto-Encoder (CE-VAE) to incorporate causal graphs for effective feature reconstruction in data-scarce cities."
  - [section] "CE-VAE takes the paths in the causal graph G as reconstruction paths and reconstructs missing features basing on their parent feature nodes according to the causal graph one by one."
  - [corpus] The "Causal-Aware Collaborative Neural Controlled Differential Equation..." paper similarly uses a causal framework to improve model robustness and reduce cumulative errors.
- Break condition: Performance degrades if the causal graph $G$ is incorrect or incomplete, leading the CE-VAE to ignore relevant features or use incorrect parent nodes for reconstruction.

### Mechanism 3
- Claim: Knowledge distillation transfers the prediction capability from a teacher model (trained on the data-rich city) to a student model (for the data-scarce city).
- Mechanism: The framework uses a Graph Attention Network (GAT) for OD prediction. A student GAT model in the target city is trained not only on its scarce local data but also to mimic the internal representations (layer outputs) of a teacher GAT model trained on the source city, using a transfer loss ($L_{transfer}$). This transfers learned urban knowledge and spatial dependencies.
- Core assumption: The teacher model has learned generalizable patterns of human mobility that are useful in the target city, and distilling its "dark knowledge" (soft targets/intermediate features) is more effective for the target task than direct transfer or training from scratch with limited data.
- Evidence anchors:
  - [abstract] "...with the reconstructed features, we devise a knowledge distillation method with a graph attention network to migrate the OD prediction model from data-rich cities to data-scare cities."
  - [section] "Because of the problem of sparse OD flow data in developing cities, we exploit the method of knowledge distillation when transferring the model of prediction... Specifically, we add a loss so that the prediction model of the data-scarce city contains as much information as possible from the model of data-rich city."
  - [corpus] The "FlowDistill" paper explicitly uses distillation from LLMs for traffic flow prediction, providing strong external evidence for the efficacy of distillation in this domain.
- Break condition: Fails if the source and target cities have fundamentally different urban structures or mobility behaviors, such that the teacher model's learned representations are misleading for the student.

## Foundational Learning

### Concept: Variational Auto-Encoders (VAE)
- Why needed here: The paper's CE-VAE builds directly on VAE principles. You must understand how VAEs learn a latent probability distribution (mean $\mu$ and variance $\sigma$) from which to reconstruct data, and the role of the Evidence Lower Bound (ELBO) loss function.
- Quick check question: Can you explain why a standard VAE might struggle to generalize its reconstructions to data drawn from a different distribution (a different city)?

### Concept: Causal Graphs and Directed Acyclic Graphs (DAGs)
- Why needed here: The core of the "causality-enhanced" approach is discovering and using a DAG. You need to grasp what a DAG is (nodes as variables, directed edges as causal links, no cycles) and why it can represent universal relationships.
- Quick check question: Why is enforcing a "no-cycle" constraint important when learning a causal structure?

### Concept: Knowledge Distillation
- Why needed here: The final step uses this transfer learning technique. You need to understand the concept of a "teacher-student" framework, where a smaller or less-trained model learns to mimic a more powerful one.
- Quick check question: What is the fundamental idea behind knowledge distillation, and why might it be useful for transferring knowledge between cities?

## Architecture Onboarding

### Component map
The system has three main stages: 1) **Causal Discovery Module** (RL-based agent, Transformer encoder, LSTM decoder) outputs a DAG; 2) **Feature Reconstruction Module** (CE-VAE encoder/decoder) uses the DAG and source city data to train, then reconstructs missing target features ($\mu$ and $\sigma$); 3) **Prediction & Transfer Module** (GAT-based teacher and student models) performs final OD prediction using knowledge distillation.

### Critical path
The causal graph $G$ is the linchpin. An error in the RL-based discovery phase will propagate through the CE-VAE and degrade the final GAT-based prediction. The flow is: `Source City Data -> RL Agent -> Causal Graph G -> CE-VAE -> Reconstructed Target Features -> Student GAT (Distilled from Teacher GAT) -> Final OD Prediction`.

### Design tradeoffs
The paper trades off end-to-end trainability for a modular, interpretable system. By separating causal discovery from prediction, it gains the ability to inspect the learned causal graph but risks propagating errors between stages. Using RL for graph search is powerful but adds significant training complexity and hyperparameter sensitivity compared to simpler correlation-based methods.

### Failure signatures
- **Cyclic or nonsensical causal graph**: Indicates RL agent instability or poor reward shaping.
- **CE-VAE overfitting**: Reconstruction loss drops on source city but is high on target city.
- **Distillation loss plateaus but prediction error is high**: The student model is mimicking the teacher perfectly, but the teacher's knowledge is not generalizable to the target city's context.

### First 3 experiments
1.  **Causal Graph Verification**: Run the RL discovery module on two different data-rich cities (e.g., NYC and another city if data is available) and compare the resulting DAGs. The paper claims >50% similarity; reproduce this to validate the "universal" assumption.
2.  **Ablation on CE-VAE**: Compare the performance of the CE-VAE against a vanilla VAE and a standard autoencoder (AE) for feature reconstruction on a held-out validation set *from a different city*. Confirm that the causal constraint improves cross-city generalization.
3.  **Baseline Transfer Comparison**: Implement a direct fine-tuning approach (train on source city, fine-tune on target city without distillation) and compare it to the proposed knowledge distillation method to quantify the benefit of the distillation loss ($L_{transfer}$).

## Open Questions the Paper Calls Out
- Can the CE-OFP framework effectively generalize to developing cities with urban structures fundamentally different from the data-rich source cities used in training?
- How can the CE-OFP methodology be extended to handle dynamic, time-varying urban features rather than static regional attributes?
- How sensitive is the model's performance to significant divergence between the source city's causal graph and the target city's actual causal structure?

## Limitations
- The framework's performance relies heavily on the assumption that causal relationships are "universal" across cities, which is only partially validated with 50% structural similarity.
- The RL-based causal discovery adds significant complexity and hyperparameter sensitivity without clear justification that it outperforms simpler correlation-based methods.
- Experiments are limited to three cities (NYC, Chicago, Seattle), restricting generalizability claims to other urban contexts.

## Confidence

**High Confidence**: The overall framework design (causal discovery → feature reconstruction → knowledge distillation) is logically sound and well-motivated by the problem of data scarcity.

**Medium Confidence**: The experimental results showing CE-OFP outperforming baselines (up to 11% RMSE reduction) are convincing within the tested cities, but the small number of target cities and limited ablation studies prevent high confidence in the universal applicability of the causal graph discovery method.

**Low Confidence**: The specific claim that RL is the optimal or most robust method for discovering "universal" causal graphs, and that the discovered graph truly represents mechanistic relationships rather than just high correlations that happen to transfer well.

## Next Checks

1. **Causal Graph Robustness**: Replicate the RL discovery process on a held-out subset of NYC data and on at least one additional data-rich city (if available) to quantify the stability and "universality" of the discovered DAG structure.

2. **Causal Graph Ablation**: Systematically remove or rewire edges in the discovered causal graph and retrain the CE-VAE to empirically test which causal connections are critical for cross-city performance.

3. **Teacher Model Comparison**: Replace the GAT teacher model with simpler transfer methods (e.g., direct fine-tuning, feature matching without distillation) to isolate the contribution of the knowledge distillation component to the overall performance gain.