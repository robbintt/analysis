---
ver: rpa2
title: 'STACHE: Local Black-Box Explanations for Reinforcement Learning Policies'
arxiv_id: '2512.09909'
source_url: https://arxiv.org/abs/2512.09909
tags:
- state
- states
- policy
- robustness
- agent
- transformers
- self-attention
- retrieval-augmented-generation
- instruction-tuning
- parameter-efficient-finetuning
- mixture-of-experts
- chain-of-thought
core_contribution: 'This paper introduces STACHE, a framework for generating local,
  black-box explanations for reinforcement learning policies in discrete Markov games.
  The core method combines two complementary components: a Robustness Region (the
  connected neighborhood where the agent''s action remains invariant) and Minimal
  Counterfactuals (the smallest state perturbations required to change the decision).'
---

# STACHE: Local Black-Box Explanations for Reinforcement Learning Policies

## Quick Facts
- arXiv ID: 2512.09909
- Source URL: https://arxiv.org/abs/2512.09909
- Reference count: 24
- Primary result: Introduces STACHE, a framework generating local black-box explanations for RL policies using robustness regions and minimal counterfactuals with 100% fidelity.

## Executive Summary
This paper introduces STACHE, a framework for generating local, black-box explanations for reinforcement learning policies in discrete Markov games. The core method combines two complementary components: a Robustness Region (the connected neighborhood where the agent's action remains invariant) and Minimal Counterfactuals (the smallest state perturbations required to change the decision). STACHE uses an exact, search-based algorithm that exploits factored state spaces to compute these explanations with 100% fidelity to the agent's actual logic, without relying on policy approximations or gradient access.

## Method Summary
STACHE generates local explanations for black-box RL policies through an exact, search-based algorithm operating on factored state spaces. The method performs BFS exploration from a seed state to discover the connected component of states sharing the same action (Robustness Region) and identifies the minimal-distance counterfactuals where the action changes. A hybrid distance metric combines Manhattan distance for numerical factors and Hamming distance for categorical factors. The framework provides both an exact variant (STACHE-EXACT) that computes full robustness regions and a truncated variant (STACHE-CUTOFF) that stops after finding all minimal counterfactuals for scalability.

## Key Results
- STACHE successfully captures policy logic evolution during training, revealing distinct patterns: robustness regions for specific actions like pickups shrink as policies learn precision, while regions for navigation actions grow as agents generalize.
- The method identifies brittle decision boundaries where small perturbations cause dramatic action changes, providing actionable insights for debugging and verification of RL agents.
- Experiments on Gymnasium environments demonstrate 100% fidelity to the agent's actual logic without relying on policy approximations or gradient access.

## Why This Works (Mechanism)

### Mechanism 1: Robustness Region Discovery via Connected Component BFS
- Claim: Exploring the state-similarity graph via BFS from a seed state reveals the maximal connected region where the policy remains invariant, quantifying decision stability.
- Mechanism: The algorithm treats the factored state space as a graph where edges connect states at unit distance. BFS from s_0 expands only to neighbors sharing the same action, guaranteeing discovery of the connected component of action invariance.
- Core assumption: The user-defined factorization meaningfully captures the features the policy actually depends on.
- Evidence anchors: Formal definition in section 4.1 requiring both action invariance AND connectivity via simple continuous paths.
- Break condition: If the state space is too large or poorly factored, the BFS becomes computationally prohibitive or produces regions with no semantic coherence.

### Mechanism 2: Minimal Counterfactual Identification via Distance-Ordered Search
- Claim: The first action-flipping states encountered during BFS are guaranteed to be minimal-distance counterfactuals, providing the smallest perturbations that change the decision.
- Mechanism: BFS visits states in non-decreasing order of distance from s_0. The moment a state s' with π(s') ≠ π(s_0) is dequeued, all states at smaller distances have been confirmed to share the original action.
- Core assumption: The hybrid distance metric meaningfully captures "small" perturbations from a human-interpretable perspective.
- Evidence anchors: Formal definition in section 4.3 and proof in Appendix C that C_min contains all minimal counterfactuals and no non-minimal ones.
- Break condition: If multiple counterfactuals exist at the same minimal distance but only some are reachable via the BFS expansion, the reachable set may be incomplete.

### Mechanism 3: Policy Logic Evolution Detection via Region Dynamics
- Claim: Tracking robustness region size and counterfactual structure across training checkpoints reveals when policies transition from erratic to optimized behavior.
- Mechanism: Untrained policies have large, chaotic robustness regions with incoherent counterfactuals. As training progresses, task-specific actions develop SMALL, precise regions while navigation actions develop LARGE regions.
- Core assumption: Smaller robustness regions for precision actions and larger regions for general navigation are signatures of competent policies.
- Evidence anchors: Quantitative evolution data showing RR shrinks from 9 to 3 for Pickup and CF logic shifts from "Random/Chaotic" to "Specific."
- Break condition: If a policy overfits to a narrow set of training configurations, it may show artificially small robustness regions that do not generalize.

## Foundational Learning

- Concept: **Factored State Representations**
  - Why needed here: STACHE operates on states decomposed into typed variables (numerical/categorical). Without understanding how to define factors, you cannot construct meaningful neighborhoods or distance metrics.
  - Quick check question: Given a GridWorld state (agent_x, agent_y, facing_direction, has_key), which factors are numerical vs categorical, and what is the unit distance for each?

- Concept: **Graph-Based BFS and Connected Components**
  - Why needed here: The algorithm's correctness depends on BFS exploring states in distance order and identifying connected components. Understanding why BFS (not DFS) guarantees minimal-distance discovery is essential.
  - Quick check question: Why does DFS not guarantee that the first counterfactual encountered is minimal distance from the seed?

- Concept: **Hybrid Distance Metrics for Mixed Attribute Spaces**
  - Why needed here: Real RL states combine coordinates (ordered) with object types (unordered). Standard metrics fail; the hybrid approach combines Manhattan and Hamming appropriately.
  - Quick check question: Compute d_hybrid between state (x=2, y=3, P=0, D=1) and (x=2, y=4, P=2, D=1) for Taxi-v3.

## Architecture Onboarding

- Component map: Seed State s_0 → Factorization Module → Neighbor Generator (GetNeighbors) → Policy Query π(s) ← Black-Box Policy Interface → BFS Core (STACHE-EXACT or STACHE-CUTOFF) → Composite Explanation: Robustness Region R + Minimal Counterfactuals C_min → Visualization/Analysis Module

- Critical path:
  1. Define the user factorization (this determines all downstream results—garbage in, garbage out).
  2. Implement GetNeighbors to enumerate all states at unit distance.
  3. Ensure policy query interface is truly query-only (no gradient/weight access needed).
  4. Run BFS, collecting R (invariant states) and C (boundary states where action flips).
  5. Filter C for minimal distance to obtain C_min.

- Design tradeoffs:
  - EXACT vs CUTOFF: EXACT gives full robustness region but O(N·T_π) for large N; CUTOFF stops after finding all minimal counterfactuals, trading region completeness for speed.
  - Factorization granularity: Coarse factors yield large, less interpretable regions; fine factors increase computational cost and may over-fragment.
  - Distance metric: The hybrid metric assumes numerical factors have comparable "unit" scales; normalization may be needed for heterogeneous factors.

- Failure signatures:
  - RR size = 1: Policy is extremely brittle at this state; any perturbation flips the action.
  - Chaotic CFs: Counterfactuals involve seemingly random factor changes, indicating untrained or broken policy logic.
  - Computation timeout: State space too large for EXACT; must switch to CUTOFF or coarser factorization.

- First 3 experiments:
  1. Replicate Taxi-v3 analysis on π_0%, π_50%, π_100% for seed state s_1 = (0,0,0,2). Verify RR shrinks from 9 to 3 and CFs become specific.
  2. Run STACHE-CUTOFF on MiniGrid-Empty-Random-6x6 with a PPO agent. Identify at least one "brittle" state (RR size < 5) and one "corridor of stability" state (RR size > 10).
  3. Ablate the factorization: Run STACHE on Taxi-v3 with a degenerate factorization (e.g., treating P and D as numerical). Document how explanation quality degrades.

## Open Questions the Paper Calls Out

### Open Question 1
- Question: Can local robustness regions be extended to temporal "robustness tubes" that explain entire trajectories rather than single actions?
- Basis in paper: The authors state: "Our future work will focus on... extending local regions to temporal 'robustness tubes' for trajectory explanations."
- Why unresolved: The current framework operates on single-state decisions; temporal sequences introduce dependencies where perturbations compound or propagate across time steps.
- What evidence would resolve it: A formal definition of trajectory-level robustness regions with an algorithm that computes connected regions in state-time space, validated on multi-step RL tasks.

### Open Question 2
- Question: Can local safety certificates be formally derived from robustness region boundaries?
- Basis in paper: The authors list "deriving local safety certificates from region boundaries" as a key future direction.
- Why unresolved: The paper provides descriptive explanations but does not establish formal guarantees that could certify safety properties.
- What evidence would resolve it: A theorem connecting robustness region structure to formal safety bounds, with empirical validation showing certificates hold under adversarial testing.

### Open Question 3
- Question: How can STACHE maintain exactness while scaling to high-dimensional or continuous state spaces?
- Basis in paper: The authors acknowledge: "The exact BFS scales with the size of the robustness region. For large regions in complex games, the truncated BFS is necessary."
- Why unresolved: BFS over discrete factored states becomes intractable for large or continuous domains; truncation sacrifices completeness guarantees.
- What evidence would resolve it: An algorithm leveraging SMT solvers or symbolic reasoning that proves correctness while handling state spaces orders of magnitude larger than Taxi-v3 or MiniGrid.

## Limitations
- The framework assumes the user can define a meaningful factorization of the state space; poor factorization leads to misleading explanations.
- Computational complexity is a significant constraint, as the exact algorithm explores the entire connected component of invariant states.
- The experiments focus on discrete, tabular environments; performance on continuous or hybrid state spaces is unclear.

## Confidence
- **High Confidence**: The correctness of the BFS algorithm for finding connected robustness regions and minimal counterfactuals, as proven in the appendices.
- **Medium Confidence**: The interpretability of the explanations and their usefulness for debugging, based on qualitative observations in experiments but limited quantitative user studies.
- **Low Confidence**: Generalizability to complex, high-dimensional environments beyond the discrete tabular cases demonstrated.

## Next Checks
1. **Factorization Sensitivity Analysis**: Systematically vary the state factorization granularity on Taxi-v3 and measure how robustness region size and counterfactual quality change.

2. **Scalability Benchmark**: Implement STACHE-CUTOFF on a larger discrete environment (e.g., FrozenLake8x8) and measure runtime vs explanation completeness trade-offs across different seed states and cutoff distances.

3. **Continuous State Extension**: Adapt the hybrid distance metric and neighbor generation for a simple continuous control environment (e.g., CartPole with discretized factors) to test the framework's boundaries and identify necessary modifications for non-tabular domains.