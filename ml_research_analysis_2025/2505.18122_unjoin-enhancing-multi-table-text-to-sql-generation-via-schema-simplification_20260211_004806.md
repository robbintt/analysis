---
ver: rpa2
title: 'UNJOIN: Enhancing Multi-Table Text-to-SQL Generation via Schema Simplification'
arxiv_id: '2505.18122'
source_url: https://arxiv.org/abs/2505.18122
tags:
- schema
- unjoin
- table
- query
- simplified
- transformers
- self-attention
- retrieval-augmented-generation
- instruction-tuning
- parameter-efficient-finetuning
- mixture-of-experts
- chain-of-thought
core_contribution: UNJOIN tackles the challenge of multi-table Text-to-SQL generation
  by simplifying the schema into a single table with prefixed column names, allowing
  LLMs to focus on column and table retrieval without worrying about JOINs. The generated
  SQL is then mapped back to the original schema with reconstructed JOINs.
---

# UNJOIN: Enhancing Multi-Table Text-to-SQL Generation via Schema Simplification

## Quick Facts
- arXiv ID: 2505.18122
- Source URL: https://arxiv.org/abs/2505.18122
- Reference count: 40
- Primary result: UNJOIN achieves Exact Match scores of up to 77.13% on Spider and 56.35% on BIRD by simplifying multi-table schemas

## Executive Summary
UNJOIN addresses the challenge of multi-table Text-to-SQL generation by transforming complex database schemas into simplified single-table representations. The method prefixes column names with their table names (e.g., `customer.name`) to create a flattened schema that eliminates the need for JOIN logic during initial SQL generation. This allows large language models to focus on accurate column retrieval and semantic understanding without being distracted by relational complexity. The generated SQL is then translated back to the original multi-table schema with reconstructed JOINs, achieving state-of-the-art performance on standard benchmarks.

## Method Summary
UNJOIN operates through a two-stage framework: first, it deterministically simplifies multi-table schemas into single-table representations by prefixing each column with its table name. This transformation relies only on schema-level information and does not require access to row-level data. Second, it generates SQL queries against this simplified schema, then translates the resulting queries back to the original schema with reconstructed JOIN logic. The method includes an edit-distance-based post-processing step to correct any hallucinated table or column names. Two variants are evaluated: UNJOIN SP (single-prompt joint approach) and UNJOIN MP (multi-prompt with separate generation and translation stages).

## Key Results
- Achieves Exact Match (EM) scores of up to 77.13% on Spider and 56.35% on BIRD datasets
- Outperforms standard prompting, in-context learning, supervised fine-tuning, and reasoning models
- Improves column retrieval accuracy significantly (80-96% recall vs. 37-54% for CoT baselines)
- Effective across multiple model sizes and retriever-based setups
- Works with schema information only, no row-level data required

## Why This Works (Mechanism)

### Mechanism 1: Schema Simplification via Column Flattening
UNJOIN flattens multi-table schemas into a single-table representation with prefixed column names, reducing LLM cognitive load for schema element retrieval. The prefix disambiguates columns with identical names across tables while eliminating the need for the LLM to reason about inter-table relationships during column selection. This leverages the fact that LLMs are more proficient at single-table SQL generation due to training data skew toward simpler schemas.

### Mechanism 2: Decoupled Query Generation Without Relational Reasoning
By separating schema element retrieval from JOIN logic, UNJOIN allows the LLM to focus on semantic correctness without structural distraction. The model generates intermediate SQL against the simplified schema where no JOIN syntax is required, concentrating on SELECT clauses, WHERE conditions, aggregations, and ordering—operations where LLMs demonstrate stronger capability.

### Mechanism 3: Query Translation via LLM Schema Mapping
The LLM translates intermediate single-table SQL into executable multi-table SQL by reconstructing JOINs based on schema context and the original question. This implicit reasoning capability means no additional rule-based logic is required for JOIN reconstruction. An edit-distance-based post-processing step corrects hallucinated table/column names, ensuring output alignment with the actual schema.

## Foundational Learning

- **Schema Linking**: Understanding how natural language terms map to schema elements is prerequisite to grasping why UNJOIN's flattening helps. Quick check: Given tables `orders` and `customers`, how would you flatten `id`, `customer_id`, and `name` columns from both tables?

- **Execution-Accuracy vs. Exact-Match Metrics**: The paper distinguishes Query Execution (QE, query runs) from Exact Match (EM, query returns correct results). Quick check: If a generated SQL runs successfully but returns 10 rows instead of 8, does it count toward QE, EM, both, or neither?

- **Open-Book vs. Closed-Book Text-to-SQL**: The paper evaluates both settings. In open-book, retrieval precedes SQL generation; UNJOIN plugs into retrievers. Quick check: Which setting would benefit more from a retrieval-augmented approach like UNJOIN combined with DTR or Contriever?

## Architecture Onboarding

- **Component map**: [Original Schema] → [Schema Simplifier (deterministic)] → [Simplified Schema] → [LLM Query Generator] → [Intermediate SQL] → [LLM Translator] → [Final SQL] → [Edit-Distance Corrector] → [Executable SQL]

- **Critical path**: The Query Translation step is the highest-risk component. Paper evidence shows CoT-SS (which skips translation) catastrophically fails, dropping EM from 76% to 12% for GPT-4o on Spider.

- **Design tradeoffs**: UNJOIN SP (single-prompt) offers faster execution but may conflate reasoning steps, better for simpler queries. UNJOIN MP (multi-prompt) separates generation and translation into distinct LLM calls, offering higher accuracy on complex schemas at the cost of doubled API latency and costs.

- **Failure signatures**: 
  1. Column name hallucination: LLM generates `account.customer_id` when actual column is `account.client_id`
  2. Missing JOIN conditions: Translated query omits WHERE clause for join, producing Cartesian products
  3. Ambiguous question interpretation: User asks "total sales" but schema has `gross_sales` and `net_sales`

- **First 3 experiments**:
  1. Baseline comparison: Run UNJOIN MP with GPT-4o on Spider's multi-table subset (443 queries), measuring EM and QE against DIN-SQL and CoT baselines
  2. Ablation on translation step: Generate intermediate SQL, manually inspect 20 random queries before and after translation to quantify JOIN reconstruction accuracy
  3. Retriever integration (open-book): Combine UNJOIN with DTR retriever on Spider to measure table retrieval recall improvement and end-to-end EM impact

## Open Questions the Paper Calls Out
- **Adapting to hierarchical/semi-structured data**: Future work includes extending UNJOIN to handle nested schemas like JSON or XML, as the current deterministic flattening approach doesn't easily translate to non-relational data structures
- **Cell-level content extraction**: UNJOIN currently focuses on structural correctness rather than resolving specific data values, making it less suited for tasks requiring entity disambiguation (e.g., "M. Obama" vs. "Michelle Obama")
- **Smaller model reliability**: The method's effectiveness depends on LLM instruction-following capability, which is less reliable with smaller models like SQLCoder-7B compared to larger models like GPT-4o

## Limitations
- Performance gains are concentrated on multi-table queries, which represent only ~40% of Spider and ~30% of BIRD datasets
- Relies on LLM's implicit relational reasoning for JOIN reconstruction without direct validation against explicit schema linking methods
- Edit-distance post-processing step is mentioned as critical but implementation details are not provided

## Confidence
- **High Confidence**: Schema flattening mechanism - directly supported by algorithm description and implementation feasibility
- **Medium Confidence**: Query translation via LLM - supported by ablation results but lacks corpus evidence for JOIN reconstruction accuracy
- **Low Confidence**: Edit-distance correction effectiveness - mentioned as critical but no implementation details or error analysis provided

## Next Checks
1. **JOIN Reconstruction Validation**: Manually inspect 50 translated queries from complex multi-table schemas (e.g., with bridge tables or indirect foreign keys) to quantify reconstruction accuracy for simple vs. complex join patterns
2. **Edit-Distance Correction Analysis**: Implement and test the post-processing correction on queries with intentional column name mismatches to measure precision/recall and identify edge cases
3. **Retrieval Integration Benchmark**: Combine UNJOIN with DTR retriever on Spider's open-book setting to validate the reported +22.55% table retrieval improvement and measure end-to-end impact on EM scores