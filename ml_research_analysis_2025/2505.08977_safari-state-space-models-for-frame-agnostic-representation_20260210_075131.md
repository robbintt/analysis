---
ver: rpa2
title: 'SaFARi: State-Space Models for Frame-Agnostic Representation'
arxiv_id: '2505.08977'
source_url: https://arxiv.org/abs/2505.08977
tags:
- frame
- representation
- safari
- error
- measure
- transformers
- self-attention
- retrieval-augmented-generation
- instruction-tuning
- parameter-efficient-finetuning
- mixture-of-experts
- chain-of-thought
core_contribution: SaFARi generalizes the HiPPO framework by enabling SSM construction
  with any frame or basis, not just orthogonal polynomials. It introduces a numerical
  method to derive SSM parameters A and B for arbitrary frames, extending applicability
  beyond polynomial bases.
---

# SaFARi: State-Space Models for Frame-Agnostic Representation

## Quick Facts
- arXiv ID: 2505.08977
- Source URL: https://arxiv.org/abs/2505.08977
- Reference count: 40
- Key outcome: Generalizes HiPPO framework to arbitrary frames/bases for SSM construction

## Executive Summary
SaFARi extends the HiPPO framework by enabling State-Space Model construction with arbitrary frames or bases, not just orthogonal polynomials. The framework introduces numerical methods to derive SSM parameters A and B for any frame, preserving key HiPPO properties like timescale robustness. Two variants are presented for uniform scaled and translated measures, with error analysis showing that truncation and mixing errors arise from frame truncation. The approach enables exploration of novel bases like wavelets for sequential modeling tasks.

## Method Summary
SaFARi constructs SSM matrices through numerical integration of frame-dual frame products, generalizing HiPPO's closed-form derivations. The A matrix is computed via A = I + U_Υ U*_Φ̃ (scaled) or A = U_Φ̇ U*_Φ̃ + Q_Φ Q*_Φ̃ (translated), where frame operator products capture coefficient derivative relationships. The framework provides two finite-dimensional approximation methods: ToD (Truncation of Dual) and DoT (Dual of Truncation), with DoT proven optimal for representation error. For inference, sequential updates use Generalized Bilinear Transform discretization, while diagonalizable A enables closed-form convolution kernels for efficient training.

## Key Results
- Introduces SaFARi framework generalizing HiPPO to arbitrary frames/bases
- Provides explicit matrix constructions (Theorems 1-2) for scaled and translated measures
- Proves DoT construction has optimal representation error (Theorem 5)
- Shows mixing errors depend on A matrix structure, minimized when A is lower-triangular
- Enables exploration of novel bases like wavelets in sequential modeling

## Why This Works (Mechanism)

### Mechanism 1
Arbitrary frames can generate valid SSM matrices through numerical integration of frame-dual frame products. The A matrix is constructed via A = I + U_Υ U*_Φ̃ (scaled) or A = U_Φ̇ U*_Φ̃ + Q_Φ Q*_Φ̃ (translated), where the frame operator products capture how coefficient derivatives relate to current coefficients. This generalizes HiPPO's closed-form derivations. Core assumption: The frame elements are differentiable and the dual frame can be approximated numerically via pseudo-inverse. Evidence anchors: [abstract] presents SaFARi, a generalized framework for constructing State-Space Models (SSMs) using arbitrary frames or bases; [Section 4.2-4.3] Theorems 1 and 2 provide explicit matrix constructions for scaled and translated measures; [corpus] WaLRUS paper independently validates wavelet-based SSMs, suggesting frame generalization is empirically viable. Break condition: Frame elements lacking differentiability or frames with poor numerical conditioning in the dual computation.

### Mechanism 2
The Dual of Truncation (DoT) construction minimizes representation error compared to Truncation of Dual (ToD). DoT computes the pseudo-inverse dual of the truncated N-element frame before deriving A,B. This ensures the reconstruction error ξ = Υ(Φ̃Φ - I) is minimized in Frobenius norm. ToD truncates an (infinite) dual approximation, introducing uncontrolled error. Core assumption: The truncated frame's pseudo-inverse is well-conditioned. Evidence anchors: [Section 5.1.3] Defines DoT construction algorithm; [Section 5.2.5, Theorem 5] Proves DoT has optimal representation error; [corpus] No direct corpus comparison; validation remains limited to this paper's numerical experiments. Break condition: Ill-conditioned frames where pseudo-inverse amplifies numerical noise.

### Mechanism 3
Mixing errors dominate truncation errors when A has non-zero upper-right quadrant elements and high-index coefficients carry energy. During state updates (∂c/∂T = -TA⁻¹Ac + ...), the matrix multiplication Ac mixes information from truncated indices (n>N) into retained indices (n≤N). Lower-triangular A (like HiPPO-LegS) eliminates mixing by construction. Core assumption: Signal energy distributes non-uniformly across coefficient indices. Evidence anchors: [Section 5.2.2] Defines mixing errors and their dependence on A structure; [Figure 5] Shows A matrix structures; dense upper-right regions in LegT/FouT correlate with poor performance; [corpus] WaLRUS notes wavelet frames may reduce mixing through locality—consistent but not proven. Break condition: Frames yielding approximately lower-triangular A or signals with rapidly decaying coefficient spectra.

## Foundational Learning

- Concept: Frame theory and dual frames
  - Why needed here: SaFARi's core construction requires computing frame operators and pseudo-inverse duals to derive A matrices.
  - Quick check question: Given frame vectors Φ = {ϕ₁, ϕ₂}, can you compute the dual frame elements via (ΦΦᵀ)⁻¹Φ?

- Concept: State-space model discretization (Generalized Bilinear Transform)
  - Why needed here: The continuous ODE must be discretized for sequential updates; GBT with α parameter controls numerical accuracy.
  - Quick check question: What discretization parameter α gives the forward Euler method? (Answer: α = 0)

- Concept: Eigenvalue stability and diagonalization
  - Why needed here: Computational efficiency requires diagonal A; stability requires negative real eigenvalues.
  - Quick check question: If A has eigenvalues with positive real parts, what happens to the state c(t) over time?

## Architecture Onboarding

- Component map: Frame selection module -> Dual frame computation -> SSM matrix derivation -> Diagonalization check -> Convolution kernel -> Inference
- Critical path:
  1. Choose frame appropriate to signal class (polynomial → smooth, wavelet → localized)
  2. Compute DoT-based A, B matrices (always prefer DoT over ToD)
  3. Verify A structure: lower-triangular → zero mixing error; dense upper-right → high mixing risk
  4. Check diagonalizability: if stable, use closed-form kernels for O(N log L) training
- Design tradeoffs:
  - Frame choice vs. mixing error: Lower-triangular A (LegS) eliminates mixing but constrains representational flexibility
  - N (state size) vs. truncation error: Larger N reduces truncation error but increases O(N³L) sequential cost if non-diagonalizable
  - Scaled vs. translated measure: Scaled enables simpler updates; translated provides fixed window but higher mixing risk
- Failure signatures:
  - Exploding representations: A has eigenvalues with positive real parts or fast LegS solver used with N > 400
  - Poor reconstruction: Frame mismatched to signal class; mixing errors from dense A upper quadrant
  - Numerical divergence in dual: Ill-conditioned frame Gram matrix; increase discretization L or orthogonalize
- First 3 experiments:
  1. Reproduce HiPPO-LegS A matrix using SaFARi with Legendre polynomials (L=1000) to validate numerical convergence; expect <10⁻³ error vs. closed-form
  2. Test wavelet frame on discontinuous signal; compare DoT vs. ToD reconstruction error across N ∈ {16, 64, 256}
  3. Profile diagonalizable (Fourier) vs. non-diagonalizable (Legendre) frames on sequence length L=10⁴; measure wall-clock training time ratio

## Open Questions the Paper Calls Out

### Open Question 1
How do wavelet and other structured frames (e.g., Gabor frames, curvelets) perform within the SaFARi framework for localized and sparse signal representations? Basis in paper: [explicit] The conclusion states: "Future directions include the evaluation of wavelet and other structured frames within SaFARi, aiming to enhance localized and sparse representations beyond the capabilities of polynomial or Fourier methods." Why unresolved: The current work validates SaFARi primarily on polynomial and Fourier bases; structured frames with localization properties remain unexplored. What evidence would resolve it: Empirical comparison of reconstruction error and mixing error for wavelet-based SaFARi against HiPPO baselines on signals with localized features or discontinuities.

### Open Question 2
Can SaFARi be extended to non-uniform weighting measures (e.g., exponential decay, Gaussian weighting) while preserving the closed-form SSM update structure? Basis in paper: [explicit] The paper notes in Section 2.2: "We leave alternative weighting schemes to future work" and considers only uniform weighting. Why unresolved: The theoretical derivation (Theorems 1 and 2) depends explicitly on uniform measures; it remains unclear whether arbitrary weighting functions yield tractable A and B matrices. What evidence would resolve it: Derivation of A and B matrix formulas for a non-uniform measure, plus numerical validation showing bounded representation error.

### Open Question 3
What are the necessary and sufficient conditions on a frame Φ for the resulting SaFARi A matrix to be stably diagonalizable? Basis in paper: [inferred] The paper notes that Legendre-based SSMs "cannot be stably diagonalized, even for representation sizes as small as N = 20," limiting computational efficiency. No characterization of which frames avoid this is provided. Why unresolved: Diagonalizability determines whether O(NL) parallel computation is achievable, but the structural properties of Φ that guarantee stable diagonalization remain unidentified. What evidence would resolve it: Theoretical analysis linking frame properties (e.g., orthogonality, tightness) to eigenvalue conditioning of A, validated across multiple frame families.

## Limitations

- Numerical integration method for deriving A and B matrices lacks rigorous error bounds for arbitrary frames
- Limited empirical validation beyond synthetic reconstruction tasks and no real-world sequential modeling benchmarks
- Generalization claims not thoroughly tested across diverse signal classes and frame families

## Confidence

- **High Confidence**: The mathematical framework for frame-based SSM construction is sound, as it directly extends established Hilbert space theory. The distinction between DoT and ToD constructions and their respective error characteristics is well-established.
- **Medium Confidence**: The theoretical error decomposition (truncation + mixing) accurately captures the dominant failure modes, though empirical validation is limited. The scalability claims for diagonalizable SSMs assume well-behaved eigenvalue distributions.
- **Low Confidence**: The assertion that frame choice can be systematically matched to signal characteristics for improved performance remains largely theoretical, with only wavelet examples in the corpus and no comprehensive ablation studies.

## Next Checks

1. Benchmark SaFARi-constructed SSMs against S4/HiPPO on standard long-sequence tasks (PG-19, Long Range Arena) using multiple frame choices to quantify practical performance differences.
2. Systematically characterize the numerical stability of dual frame computation across diverse frame families (wavelets, windowed Fourier, learned dictionaries) and identify which properties guarantee well-conditioned Gram matrices.
3. Develop and validate quantitative metrics for "frame-signal alignment" that predict when a particular frame will outperform others for a given task, moving beyond the current qualitative guidance.