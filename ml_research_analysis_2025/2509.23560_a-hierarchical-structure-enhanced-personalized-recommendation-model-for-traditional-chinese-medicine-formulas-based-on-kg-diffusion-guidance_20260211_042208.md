---
ver: rpa2
title: A Hierarchical Structure-Enhanced Personalized Recommendation Model for Traditional
  Chinese Medicine Formulas Based on KG Diffusion Guidance
arxiv_id: '2509.23560'
source_url: https://arxiv.org/abs/2509.23560
tags:
- herb
- herbs
- tcm-hedpr
- symptom
- process
- transformers
- self-attention
- retrieval-augmented-generation
- instruction-tuning
- parameter-efficient-finetuning
- mixture-of-experts
- chain-of-thought
core_contribution: This paper introduces TCM-HEDPR, a hierarchical structure-enhanced
  personalized recommendation model for traditional Chinese medicine formulas based
  on knowledge graph diffusion guidance. The model addresses limitations in existing
  herb recommendation systems by incorporating patient-personalized information, mitigating
  long-tailed herb data distribution, and capturing herb compatibility relationships.
---

# A Hierarchical Structure-Enhanced Personalized Recommendation Model for Traditional Chinese Medicine Formulas Based on KG Diffusion Guidance

## Quick Facts
- arXiv ID: 2509.23560
- Source URL: https://arxiv.org/abs/2509.23560
- Reference count: 40
- Introduces TCM-HEDPR model showing 5.33% to 12.50% improvement in precision, recall, and NDCG metrics over state-of-the-art approaches

## Executive Summary
This paper presents TCM-HEDPR, a hierarchical structure-enhanced personalized recommendation model for traditional Chinese medicine formulas that leverages knowledge graph diffusion guidance. The model addresses critical limitations in existing herb recommendation systems by incorporating patient-personalized information, mitigating long-tailed herb data distribution, and capturing herb compatibility relationships. Through extensive experiments on two public datasets and one clinical dataset, the model demonstrates superior performance compared to current HPR methods while providing therapeutic validity through network pharmacology analysis.

## Method Summary
The TCM-HEDPR model employs a multi-stage approach to personalized TCM prescription generation. It begins with prompt-oriented contrastive learning for data augmentation, addressing the long-tailed distribution of herb data. A knowledge graph-guided homogeneous graph diffusion method with self-attention mechanisms captures symptom-herb relationships, while a heterogeneous graph hierarchical network enables fine-grained prescription generation. The model integrates patient-specific information throughout the recommendation process, moving beyond symptom-based approaches to consider comprehensive patient profiles.

## Key Results
- Achieves 5.33% to 12.50% improvements in precision, recall, and NDCG metrics over state-of-the-art approaches
- Demonstrates effective target interactions and pathway enrichment through network pharmacology analysis
- Shows superior performance on two public datasets and one clinical dataset compared to existing HPR methods

## Why This Works (Mechanism)
The model's effectiveness stems from its hierarchical architecture that progressively refines recommendations from symptom identification to complete prescription generation. The knowledge graph diffusion guidance allows for capturing complex relationships between herbs, symptoms, and patient characteristics that traditional methods miss. The prompt-oriented contrastive learning addresses data scarcity issues common in TCM datasets, while the heterogeneous graph structure enables the model to learn both high-level compatibility patterns and fine-grained herb interactions simultaneously.

## Foundational Learning
1. **Knowledge Graph Diffusion** - Why needed: Captures indirect relationships between herbs and symptoms; Quick check: Verify edge weights and propagation coefficients in KG
2. **Prompt-Oriented Contrastive Learning** - Why needed: Addresses long-tailed distribution in herb data; Quick check: Confirm augmentation diversity and sampling strategies
3. **Heterogeneous Graph Neural Networks** - Why needed: Models multi-type entities and relationships in TCM data; Quick check: Validate node type embeddings and relation-specific transformations
4. **Hierarchical Network Architecture** - Why needed: Enables progressive refinement from symptoms to complete prescriptions; Quick check: Test information flow between hierarchy levels
5. **Self-Attention Mechanisms** - Why needed: Captures complex interactions between symptoms and herbs; Quick check: Analyze attention weight distributions
6. **Network Pharmacology Analysis** - Why needed: Validates therapeutic validity of recommendations; Quick check: Verify pathway enrichment significance and target interaction scores

## Architecture Onboarding

**Component Map:** Patient Data -> Prompt Learning -> KG Diffusion -> Hierarchical Network -> Prescription Output

**Critical Path:** The model processes patient information through prompt-oriented contrastive learning for augmentation, then applies knowledge graph diffusion to establish symptom-herb relationships, and finally uses the heterogeneous hierarchical network to generate prescriptions. The KG diffusion and hierarchical network components are most critical for achieving high performance.

**Design Tradeoffs:** The model trades computational complexity for accuracy by using hierarchical structures and knowledge graph guidance. While this increases training time and model size, it significantly improves recommendation quality and therapeutic validity compared to simpler approaches.

**Failure Signatures:** Performance degradation occurs when knowledge graphs have incomplete herb-symptom relationships, when patient data lacks sufficient detail for personalization, or when the hierarchical network fails to properly capture compatibility patterns between herbs.

**First 3 Experiments:**
1. Validate contrastive learning augmentation effectiveness by comparing herb distribution before and after augmentation
2. Test KG diffusion propagation by measuring how well indirect relationships are captured
3. Evaluate hierarchical network performance by comparing top-K recommendation accuracy at each hierarchy level

## Open Questions the Paper Calls Out
None

## Limitations
- Evaluation based primarily on public datasets with limited clinical validation
- Model performance in real-world clinical settings remains unverified
- Focus specifically on traditional Chinese medicine limits generalizability to other medical domains

## Confidence
- Model Architecture and Implementation: **High**
- Performance Claims: **Medium**
- Clinical Relevance: **Low**

## Next Checks
1. Conduct prospective clinical trials to evaluate prescription recommendations in actual patient care settings
2. Perform cross-domain validation using non-TCM medical datasets to test generalizability
3. Implement ablation studies to quantify the specific contribution of each component (KG diffusion, hierarchical network, prompt learning) to overall performance