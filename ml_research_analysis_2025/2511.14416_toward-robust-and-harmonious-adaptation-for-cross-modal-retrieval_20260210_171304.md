---
ver: rpa2
title: Toward Robust and Harmonious Adaptation for Cross-modal Retrieval
arxiv_id: '2511.14416'
source_url: https://arxiv.org/abs/2511.14416
tags:
- query
- retrieval
- shift
- adaptation
- queries
- transformers
- self-attention
- retrieval-augmented-generation
- instruction-tuning
- parameter-efficient-finetuning
- mixture-of-experts
- chain-of-thought
core_contribution: This paper addresses the query shift (QS) problem in cross-modal
  retrieval (CMR), where online and diverse real-world queries exhibit distribution
  shifts that degrade retrieval performance. The authors propose REST (Robust adaptation
  with quEry ShifT), a test-time adaptation method that formulates query predictions
  to enable existing recognition-oriented TTA methods for CMR.
---

# Toward Robust and Harmonious Adaptation for Cross-modal Retrieval

## Quick Facts
- **arXiv ID**: 2511.14416
- **Source URL**: https://arxiv.org/abs/2511.14416
- **Reference count**: 40
- **Key outcome**: REST significantly outperforms state-of-the-art methods, achieving improvements of up to 11.4% in recall@1 metrics on challenging benchmarks with synthetic and real-world distribution shifts

## Executive Summary
This paper addresses the query shift (QS) problem in cross-modal retrieval (CMR), where online and diverse real-world queries exhibit distribution shifts that degrade retrieval performance. The authors propose REST (Robust adaptation with quEry ShifT), a test-time adaptation method that formulates query predictions to enable existing recognition-oriented TTA methods for CMR. REST employs a QS-robust objective function that preserves query uniformity, narrows query-gallery gaps, and enhances query-gallery consistency. Additionally, a gradient decoupling module prevents the model from forgetting general knowledge when adapting to diverse queries. Experiments on 20 benchmarks across three CMR tasks show that REST significantly outperforms state-of-the-art methods, achieving improvements of up to 11.4% in recall@1 metrics on challenging benchmarks with synthetic and real-world distribution shifts.

## Method Summary
REST is a test-time adaptation framework specifically designed to handle query shift problems in cross-modal retrieval. The method introduces a QS-robust objective function that simultaneously preserves query uniformity (preventing clustering), narrows the query-gallery feature gap, and enhances consistency between query and gallery representations. A gradient decoupling module is incorporated to prevent catastrophic forgetting of general knowledge during adaptation. The framework adapts existing recognition-oriented test-time adaptation methods to the CMR domain by formulating query predictions in a way that leverages contrastive learning principles. During inference, REST processes incoming queries in mini-batches, estimating constraints from source-domain-like data within each batch to guide the adaptation process.

## Key Results
- REST achieves up to 11.4% improvement in recall@1 metrics on challenging benchmarks
- Outperforms state-of-the-art methods across 20 benchmarks spanning three CMR tasks
- Demonstrates effectiveness on both synthetic distribution shifts and real-world query variations
- Shows consistent improvements across different types of cross-modal retrieval scenarios

## Why This Works (Mechanism)
The REST framework works by addressing the fundamental challenge of query shift in cross-modal retrieval through three complementary mechanisms. First, the QS-robust objective function preserves the uniformity of query representations in the feature space, preventing them from clustering in ways that would degrade retrieval performance. Second, it actively narrows the feature gap between queries and the gallery, ensuring that the adapted model maintains effective cross-modal alignment. Third, the enhanced query-gallery consistency improves the reliability of retrieval results. The gradient decoupling module plays a crucial role by allowing the model to adapt to specific query distributions while maintaining its general knowledge base, preventing catastrophic forgetting that would otherwise degrade performance on queries from the original distribution.

## Foundational Learning

**Cross-modal retrieval**: The task of retrieving relevant items across different modalities (e.g., text-to-image or image-to-text search) using shared embedding spaces. *Why needed*: Understanding this task is fundamental to grasping the problem REST addresses. *Quick check*: Can you explain how text queries are mapped to image features in a shared embedding space?

**Test-time adaptation (TTA)**: Methods that adapt pre-trained models during inference without access to source data. *Why needed*: REST is a TTA method, so understanding this concept is crucial. *Quick check*: What distinguishes test-time adaptation from traditional fine-tuning?

**Query shift problem**: The phenomenon where online queries exhibit distribution shifts that differ from the source domain distribution. *Why needed*: This is the core problem REST solves. *Quick check*: How does query shift differ from domain shift in traditional domain adaptation?

**Gradient decoupling**: A technique that separates the adaptation of different model components to prevent catastrophic forgetting. *Why needed*: This is a key component of REST's effectiveness. *Quick check*: What are the risks of not using gradient decoupling during test-time adaptation?

## Architecture Onboarding

**Component map**: Input query batch -> Feature extraction (shared encoder) -> Query uniformity preservation -> Query-gallery gap estimation -> Constraint selection -> Gradient decoupling -> Adapted query representation -> Retrieval

**Critical path**: The most critical sequence is: Query batch → Feature extraction → QS-robust objective computation → Gradient decoupling → Adapted query representations. This path determines the quality of the final retrieval results.

**Design tradeoffs**: REST trades computational overhead during inference for improved retrieval accuracy. The method requires processing queries in mini-batches rather than individually, which may not be suitable for strict online settings with single-query arrivals. The gradient decoupling adds complexity but prevents catastrophic forgetting.

**Failure signatures**: Performance degradation occurs when: 1) Query batches contain no source-domain-like data for constraint estimation, 2) Batch sizes are too small for reliable center estimation, 3) Distribution shifts are too extreme for the adaptation mechanism to handle effectively.

**First experiments**:
1. Validate query uniformity preservation by visualizing query feature distributions before and after REST adaptation
2. Test retrieval performance degradation with varying batch sizes (1, 8, 16, 32, 64) to identify optimal batch size
3. Measure catastrophic forgetting by evaluating performance on original distribution queries after REST adaptation

## Open Questions the Paper Calls Out

**Open Question 1**: Can the REST framework be generalized to generative cross-modal tasks like image captioning and visual question answering (VQA)?
- **Basis in paper**: [explicit] The Conclusion states: "In the future, we plan to explore more applications that might suffer from the query-shift problem, such as image captioning and visual question answering."
- **Why unresolved**: REST currently relies on query prediction refinement from a fixed gallery and contrastive losses, mechanisms that do not directly apply to generative decoding with open-ended outputs.
- **What evidence would resolve it**: Successful adaptation of the gradient decoupling module to generative Vision-Language Models (VLMs) demonstrating robustness to query shift in captioning tasks.

**Open Question 2**: How does REST perform in a strict online setting where queries arrive strictly one-by-one (batch size = 1) rather than in mini-batches?
- **Basis in paper**: [inferred] The method relies on batch-level statistics, specifically the "center of queries" ($z_Q$) for uniformity (Eq. 9) and constraint estimation (Eq. 6), using batch sizes of 32 or 64.
- **Why unresolved**: With a batch size of 1, the center $z_Q$ is undefined, making the calculation of query uniformity and the selection of source-domain-like constraints unstable.
- **What evidence would resolve it**: Experiments evaluating performance degradation as batch size approaches 1, or the introduction of a running average mechanism to replace batch-level centers.

**Open Question 3**: How does the method perform when the online query stream is entirely out-of-distribution, containing no "source-domain-like" data for constraint estimation?
- **Basis in paper**: [inferred] Section III-B-2 assumes the batch contains some source-domain-like data to estimate the query-gallery gap constraint ($\Delta_S$).
- **Why unresolved**: If a batch is entirely corrupted or from a novel domain, the constraint estimation may select noisy samples, leading to incorrect gap rectification.
- **What evidence would resolve it**: A sensitivity analysis measuring the stability of the estimated $\Delta_S$ under increasing levels of corruption where source-domain-like samples are artificially removed.

## Limitations

- **Generalizability uncertainty**: The method's performance on truly open-domain queries with extreme distribution shifts remains unverified beyond the tested benchmarks.
- **Computational overhead**: The test-time adaptation process adds computational complexity that may limit practical deployment in resource-constrained settings.
- **Batch size dependency**: The method relies on mini-batch processing, making it less suitable for strict online settings where queries arrive one-by-one.

## Confidence

**High confidence**: The core methodology for formulating query predictions and the QS-robust objective function are well-justified and technically sound. The experimental design and baseline comparisons are rigorous, providing strong evidence for the method's effectiveness.

**Medium confidence**: The claims about REST's superiority over state-of-the-art methods are well-supported by the reported metrics, but the real-world applicability may vary depending on specific deployment scenarios and query distributions not captured in the benchmarks.

**Low confidence**: The assertion that REST achieves "harmonious adaptation" is somewhat qualitative and not rigorously quantified. The long-term stability of the adaptation process and potential degradation over multiple adaptation rounds requires further investigation.

## Next Checks

1. Conduct extensive testing with real-world query distributions from diverse applications (e.g., e-commerce, social media, medical imaging) to verify robustness beyond synthetic distribution shifts.

2. Perform ablation studies focusing specifically on the gradient decoupling module's effectiveness in preventing catastrophic forgetting under more severe domain shifts.

3. Evaluate the computational efficiency and memory requirements during test-time adaptation across different hardware configurations to assess practical deployment feasibility.