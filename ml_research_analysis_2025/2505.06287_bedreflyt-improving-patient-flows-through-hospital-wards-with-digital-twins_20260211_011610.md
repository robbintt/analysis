---
ver: rpa2
title: 'BedreFlyt: Improving Patient Flows through Hospital Wards with Digital Twins'
arxiv_id: '2505.06287'
source_url: https://arxiv.org/abs/2505.06287
tags:
- patient
- patients
- hospital
- ward
- allocation
- transformers
- self-attention
- retrieval-augmented-generation
- instruction-tuning
- parameter-efficient-finetuning
- mixture-of-experts
- chain-of-thought
core_contribution: The paper presents BedreFlyt, a digital twin system for improving
  hospital ward resource planning through bed allocation optimization. The core method
  combines executable formal models (ABS), ontologies for knowledge representation,
  and SMT solvers (Z3) to transform streams of incoming patients into optimization
  problems for bed allocation.
---

# BedreFlyt: Improving Patient Flows through Hospital Wards with Digital Twins

## Quick Facts
- **arXiv ID:** 2505.06287
- **Source URL:** https://arxiv.org/abs/2505.06287
- **Reference count:** 40
- **Primary result:** Multi-day bed allocation for up to 2000 patients over 365 days is computationally feasible, with most scenarios computed in under 20 minutes.

## Executive Summary
BedreFlyt is a digital twin system designed to optimize bed allocation in hospital wards by minimizing patient movement while satisfying constraints on gender, bed bay categories, and infectious conditions. The system combines executable formal models, ontologies, and SMT solvers to transform patient streams into optimization problems. Evaluation using anonymized historical data from Rikshospitalet demonstrates computational tractability for large-scale scenarios, though live deployment faces unresolved legal and practical barriers.

## Method Summary
BedreFlyt uses an ABS simulation model to generate timed bed-need streams from patient trajectories, an ontology (RDF/OWL) to formalize ward structure and treatments, and SMOL to orchestrate components while querying the knowledge base via SPARQL. Z3 SMT solver with optimization modulo theories solves allocation problems using quantifier-free linear real arithmetic formulas, minimizing patient reallocations. The system was evaluated on anonymized historical data from Rikshospitalet, testing various patient counts and time frames.

## Key Results
- Computational feasibility demonstrated for up to 2000 patients over 30 days (peak 80 minutes computation time)
- Most scenarios (up to 1000 patients) computed in under 20 minutes
- Constraint satisfaction maintained across all tested scenarios (gender, capacity, category, isolation)
- System produces allocation plans that minimize patient movement while meeting all constraints

## Why This Works (Mechanism)

### Mechanism 1
- **Claim:** Bed allocation is computationally tractable for large-scale scenarios by encoding it as a quantifier-free linear real arithmetic formula solved via SMT with optimization.
- **Mechanism:** The system transforms patient-to-room assignment into a conjunction of sub-formulas (ϕpatient ∧ ϕroom ∧ ϕgender ∧ ϕcontagious ∧ ϕcategory) with an optimization objective minimizing reallocations via Z3's νZ extension. This reduces an NP-hard assignment problem to a form where modern SMT solvers can find solutions efficiently for realistic instance sizes.
- **Core assumption:** Constraint density in real hospital scenarios remains below the threshold where satisfiability becomes intractable (the problem is NP-hard but practically solvable).
- **Evidence anchors:**
  - [Section 4.3]: Formal definition of all constraint sub-formulas with optimization extension for minimizing changes
  - [Section 6.2]: "Apart from the scenario with 2000 patients with a time frame of 30 days... all scenarios in less than 20 minutes"
  - [corpus]: No direct corpus comparison of SMT vs. alternative optimization methods for bed allocation; related work uses simulation or ML approaches.
- **Break condition:** If patient-to-room ratio exceeds available capacity significantly, or constraint interactions create unsatisfiable cores (days are skipped in evaluation).

### Mechanism 2
- **Claim:** Patient trajectories can be abstracted as packages of tasks with dependencies, enabling simulation-driven generation of time-indexed resource needs.
- **Mechanism:** The ABS simulator maintains a list of "packages" (patient + remaining treatment tasks). At each time step, it activates tasks whose dependencies are satisfied, decrements durations, and emits bed bay category needs per patient. This decouples treatment logic from allocation logic.
- **Core assumption:** Treatment durations can be approximated with average values without significantly degrading allocation quality (granularity currently day-level).
- **Evidence anchors:**
  - [Section 4.2]: "The simulator uses the concept of a Package to capture ongoing treatments... A task in a package becomes active once all tasks it depends on have been performed."
  - [Section 5]: "simulation starts with time interval 1... for each of them, the first enabled task is executed, and the bed bay needs are registered"
  - [corpus]: LSDTs paper mentions similar knowledge-intensive infrastructure planning but with LLM augmentation; no direct comparison to ABS-style simulation.
- **Break condition:** If task durations have high variance or treatments require sub-day granularity, day-level simulation produces inaccurate resource need predictions.

### Mechanism 3
- **Claim:** Separating domain knowledge (ontology) from simulation and solver logic enables scenario reconfiguration without code changes.
- **Mechanism:** Ward structure, treatment definitions, and task dependencies are stored in an RDF/OWL knowledge base. SMOL queries this via SPARQL to configure the ABS model and constraint generator at runtime. This implements "semantic reflection" where the DT's runtime state is queryable alongside domain knowledge.
- **Core assumption:** The ontology captures all relevant constraints for bed allocation; extensions (e.g., equipment, personnel) require ontology updates but not architectural changes.
- **Evidence anchors:**
  - [Section 4.1]: "no information about the ward's resources or processes are hard-coded into the DT's simulator or constraint-solver components; rather, these are configured on the fly"
  - [Section 5]: "information from the knowledge base is retrieved by SMOL through SPARQL queries encapsulated into service components"
  - [corpus]: Semantic NLP Pipelines paper addresses patient DTs from unstructured EHRs but focuses on extraction, not runtime configuration.
- **Break condition:** If ontology schema doesn't match simulation needs, manual bridge code is required, breaking the self-adaptation property.

## Foundational Learning

- **Concept: SMT Solving with Optimization (Z3)**
  - Why needed here: Understanding how constraints are encoded and why optimization (minimizing reallocations) is layered on top of satisfiability.
  - Quick check question: Can you explain why the formula ϕchanges uses disjunction (apv(p) ∨ cp) to track whether a patient moved rooms?

- **Concept: Actor-Based Simulation (ABS)**
  - Why needed here: The simulator uses cooperative scheduling with explicit suspension points; understanding this helps debug timing issues in package processing.
  - Quick check question: How would you modify the simulator to handle tasks that can occur in parallel (e.g., lab test during bed occupancy)?

- **Concept: Ontology Querying (SPARQL/SHACL)**
  - Why needed here: The DT's self-adaptation depends on querying the knowledge base at runtime to configure scenarios.
  - Quick check question: What SPARQL query would retrieve all tasks for a given treatment ordered by dependency?

## Architecture Onboarding

- **Component map:** Knowledge Base (RDF/OWL) ← SMOL Application (orchestrator) → queries → Local Data Store (SQLite with patient stream) → configures → ABS Simulation Model → emits constraints → Z3 SMT Solver → returns allocations → SMOL → Output stream

- **Critical path:** Patient stream ingestion → Treatment lookup from KB → ABS simulation generating per-day bed needs → Z3 constraint encoding and solving → Allocation output. Latency is dominated by Z3 for large patient counts (peak at 80 min for 2000 patients/30 days).

- **Design tradeoffs:**
  - Modularity (microservices) vs. latency: Containerized components ease scaling but add communication overhead vs. monolithic approach.
  - Day-level granularity vs. accuracy: Current design uses average durations and day-level decisions; finer granularity would increase constraint complexity.
  - Historical data vs. live integration: Evaluation uses anonymized historical data; live deployment has unresolved legal/practical barriers.

- **Failure signatures:**
  - Unsatisfiable constraints: Z3 returns no solution; current implementation skips the day and keeps previous allocation.
  - High patient density with few rooms: Constraint model construction time spikes (observed peak for 2000 patients/30 days).
  - Missing ontology entries: SPARQL queries return empty results, simulator receives incomplete treatment definitions.

- **First 3 experiments:**
  1. **Baseline validation:** Run the 100-patient/30-day scenario from Section 6.1 and verify ~30-second runtime with plausible allocations (cross-check gender/isolation constraints).
  2. **Stress test boundary:** Increment patient count from 500 to 2000 with fixed 90-day horizon; identify where construction time dominates vs. solving time.
  3. **Scenario perturbation:** Modify the ontology to change one room's bed bay category (e.g., Standard → High Monitoring) and verify allocations adapt without code changes by comparing outputs before/after.

## Open Questions the Paper Calls Out

### Open Question 1
- **Question:** How can probabilistic distributions for task durations and patient arrivals be integrated into the digital twin to replace the current average-case approximations?
- **Basis in paper:** [explicit] "We have not yet integrated statistical models into the twin architecture. The twin model could be extended to include probabilities and distributions that will allow more a more realistic generation of scenarios for simulations."
- **Why unresolved:** Current implementation uses only average durations for tasks; integrating distributions requires architectural changes to both the ABS simulation model and how scenarios are generated from the knowledge base.
- **What evidence would resolve it:** A modified BedreFlyt implementation that accepts distribution parameters (e.g., log-normal for length of stay) and produces statistically valid allocation plans across multiple simulation runs.

### Open Question 2
- **Question:** What is the computational impact of reducing the planning granularity from day-level to minute-level intervals on the SMT solver's performance?
- **Basis in paper:** [explicit] "We plan for the next version of the resource allocation planner to account for real-time updates and leverage the time semantics of ABS to support the generation of bed allocation problems at parameterized time intervals."
- **Why unresolved:** Day-level granularity was sufficient for proof-of-concept; minute-level intervals would dramatically increase the number of constraint problems generated and may affect satisfiability checking times.
- **What evidence would resolve it:** Benchmark experiments showing solver execution times and memory usage across varying time granularities (day, hour, minute) with controlled patient loads.

### Open Question 3
- **Question:** How can the constraint model be extended to handle inter-ward patient transfers and dependencies across multiple hospital wards?
- **Basis in paper:** [explicit] "We plan to extend the model of the ward to include dependencies spanning over multiple wards that influence the movement of patients. This will lead to work on ecosystems of twins."
- **Why unresolved:** Current architecture models a single ward with fixed room configurations; inter-ward coordination requires modeling patient flow between wards and potentially distributed constraint solving.
- **What evidence would resolve it:** A prototype demonstrating coordinated allocation across at least two wards with shared patients, including constraint formulations that capture transfer timing and capacity dependencies.

### Open Question 4
- **Question:** What automated mitigation strategies can the system employ when the bed allocation problem becomes unsatisfiable due to overcrowding?
- **Basis in paper:** [inferred] The paper notes: "When no such allocation can be provided, the day is skipped in our experiments... Clearly, in a real hospital, a more refined approach would be required here, and mitigation actions that lie outside the scope of our DT would be needed."
- **Why unresolved:** Current implementation provides no guidance for infeasible scenarios; real deployment requires actionable alternatives (e.g., early discharge recommendations, overflow protocols).
- **What evidence would resolve it:** Extended Z3 formulations that return near-feasible solutions with constraint relaxation indicators, or integration of soft constraints with penalty weights for ranking partial solutions.

## Limitations
- Evaluation scale boundary: Demonstrated tractability for up to 2000 patients over 30 days, but scalability beyond this range remains untested
- Data availability: Evaluation relies on anonymized historical data from a single Norwegian hospital, limiting generalizability
- Live integration feasibility: System architecture supports real-time data streams, but live deployment faces unresolved legal and practical barriers

## Confidence
- **High confidence:** Core claim that constraint-based SMT solving can handle realistic bed allocation scenarios (validated by computation time results and constraint satisfaction across multiple test cases)
- **Medium confidence:** Architectural separation of concerns (ontology-driven configuration) is sound, but practical benefit over traditional hard-coded approaches isn't directly quantified
- **Low confidence:** Claim about reduced manual workload is asserted but not empirically measured against current hospital practices

## Next Checks
1. **Cross-hospital validation:** Apply the system to anonymized data from a hospital with different patient demographics and ward configurations to test generalizability.
2. **Real-time performance test:** Implement a simulated live data feed with variable arrival patterns to measure system responsiveness under realistic operational conditions.
3. **Comparative workload analysis:** Conduct a time-motion study comparing manual bed allocation processes with BedreFlyt recommendations in a clinical setting to quantify the claimed workload reduction.