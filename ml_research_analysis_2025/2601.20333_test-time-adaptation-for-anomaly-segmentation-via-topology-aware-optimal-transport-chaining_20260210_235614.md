---
ver: rpa2
title: Test-Time Adaptation for Anomaly Segmentation via Topology-Aware Optimal Transport
  Chaining
arxiv_id: '2601.20333'
source_url: https://arxiv.org/abs/2601.20333
tags:
- anomaly
- topoot
- across
- score
- ttt4as
- transformers
- self-attention
- retrieval-augmented-generation
- instruction-tuning
- parameter-efficient-finetuning
- mixture-of-experts
- chain-of-thought
core_contribution: TopoOT integrates multi-scale topological priors with optimal transport
  to generate stability-aware pseudo-labels for test-time anomaly segmentation. By
  chaining persistence diagrams across filtration levels and back-projecting only
  consistently preserved features, it avoids brittle threshold-based binarization
  and yields robust supervision.
---

# Test-Time Adaptation for Anomaly Segmentation via Topology-Aware Optimal Transport Chaining

## Quick Facts
- arXiv ID: 2601.20333
- Source URL: https://arxiv.org/abs/2601.20333
- Reference count: 40
- Outperforms best prior methods by up to +24.1% mean F1 on 2D and +10.2% on 3D datasets

## Executive Summary
TopoOT integrates multi-scale topological priors with optimal transport to generate stability-aware pseudo-labels for test-time anomaly segmentation. By chaining persistence diagrams across filtration levels and back-projecting only consistently preserved features, it avoids brittle threshold-based binarization and yields robust supervision. A lightweight head is trained online with OT-consistency and contrastive objectives to refine the final mask. Evaluated on five 2D/3D benchmarks and seven backbones, TopoOT achieves state-of-the-art performance while running at 121 FPS with 349 MB GPU memory.

## Method Summary
TopoOT processes anomaly maps from frozen backbones through multi-scale sublevel/superlevel filtrations to extract cubical complexes and persistence diagrams (H₀, H₁). Optimal transport chaining aligns diagrams across thresholds (cross-PD) and filtration levels (cross-level), computing stability scores for each topological feature. Only the top-K most stable features are back-projected as pseudo-labels. A lightweight MLP head is trained online per test sample using OT-consistent loss and contrastive objectives to refine the binary mask. The framework is designed for plug-and-play integration with existing anomaly detection backbones.

## Key Results
- Achieves state-of-the-art performance on MVTec AD, VisA, Real-IAD, MVTec 3D-AD, and Anomaly-ShapeNet
- Outperforms best prior methods by up to +24.1% mean F1 on 2D and +10.2% on 3D datasets
- Runs at 121 FPS with 349 MB GPU memory, enabling real-time deployment
- K=1 (single component selection) empirically optimal, with higher K degrading precision

## Why This Works (Mechanism)

### Mechanism 1
Multi-scale topological filtrations capture anomaly structure that single-threshold binarization discards. The method thresholds anomaly maps at multiple levels, builds cubical complexes on sub-/super-level sets, computes persistence diagrams, and treats these diagrams as candidate structural features rather than applying a fixed threshold. Anomalies manifest as disruptions to connectivity/holes that persist across scales.

### Mechanism 2
Entropy-regularized optimal transport chaining identifies topological features that are stable across filtrations. OT is applied to align persistence diagrams within each filtration and between sub-/super-level filtrations. Features with low transport cost and high persistence receive higher stability scores and are selected as pseudo-labels.

### Mechanism 3
A lightweight head trained online with OT-consistency and contrastive objectives refines masks adaptively per sample. The backbone is frozen, and a small MLP head is trained on each test image using OT-aligned pseudo-labels and contrastive separation to push anomalous/nominal pixels apart.

## Foundational Learning

- **Persistent Homology (H₀: connected components, H₁: loops/holes)**: Core to extracting multi-scale topological features from cubical complexes. Without understanding birth/death/persistence, the stability scoring is opaque.
  - Quick check: Can you explain why a feature close to the diagonal (birth ≈ death) is considered noise?

- **Entropy-Regularized Optimal Transport (Sinkhorn Distance)**: Used for all OT alignments in the framework. Enables differentiable, stable matching of persistence diagram points across filtrations.
  - Quick check: How does entropy regularization (ε) affect the sparsity of the transport plan Π*?

- **Test-Time Adaptation (TTA) Principles**: TopoOT operates in TTA mode—frozen backbone + lightweight online-trained head. Understanding entropy minimization, feature consistency, and pseudo-label risks contextualizes the design.
  - Quick check: Why might entropy-minimization alone fail for dense prediction tasks like segmentation?

## Architecture Onboarding

- **Component map**: Input → Frozen Backbone → Anomaly Map A → Multi-Scale Filtration → Persistence Diagrams → OT Chaining → Stability scores → Top-K features → Backprojection → Pseudo-label mask → Lightweight MLP Head → TTT with L_OT + L_contrastive → Refined binary mask
- **Critical path**: The OT chaining step (computing Π* between consecutive PDs and cross-level) is both the stability filter and the pseudo-label generator. If OT alignment is noisy, downstream TTT inherits that noise.
- **Design tradeoffs**: K=1 empirically best; CPU-based persistence computation dominates runtime (~0.33s/sample); backbone dependency means poor A yields poor topology.
- **Failure signatures**: Texture-heavy categories show fragmented pseudo-labels and small false positives; severe distribution shift breaks backbone alignment; K>1 consistently degrades precision.
- **First 3 experiments**: 1) Reproduce MVTec AD PatchCore + TopoOT on bottle/cable to validate pipeline and match F1 ~0.522. 2) Ablation: Run with cross-PD only, cross-level only, and full OT chaining to confirm cross-level is largest contributor. 3) Integration test: Swap backbones (PatchCore → PaDiM) without retraining to verify plug-and-play claims.

## Open Questions the Paper Calls Out

### Open Question 1
Can TopoOT be extended to spatiotemporal domains to enforce temporal coherence in video anomaly detection? The current framework processes 2D/3D snapshots independently and lacks mechanisms to track evolving persistence diagrams across frames.

### Open Question 2
Does integrating differentiable persistent homology layers into the backbone training phase outperform the current frozen-backbone approach? The lightweight head cannot correct for fundamental representational flaws in the frozen backbone.

### Open Question 3
How can the filtration strategy be refined to handle texture-heavy categories where backbone anomaly maps provide weak topological contrast? TopoOT struggles with texture-heavy categories where the backbone provides weak topological signals.

## Limitations
- Performance is bounded by the quality of backbone anomaly maps; cannot recover structure absent from initial maps
- Optimal number and values of filtration thresholds are unspecified, creating reproducibility challenges
- Struggles with texture-heavy categories (carpet, grid, wood) producing fragmented pseudo-labels and small false positives
- CPU-based persistence computation dominates runtime (~0.33s/sample), limiting real-time scalability

## Confidence
- **High**: The core topological pipeline (cubical complexes → persistence diagrams → stability scoring) is well-grounded in TDA literature and technically sound.
- **Medium**: The claim that OT chaining consistently identifies "true" anomalies across backbones hinges on the assumption that stability correlates with semantic anomaly persistence.
- **Low**: The limitation that TopoOT struggles with texture-heavy categories producing fragmented pseudo-labels is acknowledged but not deeply quantified.

## Next Checks
1. Reproduce End-to-End on a Subset: Run PatchCore + TopoOT on MVTec AD bottle and cable categories to validate the full pipeline and match the reported F1 (~0.522).
2. Ablation of OT Components: Systematically disable cross-PD and cross-level alignments to confirm that cross-level OT chaining is the primary driver of gains.
3. Backbone Transfer Test: Swap the backbone (PatchCore → PaDiM or Dinomaly) on a held-out MVTec category without retraining TopoOT to verify the plug-and-play claim.