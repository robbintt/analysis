---
ver: rpa2
title: Anatomically-aware conformal prediction for medical image segmentation with
  random walks
arxiv_id: '2601.18997'
source_url: https://arxiv.org/abs/2601.18997
tags:
- prediction
- conformal
- segmentation
- rw-cp
- medical
- transformers
- self-attention
- retrieval-augmented-generation
- instruction-tuning
- parameter-efficient-finetuning
- mixture-of-experts
- chain-of-thought
core_contribution: This paper addresses the challenge of generating anatomically coherent
  and statistically valid prediction sets for medical image segmentation. Standard
  conformal prediction methods often ignore spatial context, leading to fragmented,
  over-segmented, and anatomically implausible boundaries.
---

# Anatomically-aware conformal prediction for medical image segmentation with random walks

## Quick Facts
- arXiv ID: 2601.18997
- Source URL: https://arxiv.org/abs/2601.18997
- Reference count: 40
- Generates anatomically coherent and statistically valid prediction sets for medical image segmentation

## Executive Summary
This paper addresses the challenge of generating anatomically coherent and statistically valid prediction sets for medical image segmentation. Standard conformal prediction methods often ignore spatial context, leading to fragmented, over-segmented, and anatomically implausible boundaries. To overcome this limitation, the authors propose Random-Walk Conformal Prediction (RW-CP), a model-agnostic framework that enforces spatial coherence by diffusing uncertainty across semantically similar regions using high-dimensional features from pre-trained vision foundation models. Specifically, RW-CP constructs a k-nearest neighbor graph from foundation model embeddings and applies a random walk to propagate probabilities, effectively regularizing the non-conformity scores. This results in more stable and anatomically plausible prediction sets.

## Method Summary
RW-CP is a model-agnostic framework that integrates anatomical awareness into conformal prediction for medical image segmentation. The method extracts pixel-wise embeddings from a frozen DINOv3 vision foundation model, constructs a k-nearest neighbor graph based on cosine similarity, and applies a random walk diffusion to the base segmenter's probability map. This diffusion propagates uncertainty across semantically similar regions while preserving anatomical boundaries. The framework then calibrates a threshold using conformal risk control with false negative rate loss on a held-out calibration set. The diffusion is treated as a fixed pre-processing step, ensuring statistical coverage guarantees hold under exchangeability assumptions.

## Key Results
- RW-CP achieves up to 35.4% improvement in segmentation quality metrics (DSC, ASSD, HD95) compared to standard conformal baselines
- Maintains required marginal coverage guarantees (coverage ≥ 1−α) across multiple imaging modalities
- Outperforms standard conformal methods by producing more stable prediction sets with smoother score landscapes
- Demonstrates consistent performance across CAMUS ultrasound, ACDC MRI, and MSD Pancreas CT datasets

## Why This Works (Mechanism)

### Mechanism 1: Semantic Diffusion via Feature-Guided Random Walks
- Propagates uncertainty across semantically similar pixels rather than just spatial neighbors, reducing fragmentation in the prediction set
- Constructs k-nearest neighbor graph from vision foundation model embeddings and applies random walk to diffuse probabilities
- Core assumption: vision foundation models yield embeddings where semantic similarity correlates with anatomical coherence
- Break condition: if embeddings fail to distinguish adjacent anatomical structures, diffusion will bleed probability mass across labels

### Mechanism 2: Gradient Regularization of the Score Function
- Smooths non-conformity score function via diffusion, stabilizing prediction set size against minor threshold fluctuations
- Creates smoother gradient landscape, preventing massive set expansion from small threshold changes
- Core assumption: Lipschitz continuity of score function is desirable for stable set construction
- Break condition: excessive diffusion strength makes gradient too flat, causing indiscriminate set expansion

### Mechanism 3: Decoupled Calibration via Conformal Risk Control
- Guarantees statistical coverage by treating diffusion as fixed pre-processing step before calibration
- Diffuses probabilities for all calibration samples, then finds threshold satisfying risk bound on modified scores
- Core assumption: calibration and test data are exchangeable even after diffusion transformation
- Break condition: relationship between diffused score and ground truth changes drastically between domains

## Foundational Learning

- **Concept: Conformal Prediction (Split-CP)**
  - Why needed: Statistical engine for calibrating threshold to achieve user-defined error rate (α)
  - Quick check: If I set α=0.1, what is the guaranteed probability that the true mask is contained within the prediction set?

- **Concept: Random Walks on Graphs (Diffusion)**
  - Why needed: Spatial regularizer that propagates values across graph structure defined by feature similarity
  - Quick check: If a pixel has high probability but neighbors in embedding graph have low probabilities, what happens after 10 diffusion steps?

- **Concept: Vision Foundation Models (VFM)**
  - Why needed: Provide semantic map for the graph using robust features without medical-specific fine-tuning
  - Quick check: Why use embeddings from foundation model rather than raw pixel intensity to build neighbor graph?

## Architecture Onboarding

- **Component map:** DINOv3 (Frozen) -> Extracts features Z -> Graph Engine (kNN graph) -> Transition matrix P -> Base UNet -> Raw probability map S(0) -> Diffusion Module -> Diffused map S(nstep) -> Calibrator (FNR loss) -> Threshold λ̂

- **Critical path:** Resolution mismatch handling between DINOv3 features and UNet output requires careful resampling before and after diffusion to ensure proper alignment

- **Design tradeoffs:**
  - k (Neighbors): Low k is fast but disconnected; high k is slow and may blur distinct structures (paper uses k=20)
  - β (Scale): High β restricts diffusion to very similar pixels (conservative); low β spreads uncertainty broadly
  - Steps (n_step): Too few steps leave noise; too many steps merge adjacent organs (over-smoothing)

- **Failure signatures:**
  - "Bleeding" masks: Prediction set expands into adjacent organs → Increase β or decrease steps/k
  - Fragmented masks: Prediction set is noisy → Increase steps or check feature extractor alignment
  - Coverage failure: Empirical coverage < 1−α → Check calibration set size (needs n ≥ 1/α − 1)

- **First 3 experiments:**
  1. Hyperparameter Sweep: Run ablation on k ∈ {5, 20, 50} and steps ∈ {1, 10, 20} to reproduce stability peaks
  2. Visual Alignment Check: Visualize raw probability map S(0) vs. diffused map S(nstep) to confirm noise reduction while preserving boundaries
  3. Calibration Stability: Plot conformal set size vs. λ for Standard CP vs. RW-CP to verify smoother curve for RW-CP

## Open Questions the Paper Calls Out
None

## Limitations
- Assumes pre-trained vision foundation model embeddings provide semantically meaningful groupings for medical anatomy without rigorous validation
- Hyperparameter choices (k=20, β=50, 10 steps) are empirically effective but lack theoretical justification for optimality
- Calibration requires sufficient hold-out set size (n ≥ 1/α − 1), potentially prohibitive for rare disease applications
- Coverage guarantees are marginal (per-pixel) rather than conditional on image content

## Confidence

| Claim | Confidence Level |
|-------|------------------|
| Diffusion via random walks on kNN graphs improves segmentation metrics | High |
| Cross-domain effectiveness of DINOv3 embeddings for anatomical coherence | Medium |
| Approach generalizes to highly heterogeneous anatomies without re-calibration | Low |

## Next Checks

1. Perform ablation study testing alternative foundation models (e.g., Med-Flamingo, BiomedCLIP) and layers to quantify importance of cross-domain embedding quality

2. Evaluate conditional coverage metrics by stratifying results by anatomical complexity and image quality to assess when marginal guarantees fail

3. Test framework on dataset with significant domain shift (different scanner protocols or rare anatomies) to measure robustness beyond training distribution