---
ver: rpa2
title: 'Angle Domain Guidance: Latent Diffusion Requires Rotation Rather Than Extrapolation'
arxiv_id: '2506.11039'
source_url: https://arxiv.org/abs/2506.11039
tags:
- guidance
- diffusion
- distribution
- latent
- domain
- transformers
- self-attention
- retrieval-augmented-generation
- instruction-tuning
- parameter-efficient-finetuning
- mixture-of-experts
- chain-of-thought
core_contribution: Angle Domain Guidance (ADG) addresses the color distortion and
  oversaturation problems that arise in Classifier-Free Guidance (CFG) when using
  high guidance weights in latent diffusion models. The authors identify that these
  artifacts stem from excessive amplification of sample norms in the latent space.
---

# Angle Domain Guidance: Latent Diffusion Requires Rotation Rather Than Extrapolation

## Quick Facts
- **arXiv ID**: 2506.11039
- **Source URL**: https://arxiv.org/abs/2506.11039
- **Reference count**: 40
- **Primary result**: ADG achieves CLIP 0.322, ImageReward 0.970 at ω=8 while maintaining color fidelity and stability at extreme guidance weights (ω=20).

## Executive Summary
Angle Domain Guidance (ADG) addresses the color distortion and oversaturation problems that arise in Classifier-Free Guidance (CFG) when using high guidance weights in latent diffusion models. The authors identify that these artifacts stem from excessive amplification of sample norms in the latent space. They provide a theoretical analysis showing that CFG induces norm amplification and anomalous diffusion behavior, particularly for surface classes in mixture models. ADG mitigates these issues by constraining magnitude variations while optimizing angular alignment in the latent space, replacing linear extrapolation with angular rotation. Experiments on the COCO dataset using Stable Diffusion v3.5 demonstrate that ADG achieves superior text-image alignment while maintaining better color fidelity and outperforming CFG and CFG++ across guidance weights ranging from 2 to 10.

## Method Summary
ADG Algorithm 1 replaces CFG's linear extrapolation with angular rotation in the latent space. The method computes both conditional and unconditional x̂₀ predictions from noise predictions, calculates the angular difference γ between them, applies a scaled rotation with a maximum angle threshold (π/3), and uses the rotated x̂₀,ω for the next timestep update. The core computation involves rotating the conditional prediction toward the unconditional prediction by a scaled angle, with the rotation magnitude capped to prevent catastrophic failure. The method is implemented as a guidance wrapper that modifies the denoising loop and uses 10 NFE with guidance weights ω ∈ [2, 20].

## Key Results
- ADG achieves CLIP 0.322 and ImageReward 0.970 at ω=8 on COCO, outperforming CFG at the same guidance weight.
- ADG remains stable at extreme guidance weights (ω=20) without producing the severe color artifacts and oversaturation seen in CFG.
- ADG demonstrates superior text-image alignment and color fidelity compared to both CFG and CFG++ across the guidance weight range from 2 to 10.

## Why This Works (Mechanism)
ADG works by replacing the linear extrapolation of CFG with angular rotation in the latent space. CFG amplifies both the direction and magnitude of the guidance vector, leading to unbounded norm growth and color distortion at high guidance weights. ADG constrains the magnitude while optimizing angular alignment, ensuring that the guided sample moves along the spherical shell rather than radially outward. The maximum angle threshold (π/3) prevents pathological rotation that could cause catastrophic failure, while still allowing strong semantic control through angular manipulation.

## Foundational Learning
- **Latent Diffusion Models**: Generate images by denoising in a compressed latent space rather than pixel space. Why needed: ADG operates on latent space geometry, so understanding the compressed representation is essential.
- **Classifier-Free Guidance (CFG)**: A technique that linearly interpolates between conditional and unconditional predictions using a guidance weight. Why needed: ADG directly replaces this mechanism, so understanding its failure modes is crucial.
- **Angular Rotation in High Dimensions**: The geometric intuition that rotation on a high-dimensional sphere preserves norm while changing direction. Why needed: ADG's core mechanism relies on rotating vectors in latent space rather than scaling them.
- **Mixture Models and Surface Classes**: Theoretical analysis of how different components in mixture models behave under guidance. Why needed: The paper's theoretical section uses mixture models to demonstrate CFG's failure modes.
- **Text-Image Alignment Metrics**: CLIP score and ImageReward as measures of semantic alignment between generated images and text prompts. Why needed: These are the primary evaluation metrics for ADG's effectiveness.
- **Diffusion Sampling Schedulers**: Different algorithms (DDIM, Euler, DPM-Solver) for generating samples through the diffusion process. Why needed: ADG modifies the guidance step, which must be compatible with various samplers.

## Architecture Onboarding

**Component Map**: Noise prediction → x̂₀ computation → Angular difference calculation → Rotation application → Updated x̂₀,ω → Next timestep

**Critical Path**: The denoising loop where ADG modifies the guidance step by replacing CFG's linear extrapolation with angular rotation. This occurs at each sampling step after computing both conditional and unconditional x̂₀ predictions.

**Design Tradeoffs**:
- **Guidance Weight Range**: ADG allows for much higher guidance weights (ω > 10) without degradation, trading off the traditional risk of artifacts for potentially stronger semantic control.
- **Constraint vs. Freedom**: The maximum angle threshold (default π/3) is a hard constraint that prevents pathological rotation. Removing it leads to catastrophic failure.

**Failure Signatures**:
- **Catastrophic Failure**: If the angle constraint is removed, generation can completely fail with garbled output, especially when (ω-1)γ > π.
- **Minor Color Shift**: Even with ADG, some minor color variations compared to CFG may exist, as the method prioritizes preventing oversaturation over perfectly matching CFG's color profile.
- **Implementation Error**: If the rotation formula is implemented incorrectly (e.g., incorrect sign or projection), the guidance will push samples in the wrong direction, degrading text alignment.

**First 3 Experiments**:
1. **High-Weight Stress Test**: Generate images with a standard prompt using guidance weights ω ∈ {5, 10, 15, 20}. Compare the color saturation and semantic consistency of ADG vs. CFG. Expected: CFG becomes oversaturated and distorted at ω > 8, while ADG remains stable.
2. **Ablation of the Angle Constraint**: Run ADG with and without the threshold(ω-1)γ, π/3 line at a high guidance weight (e.g., ω=15). Expected: The unconstrained version will produce highly degraded or unrecognizable images.
3. **Norm Tracking Plot**: During sampling, log the ℓ₂-norm of the guided x̂₀,ω vector at each step. Compare the trajectory for ADG and CFG. Expected: CFG's norm will grow unboundedly with ω, while ADG's norm will remain bounded (per Proposition 4.1).

## Open Questions the Paper Calls Out
- **Can the output distribution of Angle Domain Guidance (ADG) be formally characterized, or does it strictly remain a heuristic modification without theoretical convergence guarantees?**
- **How does ADG perform when applied to diffusion processes operating directly in the image domain (pixel space) rather than the latent space?**
- **Can ADG be integrated with few-step sampling methods (e.g., consistency models) to enable real-time generation without inducing instability?**
- **How does the geometric constraint of ADG affect temporal consistency when extended to video synthesis or spatial consistency in 3D generation?**

## Limitations
- The angle threshold π/3 is an empirically chosen hyperparameter without theoretical justification for optimality.
- The analysis assumes unimodal or well-separated mixture components, but real image distributions exhibit complex multimodal structures.
- While ADG demonstrates superiority over CFG for color preservation, it doesn't establish whether it provides better overall image quality or diversity compared to recent alternatives.

## Confidence

**High Confidence**: The identification of norm amplification as the root cause of color distortion in CFG is well-supported by the theoretical analysis and empirical evidence.

**Medium Confidence**: The claim that angular rotation outperforms linear extrapolation for guidance is supported by experiments but lacks ablation studies comparing different rotation strategies or threshold values.

**Low Confidence**: The assertion that ADG maintains "superior" text-image alignment across all guidance weights requires scrutiny, as the experiments show competitive performance at specific points but don't establish consistent dominance across the full ω ∈ [2,20] range against all baselines.

## Next Checks
1. **Threshold Sensitivity Analysis**: Systematically vary the angle threshold parameter (π/6, π/4, π/2, no threshold) across multiple guidance weights and measure degradation in CLIP scores and color fidelity to determine optimal thresholding strategy.
2. **Cross-Architecture Generalization**: Apply ADG to non-SD models like DALLE-3, Kandinsky, or LCM-based diffusion models to test whether the angular rotation principle holds across different latent space geometries and conditioning mechanisms.
3. **Distribution Coverage Test**: Measure the Fréchet Inception Distance (FID) and perceptual path length between ADG and CFG samples at guidance weights 2-20 to quantify whether ADG's bounded norm constraint reduces diversity or creates mode collapse compared to CFG.