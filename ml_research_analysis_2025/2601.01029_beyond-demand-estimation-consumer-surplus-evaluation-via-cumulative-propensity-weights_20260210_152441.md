---
ver: rpa2
title: 'Beyond Demand Estimation: Consumer Surplus Evaluation via Cumulative Propensity
  Weights'
arxiv_id: '2601.01029'
source_url: https://arxiv.org/abs/2601.01029
tags:
- surplus
- demand
- estimator
- policy
- pricing
- transformers
- self-attention
- retrieval-augmented-generation
- instruction-tuning
- parameter-efficient-finetuning
- mixture-of-experts
- chain-of-thought
core_contribution: This paper proposes a practical framework for using observational
  data to audit the consumer surplus effects of AI-driven pricing and lending decisions.
  The key innovation is the cumulative propensity weight (CPW) estimator, which leverages
  price randomization inherent in modern algorithmic pricing to directly estimate
  consumer surplus without explicit demand integration.
---

# Beyond Demand Estimation: Consumer Surplus Evaluation via Cumulative Propensity Weights

## Quick Facts
- **arXiv ID:** 2601.01029
- **Source URL:** https://arxiv.org/abs/2601.01029
- **Reference count:** 40
- **Key outcome:** Proposes a framework to audit consumer surplus effects of AI-driven pricing using observational data via cumulative propensity weights, validated on auto loan data showing personalized pricing reduces total surplus while narrowing disparities.

## Executive Summary
This paper introduces a novel framework for estimating consumer surplus from observational pricing data without requiring explicit demand function estimation. The key innovation is the Cumulative Propensity Weight (CPW) estimator, which leverages price randomization inherent in modern algorithmic pricing to directly estimate surplus by reweighting observed purchase outcomes. The authors extend this with a doubly robust augmented CPW (ACPW) estimator that remains consistent if either the demand model or historical pricing distribution is correctly specified. The framework is further extended to inequality-aware surplus measures, allowing regulators to quantify profit-equity trade-offs. Theoretical analysis establishes asymptotic normality and efficiency, while numerical studies validate robustness across different settings.

## Method Summary
The method uses observational data (features, prices, purchase decisions) to estimate consumer surplus under target pricing policies. The CPW estimator directly computes surplus by reweighting purchase outcomes using the ratio of the target policy's cumulative distribution to the historical pricing density. The ACPW estimator adds double robustness by combining this with a direct demand model estimate, remaining consistent if either model is correct. Both estimators use cross-fitting to avoid overfitting bias. The framework extends to inequality-aware measures using generalized means with parameter r, though this variant sacrifices double robustness. The approach is validated through simulation studies and applied to a large-scale auto loan dataset.

## Key Results
- CPW estimator successfully recovers consumer surplus without explicit demand integration by leveraging price randomization
- ACPW estimator achieves double robustness and parametric convergence rates even with slow-converging nuisance models
- Inequality-aware extensions enable profit-equity trade-off analysis but require stricter demand model accuracy
- Application to auto loans shows personalized pricing reduces total consumer surplus while narrowing disparities across credit and political groups
- Comprehensive numerical studies validate robustness of all proposed estimators

## Why This Works (Mechanism)

### Mechanism 1
- **Claim:** Consumer surplus can be estimated directly from binary purchase outcomes by reweighting observations based on the cumulative distribution of the target pricing policy, bypassing the need to explicitly model and integrate the demand function.
- **Mechanism:** The Cumulative Propensity Weight (CPW) estimator leverages the randomness inherent in algorithmic pricing (exploration). Instead of integrating a demand curve $\mu(x,p)$, it aggregates observed purchase decisions ($Y$) weighted by the ratio of the target policy's cumulative distribution $F^\pi(p|x)$ to the historical policy density $\pi^D(p|x)$. This effectively reconstructs the area under the demand curve (surplus) in expectation without estimating the curve itself.
- **Core assumption:** The historical pricing policy involves sufficient randomization (exploration) such that $\pi^D(p|x) > 0$ for all relevant prices (Overlap Assumption 2), and prices are conditionally independent of valuations given covariates (Ignorability Assumption 1).
- **Evidence anchors:**
  - [abstract]: "Each observed purchase outcome at a randomized price is an unbiased estimate of demand... reweighting purchase outcomes using novel cumulative propensity weights (CPW), we are able to reconstruct the integral."
  - [Section 4, Theorem 1]: Proves that $S(\pi) = E[\frac{F^\pi(P|X)}{\pi^D(P|X)} Y]$, allowing surplus estimation without demand modeling.
  - [corpus]: Related work ("Uncovering Utility Functions...") discusses recovering utility from choices, but this specific mechanism focuses on surplus recovery via price randomization.
- **Break condition:** If the historical pricing policy is deterministic or lacks exploration (violating Assumption 2), the denominator $\pi^D(P|X)$ approaches zero, causing weights to explode and estimation to fail.

### Mechanism 2
- **Claim:** The Augmented CPW (ACPW) estimator maintains consistency even if one of the two nuisance models (demand or historical pricing policy) is misspecified, and achieves fast convergence rates with flexible machine learning methods.
- **Mechanism:** This approach uses doubly robust estimation derived from the Efficient Influence Function (EIF). It combines the CPW estimate with a direct demand model estimate. If the propensity (policy) model is wrong, the demand model corrects the bias; if the demand model is wrong, the propensity weights correct the bias. Cross-fitting (data splitting) is used to remove overfitting bias, allowing the use of complex ML models.
- **Core assumption:** The product of the convergence rates of the demand estimator and the propensity estimator must be faster than $n^{-1/2}$ (Assumption 4). This allows both to converge slowly individually while the final estimator converges quickly.
- **Evidence anchors:**
  - [abstract]: "...doubly robust augmented CPW (ACPW) estimator that remains consistent if either the demand model or historical pricing distribution is correctly specified."
  - [Section 5, Proposition 1]: Formally proves that if either $\bar{\mu} = \mu$ or $\bar{\pi}^D = \pi^D$, the estimator is consistent.
  - [Section 7.1.2, Theorem 4]: Establishes asymptotic normality and efficiency under the product-rate condition.
  - [corpus]: "Offline Dynamic Inventory..." addresses censored demand, while this mechanism specifically targets robustness to model misspecification in surplus.
- **Break condition:** If both the demand model and the historical policy model are misspecified simultaneously, the double robustness property fails, and the estimator will be inconsistent.

### Mechanism 3
- **Claim:** Extending the framework to inequality-aware surplus allows regulators to quantify profit-equity trade-offs, though this variant sacrifices double robustness and requires strict accuracy from the demand model.
- **Mechanism:** This mechanism modifies the target estimand from a simple average to a generalized mean $(E[S(\pi|X)^r])^{1/r}$ with parameter $r$. This prioritizes low-surplus groups as $r$ decreases. The estimator is derived from the nonlinear efficient influence function (IA-ACPW).
- **Core assumption:** The demand model must converge at a rate faster than $n^{-1/4}$ (Assumption 8, Section 9). Unlike the standard surplus case, the nonlinearity of the objective prevents the propensity weights from canceling out demand model errors.
- **Evidence anchors:**
  - [abstract]: "...extended to inequality-aware surplus measures, allowing regulators and firms to quantify profit-equity trade-offs."
  - [Section 6]: Introduces the parameter $r$ to trade off aggregate surplus against dispersion.
  - [Section 7.2, Theorem 5]: Notes that for $r \neq 1$, the quadratic error term necessitates stricter demand model convergence ($\alpha_1 > 1/4$), implying single robustness.
  - [corpus]: "Balancing Profit and Fairness..." aligns with the goal but uses different regulatory/tax mechanisms; this paper uses direct statistical estimation of welfare changes.
- **Break condition:** If the demand model is misspecified or converges too slowly (e.g., slow non-parametric ML), the inequality-aware estimator becomes biased and confidence intervals may not cover the true value, as the "safety net" of double robustness is removed by the nonlinear transformation.

## Foundational Learning

- **Concept: Off-Policy Evaluation (OPE) and Inverse Propensity Weighting (IPW)**
  - **Why needed here:** The paper builds upon OPE logic (evaluating a target policy using data from a historical policy). Understanding standard IPW is necessary to appreciate why the authors use *Cumulative* Propensity Weights instead of standard weights—the surplus is an integral (area), not a point estimate.
  - **Quick check question:** Why does the standard IPW numerator (target density) fail for surplus estimation, requiring a cumulative distribution function (CDF) instead? (Answer: Because we are aggregating the area under the curve, not just the expected value at a point).

- **Concept: Semiparametric Efficiency and Influence Functions**
  - **Why needed here:** The "Augmented" estimator relies on the Efficient Influence Function (EIF) to achieve the lowest possible variance and double robustness. Without this concept, the derivation of the ACPW estimator appears arbitrary rather than theoretically optimal.
  - **Quick check question:** What does it mean for an estimator to be "doubly robust" in the context of nuisance functions (demand and policy)? (Answer: It remains consistent if *either* model is correct, but not necessarily if both are wrong).

- **Concept: Consumer Surplus and Willingness to Pay**
  - **Why needed here:** The core problem is that surplus $(V-P)^+$ depends on latent valuation $V$, which is never observed—only the binary purchase $Y$ is observed. Understanding this gap is crucial to seeing why standard regression on outcomes doesn't work.
  - **Quick check question:** How does the paper link the unobserved valuation $V$ to the observed purchase decision $Y$? (Answer: via the mechanism $Y = \mathbb{I}(V > P)$, allowing the probability of purchase to stand in for the demand curve).

## Architecture Onboarding

- **Component map:**
  - Historical logs (X_i, P_i, Y_i) -> Nuisance Estimators (Demand Model μ, Policy Model π^D) -> CPW/ACPW Modules -> Consumer Surplus S or Δ with Confidence Intervals

- **Critical path:**
  1. **Overlap Check:** Verify that historical prices cover the support of the target policy (Appendix 10 handles partial identification if this fails).
  2. **Cross-Fitting:** Split data into K folds. Train μ and π^D on K-1 folds, predict on the held-out fold. Repeat.
  3. **CDF Calculation:** For the target policy π, pre-compute the Cumulative Distribution Function F^π(p|x).
  4. **Aggregation:** Apply the ACPW formula (Eq. 16) using the out-of-sample predictions to avoid bias.

- **Design tradeoffs:**
  - **CPW vs. ACPW:** Use CPW if you trust your historical policy data/estimation but distrust your demand model. Use ACPW for robustness against errors in *either* model.
  - **Standard vs. Inequality-Aware (r < 1):** Use Standard (r=1) if you only care about total market efficiency. Use Inequality-Aware (r < 1) if you need to prioritize/protect low-surplus demographics, but be aware you lose double robustness and must rely heavily on a well-specified demand model.

- **Failure signatures:**
  - **Extreme Weights:** If π^D(P|X) ≈ 0 for some observations, variance explodes (Overlap violation).
  - **Negative Surplus:** If the demand model is severely misspecified in the ACPW term, estimates may theoretically violate economic constraints (though the formula generally corrects this).
  - **Bias in Inequality Mode:** If using r < 1, slow convergence of the ML demand model will lead to biased estimates and invalid confidence intervals.

- **First 3 experiments:**
  1. **Validation of Double Robustness:** Run simulations where you intentionally break *one* model (e.g., use a linear model for non-linear demand) and verify that ACPW recovers the true surplus while Direct Method (DM) or CPW fail (Replicate Figure 2/3).
  2. **Overlap Stress Test:** Generate data with a "gap" in historical prices (e.g., never priced between $10-$15) and evaluate the target policy in that range. Compare standard ACPW failure vs. Partial Identification bounds (Appendix 10).
  3. **Real-World Audit (Auto Loans):** Replicate the analysis in Section 8.4. Calculate the trade-off curve: Plot Total Surplus vs. Inequality Index (varying r) for the "Behavior" policy vs. the "Target" AI policy to see if profit maximization hurts vulnerable groups.

## Open Questions the Paper Calls Out

- **Open Question 1:** Can a robust estimator (e.g., doubly or singly robust) be constructed for the inequality-aware surplus of the behavioral policy (S_r(π_D)) that avoids the requirement for simultaneous model consistency?
  - **Basis in paper:** [explicit] Section 7.2 states that the IA-ACPW estimator for the behavioral policy "does not enjoy even single robustness" and highlights the "inherent difficulty of evaluating inequality metrics on the behavioral policy."
  - **Why unresolved:** The nonlinearity of the inequality-aware functional introduces independent quadratic error terms for both nuisance estimators, preventing the error cancellation mechanisms that enable robustness in the standard surplus case.
  - **What evidence would resolve it:** The derivation of an estimator or theoretical bound demonstrating consistency for S_r(π_D) when either the demand model or the propensity model is misspecified.

- **Open Question 2:** How can the CPW framework be adapted to settings with significant income effects or non-quasilinear utility?
  - **Basis in paper:** [explicit] Section 2.1 and Section 3 explicitly state the paper focuses on goods where expenditure is a small fraction of the budget, assuming "income effects are negligible" and utility is quasilinear.
  - **Why unresolved:** The current identification relies on the equivalence between the area under the demand curve and consumer surplus, which does not hold generally when income effects are present.
  - **What evidence would resolve it:** An extension of the identification strategy and efficient influence function derivation that incorporates income-dependent valuations.

- **Open Question 3:** Can the convergence rates for the proposed partial identification bounds be accelerated to match the parametric rates achieved by the ACPW estimator?
  - **Basis in paper:** [explicit] Appendix 10.2 notes that unlike the ACPW estimator, the partial identification bounds rely on the direct method, resulting in slower convergence rates dominated by nuisance estimation error.
  - **Why unresolved:** Without overlap (propensity scores) in the non-experimental regions, the method cannot leverage debiasing techniques to achieve n^{-1/2} convergence.
  - **What evidence would resolve it:** A modified estimation strategy for the bounds that achieves parametric convergence rates without requiring uniform overlap across the entire price space.

## Limitations

- The framework relies on sufficient randomization in historical pricing data; deterministic pricing policies would invalidate the method
- Inequality-aware extensions (r < 1) sacrifice double robustness and require stringent demand model accuracy (convergence rate > n^(-1/4))
- Cross-sectional setting assumes no temporal dynamics; results may not generalize to sequential pricing with inventory constraints
- Confidence intervals rely on asymptotic approximations that may underperform in finite samples with extreme propensity weights

## Confidence

- **High Confidence:** Core CPW estimator mechanism and ACPW double robustness under correct specification
- **Medium Confidence:** Inequality-aware extensions and asymptotic efficiency claims (require careful verification of rate conditions)
- **Medium Confidence:** Empirical results on auto loans (validation depends on data quality and implementation details)

## Next Checks

1. **Double Robustness Verification:** Run controlled simulations where either demand model OR policy model is intentionally misspecified; verify ACPW remains consistent while CPW or DM fail
2. **Overlap Stress Test:** Generate data with price coverage gaps and evaluate target policies in uncovered regions; compare standard bounds vs. partial identification approach
3. **Inequality-Aware Accuracy:** Test IA-ACPW on synthetic data with known surplus distributions across groups; verify that slower-converging demand models produce biased estimates as predicted