---
ver: rpa2
title: 'Cowpox: Towards the Immunity of VLM-based Multi-Agent Systems'
arxiv_id: '2508.09230'
source_url: https://arxiv.org/abs/2508.09230
tags:
- agents
- agent
- cowpox
- virus
- sample
- transformers
- self-attention
- retrieval-augmented-generation
- instruction-tuning
- parameter-efficient-finetuning
- mixture-of-experts
- chain-of-thought
core_contribution: This paper introduces COWPOX, a novel defense mechanism against
  infectious jailbreak attacks in VLM-based multi-agent systems. The core idea is
  to deploy a small number of special "COWPOX agents" that can detect and neutralize
  malicious samples (viruses) by generating cure samples with higher RAG scores, preventing
  the spread of infections.
---

# Cowpox: Towards the Immunity of VLM-based Multi-Agent Systems

## Quick Facts
- arXiv ID: 2508.09230
- Source URL: https://arxiv.org/abs/2508.09230
- Reference count: 37
- With only 3% of agents protected by COWPOX, over 95% of infected agents recover and nearly 90% of agents are prevented from initial infection across various attack scenarios.

## Executive Summary
COWPOX introduces a novel defense mechanism against infectious jailbreak attacks in VLM-based multi-agent systems. The core innovation is deploying a small number of specialized "COWPOX agents" that can detect malicious samples and generate cure samples with higher RAG scores, effectively neutralizing the spread of infections. The defense exploits the RAG retrieval mechanism by ensuring cures score higher than viruses when malicious content is present in the chat history. Theoretical analysis proves that COWPOX can achieve system-wide recovery when cure RAG scores exceed virus RAG scores, and experiments demonstrate effectiveness with minimal deployment overhead.

## Method Summary
COWPOX is a defense mechanism that protects VLM-based multi-agent systems from infectious jailbreak attacks by deploying a small number of specialized COWPOX agents. The system simulates pairwise communication among N=128 agents with κ=4 COWPOX agents (3%), running 64 chat rounds with history length |H|=3 and album size |B|=10. When a COWPOX agent receives a virus sample, its Output Analysis Module detects malicious content, and the Cure Generation Module optimizes either the virus or a benign sample to achieve higher RAG scores than the virus. The optimization uses gradient-based ascent on CLIP-based RAG similarity scores, and cures propagate through the same pairwise communication channels as viruses. The defense maintains system functionality while achieving over 95% recovery rate and preventing initial infection in nearly 90% of cases.

## Key Results
- With only 3% of agents protected by COWPOX, over 95% of infected agents recover from infectious jailbreak attacks
- Nearly 90% of agents are prevented from initial infection across various attack scenarios
- The system maintains normal functionality (measured by GPT-4o score) while providing immunity against adaptive attacks

## Why This Works (Mechanism)

### Mechanism 1
- Claim: Cure samples with higher RAG scores than virus samples can halt infectious spread in VLM-based multi-agent systems.
- Mechanism: The defense exploits the RAG retrieval mechanism. Virus samples are crafted to maximize RAG scores, ensuring preferential retrieval. COWPOX agents generate cure samples optimized to score even higher in RAG retrieval when chat history contains malicious content, causing agents to retrieve the cure instead of the virus.
- Core assumption: The RAG retrieval mechanism follows a ranking-based selection where higher-scoring samples are preferentially retrieved and propagated.
- Evidence anchors:
  - [abstract] "The core idea is to generate and distribute a special cure sample that immunizes an agent against the attack before exposure and helps recover the already infected agents."
  - [section 4.1] "if the RAG process no longer prioritizes the virus sample, the infection probability β will be reduced"
  - [corpus] Weak direct corpus evidence for this specific RAG-competition mechanism; related multi-agent systems (VIKI-R, SAFEFLOW) address coordination and security but not infectious RAG attacks.
- Break condition: If agents use alternative retrieval mechanisms not based on similarity scoring, or if viruses can achieve arbitrarily high RAG scores that cures cannot exceed.

### Mechanism 2
- Claim: Deploying COWPOX agents on only ~3% of the system provides system-wide recovery.
- Mechanism: COWPOX agents participate in normal pairwise communication. Upon receiving a virus, they analyze outputs for malicious content, generate a cure, and propagate it. The cure spreads through the same communication channels as the virus, establishing an immune barrier.
- Core assumption: Multi-agent systems use pairwise communication where agents share samples from their albums, and cure samples propagate through the same mechanism as virus samples.
- Evidence anchors:
  - [section 5.4] "with only 3% of agents protected by COWPOX, over 95% of infected agents recover"
  - [section 4.1] "the cure will also be passed among the uninfected agents like the other benign samples, making them temporarily immune"
  - [corpus] SAFEFLOW addresses trustworthy autonomous agent systems but does not evaluate infectious attacks; no direct corpus validation of the 3% deployment ratio.
- Break condition: If communication topology is highly constrained or centralized, preventing cure propagation to infected regions.

### Mechanism 3
- Claim: System recovery is theoretically guaranteed when cure's expected RAG score exceeds the virus's.
- Mechanism: The transmission dynamics are modeled via differential equations. When ϵ (cure recovery rate) > η (virus re-infection rate of cured agents), the stationary solution converges to zero infected agents. This condition is equivalent to E[R(c, µ′)] > E[R(v, µ′)].
- Core assumption: The infection spread follows a modified SIR-like model with deterministic dynamics, and agents have sufficient chat rounds for convergence.
- Evidence anchors:
  - [section 4.3, Proposition 4.1] "One sufficient condition for COWPOX to be an effective cure is: ϵ ≥ η. That is, lim_{t→∞} r(t) = 0 when ϵ > η holds."
  - [section 5.5, Proposition 5.1] "For any given virus v, we can find a cure c, s.t. R(c, µ′) ≥ R(v, µ′)."
  - [corpus] No corpus papers provide theoretical guarantees for infectious attack recovery in VLM systems.
- Break condition: If chat history length is too short, or if agents exit the system before convergence can occur.

## Foundational Learning

- Concept: Retrieval-Augmented Generation (RAG) for VLM agents
  - Why needed here: The entire attack and defense hinges on RAG scoring. Understanding how agents retrieve samples from memory based on similarity to chat history is essential.
  - Quick check question: Given a chat history containing "malicious content," which sample would a RAG system retrieve: one with high similarity to the history or one with low similarity?

- Concept: Infectious jailbreak attacks on multi-agent systems
  - Why needed here: COWPOX is designed specifically against infectious attacks where a single compromised agent can spread malware to millions via pairwise communication.
  - Quick check question: How does AgentSmith (the infectious attack) differ from a single-agent jailbreak attack?

- Concept: Epidemic modeling (SIR/compartmental models)
  - Why needed here: The paper uses differential equations from epidemiology to model infection spread. Understanding r(t), β, γ, and equilibrium conditions is necessary to interpret theoretical guarantees.
  - Quick check question: In the equation dr/dt = βr(1-r)/2 - γr, what happens to r(t) as t → ∞ when β < 2γ?

## Architecture Onboarding

- Component map:
  1. **COWPOX Agent**: Specialized agent with Output Analysis Module and Cure Generation Module
  2. **Output Analysis Module**: LLM-based inspector that scores responses for malicious content using randomized templates
  3. **Cure Generation Module**: Two strategies—(1) optimize virus sample to forget malicious target, (2) optimize benign sample to achieve higher RAG score than virus
  4. **RAG System**: CLIP-based retrieval that scores and selects samples from agent albums
  5. **VLM Backbone**: Llava-1.5-7B for response generation

- Critical path: Infected agent → communicates with COWPOX agent → Output Analysis detects malicious response → Cure Generation optimizes sample → Cure replaces virus in album → Cure spreads via pairwise communication → Immune barrier forms → System recovers

- Design tradeoffs:
  - Strategy ❶ (virus-based cure) recovers original information but requires optimization on the virus; Strategy ❷ (benign-based cure) preserves functionality but may lose information
  - More COWPOX agents (κ) accelerate recovery but increase deployment cost
  - Longer history length |H| improves cure persistence but increases memory overhead
  - Smaller album size |B| increases self-recovery rate (γ) but causes agents to "forget" cures faster

- Failure signatures:
  1. High false negative rate in Output Analysis (Table 1: 3-12.5% FNR) may delay cure generation
  2. Monotonous conversation topics if COWPOX agents repeatedly select the same cure samples
  3. Adaptive attacks that optimize viruses to exceed cure RAG scores—though constrained by malicious output requirement

- First 3 experiments:
  1. Replicate the baseline infection: Run AgentSmith attack on 128-agent system (no COWPOX), plot r(t) over 64 chat rounds to verify ~100% infection rate.
  2. Test κ=4 COWPOX agents: Deploy 4 COWPOX agents (3%), run same attack, measure current infectious rate and cumulative infectious rate against the values in Table 2.
  3. Verify cure RAG superiority: For a given virus sample, generate cure using Strategy ❶, compute R(c, µ′) and R(v, µ′), confirm R(c, µ′) > R(v, µ′).

## Open Questions the Paper Calls Out

### Open Question 1
- Question: Can COWPOX be adapted to defend multi-agent systems with non-pairwise communication topologies or significantly different operational procedures?
- Basis in paper: [explicit] The authors state that the discussion is "limited to a single experimental environment" and that in systems with different operational procedures, "both the attack strategies and the implementation of COWPOX would require modification."
- Why unresolved: The current validation relies entirely on the randomized pairwise communication model used in the AgentSmith framework, leaving the efficacy of the "cure" spreading mechanism in hierarchical, broadcast, or scale-free network topologies unknown.
- What evidence would resolve it: Empirical results demonstrating COWPOX's effectiveness in multi-agent systems with distinct architectures, such as centralized coordination or star topologies.

### Open Question 2
- Question: How can the system prevent the "monotonous conversation topics" caused by the dominance of cure samples in the RAG retrieval process?
- Basis in paper: [explicit] The authors identify that COWPOX agents tend to select specific cure samples due to their high RAG scores, which "may result in monotonous conversation topics."
- Why unresolved: The high retrieval score required for the cure to outcompete the virus inherently suppresses other benign samples, creating a trade-off between system immunity and conversational diversity that temporary RAG disabling only partially addresses.
- What evidence would resolve it: A mechanism that maintains immunity while ensuring semantic diversity metrics (e.g., distinct topics per round) remain comparable to a non-infected baseline.

### Open Question 3
- Question: Is it possible to fully recover the semantic information of a benign sample that was compromised to create the virus, without retaining the malicious payload?
- Basis in paper: [explicit] The paper notes a limitation where the cure sample "cannot fully recover the information lost during the curing process."
- Why unresolved: Strategy 1 attempts to optimize the virus to "forget" the malicious target, but the authors note this optimization does not guarantee the restoration of the original benign content, often resulting in lower BLEU/CLIP scores compared to the original.
- What evidence would resolve it: A generation method that produces a cure sample yielding high semantic similarity scores (BLEU/CLIP) relative to the original benign image while strictly failing the malicious output check.

## Limitations
- RAG Score Competition Assumption: The defense fundamentally relies on cure samples consistently achieving higher RAG scores than virus samples, which may not hold for all malicious content types
- Adaptive Attack Vulnerability: The paper claims effectiveness against adaptive attacks but provides limited empirical validation of this claim
- System Size Dependence: The 3% deployment ratio was tested on 128-agent systems; scalability to larger systems remains unproven

## Confidence
- **High Confidence**: The theoretical framework using epidemic modeling is sound, and the mechanism of RAG-based sample prioritization is well-established
- **Medium Confidence**: The empirical results showing >95% recovery with 3% COWPOX agents are promising but limited to specific attack scenarios and system sizes
- **Low Confidence**: The scalability claims and performance in real-world deployment scenarios remain speculative

## Next Checks
1. **Scalability Test**: Reproduce the experiment with system sizes of 512, 1024, and 2048 agents to verify the 3% deployment ratio remains effective as system scale increases
2. **Adaptive Attack Stress Test**: Design an adaptive attack strategy that specifically targets the cure generation mechanism by optimizing for both malicious content and high RAG scores, then measure COWPOX effectiveness
3. **Real-World Network Topology Test**: Implement the defense in a multi-agent system with realistic communication constraints (sparse connectivity, hierarchical structures) rather than the assumed pairwise uniform communication model