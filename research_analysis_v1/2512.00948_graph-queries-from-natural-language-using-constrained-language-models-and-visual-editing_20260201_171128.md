# Graph Queries from Natural Language using Constrained Language Models and Visual Editing

*Benedikt Kantz; Kevin Innerebner; Peter Waldert; Stefan Lengauer; Elisabeth Lex; Tobias Schreck*

---

## ðŸ“Š Quick Facts

| Metric | Details |
| :--- | :--- |
| **Quality Score** | 8/10 |
| **Datasets Used** | DBpedia, Yago, BTO, UniProt |
| **Complexity Levels** | $k \in \{2, 3, 5, 7\}$ |
| **Node Retrieval F1** | ~0.7 |
| **Relation Retrieval F1** | ~0.8 |
| **References** | 36 Citations |

---

## Executive Summary

Knowledge Graphs (KGs) are fundamental repositories of structured data, yet their utility is often constrained by the technical difficulty of SPARQL, the standard query language. Domain experts frequently lack the programming expertise required to formulate valid queries, creating a significant accessibility barrier. Furthermore, existing Natural Language-to-SPARQL systems are prone to "hallucinations"â€”generating non-existent classes or relationshipsâ€”and syntax errors, rendering them unreliable for practical use. This paper addresses the critical need for a querying framework that empowers non-technical users to retrieve complex graph data accurately without requiring deep knowledge of ontologies or programming syntax.

The authors present a hybrid system that integrates natural language input with a user-driven visual interface. The core technological innovation is a **Two-Step Constrained Generation** process. This workflow translates natural language into an intermediate "prototype graph" and then maps it to the specific ontology using Ontology-Driven Constraints. By strictly bounding the language model's output to valid syntax and verified schema elements, this mechanism effectively eliminates hallucinations and syntax errors, ensuring that only existing classes and relationships are generated. The process culminates in a **Visual Refinement** stage, which allows users to interactively edit the graph structure to bridge the gap between intuitive language input and precise logical requirements.

The system was rigorously evaluated across four diverse datasetsâ€”DBpedia, Yago, BTO, and UniProtâ€”testing structural complexity levels ranging from $k=2$ to $k=7$. The system achieved a mean Node Retrieval $F_1$ score of approximately 0.7 and a Relation Retrieval $F_1$ score of roughly 0.8. Graph Edit Distance (GED) metrics confirmed strong structural recovery for small to medium complexity queries ($k=2, 3, 5$), with a performance decrease at the highest complexity ($k=7$). These technical results were further validated by a preliminary user study, which confirmed the system's efficacy for non-expert users. Additionally, ablation studies demonstrated that the constrained pipeline significantly outperforms raw language model generation and matches human-quality query construction at medium complexity levels.

This research represents a significant step toward democratizing access to semantic data by demonstrating that high-fidelity graph querying does not require massive Large Language Models (LLMs). The authors prove that by leveraging constrained decoding and visual feedback, smaller, more efficient models can perform with high accuracy while avoiding common generative AI failures.

---

## Key Findings

*   **Robust Query Generation:** The system consistently generates valid SPARQL queries on the first attempt, eliminating syntax errors and hallucinated classes or links.
*   **Accessibility for Non-Experts:** The approach empowers users without prior knowledge of ontologies or query languages to formulate complex knowledge graph queries.
*   **Model Efficiency:** By utilizing a constrained generation pipeline, the system achieves efficient and accurate graph retrieval using smaller, more efficient models.
*   **Effective Validation:** Performance was confirmed through graph retrieval experiments on synthetic queries and a preliminary user study.

---

## Methodology

The proposed system utilizes a multi-stage workflow designed to bridge the gap between natural language and formal graph queries:

1.  **Hybrid Input Mechanism**
    The system accepts both natural language text and user-driven visual edits. These inputs work together to define prototype graphs, which serve as intermediate representations of the user's intent.

2.  **Two-Step Constrained Generation**
    The system employs a constrained generation process that converts natural language into graph structures. It utilizes semantically similar features within the ontology to guide the translation, ensuring the output aligns with the underlying data schema.

3.  **Ontology-Driven Constraints**
    To ensure validity, the generation process is strictly bounded. The output is forced to use only valid syntax, classes, and links defined in the ontology, effectively preventing the model from generating invalid or non-existent elements.

4.  **Visual Refinement**
    Before execution, users can manually refine the query structure. A dedicated visual query builder allows for the correction or adjustment of the graph structure based on visual feedback.

---

## Contributions

*   **A Novel Interactive Interface:** Introduction of a user-centric querying system bridging natural language input and visual query construction for Knowledge Graphs.
*   **A Constrained Generation Framework:** Development of a pipeline that enforces ontology constraints during the language model generation phase to prevent invalid code issues.
*   **Resource-Efficient Solution:** Demonstration that high-performance graph retrieval does not strictly require the largest or most computationally expensive language models when semantic constraints are effectively applied.

---

## Technical Details

*   **Constrained Generation Pipeline:** The system likely utilizes Grammar-Based Normalization Form (**GBNF**) to ensure valid SPARQL output and reduce hallucinations.
*   **Workflow Alignment:** The workflow processes natural language into a prototype graph and aligns it with specific ontology schemas via a constraint step.
*   **Visual Feedback:** The system includes mechanisms for visual feedback and refinement, enabling users to correct logical misalignments.
*   **Evaluation Pipeline:** A synthetic graph generation pipeline is utilized to automate evaluation across varying complexities ($k=2$ to $k=7$).
*   **Model Independence:** Demonstrated that the constrained approach allows for model size independence, validated by the ability of smaller models to perform effectively.

---

## Results

The system was evaluated on four distinct datasets (DBpedia, Yago, BTO, UniProt) across varying complexity levels:

*   **Retrieval Scores:**
    *   **Node Retrieval:** Mean $F_1$ score of approximately **0.7**.
    *   **Relation Retrieval:** Mean $F_1$ score of approximately **0.8**.
*   **Structural Recovery (Graph Edit Distance):**
    *   **Strong performance** observed for smaller graphs ($k=2, 3, 5$).
    *   **Performance drop** noted at the highest complexity level ($k=7$).
*   **Ablation Studies:**
    *   Aligned output (constrained) significantly outperformed raw LM output.
    *   Query generation quality matched human performance at complexity levels $k=\{3, 5\}$.

---

**References:** 36 citations