---
ver: rpa2
title: Guiding the generation of counterfactual explanations through temporal background
  knowledge for Predictive Process Monitoring
arxiv_id: '2403.11642'
source_url: https://arxiv.org/abs/2403.11642
tags:
- counterfactual
- process
- counterfactuals
- fitness
- trace
- transformers
- self-attention
- retrieval-augmented-generation
- instruction-tuning
- parameter-efficient-finetuning
- mixture-of-experts
- chain-of-thought
core_contribution: This paper addresses the challenge of generating counterfactual
  explanations for Predictive Process Monitoring (PPM) that respect temporal constraints
  in business processes. The authors adapt genetic algorithm (GA)-based methods to
  incorporate Declare constraints as temporal background knowledge, ensuring generated
  counterfactuals do not violate process control flow relationships.
---

# Guiding the generation of counterfactual explanations through temporal background knowledge for Predictive Process Monitoring

## Quick Facts
- arXiv ID: 2403.11642
- Source URL: https://arxiv.org/abs/2403.11642
- Reference count: 40
- Key outcome: AOMO method achieves best performance incorporating temporal constraints into counterfactual generation for PPM

## Executive Summary
This paper addresses the challenge of generating counterfactual explanations for Predictive Process Monitoring (PPM) that respect temporal constraints in business processes. The authors adapt genetic algorithm (GA)-based methods to incorporate Declare constraints as temporal background knowledge, ensuring generated counterfactuals do not violate process control flow relationships. They propose adaptations to both single and multi-objective fitness functions and introduce novel crossover and mutation operators that preserve constraint satisfaction. Evaluation on five real-life datasets shows their adapted methods outperform baseline approaches in terms of trace fitness, distance to original instances, and plausibility, while maintaining comparable diversity and sparsity.

## Method Summary
The authors adapt genetic algorithms for counterfactual generation by incorporating Declare constraints as temporal background knowledge. They modify the fitness function to include an objective measuring trace fitness (conformance to temporal constraints) and develop novel crossover and mutation operators that preserve satisfied constraints from the original query. The approach supports both single-objective (AOSO) and multi-objective (AOMO) formulations, with the latter optimizing validity, distance, sparsity, implausibility, and trace fitness simultaneously. The methods are evaluated against baseline approaches on five real-life event logs, demonstrating improved trace fitness and plausibility while maintaining traditional counterfactual quality metrics.

## Key Results
- AOMO method achieves best overall performance across all evaluation metrics
- Adapted methods show significant improvements in trace fitness (15-28% better than baselines)
- Generated counterfactuals maintain comparable distance, diversity, and sparsity to original instances
- Temporal constraint satisfaction does not compromise predictive validity of counterfactuals

## Why This Works (Mechanism)

### Mechanism 1
- Claim: Incorporating Declare constraints as temporal background knowledge into GA-based counterfactual generation improves trace fitness without sacrificing traditional quality metrics
- Mechanism: The adapted crossover and mutation operators preserve satisfied Declare constraints from the original query instance while allowing controlled modifications to other features, ensuring generated counterfactuals respect temporal relationships
- Core assumption: Temporal constraints (Declare constraints) can be discovered from event logs and effectively encoded as background knowledge for the GA optimization
- Evidence anchors:
  - [abstract]: "They propose adaptations to both single and multi-objective fitness functions and introduce novel crossover and mutation operators that preserve constraint satisfaction"
  - [section 5.2.3]: "The idea behind the adapted crossover and mutation operators is generating offspring individuals that preserve the satisfaction of the Declare constraints of the original query"
  - [corpus]: Weak - corpus contains papers on counterfactual explanations but none specifically addressing temporal constraints in process mining context
- Break condition: If discovered Declare constraints don't accurately represent true temporal dependencies in the process, or if constraint satisfaction conflicts with achieving counterfactual validity

### Mechanism 2
- Claim: Multi-objective formulation outperforms single-objective in balancing trade-offs between counterfactual quality dimensions
- Mechanism: The multi-objective fitness function simultaneously optimizes validity, distance, sparsity, implausibility, and trace fitness without requiring explicit weighting, allowing the Pareto front to reveal optimal trade-offs
- Core assumption: The different counterfactual quality dimensions can be meaningfully optimized simultaneously rather than collapsed into a weighted single objective
- Evidence anchors:
  - [abstract]: "The AOMO method achieves the best overall performance, demonstrating the effectiveness of incorporating temporal background knowledge in counterfactual generation for PPM"
  - [section 5.2.2]: "A natural solution to the complex problem of balancing the different objectives posed in the previous single-objective problem is moving to a multi-objective problem"
  - [corpus]: Weak - corpus contains multi-objective counterfactual generation papers but none specifically in PPM context
- Break condition: If the different objectives conflict too severely, making it impossible to find solutions that satisfy all quality dimensions simultaneously

### Mechanism 3
- Claim: Adapted fitness function with temporal constraint satisfaction objective (o5) directly improves counterfactual plausibility within process context
- Mechanism: Objective o5 measures trace fitness using Declare constraint satisfaction, creating a direct optimization pressure toward counterfactuals that respect process temporal logic
- Core assumption: Trace fitness as measured by Declare constraint satisfaction correlates with counterfactual plausibility in business process contexts
- Evidence anchors:
  - [abstract]: "We showcase that the inclusion of temporal background knowledge allows the generation of counterfactuals more conformant to the temporal background knowledge"
  - [section 5.2.2]: "To measure this aspect, this objective leverages the trace fitness metrics defined in Section 3.2, which measures the number of satisfied temporal constraints present in the Declare model MDecl"
  - [corpus]: Weak - corpus contains papers on counterfactual explanations but none specifically addressing trace fitness measurement
- Break condition: If trace fitness optimization leads to counterfactuals that are too constrained and fail to achieve validity (flipping the prediction)

## Foundational Learning

- Concept: Declare constraint language and trace fitness computation
  - Why needed here: The entire approach relies on representing temporal background knowledge as Declare constraints and measuring how well counterfactuals conform to these constraints
  - Quick check question: Given a trace ⟨a, b, c, a, b⟩ and Declare constraints {ChainResponse(a,b), existence(1,c)}, what is the trace fitness score?

- Concept: Genetic algorithm operators (crossover and mutation) and their adaptation
  - Why needed here: The novel adapted operators are central to the approach's ability to preserve temporal constraints while generating diverse counterfactuals
  - Quick check question: How does the adapted crossover operator ensure that constraint activations from the original query are preserved in offspring individuals?

- Concept: Multi-objective optimization and Pareto fronts
  - Why needed here: The AOMO method uses multi-objective optimization to balance multiple counterfactual quality dimensions without requiring weight parameters
  - Quick check question: What is the advantage of returning a Pareto front of solutions rather than a single weighted-optimal solution in the counterfactual generation context?

## Architecture Onboarding

- Component map:
  Event log preprocessing -> Declare constraint discovery -> GA initialization -> Fitness evaluation (o1-o5) -> Adapted crossover/mutation -> Pareto optimization -> Counterfactual selection

- Critical path:
  1. Load event log and preprocess traces
  2. Discover Declare constraints from training data
  3. Initialize GA population with hybrid approach (training data points + random sampling)
  4. Evaluate fitness using adapted single/multi-objective function
  5. Apply adapted crossover and mutation operators
  6. Select next generation based on fitness (single-objective) or Pareto dominance (multi-objective)
  7. Repeat until convergence criteria met
  8. Return top counterfactuals from final population

- Design tradeoffs:
  - Single vs multi-objective: Single-objective offers faster convergence but requires weight tuning; multi-objective provides better trade-off exploration but is computationally heavier
  - Constraint strictness: Tighter constraint satisfaction improves temporal validity but may reduce counterfactual diversity and increase runtime
  - Population size vs generations: Larger populations explore more solutions but increase per-generation computation time

- Failure signatures:
  - Trace fitness remains low despite adaptation -> Constraint discovery may be flawed or constraints too strict
  - Runtime increases dramatically -> Check constraint checking implementation efficiency or consider constraint relaxation
  - Generated counterfactuals are too similar to original -> Mutation rate may be too low or constraint preservation too restrictive
  - Counterfactuals fail to flip prediction -> Validity objective (o1) may be conflicting with constraint satisfaction

- First 3 experiments:
  1. Run AOSO and BOSO on a small, well-understood event log (e.g., Sepsis with known constraints) and verify trace fitness improvement with adaptation
  2. Compare single vs multi-objective versions on BPIC2012 with prefix length 20 to observe trade-off differences
  3. Test adapted operators in isolation by running GA with only the original query and parents to verify constraint preservation behavior

## Open Questions the Paper Calls Out

### Open Question 1
- Question: How can the proposed framework be extended to handle data-aware variants of Declare constraints that include other attributes together with the control-flow constraints?
- Basis in paper: [explicit] The authors mention extending the framework to include data-aware variants of Declare constraints as future work.
- Why unresolved: The paper focuses on temporal background knowledge in the form of Declare constraints without considering other attributes that may influence the constraints.
- What evidence would resolve it: Developing and evaluating a modified version of the framework that incorporates data-aware variants of Declare constraints and comparing its performance with the current approach on real-life datasets.

### Open Question 2
- Question: What are the trade-offs between the single-objective and multi-objective formulations of the counterfactual generation problem in terms of runtime and quality of generated counterfactuals?
- Basis in paper: [explicit] The authors compare the single-objective and multi-objective formulations and observe differences in performance, but the trade-offs are not fully explored.
- Why unresolved: The paper provides initial insights into the differences between the two formulations but does not provide a comprehensive analysis of the trade-offs.
- What evidence would resolve it: Conducting an extensive evaluation of the single-objective and multi-objective formulations on various datasets and analyzing the trade-offs in terms of runtime, quality of generated counterfactuals, and other relevant metrics.

### Open Question 3
- Question: How can the proposed framework be integrated with gradient-based optimization techniques for counterfactual generation?
- Basis in paper: [explicit] The authors mention integrating temporal background knowledge with gradient-based optimization techniques as future work.
- Why unresolved: The paper focuses on genetic algorithms for counterfactual generation and does not explore the integration with gradient-based techniques.
- What evidence would resolve it: Developing and evaluating a hybrid approach that combines the strengths of genetic algorithms and gradient-based optimization techniques for counterfactual generation, and comparing its performance with the current approach on real-life datasets.

## Limitations
- Evaluation relies on artificial event logs with synthetically introduced Declare constraints
- Methods require careful tuning of genetic algorithm parameters with potential sensitivity to settings
- Trace fitness metric may not capture all aspects of process conformance

## Confidence
- High confidence: General approach of incorporating temporal background knowledge into counterfactual generation
- Medium confidence: Specific implementation details of the adapted genetic operators
- Low confidence: Generalizability to processes with highly complex temporal patterns beyond Declare constraint language scope

## Next Checks
1. Validate the approach on a real-world event log with known temporal dependencies to assess performance on more complex constraints
2. Conduct ablation studies removing the adapted crossover/mutation operators to quantify their specific contribution to performance gains
3. Test the sensitivity of the methods to different population sizes and generation counts to establish robustness across parameter settings