---
ver: rpa2
title: Probabilistic Routing for Graph-Based Approximate Nearest Neighbor Search
arxiv_id: '2402.11354'
source_url: https://arxiv.org/abs/2402.11354
tags: []
core_contribution: This paper studies probabilistic routing in graph-based approximate
  nearest neighbor search (ANNS). The authors address the challenge of efficiently
  identifying which neighbors in a proximity graph should be considered for exact
  distance computation during the search phase.
---

# Probabilistic Routing for Graph-Based Approximate Nearest Neighbor Search

## Quick Facts
- arXiv ID: 2402.11354
- Source URL: https://arxiv.org/abs/2402.11354
- Reference count: 40
- Queries per second increased by 1.6 to 2.5 times compared to vanilla HNSW

## Executive Summary
This paper introduces Partitioned Extreme Order Statistics (PEOs), a novel probabilistic routing technique for graph-based approximate nearest neighbor search. The method addresses the computational bottleneck of exact distance calculations during search by using extreme order statistics and space partitioning to estimate distances between neighbors and query vectors. PEOs provides theoretical guarantees that promising neighbors are explored with high probability while significantly reducing the number of exact distance computations required, achieving substantial performance improvements over existing approaches.

## Method Summary
PEOs leverages random projections and space partitioning to estimate distances without computing exact values. The method partitions data space using random projections, then uses extreme order statistics from these partitions to estimate distances between neighbors and query vectors. This probabilistic approach provides theoretical guarantees about routing decisions while dramatically reducing exact distance computations. The algorithm integrates with HNSW graph indices and uses a quantile lookup table for efficient probability calculations. PEOs trades off some additional space for significant computational speedups during the search phase.

## Key Results
- QPS improved by 1.6 to 2.5 times when equipping HNSW with PEOs routing
- Outperformed state-of-the-art routing techniques by 1.1 to 1.4 times
- Reduced space requirements compared to competing routing methods
- Validated across six million-scale datasets with varying dimensions and metrics

## Why This Works (Mechanism)
PEOs works by exploiting the statistical properties of random projections and extreme order statistics. When data is partitioned using random projections, the extreme values within each partition provide information about the relative distances between points. By analyzing the distribution of these extreme values, PEOs can estimate the probability that a given neighbor is close to the query without computing the exact distance. This probabilistic approach allows the algorithm to make informed routing decisions while avoiding expensive distance calculations, with theoretical guarantees on the probability of correctly identifying promising neighbors.

## Foundational Learning

**Random Projections**: Technique for dimensionality reduction that preserves distances between points. Needed because direct distance estimation in high dimensions is computationally expensive. Quick check: Verify Johnson-Lindenstrauss lemma guarantees hold for chosen projection parameters.

**Extreme Order Statistics**: Statistical analysis of maximum/minimum values from samples. Needed to estimate tail probabilities without computing full distributions. Quick check: Confirm extreme value distributions follow expected Gumbel/Fréchet forms on test data.

**Space Partitioning**: Division of high-dimensional space into regions using hyperplane cuts. Needed to create manageable subsets for statistical analysis. Quick check: Measure balance of partition sizes across different random projection seeds.

**Quantile Functions**: Inverse cumulative distribution functions for probability calculations. Needed to efficiently compute routing probabilities. Quick check: Validate F^-1_e,ϵ(·) implementations against numerical integration on synthetic data.

**Probabilistic Routing**: Making neighbor selection decisions based on estimated probabilities rather than exact distances. Needed to reduce computational overhead while maintaining search quality. Quick check: Verify recall degradation remains within acceptable bounds as routing probability threshold varies.

## Architecture Onboarding

**Component Map**: Query vector → Random projections → Space partitions → Extreme value sampling → Quantile table lookup → Routing decision → Neighbor exploration

**Critical Path**: Search initialization → Neighbor candidate generation → PEOs routing estimation → Exact distance computation for selected neighbors → Local graph traversal → Result aggregation

**Design Tradeoffs**: PEOs trades increased memory usage (for storing random projections and quantile tables) against reduced computational cost during search. The method requires careful tuning of partition parameters and permutation counts to balance accuracy with efficiency.

**Failure Signatures**: Poor performance occurs when: L parameter not properly tuned to dataset dimension, quantile tables incorrectly constructed, or edge weight normalization improperly implemented. These manifest as either excessive exact distance computations or reduced recall.

**First Experiments**:
1. Implement basic PEOs routing on synthetic Gaussian data to verify extreme value distribution properties
2. Benchmark PEOs against exact HNSW search on GloVe200 with varying L parameters
3. Measure memory overhead of quantile tables versus computational savings across different dataset dimensions

## Open Questions the Paper Calls Out
None

## Limitations
- Implementation details for dimension permutation optimization remain underspecified
- Exact quantile table construction method for F^-1_e,ϵ(·) function is not fully described
- Hyperparameter sensitivity across different dataset characteristics not thoroughly explored

## Confidence

**High Confidence**: The theoretical framework of using extreme order statistics for routing decisions is mathematically rigorous and well-explained.

**Medium Confidence**: Experimental results showing QPS improvements are plausible given the methodology, though exact replication depends on unspecified implementation details.

**Low Confidence**: Claims about memory efficiency improvements relative to state-of-the-art routing techniques require careful examination of baseline implementations.

## Next Checks

1. Implement and benchmark the exact quantile table construction method using synthetic data to verify the F^-1_e,ϵ(·) function implementation
2. Conduct ablation studies varying the L parameter (number of permutations) to determine optimal settings for different dataset dimensions
3. Compare PEOs performance against CRouting on identical hardware configurations to validate claimed QPS improvements in a controlled setting