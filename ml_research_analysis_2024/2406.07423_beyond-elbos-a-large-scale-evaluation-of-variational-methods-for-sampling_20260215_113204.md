---
ver: rpa2
title: 'Beyond ELBOs: A Large-Scale Evaluation of Variational Methods for Sampling'
arxiv_id: '2406.07423'
source_url: https://arxiv.org/abs/2406.07423
tags:
- methods
- sampling
- elbo
- target
- variational
- transformers
- self-attention
- retrieval-augmented-generation
- instruction-tuning
- parameter-efficient-finetuning
- mixture-of-experts
- chain-of-thought
core_contribution: This paper benchmarks variational sampling methods using a standardized
  suite of tasks and diverse performance metrics. The authors explore density-ratio
  based criteria, integral probability metrics, and introduce entropic mode coverage
  to quantify mode collapse.
---

# Beyond ELBOs: A Large-Scale Evaluation of Variational Methods for Sampling

## Quick Facts
- arXiv ID: 2406.07423
- Source URL: https://arxiv.org/abs/2406.07423
- Reference count: 40
- No single variational sampling method dominates across all scenarios; performance depends on task structure and dimensionality.

## Executive Summary
This paper provides a comprehensive benchmark of variational sampling methods using a standardized suite of tasks and diverse performance metrics. The authors evaluate methods including sequential Monte Carlo, flow transport, and diffusion-based samplers across synthetic and real target densities. Key findings include that GMMVI and FAB methods perform well on ELBO but suffer from mode collapse in high dimensions, while diffusion-based methods like MCD and LDVI are more robust to mode collapse but often yield worse ELBO values. The paper introduces entropic mode coverage as a novel metric to quantify mode collapse and provides insights into the trade-offs between exploration and exploitation when setting the support of the proposal distribution.

## Method Summary
The paper benchmarks 11 variational sampling methods across 11 target densities using 9 performance metrics. Methods are categorized into tractable density models (MFVI, GMMVI, NFVI), sequential importance sampling (SMC, AFT, CRAFT, FAB), and diffusion-based methods (MCD, LDVI, PIS, DIS, DDS, GBS). Targets include Bayesian logistic regression, random effect regression, time series models, spatial statistics, and synthetic distributions like Funnel, MoG, MoS, Digits, and Fashion MNIST. The evaluation protocol uses 2000 samples, 40k gradient steps, batch size of 2000, and multiple random seeds. Hyperparameters are tuned via grid search, with specific details varying by method (e.g., 128 discretization steps for diffusion methods, 128 annealing steps for SMC).

## Key Results
- No single method dominates across all scenarios; performance depends on task structure and dimensionality.
- GMMVI and FAB methods achieve good ELBO values but suffer from mode collapse in high dimensions.
- Diffusion-based methods like MCD and LDVI are more robust to mode collapse but often yield worse ELBO values.
- Setting the support of the proposal distribution involves an exploration-exploitation trade-off affecting mode coverage and ELBO quality.

## Why This Works (Mechanism)

### Mechanism 1
- Claim: No single variational sampling method dominates across all scenarios; performance depends on the task structure and dimensionality.
- Mechanism: Different sampling methods optimize different trade-offs between exploration (coverage of modes) and exploitation (local accuracy). Methods like GMMVI and FAB maximize ELBO by focusing on regions with high probability mass, which can lead to mode collapse in high dimensions. Diffusion-based methods like MCD and LDVI use stochastic processes that explore more broadly but may sacrifice ELBO tightness.
- Core assumption: The target distribution's geometry (e.g., number of modes, dimensionality, separation between modes) determines which method's exploration-exploitation balance is optimal.
- Evidence anchors:
  - [abstract] "Key findings include that no single method dominates across all scenarios, GMMVI and FAB perform well on ELBO but suffer from mode collapse in high dimensions, while diffusion-based methods like MCD and LDVI are more robust to mode collapse but often yield worse ELBO values."
  - [section] "O6) No single method exhibits superiority across all situations. Generally, GMMVI and FAB demonstrate good ELBO values across a diverse set of tasks, although both tend to suffer from mode collapse in high dimensions. In contrast, diffusion-based methods such as MCD and LDVI exhibit resilience against mode collapse but frequently fall short of achieving satisfactory ELBO values."
  - [corpus] Weak—no explicit mechanism description found.
- Break condition: If the target distribution is unimodal or has well-separated modes with known structure, a single method (e.g., FAB with tuned proposal support) may dominate.

### Mechanism 2
- Claim: Mode collapse severity increases with dimensionality for methods that rely on mode-seeking objectives like reverse KL.
- Mechanism: In high dimensions, the volume of space grows exponentially, making it harder for mode-seeking methods to cover all modes. The reverse KL divergence encourages the model to focus on high-density regions, which in high dimensions often means collapsing to a subset of modes.
- Core assumption: The curse of dimensionality affects the ability of mode-seeking variational methods to explore the full support of the target.
- Evidence anchors:
  - [abstract] "GMMVI and FAB perform well on ELBO but suffer from mode collapse in high dimensions, while diffusion-based methods like MCD and LDVI are more robust to mode collapse."
  - [section] "O1) Mode collapse gets worse in high dimensions. We observe that several methods, that do not suffer from mode collapse in low-dimensional problems encounter significant mode collapse when applied to higher-dimensional ones."
  - [corpus] Weak—no explicit geometric argument provided.
- Break condition: If the target has only one mode or if the modes are extremely well-separated and identifiable, mode collapse may not be an issue even in high dimensions.

### Mechanism 3
- Claim: The choice of proposal distribution support in variational Monte Carlo methods involves an exploration-exploitation trade-off that directly affects mode coverage and ELBO quality.
- Mechanism: A small initial support of the proposal distribution leads to tight ELBO bounds but risks missing modes (exploitation). A large initial support improves mode coverage (exploration) but introduces looseness in the ELBO bound due to the additional slack from the extended distribution.
- Core assumption: The support of the initial proposal distribution can be controlled and directly influences both the ELBO bound and the ability to avoid mode collapse.
- Evidence anchors:
  - [abstract] "The paper also provides insights into the trade-offs between exploration and exploitation when setting the support of the proposal distribution."
  - [section] "M2) There exists an exploration-exploitation trade-off when setting the support of the proposal distribution π0 in Variational Monte Carlo (cf. Ablation F.4). Opting for a small initial support of π0 results in tight ELBO values but can limit coverage to only a few modes. Conversely, employing a sufficiently large initial support helps prevent mode collapse but introduces additional looseness in the ELBO."
  - [corpus] Weak—no explicit mathematical formulation of the trade-off.
- Break condition: If the target distribution's support is known and compact, the trade-off may be less critical.

## Foundational Learning

- Concept: Variational Inference (VI) and the Evidence Lower Bound (ELBO).
  - Why needed here: The paper evaluates many variational sampling methods that optimize or use the ELBO as a performance metric.
  - Quick check question: What is the relationship between the ELBO and the reverse KL divergence, and why is the ELBO a lower bound on the log evidence?

- Concept: Mode collapse in variational inference.
  - Why needed here: Several methods suffer from mode collapse in high dimensions, and the paper introduces metrics to quantify it.
  - Quick check question: Why does minimizing the reverse KL divergence lead to mode-seeking behavior, and how does this cause mode collapse in multimodal distributions?

- Concept: Integral Probability Metrics (IPMs) such as MMD and Wasserstein distance.
  - Why needed here: These metrics are used to evaluate sample quality beyond the model's support and are less sensitive to mode collapse.
  - Quick check question: How do IPMs differ from density-based metrics like the ELBO in terms of what aspects of the distribution they measure?

## Architecture Onboarding

- Component map:
  Benchmark framework -> 11 target densities -> 11 sampling methods -> 9 performance metrics -> Results aggregation
  Sampling methods: Tractable density models -> Sequential importance sampling -> Diffusion-based methods
  Performance metrics: Density-ratio based -> IPMs -> Entropic mode coverage

- Critical path:
  1. Define target distributions (synthetic and real-world)
  2. Implement sampling methods with consistent API
  3. Compute performance metrics for each method on each target
  4. Aggregate results across multiple random seeds
  5. Analyze trade-offs and failure modes

- Design tradeoffs:
  - Tractable density models: Fast but limited expressiveness; suffer from mode collapse in high dimensions
  - Sequential importance sampling: Flexible but computationally expensive; resampling can cause mode collapse
  - Diffusion-based methods: Robust to mode collapse but often have worse ELBO; require many function evaluations
  - Metrics: ELBO is sensitive to mode collapse; EUBO and IPMs are more robust but may be harder to compute or interpret

- Failure signatures:
  - High-dimensional mode collapse: EMC ≈ 0, ELBO good, EUBO high
  - Poor exploration: Low ESS (forward or reverse), high W2 or MMD
  - Numerical instability: NaNs or infinities in ELBO/EUBO, especially for diffusion methods with large step sizes
  - Memory issues: Out-of-memory errors for large batch sizes or many particles

- First 3 experiments:
  1. Run MFVI and GMMVI on the Funnel target to observe mode-seeking behavior and mode collapse
  2. Compare SMC with and without resampling on a high-dimensional MoG to see the effect on mode collapse and ELBO
  3. Test MCD and LDVI on the MoS target with d=200 to observe robustness to mode collapse and ELBO degradation

## Open Questions the Paper Calls Out

### Open Question 1
- Question: How does the choice of kernel in MMD or the cost function in W2 affect the evaluation of mode collapse severity?
- Basis in paper: [explicit] The paper mentions that both MMD and W2 are influenced by subjective design choices like kernel selection and cost function determination, potentially leading to biased evaluation protocols.
- Why unresolved: The paper acknowledges this limitation but doesn't provide concrete guidance on how to select these parameters to ensure fair and consistent evaluation across different methods.
- What evidence would resolve it: Systematic experiments comparing the performance of different kernels/cost functions on a diverse set of target distributions, demonstrating their impact on the evaluation of mode collapse severity.

### Open Question 2
- Question: What are the trade-offs between exploration and exploitation when setting the support of the proposal distribution π0 in variational Monte Carlo methods?
- Basis in paper: [explicit] The paper discusses that opting for a small initial support of π0 results in tight ELBO values but can limit coverage to only a few modes, while employing a sufficiently large initial support helps prevent mode collapse but introduces additional looseness in the ELBO.
- Why unresolved: The paper highlights this trade-off but doesn't provide a clear framework or guidelines for practitioners to determine the optimal balance between exploration and exploitation in different scenarios.
- What evidence would resolve it: A comprehensive study analyzing the performance of various methods with different initial supports of π0 on a wide range of target distributions, providing insights into the optimal balance for different problem characteristics.

### Open Question 3
- Question: How can we design evaluation metrics that are sensitive to mode collapse and less affected by the mode-seeking nature of the reverse KL divergence?
- Basis in paper: [explicit] The paper introduces entropic mode coverage (EMC) as a novel metric to quantify mode collapse and discusses the limitations of existing metrics like ELBO and reverse log Z estimates, which are influenced by the mode-seeking behavior of the reverse KL.
- Why unresolved: While EMC provides a promising approach, the paper acknowledges its limitations, such as the need for prior knowledge about the target distribution and the assumption of equally probable mode descriptors. The paper doesn't propose a comprehensive solution to address these limitations.
- What evidence would resolve it: Development and evaluation of new metrics that overcome the limitations of EMC, such as handling unbalanced mode probabilities or not requiring prior knowledge about the target distribution, through extensive experiments on diverse target distributions.

## Limitations

- Reproducibility concerns due to unspecified network architectures and hyperparameters for several methods.
- Some target densities like LGCP and Brownian are mentioned but their exact implementation details are not provided.
- The impact of dimensionality on certain methods' performance is not fully characterized, particularly for diffusion-based methods.

## Confidence

- **High Confidence**: The core finding that no single method dominates across all scenarios is well-supported by the diverse results presented across multiple targets and metrics.
- **Medium Confidence**: The mechanisms explaining mode collapse and the exploration-exploitation trade-off are plausible but rely on implicit assumptions about the target distribution's geometry that are not fully articulated.
- **Low Confidence**: The specific performance rankings of methods may vary depending on the exact implementation details and hyperparameter choices, which are not fully specified in the paper.

## Next Checks

1. **Reproduce Key Results**: Implement the benchmark framework and reproduce the main results for a subset of methods (e.g., GMMVI, FAB, MCD, LDVI) on a simple target like MoG with d=20 to verify the reported trade-offs.

2. **Vary Dimensionality**: Systematically vary the dimensionality of the target distribution (e.g., d=10, 50, 100) for a few methods to confirm the claimed increase in mode collapse severity.

3. **Analyze Support Trade-off**: Conduct an ablation study on the support size of the initial proposal distribution for VMC methods, measuring the impact on ELBO, mode coverage, and ESS to validate the exploration-exploitation trade-off.