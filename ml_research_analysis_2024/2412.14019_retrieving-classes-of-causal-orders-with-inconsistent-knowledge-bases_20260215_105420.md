---
ver: rpa2
title: Retrieving Classes of Causal Orders with Inconsistent Knowledge Bases
arxiv_id: '2412.14019'
source_url: https://arxiv.org/abs/2412.14019
tags:
- causal
- graph
- acyclic
- consistent
- consistency
- transformers
- self-attention
- retrieval-augmented-generation
- instruction-tuning
- parameter-efficient-finetuning
- mixture-of-experts
- chain-of-thought
core_contribution: This paper introduces LCOS, a novel method for discovering causal
  orders using Large Language Models (LLMs) by leveraging consistency scores to overcome
  LLM unreliability. The approach extracts pairwise causal relationships from text-based
  metadata, constructs a maximally consistent semi-complete directed graph, and identifies
  acyclic tournaments that maximize consistency while being compatible with the graph
  structure.
---

# Retrieving Classes of Causal Orders with Inconsistent Knowledge Bases

## Quick Facts
- **arXiv ID**: 2412.14019
- **Source URL**: https://arxiv.org/abs/2412.14019
- **Reference count**: 7
- **Primary result**: Introduces LCOS, a method using LLM consistency scores to discover causal orders without requiring observational data or strong assumptions

## Executive Summary
This paper introduces LCOS, a novel method for discovering causal orders using Large Language Models (LLMs) by leveraging consistency scores to overcome LLM unreliability. The approach extracts pairwise causal relationships from text-based metadata, constructs a maximally consistent semi-complete directed graph, and identifies acyclic tournaments that maximize consistency while being compatible with the graph structure. Unlike traditional methods, LCOS does not require strong assumptions like causal sufficiency or faithfulness, nor does it rely on observational data. Tested on both benchmark and real-world datasets from epidemiology and public health, LCOS successfully recovers causal orders with minimal error, demonstrating its effectiveness in practical applications.

## Method Summary
LCOS extracts causal relationships from text-based metadata by querying LLMs multiple times with semantically equivalent questions to compute consistency scores. These scores are aggregated into a consistency matrix, which guides the construction of a maximally consistent semi-complete directed graph. The method then identifies strongly connected components (SCCs) in this graph and solves the Feedback Arc Set (FAS) problem for each SCC to find minimal edge reversals that create acyclic tournaments. The algorithm efficiently enumerates all maximally consistent acyclic tournaments, providing a set of compatible causal orders without requiring observational data or strong assumptions like causal sufficiency or faithfulness.

## Key Results
- LCOS achieves low Causal Order Error (COE) on both synthetic benchmark datasets and real-world epidemiological data
- The method successfully recovers causal orders with minimal error, demonstrating effectiveness in practical applications
- LCOS performs well without requiring strong assumptions like causal sufficiency or faithfulness, unlike traditional causal discovery methods

## Why This Works (Mechanism)

### Mechanism 1
- Claim: Consistency scores from repeated LLM queries act as a reliability filter, enabling selection of maximally consistent causal orders.
- Mechanism: The method computes pairwise consistency scores by querying the LLM multiple times with semantically equivalent questions. These scores are aggregated into a consistency matrix, which guides the construction of a maximally consistent semi-complete directed graph. By selecting edges based on highest consistency scores, the method filters out unreliable or hallucinated causal relationships.
- Core assumption: LLM responses to semantically equivalent questions exhibit variability that can be measured and used as a proxy for reliability.
- Evidence anchors:
  - [abstract]: "One such strategy involves leveraging a consistency measure to evaluate reliability... compute a consistency score quantifying the degree of accordance of the LLM when queried multiple times with semantically equivalent questions."
  - [section 4.1]: "The consistency score is computed by repeatedly querying the LLM with slight variations of a causal query and evaluating the concordance of its responses."
  - [corpus]: Found related papers on querying inconsistent knowledge bases, suggesting consistency measurement is a recognized approach.
- Break condition: If LLM responses are completely random or show no variance across semantically equivalent queries, the consistency score becomes meaningless.

### Mechanism 2
- Claim: Constructing a maximally consistent semi-complete directed graph provides an intermediate abstraction that captures causal relationships without requiring direct acyclic structure.
- Mechanism: After computing consistency scores, the method builds a semi-complete directed graph where edges are directed based on which consistency score is higher. This abstraction allows for cycles and bidirected edges, which are then resolved in later steps. The graph serves as a structure from which compatible acyclic tournaments can be derived.
- Core assumption: The true causal order is acyclic, and the maximally consistent semi-complete graph will contain at least one acyclic tournament that represents the true causal order.
- Evidence anchors:
  - [section 4.1]: "The semi-complete directed graph S is referred to as 'maximally consistent' because it is constructed by analyzing the consistency matrix and selecting the directed edges between each pair of nodes based on the highest consistency score."
  - [section 3]: "Definition 3 (Semi-Complete Directed Graphs). A directed graph is said to be semi-complete if there is at least one arc between each pair of its vertices."
  - [corpus]: Weak - no direct corpus evidence for this specific mechanism.
- Break condition: If the true causal graph has cycles (violates acyclicity assumption), the method cannot recover the correct causal order.

### Mechanism 3
- Claim: The algorithm efficiently identifies all maximally consistent acyclic tournaments by leveraging strongly connected components and the Feedback Arc Set problem.
- Mechanism: The method identifies strongly connected components (SCCs) in the semi-complete graph. For each SCC with multiple nodes, it solves the Feedback Arc Set (FAS) problem to find the minimal set of edges to reverse to create an acyclic tournament. This is repeated with different subsets to find all optimal solutions.
- Core assumption: SCCs in the semi-complete graph are small enough for the FAS problem to be computationally tractable.
- Evidence anchors:
  - [section 4.2]: "To obtain all the maximally consistent acyclic tournaments compatible with S we propose to use the following procedure that relies on constraining the solution space... resolving the MTR excluding from the admissible edges the subsets of E∗."
  - [section 4.1]: "Since we assume that the true causal graph is acyclic, we expect the SCCs to be relatively small, allowing for efficient detection of the FAS."
  - [corpus]: Found related papers on causal discovery and knowledge graphs, but no direct evidence for this specific algorithmic approach.
- Break condition: If SCCs grow large, the FAS problem becomes computationally intractable, making the method impractical.

## Foundational Learning

- Concept: Causal Order vs Causal Graph
  - Why needed here: The paper focuses on discovering causal orders (topological orderings) rather than full causal graphs, which is a different problem formulation that requires understanding the distinction.
  - Quick check question: What is the difference between a causal order and a causal DAG, and why might focusing on orders be more practical for LLM-based discovery?

- Concept: Strongly Connected Components (SCCs) in Directed Graphs
  - Why needed here: The algorithm uses SCC decomposition to identify which parts of the semi-complete graph need to be "acyclified" to obtain valid causal orders.
  - Quick check question: Given a directed graph, how would you identify its strongly connected components, and why are they important for this algorithm?

- Concept: Feedback Arc Set (FAS) Problem
  - Why needed here: The algorithm relies on solving the FAS problem to find the minimal edge reversals needed to make each SCC acyclic while maximizing consistency.
  - Quick check question: What is the Feedback Arc Set problem, why is it NP-hard, and how does the paper propose to handle its computational complexity?

## Architecture Onboarding

- Component map:
  LLM Query Interface -> Consistency Matrix Builder -> Semi-complete Graph Constructor -> SCC Detector -> FAS Solver -> Tournament Enumerator -> Evaluation Module

- Critical path: LLM queries → Consistency matrix → Semi-complete graph → SCC decomposition → FAS solutions → Acyclic tournaments → Evaluation

- Design tradeoffs:
  - Pairwise queries vs. triplet queries: Pairwise is simpler but may miss complex relationships
  - Exact FAS vs. approximate: Exact is NP-hard but provides optimal solutions; approximate is faster but suboptimal
  - Single LLM vs. ensemble: Single LLM is simpler but may have higher variance; ensemble could improve reliability

- Failure signatures:
  - High variance in consistency scores → LLM unreliability
  - Large SCCs → Computational intractability
  - No acyclic tournaments found → Violation of acyclicity assumption
  - Poor causal order error → Inadequate LLM knowledge or query formulation

- First 3 experiments:
  1. Run on a simple 3-node graph with known causal order to verify basic functionality
  2. Test on a graph with one SCC of size 2 to verify FAS solution works for small components
  3. Run on a medium-sized graph (5-7 nodes) to verify SCC detection and tournament enumeration scales appropriately

## Open Questions the Paper Calls Out

### Open Question 1
- Question: How does the computational complexity scale with the size of strongly connected components (SCCs) in the maximally consistent semi-complete directed graph?
- Basis in paper: [explicit] The paper mentions that the maximal tournament reversal (MTR) problem is NP-hard and equivalent to finding the Feedback Arc Set (FAS), but states that SCCs are expected to be small in practice.
- Why unresolved: The paper provides theoretical complexity but lacks empirical analysis of how computation time scales with increasing SCC sizes across different datasets.
- What evidence would resolve it: Empirical measurements of computation time across datasets with varying SCC sizes, demonstrating the relationship between SCC size and computational burden.

### Open Question 2
- Question: Does the consistency score vary significantly when querying different Large Language Models (LLMs) or using different languages?
- Basis in paper: [inferred] The paper notes that only one LLM (llama-3.1 with 8B parameters) was tested and that the method is language-agnostic, but does not explore variation across models or languages.
- Why unresolved: The paper acknowledges these as important factors but does not provide experimental evidence of how different LLMs or languages affect consistency scores and subsequent causal order discovery.
- What evidence would resolve it: Comparative experiments using multiple LLMs (different architectures, parameter sizes) and multiple languages, measuring consistency score variations and impact on causal order accuracy.

### Open Question 3
- Question: How does the comprehensiveness and quality of variable metadata descriptions affect the accuracy of causal order discovery?
- Basis in paper: [explicit] The paper states that "the simplicity and exhaustiveness of the description can greatly affect the performance of the method" and acknowledges uncertainty about whether descriptions were "complete and exhaustive."
- Why unresolved: The paper relies on expert-provided descriptions but does not systematically vary description quality to measure its impact on discovery accuracy.
- What evidence would resolve it: Controlled experiments varying description quality and comprehensiveness across the same datasets, measuring the correlation between description quality and causal order accuracy.

### Open Question 4
- Question: What is the theoretical relationship between the consistency score threshold used for edge selection and the probability of recovering the true causal order?
- Basis in paper: [inferred] The paper uses a threshold (Ci→j ≥ Cj→i) for edge selection but does not analyze how different threshold values affect discovery accuracy.
- Why unresolved: The paper implements a specific threshold without exploring the theoretical properties of this decision boundary or its sensitivity to different distributions of consistency scores.
- What evidence would resolve it: Theoretical analysis of how consistency score distributions relate to true causal relationships, combined with empirical validation across datasets showing the accuracy-cost tradeoff at different thresholds.

## Limitations
- Computational complexity of the Feedback Arc Set problem may become intractable for large strongly connected components
- Method performance depends heavily on the quality of LLM-generated consistency scores, which may vary across models and prompt strategies
- Limited empirical validation with small sample sizes in real-world datasets (3 datasets with 4-7 variables each)

## Confidence

- **High Confidence**: The core algorithmic framework (consistency-based graph construction → SCC decomposition → FAS-based acyclification) is well-specified and theoretically sound. The distinction between causal orders and causal graphs is clearly articulated.
- **Medium Confidence**: The empirical results show good performance, but the sample sizes for real-world datasets are relatively small (3 datasets with 4-7 variables each). The claim that LCOS works "without requiring strong assumptions" needs more rigorous validation across diverse domains.
- **Low Confidence**: The specific implementation details for handling bidirected edges and the exact FAS solution approach are not fully specified, making exact reproduction challenging.

## Next Checks

1. **Scalability Test**: Apply LCOS to synthetic graphs with 10-15 variables where ground truth causal orders are known. Measure both accuracy (COE) and runtime to assess computational tractability of the FAS component.

2. **Prompt Sensitivity Analysis**: Systematically vary the LLM prompts (different causal verbs, question phrasings) and measure how consistency scores and final causal order accuracy change. This would validate the robustness of the consistency score mechanism.

3. **Assumption Violation Test**: Apply LCOS to datasets where true causal graphs contain cycles (violating the acyclicity assumption). Measure how the method performs and whether it can detect when its core assumptions are violated.