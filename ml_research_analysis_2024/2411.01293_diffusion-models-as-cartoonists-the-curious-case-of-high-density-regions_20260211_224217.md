---
ver: rpa2
title: 'Diffusion Models as Cartoonists: The Curious Case of High Density Regions'
arxiv_id: '2411.01293'
source_url: https://arxiv.org/abs/2411.01293
tags:
- psde
- equation
- diffusion
- samples
- likelihood
- transformers
- self-attention
- retrieval-augmented-generation
- instruction-tuning
- parameter-efficient-finetuning
- mixture-of-experts
- chain-of-thought
core_contribution: This paper studies the probability landscape of diffusion models,
  specifically what types of images lie in the highest-likelihood regions. The authors
  introduce a novel augmented stochastic differential equation that allows tracking
  the likelihood of samples generated by the reverse diffusion process, providing
  a computationally efficient way to estimate log densities without requiring expensive
  second-order derivatives.
---

# Diffusion Models as Cartoonists: The Curious Case of High Density Regions

## Quick Facts
- arXiv ID: 2411.01293
- Source URL: https://arxiv.org/abs/2411.01293
- Authors: Rafał Karczewski; Markus Heinonen; Vikas Garg
- Reference count: 40
- Key outcome: High-density regions of diffusion models contain cartoon-like images rather than realistic samples, revealed through novel likelihood tracking methods

## Executive Summary
This paper investigates the probability landscape of diffusion models by introducing methods to track sample likelihoods during generation. The authors develop an augmented stochastic differential equation that enables efficient likelihood estimation without expensive second-order derivatives, and a mode-tracking ODE to find exact modes of denoising distributions. Surprisingly, their experiments reveal that the highest-density regions of diffusion models contain cartoon-like or blurry images rather than realistic samples, even in datasets without such examples. They also observe a strong correlation between model likelihood estimates and PNG file size, suggesting simpler images occupy higher density regions. This finding has important implications for understanding diffusion model behavior and generating high-quality samples.

## Method Summary
The paper introduces three main technical contributions: an augmented reverse SDE for tracking sample likelihoods during stochastic sampling, a mode-tracking ODE for finding exact modes of denoising distributions, and a practical high-density sampler. The augmented SDE extends the reverse diffusion dynamics to include log-density evolution, enabling exact likelihood tracking without requiring second-order derivatives. The mode-tracking ODE follows gradient flow to trace the path of highest probability modes through the diffusion process. The high-density sampler combines these techniques with a practical approximation (HD-ODE) to consistently generate images with significantly higher likelihoods than typical samplers. These methods are evaluated across multiple datasets including CIFAR-10, FFHQ-256, ImageNet-64, and Church-256.

## Key Results
- High-density samples generated by the proposed method appear as cartoon-like drawings or blurry images, even in datasets without such examples
- Strong 97% correlation between model likelihood estimates and PNG file size on FFHQ-256, indicating simpler images occupy higher density regions
- The proposed augmented SDE achieves 3.85x higher likelihood samples compared to regular stochastic sampling on CIFAR-10
- The mode-tracking ODE successfully finds exact modes of denoising distributions under appropriate conditions

## Why This Works (Mechanism)

### Mechanism 1
- **Claim**: The augmented reverse SDE enables exact likelihood tracking without requiring second-order derivatives.
- **Mechanism**: By extending the reverse SDE dynamics to include the evolution of log-density, the method leverages only first-order score information while maintaining the same marginal distributions as the original SDE.
- **Core assumption**: The score function estimate s(t,x) is sufficiently accurate and the SDE has linear drift.
- **Evidence anchors**:
  - [abstract]: "We introduce a theoretical mode-tracking process capable of pinpointing the exact mode of the denoising distribution"
  - [section 2.2]: "Theorem 1 (Augmented reverse SDE). Let x be a random process defined by equation 2. Then d[xt, log pt(xt)] = ..."
  - [corpus]: Weak - no direct mentions of augmented SDEs in neighbor papers
- **Break condition**: If the score approximation error becomes large, the log-density estimate bias increases proportionally to the score error magnitude.

### Mechanism 2
- **Claim**: High-density samples occupy regions with lower local intrinsic dimension, appearing as cartoon-like or blurry images.
- **Mechanism**: Images with simpler structure (lower complexity) compress better and have fewer local variations, making them occupy higher density regions in the learned distribution.
- **Core assumption**: PNG file size correlates with image complexity and local intrinsic dimension.
- **Evidence anchors**:
  - [section 5]: "We found a 97% correlation between model's likelihood estimates and the amount of information in the image"
  - [section 5]: "This hints at why cartoons and blurry images have the highest densities"
  - [corpus]: Weak - neighbor papers mention density-aware quantization but not cartoon generation
- **Break condition**: If the dataset contains predominantly simple images, the correlation between density and simplicity may break down.

### Mechanism 3
- **Claim**: The mode-tracking ODE can theoretically find the exact mode of the denoising distribution under specific conditions.
- **Mechanism**: By following the gradient flow that maximizes the denoising distribution density at each noise level, the ODE traces the path of highest probability modes through the diffusion process.
- **Core assumption**: A smooth mode-tracking curve exists and the Hessian of the log-density is invertible.
- **Evidence anchors**:
  - [section 4.1]: "Theorem 5 (Mode-tracking ODE). Let t ∈ (0,T] and xt ∈ RD a noisy sample. If there exists a smooth curve s → ys such that p(ys|xt) = maxxs p(xs|xt), then yt = xt..."
  - [section 4.2]: "Remark 1 (High-density ODE or HD-ODE). If p0 is Gaussian, then equation 16 becomes dys = ..."
  - [corpus]: Weak - neighbor papers focus on multi-modal sampling but not mode-tracking theory
- **Break condition**: If the mode-tracking curve has discontinuities or the Hessian becomes singular, the ODE solution becomes unstable or undefined.

## Foundational Learning

- **Concept**: Stochastic differential equations and Fokker-Planck equation
  - Why needed here: Understanding how diffusion models transform distributions and how densities evolve over time
  - Quick check question: What is the relationship between the forward SDE and its corresponding Fokker-Planck equation?

- **Concept**: Score matching and score-based generative models
  - Why needed here: The model estimates the score function ∇x log pt(x) to guide the reverse diffusion process
  - Quick check question: How does score matching relate to maximum likelihood estimation in diffusion models?

- **Concept**: Variational inference and ELBO
  - Why needed here: The likelihood estimation involves variational bounds and understanding the relationship between ELBO and true likelihood
  - Quick check question: What is the difference between the ELBO and the true log-likelihood in diffusion models?

## Architecture Onboarding

- **Component map**: Score network -> Augmented SDE solver -> Mode-tracking ODE solver -> Likelihood estimator -> Sampling controller

- **Critical path**:
  1. Score network forward pass
  2. Augmented SDE integration (reverse or forward)
  3. Mode-tracking ODE integration (for high-density sampling)
  4. Likelihood computation
  5. Sample generation and quality assessment

- **Design tradeoffs**:
  - Stochastic vs deterministic sampling: Stochastic sampling has better quality but requires density tracking
  - Accuracy vs computational cost: Mode-tracking ODE is exact but expensive; HD-ODE is approximate but efficient
  - Likelihood estimation: Augmented SDE is free with stochastic sampling; PF-ODE requires extra computation

- **Failure signatures**:
  - High variance in log-density estimates → score network approximation error
  - Mode-tracking ODE divergence → non-smooth mode curves or singular Hessians
  - Cartoon-like samples → targeting too high density regions
  - Low correlation between density and PNG size → dataset complexity mismatch

- **First 3 experiments**:
  1. Implement augmented reverse SDE tracking on a simple Gaussian mixture and verify log-density evolution matches theoretical expectations
  2. Compare regular sampling vs HD-ODE sampling on CIFAR-10 and measure likelihood improvements
  3. Test the correlation between model likelihood estimates and PNG file sizes on FFHQ-256 validation set

## Open Questions the Paper Calls Out
None

## Limitations
- The observed correlation between likelihood and PNG file size may not generalize across different datasets or compression algorithms
- The mode-tracking ODE requires computing higher-order derivatives, which may be computationally prohibitive in practice
- The paper focuses primarily on continuous diffusion models, potentially limiting applicability to other generative modeling frameworks

## Confidence
- **High Confidence**: The theoretical derivations for augmented SDE likelihood tracking are mathematically sound and internally consistent
- **Medium Confidence**: The empirical correlation between PNG size and likelihood estimates, though strong, needs validation across more diverse datasets and conditions
- **Low Confidence**: The cartoon-like nature of high-density samples may be partially an artifact of the specific evaluation methodology or dataset characteristics

## Next Checks
1. Test the PNG file size correlation on diverse datasets including natural images, medical imaging, and synthetic data to assess generalizability
2. Implement the mode-tracking ODE on a controlled synthetic distribution to verify theoretical claims about exact mode finding
3. Compare PNG file sizes using different compression algorithms (e.g., JPEG, WebP) to ensure the correlation isn't compression-method specific