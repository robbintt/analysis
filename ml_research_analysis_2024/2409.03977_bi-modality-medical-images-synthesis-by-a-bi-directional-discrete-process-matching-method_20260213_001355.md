---
ver: rpa2
title: Bi-modality medical images synthesis by a bi-directional discrete process matching
  method
arxiv_id: '2409.03977'
source_url: https://arxiv.org/abs/2409.03977
tags:
- images
- image
- synthesis
- bi-dpm
- paired
- transformers
- self-attention
- retrieval-augmented-generation
- instruction-tuning
- parameter-efficient-finetuning
- mixture-of-experts
- chain-of-thought
core_contribution: This paper proposes a novel flow-based method, termed Bi-DPM, for
  bi-modality medical image synthesis. The key idea is to utilize both forward and
  backward ODE flows and enhance the consistency on the intermediate images over a
  few discrete time steps, resulting in a synthesis process maintaining high-quality
  generations for both modalities under the guidance of paired data.
---

# Bi-modality medical images synthesis by a bi-directional discrete process matching method

## Quick Facts
- arXiv ID: 2409.03977
- Source URL: https://arxiv.org/abs/2409.03977
- Reference count: 40
- Primary result: Bi-DPM achieves SSIM of 0.869 and PSNR of 23.117 for MRI T1/T2 synthesis, outperforming state-of-the-art flow-based methods

## Executive Summary
This paper introduces Bi-DPM, a novel flow-based method for bi-modality medical image synthesis that leverages both forward and backward ODE flows with discrete process matching. Unlike traditional flow-based methods that rely on predefined transport paths, Bi-DPM enhances consistency on intermediate images over discrete time steps, enabling more flexible and accurate modality transformation. The method demonstrates superior performance on three medical imaging datasets, achieving higher image quality with accurate anatomical regions while maintaining computational efficiency.

## Method Summary
Bi-DPM addresses bi-modality medical image synthesis by employing a bidirectional ODE process that simultaneously optimizes forward and backward transformations between source and target modalities. The method uses intermediate state matching at discrete time points, with LPIPS metrics for paired data and MMD for unpaired data in the loss function. A UNet-based velocity field guides the ODE solvers, while an EMA mechanism stabilizes training. The approach can handle partially paired data scenarios and shows robustness across different medical imaging modalities including MRI T1/T2 and CT/MRI.

## Key Results
- Achieves SSIM of 0.869 and PSNR of 23.117 for MRI T1/T2 synthesis on BraTS dataset
- Outperforms RF and CFM methods by significant margins (1.7-2.8% SSIM improvement)
- Demonstrates superior performance on 3D medical image synthesis with SSIM of 0.783 for MRI-to-CT conversion

## Why This Works (Mechanism)

### Mechanism 1
- Claim: Bi-DPM outperforms traditional flow-based methods because it uses a bidirectional ODE process with intermediate state matching rather than relying on a predefined transport path
- Mechanism: By defining both forward and backward ODEs and matching intermediate states at discrete time points, the model gains flexibility in learning the transformation between modalities
- Core assumption: The paired relationship between source and target images can be effectively captured by comparing intermediate states via LPIPS or MMD metrics
- Evidence anchors:
  - [abstract] "we propose to utilize both forward and backward ODE flows and enhance the consistency on the intermediate images over a few discrete time steps"
  - [section II-A] "the value of ODE Eq. 3 coincides with each other on these time points"
  - [corpus] Weak - no direct mention of bidirectional ODE processes or intermediate state matching in neighbors
- Break condition: If the intermediate state matching fails to capture modality-specific features, or if the forward/backward ODE inconsistency grows with more steps, the method degrades

### Mechanism 2
- Claim: The training objective using LPIPS for paired data and MMD for unpaired data allows Bi-DPM to perform well even with partially paired datasets
- Mechanism: LPIPS captures perceptual similarity between paired images, while MMD measures distributional similarity for unpaired data
- Core assumption: Perceptual similarity metrics like LPIPS are more informative than pixel-wise metrics for medical image synthesis
- Evidence anchors:
  - [section II-A] "For paired data, we use Learned Perceptual Image Patch Similarity [19](LPIPS) as the metric d(·, ·) while for unpaired data, we take Maximum Mean Discrepancy [20](MMD)"
  - [section III-B.2] "we use a combination of LPIPS and MMD as the loss function"
  - [corpus] Weak - neighbors don't discuss MMD or LPIPS usage in flow-based methods
- Break condition: If LPIPS fails to capture relevant anatomical features, or if MMD becomes unstable with high-dimensional unpaired data, the hybrid loss may underperform

### Mechanism 3
- Claim: Bi-DPM's discrete process matching enables faster synthesis with fewer ODE steps compared to traditional methods
- Mechanism: By matching intermediate states at only a few discrete time points rather than computing the full ODE trajectory, Bi-DPM can achieve comparable or better quality with fewer iterations
- Core assumption: The essential transformation information between modalities can be captured at a small number of well-chosen intermediate points
- Evidence anchors:
  - [abstract] "resulting in a synthesis process maintaining high-quality generations"
  - [section III-C] "for images with complex structures, the inclusion of intermediate time points is both necessary and effective"
  - [section III-D] "DPM significantly outperforms other flow-based models (RF and CFM: 834s)"
- Break condition: If too few steps miss critical transformation details, or if the discrete matching becomes unstable, the method may fail to maintain quality

## Foundational Learning

- Concept: Ordinary Differential Equations (ODEs) and numerical ODE solvers
  - Why needed here: The method relies on solving forward and backward ODEs to transform between image modalities
  - Quick check question: What is the Euler method for approximating ODE solutions, and how does step size affect accuracy?

- Concept: Flow-based generative models and probability path construction
  - Why needed here: Understanding how flow models transform distributions is essential to grasp why Bi-DPM's approach differs from traditional methods
  - Quick check question: How do Conditional Flow Matching and Rectified Flow define their transport paths differently from Bi-DPM?

- Concept: Perceptual similarity metrics (LPIPS) and distributional metrics (MMD)
  - Why needed here: These metrics form the core of Bi-DPM's training objective for paired and unpaired data
  - Quick check question: What is the key difference between pixel-wise similarity and perceptual similarity, and when is each more appropriate?

## Architecture Onboarding

- Component map:
  - UNet-based velocity field model (u_θ) -> Forward ODE solver (Euler method) -> Backward ODE solver (Euler method) -> LPIPS metric module (pre-trained VGG-based) -> MMD computation module -> Loss aggregation and optimization (Adam optimizer) -> EMA for parameter updates

- Critical path: Data → Resize/normalize → Forward ODE iteration → Backward ODE iteration → Intermediate state comparison (LPIPS/MMD) → Loss computation → Parameter update → EMA update

- Design tradeoffs:
  - Fewer ODE steps vs. synthesis quality (trade accuracy for speed)
  - LPIPS vs. pixel-wise metrics (better perceptual quality vs. computational cost)
  - Paired vs. unpaired data weighting (guidance quality vs. data availability)
  - Discrete time points selection (transformation capture vs. computational efficiency)

- Failure signatures:
  - Mode collapse or loss of anatomical detail (LPIPS metric not capturing relevant features)
  - Unstable training with unpaired data (MMD computation issues)
  - Slow convergence or poor quality (too few ODE steps)
  - Memory overflow (large batch sizes or high-resolution images)

- First 3 experiments:
  1. Implement the basic Bi-DPM architecture with 1-step and 2-step variants on a simple paired dataset (e.g., synthetic 2D shapes)
  2. Test the LPIPS and MMD loss components separately to verify their behavior on paired and unpaired data
  3. Compare synthesis quality and speed against RF and CFM on a small medical image dataset (e.g., MRI T1/T2 from BRATS)

## Open Questions the Paper Calls Out

### Open Question 1
- Question: How does the choice of intermediate time points (e.g., 1-step vs. 2-step) impact the quality of generated images across different medical imaging modalities?
- Basis in paper: [explicit] The paper shows that 1-step Bi-DPM performs best for MRI T1/T2 while 2-step performs better for CT/MRI
- Why unresolved: The paper doesn't provide a theoretical explanation for why different modalities require different numbers of steps
- What evidence would resolve it: A study comparing Bi-DPM performance across multiple modalities with varying anatomical complexity

### Open Question 2
- Question: What is the theoretical relationship between the proposed Bi-DPM objective and the underlying optimal transport problem in medical image synthesis?
- Basis in paper: [inferred] The paper mentions that Bi-DPM is a generalized version of RF's constraint but doesn't formally establish its connection to optimal transport theory
- Why unresolved: While the paper demonstrates empirical superiority, it lacks a rigorous mathematical framework connecting the discrete process matching to optimal transport metrics
- What evidence would resolve it: A formal proof establishing that Bi-DPM's loss function converges to an optimal transport cost under specific conditions

### Open Question 3
- Question: How does Bi-DPM's performance scale with dataset size and image resolution in 3D medical image synthesis tasks?
- Basis in paper: [explicit] The paper demonstrates 3D synthesis results but doesn't explore scaling effects
- Why unresolved: The paper only tests on a single 3D dataset with limited samples and 2D slices
- What evidence would resolve it: Systematic experiments varying dataset sizes and image resolutions with analysis of training time and memory usage

## Limitations

- The evaluation primarily relies on SSIM and PSNR metrics, which may not fully capture clinical relevance of synthesized medical images
- The method's performance on truly unpaired data scenarios and generalization to other medical imaging modalities remain unexplored
- The computational efficiency claims are based on comparisons with RF and CFM implementations without ablation studies on ODE step sizes

## Confidence

- **High**: The core bidirectional ODE mechanism and discrete matching framework
- **Medium**: The effectiveness of LPIPS/MMD hybrid loss for partially paired data
- **Medium**: The computational efficiency improvements over baseline flow-based methods

## Next Checks

1. Conduct a comprehensive ablation study varying the number of discrete matching points (1, 2, 4, 8 steps) to quantify the trade-off between synthesis quality and computational efficiency

2. Evaluate performance on fully unpaired datasets to assess the method's capability when no paired data is available

3. Perform cross-modality generalization tests by applying the trained model to a different anatomical region or imaging protocol not seen during training