---
ver: rpa2
title: 'QNCD: Quantization Noise Correction for Diffusion Models'
arxiv_id: '2403.19140'
source_url: https://arxiv.org/abs/2403.19140
tags:
- quantization
- noise
- diffusion
- sampling
- qncd
- transformers
- self-attention
- retrieval-augmented-generation
- instruction-tuning
- parameter-efficient-finetuning
- mixture-of-experts
- chain-of-thought
core_contribution: "This paper addresses the challenge of deploying diffusion models\
  \ on resource-constrained devices through post-training quantization (PTQ), which\
  \ typically degrades image quality especially in low-bit settings. The authors identify\
  \ two sources of quantization noise\u2014intra noise from embedding-induced feature\
  \ distribution changes and inter noise from cumulative deviations across sampling\
  \ steps\u2014and propose QNCD to correct both."
---

# QNCD: Quantization Noise Correction for Diffusion Models

## Quick Facts
- arXiv ID: 2403.19140
- Source URL: https://arxiv.org/abs/2403.19140
- Reference count: 29
- Achieves near-lossless W4A8 and W8A8 quantization on ImageNet (LDM-4), reducing FID from 41.25 to 20.14

## Executive Summary
This paper addresses the challenge of deploying diffusion models on resource-constrained devices through post-training quantization (PTQ). The authors identify two distinct sources of quantization noise in diffusion models: intra noise from embedding-induced feature distribution changes and inter noise from cumulative deviations across sampling steps. Their proposed QNCD method corrects both types of noise, achieving near-lossless results at low-bit quantization settings. The approach is particularly effective for W4A8 and W8A8 quantization on ImageNet, significantly outperforming prior methods.

## Method Summary
QNCD addresses quantization noise in diffusion models through two complementary correction mechanisms. For intra noise, the method applies channel-wise smoothing factors derived from embeddings to make features more quantization-friendly. For inter noise, a runtime noise estimation module estimates and filters cumulative deviations across sampling steps, leveraging properties of the diffusion model's training process. The combination of these approaches allows for effective low-bit quantization without significant quality degradation.

## Key Results
- Achieves near-lossless results at W4A8 and W8A8 quantization on ImageNet (LDM-4)
- Reduces FID from 41.25 to 20.14 on ImageNet W4A6
- Significantly outperforms prior quantization methods, especially in low-bit settings

## Why This Works (Mechanism)
The method works by addressing the two fundamental sources of quantization noise in diffusion models. Intra noise occurs because quantization alters the feature distribution within each layer, which QNCD corrects through channel-wise smoothing that adapts to the specific characteristics of each embedding. Inter noise accumulates across the multiple sampling steps typical of diffusion models, which QNCD addresses through runtime estimation and filtering that exploits the predictable nature of diffusion noise during training. This dual approach ensures both immediate and cumulative quantization effects are mitigated.

## Foundational Learning

**Diffusion Models**: Generative models that iteratively denoise random noise to produce images. Needed to understand why quantization noise accumulates differently than in other architectures. Quick check: Can explain the forward (noising) and reverse (denoising) processes.

**Post-Training Quantization (PTQ)**: Technique for reducing model precision after training without retraining. Needed to understand the deployment constraints being addressed. Quick check: Can describe difference between PTQ and quantization-aware training.

**Feature Distribution Sensitivity**: How quantization affects internal activations differently than weights. Needed to understand why diffusion models are particularly vulnerable to quantization noise. Quick check: Can explain how quantization changes activation statistics.

## Architecture Onboarding

**Component Map**: Input Image -> Quantized Diffusion Model -> Noise Estimation Module -> Correction Layer -> Output Image

**Critical Path**: The correction path runs through each sampling step of the diffusion process, applying both intra-noise smoothing (channel-wise) and inter-noise estimation/filtering at each step to progressively refine the output.

**Design Tradeoffs**: QNCD prioritizes quality preservation over computational efficiency, adding runtime overhead for noise estimation. This tradeoff is justified by the significant quality improvements, particularly at low bit-widths where standard quantization fails.

**Failure Signatures**: Poor performance would manifest as either under-correction (persistent noise/artifacts) or over-correction (oversmoothing/loss of detail), particularly in textured regions or fine details.

**First Experiments**:
1. Baseline quantization (no correction) at W4A8 on ImageNet to establish performance floor
2. QNCD with only intra-noise correction to isolate its contribution
3. QNCD with only inter-noise correction to isolate its contribution

## Open Questions the Paper Calls Out
None identified in the source material.

## Limitations
- Inter-noise estimation approach may not generalize well to all diffusion model architectures or datasets
- Focus primarily on LDM-4 and ImageNet leaves open questions about performance on other domains
- Channel-wise smoothing corrections may impact model capacity or introduce new artifacts in certain image regions

## Confidence

**High confidence**: Identification of intra and inter noise sources as distinct problems; experimental methodology and comparison with baseline methods

**Medium confidence**: Generalizability of inter-noise estimation across different architectures and datasets; long-term stability of channel-wise smoothing corrections; claim of "near-lossless" results

## Next Checks
1. Test QNCD on diffusion transformer architectures (e.g., Stable Diffusion) and non-natural image domains (e.g., medical imaging, satellite imagery) to assess generalizability
2. Conduct ablation studies isolating the contribution of intra-noise correction versus inter-noise correction to quantify their relative importance
3. Perform perceptual studies with human raters to complement the quantitative metrics (FID, etc.) and verify that the corrections don't introduce subtle artifacts