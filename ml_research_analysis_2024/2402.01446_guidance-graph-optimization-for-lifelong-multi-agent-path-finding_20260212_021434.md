---
ver: rpa2
title: Guidance Graph Optimization for Lifelong Multi-Agent Path Finding
arxiv_id: '2402.01446'
source_url: https://arxiv.org/abs/2402.01446
tags:
- guidance
- pibt
- agents
- graph
- mapf
- transformers
- self-attention
- retrieval-augmented-generation
- instruction-tuning
- parameter-efficient-finetuning
- mixture-of-experts
- chain-of-thought
core_contribution: 'This paper introduces Guidance Graph Optimization (GGO) to improve
  the throughput of lifelong Multi-Agent Path Finding (MAPF) by optimizing edge weights
  in a guidance graph. The authors propose two GGO methods: (1) CMA-ES directly optimizes
  edge weights, and (2) PIU optimizes a neural network that iteratively updates the
  guidance graph based on traffic information.'
---

# Guidance Graph Optimization for Lifelong Multi-Agent Path Finding

## Quick Facts
- arXiv ID: 2402.01446
- Source URL: https://arxiv.org/abs/2402.01446
- Reference count: 40
- Authors: Yulun Zhang; He Jiang; Varun Bhatt; Stefanos Nikolaidis; Jiaoyang Li
- One-line primary result: GGO improves lifelong MAPF throughput by up to 43% compared to existing guidance methods

## Executive Summary
This paper introduces Guidance Graph Optimization (GGO) to improve the throughput of lifelong Multi-Agent Path Finding (MAPF) by optimizing edge weights in a guidance graph. The authors propose two GGO methods: (1) CMA-ES directly optimizes edge weights, and (2) PIU optimizes a neural network that iteratively updates the guidance graph based on traffic information. Experiments show that GGO significantly outperforms existing guidance methods (unweighted, crisscross, HM Cost, and Traffic Flow) in eight benchmark maps, improving throughput by up to 43%. PIU can also generate guidance graphs for large maps (93 × 91) with up to 3,000 agents, demonstrating transferability to similar map layouts.

## Method Summary
GGO optimizes edge weights in a guidance graph to improve lifelong MAPF throughput. The method uses CMA-ES to directly optimize edge weights or PIU, which optimizes a neural network update model that iteratively adjusts weights based on traffic usage. The guidance graph biases agent movement to reduce collisions and congestion by amplifying cost differences in opposite edge directions and increasing costs in high-congestion areas. The optimized guidance graphs are evaluated with lifelong MAPF simulations using algorithms like PIBT, RHCR, and DPP.

## Key Results
- GGO improves throughput by up to 43% compared to existing guidance methods
- PIU achieves competitive throughput to RHCR while using simpler algorithmic structure
- PIU successfully generates guidance graphs for large maps (93 × 91) with up to 3,000 agents
- Optimized guidance graphs demonstrate transferability to similar map layouts

## Why This Works (Mechanism)

### Mechanism 1
- Claim: Guidance graph edge weights bias agent movement patterns to reduce head-on collisions and traffic congestion.
- Mechanism: By amplifying cost differences in opposite edge directions, agents are encouraged to move consistently in one direction, reducing bidirectional conflicts. Increasing costs in high-congestion areas steers agents toward less crowded regions.
- Core assumption: Agents plan shortest-cost paths on the guidance graph rather than the base graph.
- Evidence anchors:
  - [abstract]: "by amplifying the cost difference of traveling through an edge in opposite directions, we encourage agents to move in the same direction, reducing the number of head-on collisions"
  - [section 2.2]: "we redefine the sum-of-costs of the underlying (one-shot) MAPF instances as the sum of the action costs across all paths for all agents"

### Mechanism 2
- Claim: Iterative traffic-based edge weight updates can converge to high-throughput guidance configurations.
- Mechanism: PIU uses a parameterized update model (CNN) to iteratively adjust edge weights based on observed edge usage from simulations. The update model learns to amplify costs on congested edges and reduce costs on underutilized ones.
- Core assumption: Edge usage patterns correlate with congestion and are indicative of poor guidance.
- Evidence anchors:
  - [section 4.2]: "uses CMA-ES to optimize an update model that iteratively generates a guidance graph based on simulated traffic information"
  - [section 5.2]: "PIU can generate guidance graphs for larger maps with similar layouts"

### Mechanism 3
- Claim: Optimizing a compact neural update model is more scalable than optimizing raw edge weights for large maps.
- Mechanism: CMA-ES struggles with high-dimensional edge weight vectors; PIU reduces dimensionality by optimizing a small CNN that maps usage maps to edge weights, making the search space tractable for large graphs.
- Core assumption: Similar map layouts can be guided by similar update models, enabling transferability.
- Evidence anchors:
  - [section 4.2]: "optimizing the update model reduces the dimension of search space"
  - [section 5.2]: "PIU can generate guidance graphs for as large as 93 × 91 maps"

## Foundational Learning

- Concept: Multi-Agent Path Finding (MAPF) and Lifelong MAPF
  - Why needed here: GGO is defined specifically for lifelong MAPF; understanding how throughput differs from sum-of-costs is critical.
  - Quick check question: In lifelong MAPF, what objective is being maximized, and how does it differ from one-shot MAPF?

- Concept: Edge weight optimization and bounds handling in evolutionary strategies
  - Why needed here: CMA-ES is used to optimize edge weights; understanding normalization vs projection/reflection is key for correct implementation.
  - Quick check question: Why does min-max normalization of edge weights not affect the MAPF solution?

- Concept: Neural network parameterization for spatial guidance
  - Why needed here: PIU uses a CNN to map traffic usage to edge weights; understanding its architecture and output shape is necessary.
  - Quick check question: For a grid of size h × w, how many output channels does the update model produce and what does each represent?

## Architecture Onboarding

- Component map: Graph G(V,E) -> CMA-ES optimizer -> Lifelong MAPF simulator -> Throughput and usage maps -> Update model (PIU) -> Edge weights -> Guidance graph

- Critical path:
  1. Generate initial guidance graph (uniform or via update model)
  2. Run lifelong MAPF simulation to collect throughput and edge usage
  3. Update guidance graph (direct weights or via update model)
  4. Repeat until convergence or budget exhausted
  5. Return highest-throughput guidance graph

- Design tradeoffs:
  - CMA-ES vs PIU: scalability vs generality
  - Wait cost inclusion: supports more MAPF algorithms but increases search space
  - Online vs offline optimization: runtime overhead vs precomputed guidance
  - CNN architecture: expressive power vs overfitting risk

- Failure signatures:
  - No improvement over baselines: optimization stuck in local optima or update model not expressive enough
  - Degraded throughput with more agents: guidance graph overfit to narrow agent count range
  - Extremely long runtime: CMA-ES exploring too many candidates without early stopping

- First 3 experiments:
  1. Run CMA-ES on a small grid (e.g., 10x10) with 5 agents to verify basic optimization loop
  2. Compare CMA-ES vs PIU on a medium grid (e.g., 32x32) to observe scalability difference
  3. Test update model transferability by optimizing on one warehouse map and applying to a larger one

## Open Questions the Paper Calls Out

### Open Question 1
- Question: How can the computational cost of CMA-ES and PIU be significantly reduced while maintaining or improving throughput performance?
- Basis in paper: [explicit] The paper states that both CMA-ES and PIU are computationally expensive, requiring a large number of lifelong MAPF simulations, taking 1.2 hours (setup 1) to 55 hours (setup 8) to run on machine (2) in Section 5.1. Future works can focus on reducing the computational requirements of both methods.
- Why unresolved: The paper acknowledges the computational expense but does not propose or test specific methods for reducing it. The high dimensionality of the search space and the need for many simulations are inherent challenges.
- What evidence would resolve it: Empirical results showing significantly reduced runtime (e.g., by an order of magnitude) for CMA-ES and PIU while achieving comparable or better throughput than the current methods.

### Open Question 2
- Question: Can the optimized guidance graphs be made more explainable, or can their explainability be analyzed?
- Basis in paper: [explicit] The paper states that while the optimized guidance graphs improve throughput, such improvement lacks explainability. Future works can focus on either generating more explainable guidance graphs or analyzing the explainability of our optimized guidance graphs.
- Why unresolved: The paper does not provide any analysis or methodology for explaining why the optimized guidance graphs improve throughput. The guidance graphs are presented as black boxes that work but are not interpretable.
- What evidence would resolve it: A framework or set of metrics for quantifying the explainability of guidance graphs, along with empirical results showing how changes in the guidance graph relate to improvements in throughput in a interpretable way.

### Open Question 3
- Question: How would integrating online adaptation mechanisms with GGO algorithms further enhance MAPF guidance utility?
- Basis in paper: [explicit] The paper mentions that although the guidance graph can be used with online update mechanisms introduced in previous works [Chen et al., 2024; Yu and Wolf, 2023], the experiments are limited to offline optimization. Integrating these mechanisms with GGO algorithms could further enhance MAPF guidance utility.
- Why unresolved: The paper does not explore or test the integration of online adaptation with GGO. It only mentions the potential for enhancement without providing any empirical evidence or theoretical analysis.
- What evidence would resolve it: Experimental results comparing the throughput of lifelong MAPF with and without online adaptation mechanisms integrated with GGO algorithms, showing a significant improvement in throughput when using online adaptation.

## Limitations
- High computational cost: Both CMA-ES and PIU require many lifelong MAPF simulations, taking 1.2 to 55 hours for optimization
- Limited explainability: Optimized guidance graphs improve throughput but lack interpretable explanations for their effectiveness
- Baseline hyperparameters unspecified: Exact values for α, β, γ in HM Cost baseline not provided

## Confidence
- High confidence in CMA-ES optimization methodology and basic GGO framework
- Medium confidence in PIU's transferability claims across different map sizes
- Medium confidence in throughput improvement metrics given benchmark setup

## Next Checks
1. Verify baseline guidance graph implementations with specified hyperparameters match the paper's reported performance
2. Test CMA-ES and PIU optimization on a held-out map not used in training to assess generalizability
3. Profile optimization runtime to confirm scalability claims for larger maps with PIU vs direct CMA-ES optimization