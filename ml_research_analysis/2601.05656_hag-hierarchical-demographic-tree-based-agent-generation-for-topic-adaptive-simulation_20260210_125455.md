---
ver: rpa2
title: 'HAG: Hierarchical Demographic Tree-based Agent Generation for Topic-Adaptive
  Simulation'
arxiv_id: '2601.05656'
source_url: https://arxiv.org/abs/2601.05656
tags:
- population
- topic
- demographic
- social
- consistency
- transformers
- self-attention
- retrieval-augmented-generation
- instruction-tuning
- parameter-efficient-finetuning
- mixture-of-experts
- chain-of-thought
core_contribution: 'This paper introduces HAG, a hierarchical agent generation framework
  designed to produce topic-adaptive, sociologically consistent agent populations
  for high-fidelity simulations. The key innovation is a two-stage approach: first,
  a World Knowledge Model constructs a Topic-Adaptive Demographic Distribution Tree
  that explicitly models joint attribute distributions conditioned on the topic; second,
  real-world data from the World Values Survey grounds the tree through filtering
  and agentic augmentation.'
---

# HAG: Hierarchical Demographic Tree-based Agent Generation for Topic-Adaptive Simulation

## Quick Facts
- arXiv ID: 2601.05656
- Source URL: https://arxiv.org/abs/2601.05656
- Reference count: 22
- Primary result: HAG reduces population alignment errors by 37.7% and enhances sociological consistency by 18.8% compared to baselines

## Executive Summary
This paper introduces HAG, a hierarchical agent generation framework designed to produce topic-adaptive, sociologically consistent agent populations for high-fidelity simulations. The key innovation is a two-stage approach: first, a World Knowledge Model constructs a Topic-Adaptive Demographic Distribution Tree that explicitly models joint attribute distributions conditioned on the topic; second, real-world data from the World Values Survey grounds the tree through filtering and agentic augmentation. This ensures both macro-level distribution alignment and micro-level individual rationality. Evaluation on three diverse domains—social simulation, product recommendation, and movie critique—shows HAG reduces population alignment errors by 37.7% on average and enhances sociological consistency by 18.8% compared to baselines. Qualitative analysis confirms HAG captures the population manifold structure and conditional dependencies, outperforming retrieval and flat generation methods.

## Method Summary
HAG employs a two-stage process for topic-adaptive agent population generation. First, the World Knowledge Model (WKM) constructs a hierarchical Topic-Adaptive Demographic Distribution Tree by inferring dimension priorities and conditional probabilities for the target topic. Second, the framework grounds this tree using real-world data from the World Values Survey (WVS), filtering for HIT nodes (sufficient data) and generating synthetic agents for MISS nodes (insufficient data). The tree structure captures joint attribute distributions through hierarchical conditional probability chains, while the grounding mechanism ensures realism through retrieval-before-generation. The final agent population achieves both statistical alignment with target distributions and sociological consistency across individual behaviors.

## Key Results
- HAG reduces population alignment errors by 37.7% on average compared to baselines
- HAG enhances sociological consistency by 18.8% across evaluation domains
- Hierarchical structure outperforms flat generation, capturing diagonal trends in conditional distributions rather than symmetric grid patterns

## Why This Works (Mechanism)

### Mechanism 1
- Claim: Hierarchical conditional probability modeling captures topic-dependent joint attribute distributions better than independent dimension generation.
- Mechanism: The World Knowledge Model (WKM) constructs a tree where each node's probability is conditioned on its ancestor path (Eq. 2: w(v^(l)|v^(1:l-1), t)), producing leaf-level joint distributions via path weight products (Eq. 3). This enforces dependency-aware population structure rather than marginal-independent sampling.
- Core assumption: LLMs encode sufficient world knowledge to infer sociologically valid conditional dependencies for arbitrary topics.
- Evidence anchors:
  - [abstract]: "a World Knowledge Model constructs a Topic-Adaptive Demographic Distribution Tree that explicitly models joint attribute distributions conditioned on the topic"
  - [section 4.3 RQ2]: HAG-Flat exhibits "symmetric, grid-like distribution" while HAG "closely matches the diagonal trend" of GT heatmaps
  - [corpus]: Weak direct corpus support; neighbor papers use hierarchical structures for different purposes (mobility, resource allocation)
- Break condition: WKM hallucinates incorrect conditional probabilities (observed with Gemini-2.5-Pro on Bluesky topics in Section 4.2).

### Mechanism 2
- Claim: Grounding with retrieval-before-generation prevents "Frankenstein" agents with unrealistic attribute combinations.
- Mechanism: For each leaf persona v, retrieve m(v) real WVS users first. Only generate n(v)-m(v) synthetic agents when data is scarce (Eq. 4: MISS nodes). Generated agents are constrained to the tree-defined attribute path, limiting LLM hallucination space.
- Core assumption: WVS demographics provide sufficient coverage of realistic attribute combinations for most topics.
- Evidence anchors:
  - [abstract]: "real-world data from the World Values Survey grounds the tree through filtering and agentic augmentation"
  - [section 2.2.2]: "For HIT nodes, we sample n(v) real users directly, ensuring maximum realism"
  - [corpus]: No direct corpus evidence for this specific grounding mechanism
- Break condition: Emerging topics (e.g., "Mars Colonization") may require more MISS-node generation, increasing hallucination risk.

### Mechanism 3
- Claim: Dimension prioritization by topic relevance improves both distributional fidelity and computational efficiency.
- Mechanism: WKM outputs prioritized dimension sequence f_prior(t) = (f^(1),...,f^(L)) (Eq. 1), determining tree depth order. Higher-priority dimensions expand earlier, concentrating probability mass on sociologically salient attributes for that topic.
- Core assumption: Topic-relevant dimensions are identifiable and their priority ordering correlates with actual demographic influence on topic-specific behavior.
- Evidence anchors:
  - [section 2.2.1]: "This sequence directly determines the layer order of the distribution tree from root to leaves"
  - [section 4.2]: HAG consistently outperforms HAG-Flat across all domains, validating hierarchical contribution
  - [corpus]: Neighbor "From Narrative to Action" uses hierarchical LLM-agent frameworks for mobility, suggesting generalizable hierarchical decomposition benefits
- Break condition: WKM selects irrelevant or misordered dimensions for niche topics lacking training distribution coverage.

## Foundational Learning

- Concept: Joint vs. Marginal Distributions
  - Why needed here: The paper's core criticism of LLM-based generation is that it models attributes independently (marginals) rather than capturing correlations (joints). Understanding P(A,B) vs. P(A)P(B) is essential.
  - Quick check question: If education and income are positively correlated in reality, will independent sampling over- or under-represent low-education/high-income combinations?

- Concept: Hierarchical Conditional Probability Chains
  - Why needed here: The tree structure computes P(v^(L)|v^(1:L-1),t) × ... × P(v^(1)|t). Understanding chain rule factorization is critical for tracing how topic context propagates to leaf distributions.
  - Quick check question: In a tree with dimensions [Age, Education, Income] for topic "Academic Research," what happens to P(Income=High) if you condition on Age=25 vs. Age=55?

- Concept: Distributional Distance Metrics (JSD/KL)
  - Why needed here: PACE evaluation uses Jensen-Shannon and Kullback-Leibler divergences to quantify population alignment. Interpreting these scores (lower=better, asymmetry of KL) is necessary for debugging generation quality.
  - Quick check question: Why might JSD be preferred over KL when comparing generated populations to ground truth?

## Architecture Onboarding

- Component map:
  1. World Knowledge Model (LLM): Infers dimension priorities and conditional probabilities
  2. Topic-Adaptive Distribution Tree: Hierarchical data structure storing nodes, edges, and path weights
  3. WVS Database (pre-processed): 12 demographic dimensions across Basic, Socio-Economic, Cultural categories
  4. Retrieval Engine: Filters WVS by leaf persona constraints
  5. Agentic Augmentation Module: Generates synthetic agents for MISS nodes with path constraints
  6. PACE Evaluator: Computes JSD/KL/DivErr (alignment) and ArchRel/IndCon (consistency)

- Critical path: Topic input → WKM dimension prioritization (Eq. 1) → Tree expansion with conditional probabilities (Eq. 2) → Leaf weight computation (Eq. 3) → Per-leaf retrieval/augmentation (Eq. 4) → Population output → PACE evaluation

- Design tradeoffs:
  - Tree depth (max_depth=5) vs. granularity: Deeper trees capture more joints but increase MISS nodes and computational cost
  - Real data priority vs. topic adaptivity: Favoring retrieval preserves realism but limits novel topic coverage
  - WKM temperature (0.0) vs. diversity: Low temperature ensures reproducibility but may miss valid distribution variations

- Failure signatures:
  - High JSD/KL with low DivErr: Marginal distributions wrong but structure intact → check WKM probability inference
  - High DivErr with low JSD/KL: Marginals correct but diversity misaligned → check topic-specific dimension prioritization
  - High IndCon but low ArchRel: Individuals plausible but population unrepresentative → check tree coverage vs. topic scope
  - Gemini-style hallucination: Anomalous distribution spikes on specific topics → WKM lacks topic knowledge

- First 3 experiments:
  1. Reproduce HAG vs. HAG-Flat comparison on a single domain (e.g., Bluesky "Science" topic) to validate hierarchical contribution; expect 5-15% JSD reduction
  2. Ablate retrieval-only vs. augmentation-only on a data-scarce topic (e.g., "Mars Colonization") to measure grounding contribution; expect retrieval-only to fail coverage, augmentation-only to show higher IndCon variance
  3. Test WKM replacement (e.g., GPT-4 vs. DeepSeek-V3) on Bluesky topics where Gemini showed anomalies; compare resulting tree structures to identify knowledge gaps

## Open Questions the Paper Calls Out

### Open Question 1
- Question: How can the framework dynamically update to maintain fidelity as societal structures and demographic distributions evolve beyond the static World Values Survey data?
- Basis in paper: [explicit] "Additionally, as societal structures evolve, the static nature of the World Values Survey database may eventually introduce temporal lag, necessitating periodic updates or integration with real-time data streams to maintain fidelity."
- Why unresolved: The current WVS grounding is inherently retrospective; the paper does not propose mechanisms for continuous data integration or temporal adaptation.
- What evidence would resolve it: Experiments showing HAG's performance degradation over simulated temporal shifts, and successful integration with dynamic data sources (e.g., streaming social media) maintaining comparable alignment metrics.

### Open Question 2
- Question: How can the reliability of the World Knowledge Model be systematically validated or improved to prevent topic-specific hallucinations that corrupt the demographic distribution tree?
- Basis in paper: [explicit] "Gemini-2.5-Pro model exhibited significant hallucinations on specific topics within the Bluesky dataset, leading to distributional anomalies. This observation underscores the critical importance of the World Knowledge Model's factual reliability."
- Why unresolved: The paper treats the WKM as a black box; no calibration, verification, or correction mechanism is proposed for detecting or mitigating hallucinated conditional probabilities.
- What evidence would resolve it: A comparative study showing (a) automated detection rates for hallucinated distributions, and (b) mitigation strategies (e.g., retrieval-augmented grounding for tree nodes) restoring performance to reliable-model levels.

### Open Question 3
- Question: What is the comparative downstream simulation fidelity when using agentic augmentation versus real-user retrieval for population instantiation?
- Basis in paper: [inferred] The paper evaluates population-level alignment and consistency but does not isolate the behavioral consequences of synthetic agents in actual simulations; the augmentation fills gaps but may differ in unmeasured dimensions.
- Why unresolved: The PACE framework measures statistical and sociological properties of populations, not their behavioral validity in multi-agent interactions or task performance.
- What evidence would resolve it: Ablation experiments comparing simulation outcomes (e.g., recommendation accuracy, opinion dynamics trajectories) using populations with varying ratios of real vs. augmented agents, showing error rates specific to each source.

### Open Question 4
- Question: How should the optimal tree depth and branching factor parameters scale with topic complexity and data availability?
- Basis in paper: [inferred] The paper fixes max_depth=5 and max_branches=5 across all experiments; no analysis is provided on how these hyperparameters affect representation capacity or computational cost for heterogeneous topics.
- Why unresolved: Complex topics (e.g., intersectional social issues) may require deeper hierarchies, while data-sparse topics may suffer from over-fragmentation with excessive branching.
- What evidence would resolve it: Systematic hyperparameter sweeps across topics of varying complexity, reporting alignment errors, consistency scores, and coverage rates for each configuration.

## Limitations

- The framework relies heavily on LLM world knowledge, which can hallucinate conditional probabilities for niche topics lacking training distribution coverage
- Grounding mechanism depends on WVS data completeness; emerging topics may require extensive synthetic agent generation
- Fixed tree depth of 5 constrains joint distribution complexity and may miss higher-order attribute interactions
- PACE evaluation framework lacks external validation against established sociological consistency metrics

## Confidence

- High Confidence (8-10/10): Population alignment improvements (37.7% error reduction) - directly measured through JSD/KL/DivErr metrics with clear baselines
- Medium Confidence (5-7/10): Sociological consistency gains (18.8% improvement) - evaluated through LLM-as-judge on ArchRel/IndCon, which introduces rater reliability concerns
- Low Confidence (1-4/10): Mechanism generalizability - the hierarchical conditional modeling assumes WKM's world knowledge quality without systematic validation across diverse topic domains

## Next Checks

1. **Cross-LLM Consistency Test**: Replace the WKM component with alternative LLMs (GPT-4, DeepSeek-V3, Claude) on the same Bluesky topics where Gemini failed. Compare resulting tree structures and generated populations to identify knowledge gaps and hallucination patterns. A consistent improvement across all models would strengthen the hierarchical approach claim.

2. **Grounding Coverage Analysis**: Systematically measure the proportion of HIT vs. MISS nodes across the full spectrum of WVS demographics. Calculate the synthetic agent ratio required for different topic categories (established vs. emerging) and assess the correlation between MISS-node prevalence and sociological consistency scores.

3. **Distribution Reconstruction Validation**: For a subset of WVS survey topics, use HAG to reconstruct the exact demographic distributions that generated the survey data. Compare the reconstructed vs. original joint distributions using multivariate tests (e.g., Chi-square for categorical, Kolmogorov-Smirnov for continuous) to validate the tree's ability to capture known sociological relationships.