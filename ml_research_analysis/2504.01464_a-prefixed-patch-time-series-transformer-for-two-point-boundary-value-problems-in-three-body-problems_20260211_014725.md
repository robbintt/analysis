---
ver: rpa2
title: A Prefixed Patch Time Series Transformer for Two-Point Boundary Value Problems
  in Three-Body Problems
arxiv_id: '2504.01464'
source_url: https://arxiv.org/abs/2504.01464
tags:
- figure
- trajectories
- trajectory
- time
- page
- transformers
- self-attention
- retrieval-augmented-generation
- instruction-tuning
- parameter-efficient-finetuning
- mixture-of-experts
- chain-of-thought
core_contribution: This study proposed a prefixed PatchTST model for solving two-point
  boundary value problems in three-body dynamics. The approach uses prefix tokens
  representing initial and terminal conditions to generate trajectories connecting
  specified boundary points.
---

# A Prefixed Patch Time Series Transformer for Two-Point Boundary Value Problems in Three-Body Problems

## Quick Facts
- arXiv ID: 2504.01464
- Source URL: https://arxiv.org/abs/2504.01464
- Reference count: 37
- Proposed prefixed PatchTST model achieves position errors below approximately 10,000 km for two-point boundary value problems in three-body dynamics

## Executive Summary
This paper presents a prefixed Patch Time Series Transformer (PatchTST) for generating trajectories that satisfy two-point boundary conditions in the Circular Restricted Three-Body Problem (CR3BP), specifically for cislunar mission design. The approach uses prefix tokens encoding initial and terminal positions to condition the transformer's generation of trajectories connecting specified boundary points. The model is trained on forward-propagated trajectory data rather than solving boundary value problems directly, demonstrating capability to generate trajectories for various mission scenarios including escape orbits via Lagrange points, Earth flybys, and multi-revolution orbits.

## Method Summary
The method involves generating a dataset of 3,000 CR3BP trajectories through forward numerical integration from lunar flyby conditions with different escape velocities (1.2, 1.3, 1.4 km/s). The Prefixed PatchTST architecture segments the 512-step context into 16 patches of 32 timesteps each, using prefix tokens for initial and terminal positions that bypass the standard input embedding layer. The model is trained to predict trajectory evolution while being conditioned by these boundary constraints. At inference, given arbitrary boundary conditions, the model generates trajectories connecting the specified points through iterative prediction.

## Key Results
- Position errors below approximately 10,000 km across 100 test trajectories
- z-component errors frequently achieving near-zero values due to z=0 training data constraint
- Model captures overall trajectory trends despite intermittent zigzag fluctuations
- Demonstrated capability for various mission scenarios including escape orbits, Earth flybys, and multi-revolution orbits

## Why This Works (Mechanism)

### Mechanism 1: Prefix Token Conditioning for Boundary Constraints
Prefix tokens encoding initial and terminal positions enable the transformer to generate trajectories satisfying two-point boundary conditions without explicitly solving the BVP. These tokens bypass the input embedding layer and connect directly to the Transformer Encoder with only positional encoding, injecting boundary constraints at the earliest attention layers and conditioning all subsequent trajectory patches.

### Mechanism 2: Patch-Based Segmentation for Long-Range Dependencies
Segmenting trajectory time series into patches enables tractable attention computation over 90-day horizons while preserving temporal resolution. Rather than attending to individual timesteps (17,984 forecast steps), the model segments the 512-step context into patches of 32 timesteps each, producing 16 patch tokens. This reduces computational complexity while maintaining sufficient information for accurate trajectory continuation.

### Mechanism 3: Indirect BVP Learning via Forward Propagation Training
Training exclusively on forward-propagated trajectories teaches the model trajectory dynamics, which prefix conditioning then exploits to generate BVP solutions at inference time. The model learns from CR3BP forward integration data but generates solutions satisfying arbitrary boundary conditions through prefix token conditioning, creating an implicit mapping between boundaries and feasible trajectories.

## Foundational Learning

- **Concept: Circular Restricted Three-Body Problem (CR3BP)**
  - Why needed here: The paper operates entirely within CR3BP dynamics, which lack closed-form solutions and exhibit chaotic sensitivity, making ML approaches valuable for trajectory design.
  - Quick check question: Why does Lambert's problem (two-body) fail for cislunar trajectory design, and what does this imply about the difficulty of solving BVPs in three-body systems?

- **Concept: Transformer Self-Attention**
  - Why needed here: The PatchTST architecture relies on attention to determine which trajectory segments influence future predictions, critical for understanding model behavior and debugging performance.
  - Quick check question: If attention weights were uniformly distributed across all patches vs. concentrated on recent patches, what would this suggest about how the model captures orbital dynamics?

- **Concept: Two-Point Boundary Value Problems**
  - Why needed here: The core task is connecting specified initial and terminal states—a fundamentally different objective than forward prediction, especially challenging in chaotic three-body dynamics.
  - Quick check question: Given the chaotic nature of three-body dynamics, why is solving BVPs for 90-day trajectories computationally challenging using traditional methods?

## Architecture Onboarding

- **Component map:**
  - Back-propagate from lunar flyby → Generate 512-step initial context
  - Extract prefix tokens (initial + terminal 3D positions) → Bypass input embedding
  - Segment context into patches (16 patches of 32 timesteps) → Embed and add positional encoding
  - Prepend prefix tokens with positional encoding only → Process through transformer encoder
  - Generate trajectory iteratively, feeding predictions back → Compute MSE loss on predictions

- **Critical path:**
  1. Back-propagate from lunar flyby to generate 512-step initial context (Earth-approaching trajectory)
  2. Extract prefix tokens: initial position (from context start) + terminal position (target endpoint)
  3. Segment context into patches, embed, add positional encoding
  4. Prepend prefix tokens (with positional encoding only, no embedding)
  5. Process through transformer encoder
  6. Generate trajectory iteratively, feeding predictions back into context window
  7. Compute MSE loss on position/velocity predictions

- **Design tradeoffs:**
  - **Patch length 32**: Hyperparameter search found this optimal; larger patches lose flyby detail, smaller patches increase computation
  - **Context length 512**: Set for Earth-Moon transfer duration; insufficient context may miss approach trajectory characteristics
  - **Training set size (3,000)**: Limited; paper explicitly attributes intermittent fluctuations to finite training data
  - **z=0 training data**: Explains near-zero z-errors but limits true 3D generalization capability

- **Failure signatures:**
  - **Intermittent zigzag fluctuations**: Generated trajectories oscillate locally while capturing global trends; attributed to finite training data and transformer representation limits
  - **Earth flyby prediction errors**: High sensitivity of hyperbolic approach trajectories causes degraded accuracy (explicitly noted in Earth flyby cases)
  - **Widening confidence intervals**: 95% error bounds grow over 90-day horizon, indicating compounding uncertainty
  - **Position errors ~10,000 km**: Reasonable for preliminary design but too coarse for operational use

- **First 3 experiments:**
  1. **Reproduce single V∞ condition**: Train on V∞=1.3 km/s only; verify ~10,000 km position error benchmark is reproducible
  2. **Ablate prefix conditioning**: Train standard PatchTST without prefix tokens; quantify degradation in boundary condition satisfaction
  3. **Patch length sensitivity**: Test patch lengths {4, 16, 32, 64}; measure accuracy vs. flyby detail capture in generated trajectories

## Open Questions the Paper Calls Out

### Open Question 1
- Question: Can architectural modifications or physics-informed constraints eliminate the intermittent fluctuations to ensure generated trajectories are dynamically feasible?
- Basis in paper: The authors note that the "occurrence of these oscillations suggests that the model may benefit from additional training data or architectural modifications."
- Why unresolved: The current model produces "zigzag" trajectories that capture global trends but are locally dynamically unrealistic.
- What evidence would resolve it: A model variation that generates smooth trajectories satisfying energy conservation laws without post-processing smoothing.

### Open Question 2
- Question: Does using the Prefixed PatchTST output as an initial guess significantly reduce the computational cost of numerical optimization solvers?
- Basis in paper: The paper claims the trajectory is "usable as an initial predicted trajectory for trajectory optimization," but does not quantify this utility.
- Why unresolved: The practical benefit of this method as a pre-processor for traditional solvers is asserted but not benchmarked against standard cold-start methods.
- What evidence would resolve it: Comparative analysis of convergence iterations and time for optimizers using PatchTST guesses versus random or analytical guesses.

### Open Question 3
- Question: How does model accuracy degrade when generalizing to full three-dimensional trajectories where the z-component is non-zero?
- Basis in paper: The paper acknowledges that near-zero z-errors resulted because the "training data... only has a z = 0," implying performance on 3D data is unverified.
- Why unresolved: The model's ability to handle the full complexity of the Circular Restricted Three-Body Problem (CR3BP) is masked by the planar nature of the training set.
- What evidence would resolve it: Evaluation of position and velocity errors on a dataset containing out-of-plane motion.

## Limitations

- Intermittent zigzag fluctuations in generated trajectories indicate the model has not fully captured underlying dynamical structure, limiting direct usability for operational trajectory planning
- z=0 constraint on training data significantly limits the model's ability to handle full three-dimensional three-body dynamics
- Limited training set size (3,000 trajectories) appears insufficient for capturing the full complexity of chaotic three-body dynamics

## Confidence

**High confidence:**
- The prefixed PatchTST architecture can generate trajectories connecting specified boundary points with position errors below ~10,000 km
- The model successfully captures overall trajectory trends despite intermittent local fluctuations
- Prefix conditioning enables boundary constraint satisfaction without explicit BVP solving

**Medium confidence:**
- The model is suitable for preliminary trajectory design in cislunar missions (given the ~10,000 km accuracy threshold)
- Patch-based segmentation effectively balances computational tractability with temporal resolution for 90-day horizons
- Forward-propagation training adequately covers the space of feasible BVP solutions

**Low confidence:**
- The approach generalizes to arbitrary three-body boundary value problems beyond the specific Earth-Moon CR3BP configuration tested
- The model can handle trajectories requiring significant out-of-plane motion (given z=0 training constraint)
- The indirect BVP learning mechanism will scale to more complex multi-body scenarios

## Next Checks

1. **Boundary condition feasibility analysis**: Systematically test the model on increasingly difficult boundary pairs, including those with known infeasibility, to quantify the limits of the indirect BVP learning approach and identify failure modes.

2. **Prefix token dimension sensitivity**: Conduct controlled experiments varying the dimensional mapping of prefix tokens (single vs. multiple tokens, different embedding sizes) to isolate the impact of this architectural choice on boundary condition satisfaction accuracy.

3. **Three-dimensional generalization test**: Train and evaluate the model on trajectories with non-zero z-components to assess the true 3D capability and quantify degradation when removing the z=0 constraint from training data.