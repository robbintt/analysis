---
ver: rpa2
title: 'MC3G: Model Agnostic Causally Constrained Counterfactual Generation'
arxiv_id: '2508.17221'
source_url: https://arxiv.org/abs/2508.17221
tags:
- mc3g
- counterfactual
- cost
- causal
- state
- transformers
- self-attention
- retrieval-augmented-generation
- instruction-tuning
- parameter-efficient-finetuning
- mixture-of-experts
- chain-of-thought
core_contribution: This paper addresses the challenge of generating counterfactual
  explanations for black-box models while respecting causal dependencies and maintaining
  model privacy. The proposed Model-Agnostic Causally Constrained Counterfactual Generation
  (MC3G) framework approximates any black-box model using an explainable rule-based
  surrogate (FOLD-SE), then employs Answer Set Programming to generate counterfactuals
  that adhere to causal constraints.
---

# MC3G: Model Agnostic Causally Constrained Counterfactual Generation

## Quick Facts
- arXiv ID: 2508.17221
- Source URL: https://arxiv.org/abs/2508.17221
- Authors: Sopam Dasgupta; Sadaf MD Halim; Joaquín Arias; Elmer Salazar; Gopal Gupta
- Reference count: 4
- One-line primary result: MC3G generates 100% causally compliant counterfactuals with significantly lower costs than C3G, achieving 0.907 average L1 distance vs 1.296 on Adult dataset.

## Executive Summary
MC3G addresses the challenge of generating counterfactual explanations for black-box models while respecting causal dependencies and maintaining model privacy. The framework approximates any black-box model using an explainable rule-based surrogate (FOLD-SE), then employs Answer Set Programming to generate counterfactuals that adhere to causal constraints. A key innovation is MC3G's refined cost computation that distinguishes between user-initiated feature changes and automatic adjustments caused by causal dependencies, assigning zero cost to the latter. Experiments demonstrate that MC3G produces 100% causally compliant counterfactuals on Adult and German Credit datasets, outperforming methods like Borderline-CF, DiCE, and MACE.

## Method Summary
MC3G is a model-agnostic framework that generates causally compliant counterfactuals for black-box classifiers. It works by first approximating the black-box model with a rule-based surrogate (FOLD-SE) learned from input-output predictions. The framework then uses Answer Set Programming with s(CASP) to search for counterfactuals that satisfy both the decision rules and causal constraints. The key innovation is a refined cost computation that assigns zero cost to features automatically changed by causal propagation, focusing the cost metric only on user-initiated interventions. This approach ensures explanations are both causally valid and practically actionable while preserving model confidentiality.

## Key Results
- Achieves 100% causally compliant counterfactuals on Adult and German Credit datasets
- Average L1 distance of 0.907 vs C3G's 1.296 on Adult dataset
- Outperforms baseline methods (Borderline-CF, DiCE, MACE) in causal compliance rate
- Successfully handles both model-agnostic approximation and causal constraint satisfaction

## Why This Works (Mechanism)

### Mechanism 1: Rule-Based Surrogate Approximation
- Claim: Black-box models can be approximated by explainable rule-based surrogates without revealing proprietary internals.
- Mechanism: FOLD-SE learns a stratified logic program from the black-box model's input-output predictions (not parameters), creating decision rules that approximate classification boundaries. The surrogate replaces gradient access with symbolic rules.
- Core assumption: The black-box model's decision boundary can be captured by a compact rule-based representation with sufficient fidelity for counterfactual search.
- Evidence anchors:
  - [abstract] "MC3G is model-agnostic: it approximates any black-box model using an explainable rule-based surrogate model (FOLD-SE)"
  - [section 4.2.2] "If M is statistical then V ← predict(M(H))... R ← train(R(H, V))... Q ← R"
  - [corpus] Related work (MASCOTS, RealAC) confirms model-agnostic surrogates are an active research direction, but no direct validation of FOLD-SE fidelity metrics.
- Break condition: If the black-box model has highly non-linear decision boundaries that cannot be approximated by conjunctive rules, surrogate fidelity degrades and counterfactuals may not flip the original model's prediction.

### Mechanism 2: Causal Cost Zeroing
- Claim: Assigning zero cost to causally-induced feature changes yields more actionable recourse recommendations.
- Mechanism: The `is_counterfactual` algorithm (Algorithm 3) detects features altered by causal propagation and sets their weights to 0 before computing Lp distance. Only direct user interventions contribute to cost.
- Core assumption: Causal rules correctly capture real-world dependencies; zero-weighting downstream effects accurately reflects user effort.
- Evidence anchors:
  - [abstract] "refines cost computation by distinguishing between user-initiated feature changes and automatic adjustments caused by causal dependencies, assigning zero cost to the latter"
  - [section 3.3] "MC3G's Refined Cost Computation distinguishes between direct interventions and causal effects. It excludes automatic changes due to causal effects from the cost computation."
  - [corpus] Weak corpus evidence—related papers (C3G, RealAC) discuss causality but not this specific zero-cost mechanism.
- Break condition: If causal rules are incomplete or misspecify direction, either (a) free changes are incorrectly penalized, or (b) impossible changes are treated as free, producing infeasible recommendations.

### Mechanism 3: ASP-Based Bidirectional Reasoning
- Claim: Answer Set Programming with s(CASP) enables causally constrained counterfactual search without explicit state enumeration.
- Mechanism: s(CASP) performs goal-directed, query-driven execution with program completion, transforming rules into bidirectional implications. This allows backward chaining from desired outcomes while enforcing causal constraints.
- Core assumption: The causal and decision rules form a stratified logic program with a tractable answer set.
- Evidence anchors:
  - [section 2.4] "s(CASP)... employs program completion to transform 'if' rules into 'if and only if' rules, enabling bidirectional reasoning and the simulation of causal interventions"
  - [section 3.2] "In ASP terms... ?- not reject_loan(g). — succeeds"
  - [corpus] CoGS (arXiv 2502.09226) uses similar ASP-based counterfactual generation, providing indirect support for the approach.
- Break condition: If rules introduce cycles or exponential branching, search may not terminate or become computationally prohibitive.

## Foundational Learning

- Concept: **Answer Set Programming (ASP) basics**
  - Why needed here: MC3G encodes causal and decision rules as ASP programs; understanding declarative rule syntax and stable model semantics is prerequisite to modifying the system.
  - Quick check question: Given rules `a :- b, not c.` and `b :- a.`, what are the stable models?

- Concept: **Counterfactual Explanation Formalism**
  - Why needed here: The paper defines counterfactuals as CF_f(x) = {x̂ ∈ X | f(x) ≠ f(x̂)}; you must understand minimal intervention and proximity metrics (L0/L1/L2).
  - Quick check question: Why is L0 norm preferred for sparsity while L1 for magnitude?

- Concept: **Structural Causal Models (SCM)**
  - Why needed here: MC3G requires explicit causal rules as input; understanding interventions do(·) vs. observations is essential for authoring correct rules.
  - Quick check question: In a loan scenario, if income → credit_score, what is the effect of do(income=high) on credit_score?

## Architecture Onboarding

- Component map:
  - Black-box model (M) -> FOLD-SE surrogate (R) -> Rule-based approximator (Q) -> Causal rules (C) -> is_counterfactual validation -> compute_weighted_Lp cost computation -> s(CASP) engine

- Critical path: Surrogate quality → Rule correctness → Counterfactual validity
  1. If FOLD-SE produces low-fidelity rules, counterfactuals may not flip the original model.
  2. If causal rules are wrong, cost zeroing fails (see Mechanism 2 break conditions).
  3. If candidate set S is too small, optimal counterfactual may be missed.

- Design tradeoffs:
  - **Surrogate complexity vs. interpretability**: More rules improve fidelity but increase search space.
  - **Candidate enumeration vs. constraint solving**: Current approach iterates over S; ASP could generate candidates directly but may scale poorly.
  - **Norm choice (p=0/1/2)**: L0 yields sparse interventions; L1/L2 yield smaller magnitude changes.

- Failure signatures:
  - Counterfactual doesn't flip black-box prediction → Surrogate fidelity issue; validate surrogate accuracy on held-out data.
  - Counterfactual violates domain constraints → Causal rules incomplete; audit C.
  - No counterfactual found → Candidate set exhausted or rules too restrictive; expand S or relax constraints.
  - Cost unexpectedly high → Weight adjustment not triggered; debug is_counterfactual logic.

- First 3 experiments:
  1. **Surrogate fidelity test**: Train FOLD-SE on black-box predictions; measure accuracy on held-out set. Target: >90% agreement before proceeding.
  2. **Causal ablation**: Run MC3G with and without causal cost zeroing on Adult dataset; compare average L1 cost (paper reports 0.907 vs 1.296). Replicate to validate.
  3. **End-to-end validity check**: For 100 rejected loan applicants, generate counterfactuals via MC3G, apply changes to original features, query black-box. Target: 100% prediction flip rate.

## Open Questions the Paper Calls Out

### Open Question 1
- Question: How can MC3G be extended to generate causally consistent counterfactuals for non-tabular data, such as images?
- Basis in paper: [explicit] The conclusion states future work will focus on "extending the framework to handle non-tabular data, such as images."
- Why unresolved: The current methodology relies on FOLD-SE and Answer Set Programming, which are designed for discrete, tabular feature spaces rather than high-dimensional continuous data like pixels.
- What evidence would resolve it: A modified MC3G framework successfully generating low-cost, causally compliant counterfactuals for a standard image classification benchmark.

### Open Question 2
- Question: Can the search space strategy be optimized to lower the computational cost of MC3G to compete with gradient-based methods?
- Basis in paper: [explicit] The authors acknowledge MC3G "currently incurs a higher computational cost" and propose optimizing the search space as future work.
- Why unresolved: The declarative nature of ASP and the requirement to check causal consistency for candidate states creates significant overhead compared to optimization-based counterfactual methods.
- What evidence would resolve it: A comparative analysis showing an optimized MC3G achieves runtime parity with methods like DiCE on large datasets without sacrificing causal compliance.

### Open Question 3
- Question: How does the fidelity of the FOLD-SE surrogate model impact the validity of the generated counterfactuals on the original black-box model?
- Basis in paper: [inferred] The framework assumes the surrogate model accurately mimics the black box, but the paper does not analyze performance degradation when the surrogate is an imperfect approximation.
- Why unresolved: If the rule-based surrogate diverges from the black-box decision boundary, the generated counterfactuals might fail to flip the original model's prediction (invalid recourse).
- What evidence would resolve it: Experiments correlating varying levels of surrogate fidelity with the "validity rate" of the final counterfactuals on the black-box model.

## Limitations
- **Unknown causal rules**: Complete causal rule sets for Adult and German Credit datasets are not specified, hindering reproducibility
- **Unspecified surrogate hyperparameters**: FOLD-SE training procedure, candidate state generation, and feature preprocessing remain undefined
- **Computational overhead**: ASP-based search incurs higher computational cost compared to gradient-based methods

## Confidence

- **High Confidence**: The causal cost zeroing mechanism and its theoretical justification (assigning zero cost to causally-induced changes) are well-specified and validated through experimental results showing 0.907 vs 1.296 average L1 distance on Adult dataset.
- **Medium Confidence**: The FOLD-SE surrogate approximation approach is supported by related work on model-agnostic surrogates, but lacks direct validation metrics in this paper.
- **Low Confidence**: Complete reproduction requires assumptions about unspecified components (causal rules, surrogate hyperparameters, preprocessing).

## Next Checks

1. **Surrogate Fidelity Validation**: Measure agreement rate between FOLD-SE surrogate and black-box model on held-out data before generating counterfactuals.
2. **Causal Rule Consistency Audit**: Test `is_causally_consistent` on known valid states to verify rule completeness and correctness.
3. **End-to-End Prediction Flip Test**: Apply generated counterfactuals to original features and verify 100% prediction flip rate on the black-box model.