---
ver: rpa2
title: How to Make Large Language Models Generate 100% Valid Molecules?
arxiv_id: '2509.23099'
source_url: https://arxiv.org/abs/2509.23099
tags:
- smiles
- molecule
- invalid
- llms
- selfies
- transformers
- self-attention
- retrieval-augmented-generation
- instruction-tuning
- parameter-efficient-finetuning
- mixture-of-experts
- chain-of-thought
core_contribution: This paper tackles the challenge of generating valid molecules
  using large language models (LLMs), which often struggle with strict syntax rules
  in representations like SMILES. The authors propose SmiSelf, a cross-chemical language
  framework that converts invalid SMILES strings into SELFIES and back, leveraging
  SELFIES' inherent robustness to correct errors.
---

# How to Make Large Language Models Generate 100% Valid Molecules?

## Quick Facts
- arXiv ID: 2509.23099
- Source URL: https://arxiv.org/abs/2509.23099
- Reference count: 26
- Primary result: 100% validity in molecule generation while preserving molecular characteristics

## Executive Summary
This paper addresses the fundamental challenge of generating chemically valid molecules using large language models (LLMs), which struggle with the strict syntax rules of SMILES notation. The authors introduce SmiSelf, a cross-chemical language framework that leverages the robustness of SELFIES to correct SMILES syntax errors. By converting between these two molecular representations, the framework achieves perfect validity rates while maintaining or improving performance on other evaluation metrics like BLEU, Levenshtein, and fingerprint similarity scores. The method demonstrates broad compatibility with existing SMILES-based generative models and expands the practical applications of LLMs in biomedical research.

## Method Summary
SmiSelf operates through a dual-conversion framework that maps SMILES strings to SELFIES and back. SELFIES, being a robust molecular representation language, inherently tolerates syntax errors and ensures valid molecular structures. The framework first converts invalid SMILES generated by LLMs into SELFIES, then back to SMILES, effectively "correcting" syntax errors while preserving molecular characteristics. This cross-representation approach leverages the complementary strengths of both notations - SMILES for human readability and compact representation, and SELFIES for error tolerance and guaranteed validity. The method is designed to be compatible with any SMILES-based generative model without requiring architectural modifications.

## Key Results
- Achieves 100% validity in generated molecules compared to significantly lower rates in baseline SMILES-only approaches
- Maintains or improves performance on BLEU, Levenshtein, and fingerprint similarity metrics
- Demonstrates compatibility across multiple LLM architectures (LLaMA, Vicuna) and varying token limits

## Why This Works (Mechanism)
The framework exploits the fundamental difference in error tolerance between SMILES and SELFIES representations. SMILES strings are highly sensitive to syntax errors - a single misplaced character can render an entire molecule invalid. In contrast, SELFIES uses a grammar-based approach that inherently prevents invalid molecular structures. By converting problematic SMILES into SELFIES, the framework leverages SELFIES' built-in validation to correct errors, then maps back to SMILES format. This conversion process acts as a validation and correction layer that ensures only chemically valid molecules pass through, effectively turning a problematic generation task into a robust representation translation problem.

## Foundational Learning
**SMILES notation**: A linear text-based representation of molecular structures using atom symbols and bond indicators. Needed because it's the standard input format for most molecular generative models. Quick check: Verify that basic molecules like "CCO" correctly represent ethanol.

**SELFIES representation**: A semantic, robust molecular string representation that guarantees valid molecules through a context-free grammar. Needed because it provides error tolerance that SMILES lacks. Quick check: Confirm that SELFIES strings always decode to valid molecules regardless of character modifications.

**Cross-representation conversion**: The process of translating between SMILES and SELFIES formats. Needed because it enables error correction through SELFIES' robustness while maintaining compatibility with SMILES-based models. Quick check: Verify round-trip conversion preserves molecular structure.

**Molecular similarity metrics**: Quantitative measures (BLEU, Levenshtein, fingerprint similarity) that assess how closely generated molecules match target structures. Needed because they provide objective evaluation beyond simple validity. Quick check: Confirm that similar molecules have high similarity scores across all metrics.

## Architecture Onboarding

**Component Map**: LLM Generator -> Invalid SMILES -> SmiSelf Converter -> SELFIES -> Valid SMILES -> Output

**Critical Path**: The LLM generates SMILES strings → SmiSelf converts to SELFIES → Error correction occurs inherently → Conversion back to SMILES → Valid molecule output. The critical performance bottleneck is the conversion speed between representations.

**Design Tradeoffs**: 
- *Generality vs. performance*: SmiSelf works with any SMILES-based model but adds computational overhead
- *Exactness vs. validity*: The conversion may produce chemically similar but not identical molecules to original SMILES
- *Complexity vs. robustness*: Adds representation conversion complexity but guarantees validity

**Failure Signatures**: 
- Conversion loss between SMILES and SELFIES representations
- Performance degradation on highly specific molecular properties
- Computational overhead from dual conversion process

**First Experiments**:
1. Test basic round-trip conversion with simple molecules (ethanol, benzene)
2. Evaluate validity rates on LLM-generated SMILES with varying levels of corruption
3. Benchmark similarity preservation across different molecular families

## Open Questions the Paper Calls Out
None

## Limitations
- The SMILES-to-SELFIES conversion is fundamentally lossy, potentially altering molecular identity
- Evaluation focuses on validity and similarity metrics rather than downstream task performance
- Claims about universal compatibility with all SMILES-based models are not exhaustively validated

## Confidence

**High confidence**: The 100% validity claim is technically sound given SELFIES' inherent properties and the conversion framework

**Medium confidence**: The preservation of molecular characteristics based on similarity metrics is reasonable but may not capture all chemically relevant properties

**Medium confidence**: Claims about compatibility with all SMILES-based models are plausible but not exhaustively validated across diverse model architectures

## Next Checks

1. Evaluate the method's impact on downstream molecular property prediction tasks to verify that similarity preservation translates to functional equivalence

2. Assess the synthetic accessibility and drug-likeness of molecules generated through SmiSelf compared to standard SMILES generation

3. Test the framework's performance across diverse LLM architectures (beyond LLaMA and Vicuna) and varying token limits to establish robustness bounds