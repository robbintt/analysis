---
ver: rpa2
title: 'CoFE: A Framework Generating Counterfactual ECG for Explainable Cardiac AI-Diagnostics'
arxiv_id: '2508.16033'
source_url: https://arxiv.org/abs/2508.16033
tags:
- cofe
- counterfactual
- ecgs
- framework
- potassium
- transformers
- self-attention
- retrieval-augmented-generation
- instruction-tuning
- parameter-efficient-finetuning
- mixture-of-experts
- chain-of-thought
core_contribution: The paper introduces CoFE, a framework that generates counterfactual
  ECGs to explain AI-based cardiac diagnostics by showing how changes in specific
  features influence model predictions. The method combines a pretrained StyleGAN2
  generator and encoder to synthesize and manipulate ECG signals in latent space,
  producing counterfactual examples alongside saliency maps.
---

# CoFE: A Framework Generating Counterfactual ECG for Explainable Cardiac AI-Diagnostics

## Quick Facts
- arXiv ID: 2508.16033
- Source URL: https://arxiv.org/abs/2508.16033
- Reference count: 14
- Primary result: Counterfactual ECGs show statistically significant clinically meaningful changes (p < 0.05) in features like P-wave amplitude and T-wave morphology when flipping model predictions.

## Executive Summary
CoFE is a framework that generates counterfactual ECGs to explain AI-based cardiac diagnostics by showing how changes in specific features influence model predictions. The method combines a pretrained StyleGAN2 generator and encoder to synthesize and manipulate ECG signals in latent space, producing counterfactual examples alongside saliency maps. Case studies on atrial fibrillation classification and potassium level regression demonstrate that the generated counterfactuals exhibit clinically meaningful changesâ€”reduced P-wave amplitude and increased RR variability for AF, and increased T-wave amplitude with prolonged QRS duration for hyperkalemia. Quantitative results show statistically significant shifts in these features (p < 0.05), aligning with clinical knowledge and confirming the model's reasoning is grounded in physiologically plausible patterns.

## Method Summary
CoFE uses a pretrained StyleGAN2 generator and encoder to project ECGs into latent space, where counterfactual optimization occurs via gradient descent on a prediction-flipping loss. The encoder maps input ECGs to latent vectors, which are then iteratively updated to shift the predictive model's output toward a target class while preserving signal plausibility through the generator's learned distribution. The framework generates counterfactual ECGs that are validated against clinical knowledge by measuring changes in physiologically relevant features like P-wave amplitude, RR variability, T-wave amplitude, and QRS duration.

## Key Results
- Counterfactual ECGs for AF classification show reduced P-wave amplitude (0.09â†’0.04 mV) and increased RR variability (46.17â†’85.44 ms), both p < 0.05.
- Counterfactual ECGs for potassium regression show increased T-wave amplitude (0.18â†’0.58 mV) and prolonged QRS duration (95.84â†’121.98 ms), both p < 0.05.
- Generated counterfactuals remain within the clinical data distribution due to StyleGAN2's training on 300k real ECGs.

## Why This Works (Mechanism)

### Mechanism 1
- Claim: Counterfactual ECGs are generated through latent-space gradient descent that shifts the predictive model's output toward a target class while preserving signal plausibility.
- Mechanism: The encoder maps input ECG x â†’ latent wâ‚€. Gradient descent minimizes L_cf(w) = CE(f(G(w)), Y_t), updating w iteratively. Because G is a StyleGAN2 generator trained on 300k real ECGs, synthesized signals remain within the clinical data distribution by construction.
- Core assumption: The StyleGAN2 latent space is sufficiently disentangled that targeted prediction shifts correspond to localized, interpretable morphological changes rather than distributed, uninterpretable perturbations.
- Evidence anchors:
  - [abstract] "combines a pretrained StyleGAN2 generator and encoder to synthesize and manipulate ECG signals in latent space"
  - [section 2.2] "ð‘¤_ð‘¡â‚Šâ‚ = ð‘¤_ð‘¡ âˆ’ ðœ‚ Â· âˆ‡ð‘¤_t L_cf(ð‘¤_ð‘¡)... the optimization occurs in the latent space of a pretrained generator, the resulting ECG remains a plausible sample"
  - [corpus] Related ECG synthesis papers (e.g., DiffuSETS, Simulator and Experience Enhanced Diffusion Model) use conditional generation but do not validate counterfactual plausibility via clinical feature alignmentâ€”corpus does not directly validate this specific latent-space mechanism.
- Break condition: If latent-space interpolation produces morphological artifacts (e.g., non-physiological waveform shapes, baseline wander unrelated to pathology), the assumption of disentanglement fails; counterfactuals would not be clinically interpretable.

### Mechanism 2
- Claim: Alignment between counterfactual feature changes and established clinical knowledge validates that the predictive model's reasoning is grounded in physiologically meaningful patterns.
- Mechanism: For AF classification, generated counterfactuals show reduced P-wave amplitude and increased RR variabilityâ€”both established AF hallmarks. For potassium regression, counterfactuals show increased T-wave amplitude and prolonged QRS durationâ€”consistent with hyperkalemia electrophysiology. Statistical significance (p < 0.05) of these shifts indicates systematic rather than random changes.
- Core assumption: The predictive model has learned the same features clinicians use; if the model relied on spurious correlations (e.g., lead artifacts, baseline noise), counterfactuals would modify non-physiological features.
- Evidence anchors:
  - [abstract] "reduced P-wave amplitude and increased RR variability for AF... increased T-wave amplitude with prolonged QRS duration for hyperkalemia"
  - [section 4.1] Table 1 shows quantitative shifts: P-wave 0.09â†’0.04 mV; RR variability 46.17â†’85.44 ms; T-wave 0.18â†’0.58 mV; QRS 95.84â†’121.98 ms; all p < 0.05
  - [corpus] Weak direct validationâ€”corpus papers focus on generation quality or biomarker discovery, not counterfactual-clinical knowledge alignment. Explicit gap in external validation.
- Break condition: If counterfactual feature changes contradicted clinical expectations (e.g., increased P-wave for AF, decreased T-wave for hyperkalemia), the model's learned representations would be misaligned with physiological mechanisms.

### Mechanism 3
- Claim: Combining counterfactual ECGs with saliency maps provides complementary spatial and causal explanations.
- Mechanism: Saliency maps highlight "where" the model attends (e.g., P-wave region for AF, T-wave for potassium). Counterfactuals show "how" modifying those regions changes predictions. Together, they confirm that attended regions are causally relevant, not just correlated.
- Core assumption: Saliency methods (e.g., GradCAM, Saliency Map) correctly identify discriminative regions; if saliency is noisy or misleading, the combined explanation would be inconsistent.
- Evidence anchors:
  - [abstract] "producing counterfactual examples alongside saliency maps"
  - [section 1] "these methods show where the AI-ECG is focusing; however, they are insufficient to explain how the predictions... change in response to changes in features"
  - [section 4.2] "saliency map highlights the P-wave region... counterfactual ECGs show a reduced P-wave amplitude... consistently push the model's prediction toward AF"
  - [corpus] No corpus papers directly evaluate saliency-counterfactual consistency; validation remains internal to this work.
- Break condition: If saliency highlights regions unaffected in counterfactuals (or vice versa), the two explanations would conflict, undermining combined interpretability.

## Foundational Learning

- Concept: StyleGAN2 architecture and latent space manipulation
  - Why needed here: CoFE relies on a pretrained StyleGAN2 generator; understanding how style-based generators organize latent space is prerequisite to interpreting counterfactual optimization dynamics.
  - Quick check question: Can you explain how StyleGAN2's style injection enables localized attribute control, and why a reconstruction-trained encoder is necessary for projecting clinical ECGs into this space?

- Concept: Counterfactual explanation theory
  - Why needed here: The framework generates "what-if" ECGs by optimizing for prediction flip; distinguishing valid counterfactuals from adversarial examples requires understanding sparsity, plausibility, and actionability constraints.
  - Quick check question: Given a counterfactual ECG that changes model prediction but introduces non-physiological artifacts, which constraint (sparsity, plausibility, or actionability) is violated, and how would you detect it?

- Concept: ECG electrophysiology fundamentals
  - Why needed here: Validating that counterfactuals are "clinically meaningful" requires knowledge of P-wave (atrial depolarization), QRS (ventricular depolarization), T-wave (repolarization), and RR variability (rhythm regularity).
  - Quick check question: For an AF counterfactual, would you expect PR interval to lengthen, shorten, or become undefined? Why? How does this relate to the observed P-wave amplitude reduction?

## Architecture Onboarding

- Component map: ECG -> Encoder -> latent wâ‚€ -> Generator -> reconstruction xÌƒâ‚€ -> counterfactual loop -> w_N -> Generator -> counterfactual ECG xÌƒ_N

- Critical path:
  1. Input ECG â†’ Encoder â†’ latent wâ‚€
  2. wâ‚€ â†’ Generator â†’ reconstruction xÌƒâ‚€ (sanity check: â€–x âˆ’ xÌƒâ‚€â€– low)
  3. Initialize counterfactual loop: for N iterations, compute âˆ‡_w L_cf, update w
  4. Final w_N â†’ Generator â†’ counterfactual ECG xÌƒ_N
  5. Compare x vs. xÌƒ_N with saliency overlay; extract feature deltas (P-wave, RR, T-wave, QRS)

- Design tradeoffs:
  - Latent-space vs. input-space optimization: Latent-space constrains plausibility (G's training distribution) but may limit edit granularity; input-space offers finer control but risks out-of-distribution artifacts.
  - Fixed vs. fine-tuned generator: Fixed G ensures stable latent semantics; fine-tuning could improve reconstruction fidelity but may shift learned representations unpredictably.
  - Number of optimization steps N: More iterations yield larger prediction shifts but risk semantic drift (cumulative minor artifacts compounding into major distortions).

- Failure signatures:
  - Reconstruction failure: High â€–x âˆ’ G(E(x))â€– indicates encoder fails to capture patient-specific morphology; counterfactuals will not preserve relevant context.
  - Implausible counterfactuals: Generated ECGs with non-physiological waveforms (e.g., negative P-waves in leads where they should be positive, QRS morphology inconsistent with lead configuration) suggest latent-space disentanglement is insufficient.
  - No prediction shift after many iterations: Optimizer stuck in local minimum or learning rate too low; check gradient magnitudes and prediction trajectory.
  - Feature changes inconsistent with target pathology: If AF counterfactuals increase P-wave amplitude or decrease RR variability, model has learned spurious features or optimization is misconfigured.

- First 3 experiments:
  1. **Reconstruction fidelity baseline**: Encode 100 held-out ECGs, reconstruct via G(E(x)), compute mean squared error and visual inspection of waveform fidelity. Accept if reconstruction preserves P-wave, QRS, T-wave morphology within clinical tolerance (e.g., <5% amplitude deviation).
  2. **Counterfactual plausibility validation**: Generate counterfactuals for 50 AF and 50 hyperkalemia cases, have a clinical annotator (blinded to generation method) rate physiological plausibility on 1â€“5 scale. Target: median â‰¥4, no examples rated 1â€“2 without identifiable artifact explanation.
  3. **Feature-statistic alignment test**: For each counterfactual pair (original, counterfactual), compute P-wave amplitude, RR variability, T-wave amplitude, QRS duration. Run paired t-tests for each feature; verify p < 0.05 and effect size direction matches clinical expectation. Flag any feature with non-significant or reversed change for further model investigation.

## Open Questions the Paper Calls Out
No open questions are explicitly called out in the paper.

## Limitations
- External validation of counterfactual-clinical knowledge alignment is weak; no independent clinical expert assessment or cross-database evaluation.
- Counterfactual optimization hyperparameters (learning rate, iterations) are unspecified, limiting reproducibility and robustness assessment.
- No ablation study on StyleGAN2 vs. alternative generators (e.g., diffusion models) to isolate the impact of the chosen architecture.

## Confidence
- **High Confidence**: The method's technical feasibility (StyleGAN2 + encoder + gradient-based counterfactuals) is well-supported by the described architecture and reconstruction checks.
- **Medium Confidence**: Clinical plausibility of counterfactuals (e.g., P-wave reduction for AF) is plausible but relies on internal validation without external expert review.
- **Low Confidence**: Claims about saliency-counterfactual consistency lack quantitative validation; qualitative alignment is asserted but not statistically tested.

## Next Checks
1. **Expert Clinical Review**: Have 3 independent cardiologists rate 20 counterfactual ECGs for physiological plausibility and clinical consistency; require â‰¥70% agreement with ground-truth pathology.
2. **Cross-Database Generalization**: Generate counterfactuals for ECGs from an independent dataset (e.g., PTB Diagnostic Database) and test if feature shifts align with target pathology.
3. **Ablation on Generator Architecture**: Replace StyleGAN2 with a conditional diffusion model and compare counterfactual plausibility, reconstruction fidelity, and prediction shift consistency.