---
ver: rpa2
title: 'OptAgent: Optimizing Query Rewriting for E-commerce via Multi-Agent Simulation'
arxiv_id: '2510.03771'
source_url: https://arxiv.org/abs/2510.03771
tags:
- query
- arxiv
- queries
- preprint
- product
- transformers
- self-attention
- retrieval-augmented-generation
- instruction-tuning
- parameter-efficient-finetuning
- mixture-of-experts
- chain-of-thought
core_contribution: This paper introduces OPTAGENT, a framework that optimizes query
  rewriting for e-commerce using multi-agent simulations and genetic algorithms. Instead
  of relying on a single LLM judge or static reward models, OPTAGENT uses multiple
  LLM agents with varied temperatures to simulate shopping behavior and evaluate rewritten
  queries.
---

# OptAgent: Optimizing Query Rewriting for E-commerce via Multi-Agent Simulation

## Quick Facts
- arXiv ID: 2510.03771
- Source URL: https://arxiv.org/abs/2510.03771
- Reference count: 40
- Primary result: Improves query relevance by 21.98% over original and 3.36% over Best-of-N baseline using multi-agent simulation

## Executive Summary
OPTAGENT introduces a novel framework for optimizing query rewriting in e-commerce without requiring historical interaction data. The system uses multiple LLM agents with varied temperatures to simulate shopping behavior and evaluate rewritten queries, forming a fitness function for a genetic algorithm that iteratively refines user queries. Tested on 1000 real-world Etsy queries, OPTAGENT achieves 21.98% improvement in query relevance over the original query and 3.36% over a Best-of-N LLM baseline, with particularly strong performance on tail queries (4.50% gain). The approach is especially effective for infrequent, ambiguous queries and provides a scalable method for optimizing subjective outputs.

## Method Summary
OPTAGENT uses a genetic algorithm where query fitness is evaluated by multiple LLM agents simulating shopping behavior. Five agents with temperatures {0.00, 0.25, 0.50, 0.75, 1.00} classify products from search results as "Fully Relevant," "Partially Relevant," or "Irrelevant," and make simulated purchase decisions. The fitness function combines semantic scores (0.5×s_10 + 0.4×s_a) with normalized purchase value (0.1×n). The genetic algorithm iteratively refines queries through elitism selection (60% top performers), crossover (LLM combines two parent queries), and mutation (LLM makes small alterations) over 4 generations with population size N=5. The framework is tested on 1000 Etsy queries across 5 categories using Gemini-2.5-Flash.

## Key Results
- 21.98% improvement in query relevance over original user queries
- 3.36% improvement over Best-of-N LLM baseline
- 4.50% improvement on tail queries compared to baseline

## Why This Works (Mechanism)
OPTAGENT works by leveraging multiple simulated agents with varied behaviors to evaluate query rewrites, capturing diverse shopping preferences that single-judge systems miss. The genetic algorithm efficiently explores the space of possible rewrites through iterative refinement, with multi-agent feedback providing robust fitness evaluation that's more representative of real user diversity than static reward models. This approach is particularly effective for tail queries where traditional methods struggle due to limited historical data.

## Foundational Learning
- **Multi-agent simulation**: Using multiple LLM agents with different temperatures to simulate diverse user behaviors and preferences; needed because real users have varied shopping styles, quick check is whether different agents produce significantly different purchase decisions
- **Genetic algorithm optimization**: Evolutionary approach to iteratively improve queries through selection, crossover, and mutation; needed because direct optimization is intractable for subjective outputs, quick check is whether fitness scores improve over generations
- **Semantic relevance scoring**: Classifying products into relevance categories to measure query effectiveness; needed because purchase behavior alone doesn't capture all aspects of query quality, quick check is whether semantic scores correlate with actual purchase likelihood
- **Fitness function design**: Combining semantic relevance with purchase simulation weighted at 0.5, 0.4, and 0.1; needed because both aspects contribute to query quality but require different weights, quick check is whether the chosen weights produce optimal results
- **Query rewriting diversity**: Generating multiple candidate rewrites rather than single-best approach; needed because initial user queries are often suboptimal and diverse candidates help find better formulations, quick check is whether diverse initial population leads to better final results

## Architecture Onboarding

**Component Map:**
Product Search -> Multi-Agent Evaluator -> Fitness Function -> Genetic Algorithm -> Optimized Query

**Critical Path:**
User Query → Product Search (retrieve first page) → Multi-Agent Evaluation (5 agents classify products) → Fitness Calculation → Genetic Algorithm (4 generations) → Final Optimized Query

**Design Tradeoffs:**
- Multi-agent vs single-judge: Multi-agent provides more robust evaluation but increases computation cost
- Temperature diversity: Varied temperatures capture different user behaviors but may introduce inconsistency
- Genetic algorithm parameters: Small population (N=5) and few generations (G=4) balance speed with quality
- Semantic vs purchase weighting: 0.5/0.4/0.1 split prioritizes relevance over purchase simulation

**Failure Signatures:**
- Position bias: Agents strongly prefer top-ranked products regardless of relevance
- Hidden attribute failure: Agents cannot access interactive elements like color dropdowns
- Temperature insensitivity: Agents produce similar outputs across temperature settings
- Semantic score inflation: Top results receive artificially high relevance scores

**First Experiments:**
1. Run 3 generations with N=3 agents to verify convergence behavior
2. Test single-agent vs multi-agent fitness consistency on 50 queries
3. Compare crossover vs mutation effectiveness in query improvement

## Open Questions the Paper Calls Out
None

## Limitations
- Fitness function purchase simulation lacks empirical grounding for the 5% purchase probability
- Temperature-based agent diversity lacks theoretical justification for specific values
- Evaluation depends entirely on synthetic agent behavior rather than actual user interaction data
- Limited generalizability to non-Etsy e-commerce domains without further testing

## Confidence
- **High confidence**: Query relevance improvements over baselines (21.98% vs original, 3.36% vs BoN)
- **Medium confidence**: Tail query performance gains (4.50% over baseline)
- **Medium confidence**: Multi-agent simulation effectiveness
- **Low confidence**: Purchase simulation validity

## Next Checks
1. Deploy the system on a live e-commerce platform and measure click-through and conversion rates for rewritten vs original queries over a 2-week period
2. Conduct A/B testing comparing OPTAGENT's rewritten queries against human-curated rewrites from merchandisers
3. Test the approach across multiple e-commerce domains (fashion, electronics, home goods) to assess generalizability beyond the Etsy dataset