---
ver: rpa2
title: Counterfactually Fair Conformal Prediction
arxiv_id: '2510.08724'
source_url: https://arxiv.org/abs/2510.08724
tags:
- counterfactual
- prediction
- fairness
- sets
- cf-cp
- transformers
- self-attention
- retrieval-augmented-generation
- instruction-tuning
- parameter-efficient-finetuning
- mixture-of-experts
- chain-of-thought
core_contribution: Counterfactual fairness has been well-studied for point predictors
  but remains unexplored for prediction sets. This paper bridges this gap by introducing
  Counterfactually Fair Conformal Prediction (CF-CP), a method that produces prediction
  sets invariant to counterfactual interventions on protected attributes.
---

# Counterfactually Fair Conformal Prediction

## Quick Facts
- arXiv ID: 2510.08724
- Source URL: https://arxiv.org/abs/2510.08724
- Reference count: 17
- Primary result: CF-CP produces prediction sets invariant to counterfactual interventions on protected attributes while maintaining marginal coverage and reducing unfairness compared to standard split CP.

## Executive Summary
Counterfactually Fair Conformal Prediction (CF-CP) bridges a gap in conformal prediction by extending the notion of counterfactual fairness from point predictions to prediction sets. The method achieves this by symmetrizing conformity scores across all possible counterfactual interventions on protected attributes before applying standard split conformal prediction. Under assumptions of an invertible structural causal model and exchangeability, CF-CP guarantees both marginal coverage and set-level counterfactual fairness. The approach is training-free and does not require access to the protected attribute distribution.

## Method Summary
CF-CP modifies standard split conformal prediction by computing symmetrized conformity scores that are invariant to counterfactual interventions on protected attributes. The method generates counterfactual features using an invertible structural causal model, aggregates scores across all protected attribute interventions using a permutation-invariant function (mean, max, or min), and applies standard conformal quantile thresholding. This process ensures prediction sets are identical for all counterfactual versions of an individual while maintaining the exchangeability required for coverage guarantees.

## Key Results
- CF-CP achieves target coverage rate with minimal increase in prediction set size compared to standard split CP
- CF-CP substantially reduces counterfactual unfairness (CSD) compared to standard split CP on both synthetic and real datasets
- CF-CP is training-free and does not require access to the probability distribution of the protected attribute

## Why This Works (Mechanism)

### Mechanism 1: Score Symmetrization via Counterfactual Aggregation
The method computes a counterfactual score $s_{cf}(x, a, y) = \text{Agg}(\{s(x_{A \leftarrow a'}, a', y) : a' \in A\})$. Because the multiset of counterfactual features $\{x_{A \leftarrow a'}\}$ is derived from the shared latent $U$ (recovered via an invertible SCM), the multiset is invariant to the factual $a$. Aggregating creates a single score identical for all protected attribute values. This breaks if the SCM is not invertible or counterfactual generator is inaccurate.

### Mechanism 2: Preservation of Exchangeability
Standard Split CP requires exchangeability of scores for coverage guarantees. The paper proves that applying a deterministic, measurable symmetrization function to the conformity scores preserves this exchangeability. This fails if the score function or counterfactual generator introduces dependence between data points.

### Mechanism 3: Set-Level Invariance via Thresholding
Since $s_{cf}$ is invariant to $a$ and the threshold $\hat{q}$ is constant, the prediction set $C_{\alpha} = \{y : s_{cf}(x, a, y) \le \hat{q}_{1-\alpha}\}$ is identical for all counterfactual versions of the individual. This fails if the threshold were calculated dynamically based on $a$.

## Foundational Learning

- **Split Conformal Prediction (CP)**: Why needed: CF-CP modifies standard CP. Quick check: Given 100 calibration scores, how do you calculate threshold for 90% coverage?
- **Structural Causal Models (SCMs) & Counterfactuals**: Why needed: Method requires generating counterfactual features $X_{A \leftarrow a'}$. Quick check: In SCM $X = f(A, U)$, how do you compute counterfactual $X_{A \leftarrow a'}$ while holding background factors constant?
- **Counterfactual Fairness (CF)**: Why needed: Paper extends CF definition from point predictions to prediction sets. Quick check: Does demographic parity predictor automatically satisfy counterfactual fairness?

## Architecture Onboarding

- **Component map**: Inputs -> Counterfactual Generator -> Score Symmetrizer -> Calibrator -> Inference
- **Critical path**: The Counterfactual Generator is the critical dependency. If you cannot accurately model the SCM to generate $x_{A \leftarrow a'}$, the symmetrized score will not correspond to true underlying latent $U$.
- **Design tradeoffs**: 
  - Aggregator Choice: `Mean` offers balance; `Max` produces larger thresholds but intersects sets (can be smaller if scores correlate); `Min` produces smaller thresholds but unions sets (potentially larger sets)
  - CF-CP vs Post-hoc Union: CF-CP is more efficient than naive "Union of all intervention sets" baseline
  - Training-free: CF-CP does not retrain base model $\hat{f}$
- **Failure signatures**: 
  - Non-invertible SCM: If $U$ cannot be uniquely recovered from $(X, A)$, assumption 4.1 fails
  - Empty Sets: In classification, if base model is very uncertain or `max` aggregator threshold is too tight
- **First 3 experiments**:
  1. Verify Coverage: Run CF-CP on synthetic dataset with known SCM; confirm empirical coverage $\ge 1-\alpha$
  2. Measure Fairness (CSD): Compute Counterfactual Set Disparity between sets generated for $x$ and $x_{A \leftarrow a'}$; verify near 0
  3. Efficiency Check: Compare average size of CF-CP prediction sets against "Post-hoc Union" baseline

## Open Questions the Paper Calls Out

### Open Question 1
- Question: Can CF-CP be extended to path-dependent counterfactual fairness?
- Basis: Authors explicitly state this as future direction in conclusion
- Why unresolved: Current CF-CP symmetrizes across all interventions without distinguishing causal pathways
- What evidence would resolve it: Modified CF-CP algorithm with selective path-specific interventions

### Open Question 2
- Question: How can CF-CP be generalized to dynamic settings with evolving covariates?
- Basis: Authors identify this as future direction
- Why unresolved: Current method assumes static SCM and exchangeability; temporal settings violate these
- What evidence would resolve it: Temporal CF-CP algorithm with modified exchangeability assumptions

### Open Question 3
- Question: What are theoretical fairness degradation bounds when SCM invertibility assumption is violated?
- Basis: Paper acknowledges invertibility assumption may be strong; empirical robustness tested but no theoretical bounds
- Why unresolved: No formal bounds connecting invertibility violation to counterfactual set disparity
- What evidence would resolve it: Theoretical analysis quantifying deviation bounds

### Open Question 4
- Question: Is there principled method for selecting aggregation function (mean, max, min)?
- Basis: Section 4.1 discusses tradeoffs but no theoretical guidance on optimal selection
- Why unresolved: Permutation-invariance permits infinitely many aggregators; no criteria for choosing
- What evidence would resolve it: Theoretical analysis characterizing aggregator optimality

## Limitations
- Method's effectiveness critically depends on accuracy of Structural Causal Model used to generate counterfactual features
- Cannot correct inherent biases within the base predictor; only ensures fairness of uncertainty quantification
- Assumes invertibility of SCM mapping from features to latent variables, which may be violated in practice

## Confidence

- **High Confidence**: Theoretical framework for preserving exchangeability and ensuring marginal coverage via symmetrization
- **Medium Confidence**: Claim that score symmetrization results in protected attribute-invariant score relies on SCM invertibility
- **Medium Confidence**: Experimental results demonstrating reduced counterfactual unfairness are promising but require further investigation

## Next Checks

1. **Sensitivity Analysis to SCM Accuracy**: Systematically degrade counterfactual generator accuracy and measure corresponding increase in Counterfactual Set Disparity
2. **Generalization to Complex SCMs**: Test CF-CP on datasets with hidden confounders or non-linear relationships; evaluate invertibility assumption
3. **Comparison Against Adaptive Fairness Methods**: Compare CF-CP against methods that dynamically adjust quantile threshold based on protected attribute