---
ver: rpa2
title: 'CREPE: Controlling Diffusion with Replica Exchange'
arxiv_id: '2509.23265'
source_url: https://arxiv.org/abs/2509.23265
tags:
- diffusion
- crepe
- arxiv
- samples
- replica
- transformers
- self-attention
- retrieval-augmented-generation
- instruction-tuning
- parameter-efficient-finetuning
- mixture-of-experts
- chain-of-thought
core_contribution: This paper proposes CREPE, a new inference-time control framework
  for diffusion models based on replica exchange (parallel tempering). Unlike previous
  SMC-based approaches, CREPE generates particles sequentially while maintaining parallel
  chains at different diffusion times, offering better sample diversity and online
  refinement capability.
---

# CREPE: Controlling Diffusion with Replica Exchange
## Quick Facts
- arXiv ID: 2509.23265
- Source URL: https://arxiv.org/abs/2509.23265
- Authors: Jiajun He; Paul Jeha; Peter Potaptchik; Leo Zhang; José Miguel Hernández-Lobato; Yuanqi Du; Saifuddin Syed; Francisco Vargas
- Reference count: 40
- Key outcome: CREPE achieves competitive or superior performance compared to SMC methods across various domains (molecules, images, trajectories, discrete data), particularly excelling in maintaining sample diversity and allowing flexible online constraint addition.

## Executive Summary
This paper proposes CREPE, a new inference-time control framework for diffusion models based on replica exchange (parallel tempering). Unlike previous SMC-based approaches, CREPE generates particles sequentially while maintaining parallel chains at different diffusion times, offering better sample diversity and online refinement capability. The method adapts parallel tempering to diffusion models by introducing appropriate communication and local exploration moves, enabling tasks like tempering, reward-tilting, CFG debiasing, and model composition. Experiments show CREPE achieves competitive or superior performance compared to SMC methods across various domains (molecules, images, trajectories, discrete data), particularly excelling in maintaining sample diversity and allowing flexible online constraint addition. The approach demonstrates improved inference-time scaling properties while preserving the computational efficiency of diffusion models.

## Method Summary
CREPE uses Accelerated Parallel Tempering (APT) to maintain M chains at diffusion times t₀ < ... < tₘ. It proposes swaps between adjacent chains using forward/backward proposals simulated via Euler-Maruyama, accepting swaps based on Radon-Nikodym Estimators (RNE). The method optionally includes local exploration moves (Langevin or MH steps). For CFG debiasing, CREPE applies PT only to the first 100 diffusion steps (M=100) before switching to standard denoising. The framework supports online constraint addition during sampling and allows anytime termination, distinguishing it from SMC approaches that require complete denoising trajectories.

## Key Results
- Maintains higher sample diversity than SMC-based methods by avoiding importance resampling
- Achieves competitive FID and diversity metrics in image generation tasks compared to Feynman-Kac Correctors
- Enables online constraint addition during sampling, demonstrated in trajectory stitching experiments
- Shows improved inference-time scaling properties while preserving diffusion model computational efficiency

## Why This Works (Mechanism)
### Mechanism 1: Replica Exchange for Diversity Preservation
CREPE maintains better sample diversity than SMC-based methods by replacing importance resampling with Metropolis-Hastings swap moves. SMC periodically resamples particles based on importance weights, which can eliminate diverse samples. CREPE instead runs MCMC chains at different diffusion times that exchange states via swap proposals. No particles are discarded—diversity emerges from the Markov chain's exploration rather than parallel particle survival.

### Mechanism 2: Accelerated Path-Space Swap Proposals
Accelerated PT enables communication between distant diffusion times by simulating proposal paths rather than direct state swaps. CREPE simulates forward proposal processes from time t→t' and backward proposal from t'→t, computing the Radon-Nikodym Estimator (RNE) along both paths. The acceptance probability uses path-averaged density ratios, improving acceptance when distributions overlap poorly.

### Mechanism 3: Sequential Generation with Online Refinement
CREPE supports adding/modifying constraints during sampling and permits anytime termination. SMC must complete its full denoising trajectory before returning samples. CREPE's MCMC structure produces samples at each iteration—new reward terms or constraints can be introduced mid-run, and the chain adapts to the modified target. Early termination returns the most recent target-chain sample.

## Foundational Learning
- **Parallel Tempering / Replica Exchange**
  - Why needed here: CREPE's core algorithm; understanding non-reversible swap scheduling and detailed balance is essential for implementation.
  - Quick check question: With chains at levels [0, 1, 2, 3] and non-reversible PT, which pairs swap at even iterations vs odd iterations?

- **Radon-Nikodym Derivatives for Stochastic Processes**
  - Why needed here: Computing swap acceptance requires RNE between forward/backward path measures—this is the mathematical backbone.
  - Quick check question: For discretized diffusion with K steps between t and t', what form does the RNE take in terms of transition kernels?

- **SMC vs MCMC Trade-offs in Generative Models**
  - Why needed here: CREPE positions itself against SMC; understanding when each excels guides method selection.
  - Quick check question: If you need exactly 8 high-quality samples with minimal latency, which method? If you need diverse samples and can amortize burn-in cost?

## Architecture Onboarding
- **Component map**: Annealing schedule -> Communication module -> Local exploration -> RNE calculator
- **Critical path**: 1) Initialize chains at each diffusion time level via pretrained model 2) For each PT iteration: apply swap proposals, compute acceptance via RNE, (optional) local exploration moves 3) Collect samples from t=0 chain after burn-in
- **Design tradeoffs**: More PT levels → better mixing but higher memory; fewer levels → faster but lower acceptance; include local exploration → better per-iteration quality at cost of extra score evaluations; truncate PT early (stop at t₀ > 0) → avoids small-t instability but may miss late-stage constraint satisfaction
- **Failure signatures**: Acceptance rate near zero at specific level pairs → add intermediate levels or adjust proposal drift; samples don't improve post-burn-in → proposal dynamics misaligned with target; energy metrics good but TICA shows mode collapse → histogram metrics insufficient
- **First 3 experiments**: 1) CFG debiasing on ImageNet-64 with M=100 levels, comparing FID/diversity against FKC baseline at matched NFE budget 2) Inference-time tempering on Alanine Dipeptide (800K→300K); measure TVD, W2, and TICA MMD 3) Trajectory stitching with online refinement: add intermediate waypoint constraint mid-run (e.g., at 100k iterations), measure adaptation speed via pass-rate curves

## Open Questions the Paper Calls Out
None

## Limitations
- RNE computation may become numerically unstable for very distant diffusion times or high-dimensional spaces
- Method requires careful tuning of annealing schedules and level spacing to maintain non-trivial swap acceptance rates
- Local exploration moves were omitted for images due to instability concerns, suggesting domain-specific limitations

## Confidence
- **High Confidence**: CREPE's ability to maintain sample diversity through MCMC-based sampling (versus SMC resampling) is well-supported by both theoretical framing and experimental comparisons showing improved diversity metrics.
- **Medium Confidence**: The accelerated PT mechanism's effectiveness in enabling distant-level communication is demonstrated but relies on numerical RNE calculations whose accuracy in complex settings requires further validation.
- **Medium Confidence**: Online refinement capability claims are supported by trajectory stitching experiments but limited to specific task types and may not generalize to all constraint addition scenarios.

## Next Checks
1. Test CREPE's RNE stability across varying diffusion time gaps by systematically measuring swap acceptance rates as level spacing increases, identifying the breaking point where communication fails.
2. Evaluate diversity preservation beyond burn-in by running chains for extended iterations and measuring sample diversity metrics at regular intervals to confirm sustained performance.
3. Implement the omitted local exploration moves for image tasks to identify specific numerical instabilities and test whether alternative stabilization techniques enable their safe use.